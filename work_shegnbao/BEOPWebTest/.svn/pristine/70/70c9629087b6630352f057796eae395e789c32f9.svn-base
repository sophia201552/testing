function StringBuilder(){this.data=Array("")}function Alert(targetElement,type,msg){this.element=targetElement,this.str=new StringBuilder,this.str.append('<div class="alert alert-').append(type).append(' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>').append('<div class="alert-msg">'+msg+"</div>").append("</div>"),this.$alert=$(this.str.toString())}function showDialog(url){return $.get(url).done(function(resultHtml){$("#dialogContent").html(resultHtml),$("#dialogModal").modal({})})}function clone(obj){if(null==obj||"object"!=typeof obj)return obj;var temp=obj.constructor();for(var key in obj)obj.hasOwnProperty(key)&&(temp[key]=clone(obj[key]));return temp}function tofixed(str){return parseFloat(str).toFixed(2)}if(function(root,factory){"object"==typeof exports?module.exports=factory():"function"==typeof define&&define.amd?define(factory):root.LoadingSpinner=factory()}(this,function(){"use strict";function createEl(tag,prop){var n,el=document.createElement(tag||"div");for(n in prop)el[n]=prop[n];return el}function ins(parent){for(var i=1,n=arguments.length;n>i;i++)parent.appendChild(arguments[i]);return parent}function addAnimation(alpha,trail,i,lines){var name=["opacity",trail,~~(100*alpha),i,lines].join("-"),start=.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase(),pre=prefix&&"-"+prefix+"-"||"";return animations[name]||(sheet.insertRule("@"+pre+"keyframes "+name+"{0%{opacity:"+z+"}"+start+"%{opacity:"+alpha+"}"+(start+.01)+"%{opacity:1}"+(start+trail)%100+"%{opacity:"+alpha+"}100%{opacity:"+z+"}}",sheet.cssRules.length),animations[name]=1),name}function vendor(el,prop){var pp,i,s=el.style;for(prop=prop.charAt(0).toUpperCase()+prop.slice(1),i=0;i<prefixes.length;i++)if(pp=prefixes[i]+prop,void 0!==s[pp])return pp;return void 0!==s[prop]?prop:void 0}function css(el,prop){for(var n in prop)el.style[vendor(el,n)||n]=prop[n];return el}function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i];for(var n in def)void 0===obj[n]&&(obj[n]=def[n])}return obj}function getColor(color,idx){return"string"==typeof color?color:color[idx%color.length]}function LoadingSpinner(o){this.opts=merge(o||{},LoadingSpinner.defaults,defaults)}function initVML(){function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}sheet.addRule(".spin-vml","behavior:url(#default#VML)"),LoadingSpinner.prototype.lines=function(el,o){function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml("fill",{color:getColor(o.color,i),opacity:o.opacity}),vml("stroke",{opacity:0}))))}var i,r=o.length+o.width,s=2*r,margin=2*-(o.width+o.length)+"px",g=css(grp(),{position:"absolute",top:margin,left:margin});if(o.shadow)for(i=1;i<=o.lines;i++)seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=o.lines;i++)seg(i);return ins(el,g)},LoadingSpinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild;o=o.shadow&&o.lines||0,c&&i+o<c.childNodes.length&&(c=c.childNodes[i+o],c=c&&c.firstChild,c=c&&c.firstChild,c&&(c.opacity=val))}}var useCssAnimations,prefixes=["webkit","Moz","ms","O"],animations={},sheet=function(){var el=createEl("style",{type:"text/css"});return ins(document.getElementsByTagName("head")[0],el),el.sheet||el.styleSheet}(),defaults={lines:12,length:10,width:5,radius:15,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:19,className:"spinner",top:"50%",left:"50%",position:"absolute"};LoadingSpinner.defaults={},merge(LoadingSpinner.prototype,{spin:function(target){this.stop(),this.opts.target=target;var divMask=document.createElement("div");divMask.className="spinnerMask",divMask.style.width=target.width,divMask.style.height=target.height,target.appendChild(divMask),this.divMask=divMask;{var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex});o.radius+o.length+o.width}if(css(el,{left:o.left,top:o.top}),target&&target.insertBefore(el,target.firstChild||null),el.setAttribute("role","progressbar"),self.lines(el,self.opts),!useCssAnimations){var alpha,i=0,start=(o.lines-1)*(1-o.direction)/2,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;!function anim(){i++;for(var j=0;j<o.lines;j++)alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity),self.opacity(el,j*o.direction+start,alpha,o);self.timeout=self.el&&setTimeout(anim,~~(1e3/fps))}()}return self},stop:function(){var el=this.el;return el&&(clearTimeout(this.timeout),el.parentNode&&el.parentNode.removeChild(el),this.el=void 0,this.divMask&&(this.divMask.parentNode&&this.divMask.parentNode.removeChild(this.divMask),this.el=void 0)),this},lines:function(el,o){function fill(color,shadow){return css(createEl(),{position:"absolute",width:o.length+o.width+"px",height:o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.radius+"px,0)",borderRadius:(o.corners*o.width>>1)+"px"})}for(var seg,i=0,start=(o.lines-1)*(1-o.direction)/2;i<o.lines;i++)seg=css(createEl(),{position:"absolute",top:1+~(o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,start+i*o.direction,o.lines)+" "+1/o.speed+"s linear infinite"}),o.shadow&&ins(seg,css(fill("#000","0 0 4px #000"),{top:"2px"})),ins(el,ins(seg,fill(getColor(o.color,i),"0 0 1px rgba(0,0,0,.1)")));return el},opacity:function(el,i,val){i<el.childNodes.length&&(el.childNodes[i].style.opacity=val)}});var probe=css(createEl("group"),{behavior:"url(#default#VML)"});return!vendor(probe,"transform")&&probe.adj?initVML():useCssAnimations=vendor(probe,"animation"),LoadingSpinner}),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(a){var b=a.fn.jquery.split(" ")[0].split(".");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher")}(jQuery),+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){return a(b.target).is(this)?b.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var c=a(this),e=c.data("bs.alert");e||c.data("bs.alert",e=new d(this)),"string"==typeof b&&e[b].call(c)})}var c='[data-dismiss="alert"]',d=function(b){a(b).on("click",c,this.close)};d.VERSION="3.3.0",d.TRANSITION_DURATION=150,d.prototype.close=function(b){function c(){g.detach().trigger("closed.bs.alert").remove()}var e=a(this),f=e.attr("data-target");f||(f=e.attr("href"),f=f&&f.replace(/.*(?=#[^\s]*$)/,""));var g=a(f);b&&b.preventDefault(),g.length||(g=e.closest(".alert")),g.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(g.removeClass("in"),a.support.transition&&g.hasClass("fade")?g.one("bsTransitionEnd",c).emulateTransitionEnd(d.TRANSITION_DURATION):c())};var e=a.fn.alert;a.fn.alert=b,a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",c,d.prototype.close)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof b&&b;e||d.data("bs.button",e=new c(this,f)),"toggle"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION="3.3.0",c.DEFAULTS={loadingText:"loading..."},c.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",null==f.resetText&&d.data("resetText",d[e]()),setTimeout(a.proxy(function(){d[e](null==f[b]?this.options[b]:f[b]),"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle="buttons"]');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")&&(c.prop("checked")&&this.$element.hasClass("active")?a=!1:b.find(".active").removeClass("active")),a&&c.prop("checked",!this.$element.hasClass("active")).trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active"));a&&this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(c){var d=a(c.target);d.hasClass("btn")||(d=d.closest(".btn")),b.call(d,"toggle"),c.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(b){a(b.target).closest(".btn").toggleClass("focus","focus"==b.type)})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b),g="string"==typeof b?b:f.slide;e||d.data("bs.carousel",e=new c(this,f)),"number"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=this.sliding=this.interval=this.$active=this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",a.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};c.VERSION="3.3.0",c.TRANSITION_DURATION=600,c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},c.prototype.keydown=function(a){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(".item"),this.$items.index(a||this.$active)},c.prototype.getItemForDirection=function(a,b){var c="prev"==a?-1:1,d=this.getItemIndex(b),e=(d+c)%this.$items.length;return this.$items.eq(e)},c.prototype.to=function(a){var b=this,c=this.getItemIndex(this.$active=this.$element.find(".item.active"));return a>this.$items.length-1||0>a?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){b.to(a)}):c==a?this.pause().cycle():this.slide(a>c?"next":"prev",this.$items.eq(a))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){return this.sliding?void 0:this.slide("next")},c.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},c.prototype.slide=function(b,d){var e=this.$element.find(".item.active"),f=d||this.getItemForDirection(b,e),g=this.interval,h="next"==b?"left":"right",i="next"==b?"first":"last",j=this;if(!f.length){if(!this.options.wrap)return;f=this.$element.find(".item")[i]()}if(f.hasClass("active"))return this.sliding=!1;var k=f[0],l=a.Event("slide.bs.carousel",{relatedTarget:k,direction:h});if(this.$element.trigger(l),!l.isDefaultPrevented()){if(this.sliding=!0,g&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var m=a(this.$indicators.children()[this.getItemIndex(f)]);m&&m.addClass("active")}var n=a.Event("slid.bs.carousel",{relatedTarget:k,direction:h});return a.support.transition&&this.$element.hasClass("slide")?(f.addClass(b),f[0].offsetWidth,e.addClass(h),f.addClass(h),e.one("bsTransitionEnd",function(){f.removeClass([b,h].join(" ")).addClass("active"),e.removeClass(["active",h].join(" ")),j.sliding=!1,setTimeout(function(){j.$element.trigger(n)},0)}).emulateTransitionEnd(c.TRANSITION_DURATION)):(e.removeClass("active"),f.addClass("active"),this.sliding=!1,this.$element.trigger(n)),g&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this};var e=function(c){var d,e=a(this),f=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""));if(f.hasClass("carousel")){var g=a.extend({},f.data(),e.data()),h=e.attr("data-slide-to");h&&(g.interval=!1),b.call(f,g),h&&f.data("bs.carousel").to(h),c.preventDefault()}};a(document).on("click.bs.carousel.data-api","[data-slide]",e).on("click.bs.carousel.data-api","[data-slide-to]",e),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),+function(a){"use strict";function b(b){var c,d=b.attr("data-target")||(c=b.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"");return a(d)}function c(b){return this.each(function(){var c=a(this),e=c.data("bs.collapse"),f=a.extend({},d.DEFAULTS,c.data(),"object"==typeof b&&b);!e&&f.toggle&&"show"==b&&(f.toggle=!1),e||c.data("bs.collapse",e=new d(this,f)),"string"==typeof b&&e[b]()})}var d=function(b,c){this.$element=a(b),this.options=a.extend({},d.DEFAULTS,c),this.$trigger=a(this.options.trigger).filter('[href="#'+b.id+'"], [data-target="#'+b.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};d.VERSION="3.3.0",d.TRANSITION_DURATION=350,d.DEFAULTS={toggle:!0,trigger:'[data-toggle="collapse"]'},d.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},d.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b,e=this.$parent&&this.$parent.find("> .panel").children(".in, .collapsing");if(!(e&&e.length&&(b=e.data("bs.collapse"),b&&b.transitioning))){var f=a.Event("show.bs.collapse");if(this.$element.trigger(f),!f.isDefaultPrevented()){e&&e.length&&(c.call(e,"hide"),b||e.data("bs.collapse",null));var g=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[g](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var h=function(){this.$element.removeClass("collapsing").addClass("collapse in")[g](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return h.call(this);var i=a.camelCase(["scroll",g].join("-"));this.$element.one("bsTransitionEnd",a.proxy(h,this)).emulateTransitionEnd(d.TRANSITION_DURATION)[g](this.$element[0][i])}}}},d.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var e=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return a.support.transition?void this.$element[c](0).one("bsTransitionEnd",a.proxy(e,this)).emulateTransitionEnd(d.TRANSITION_DURATION):e.call(this)}}},d.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},d.prototype.getParent=function(){return a(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(a.proxy(function(c,d){var e=a(d);this.addAriaAndCollapsedClass(b(e),e)},this)).end()},d.prototype.addAriaAndCollapsedClass=function(a,b){var c=a.hasClass("in");a.attr("aria-expanded",c),b.toggleClass("collapsed",!c).attr("aria-expanded",c)};var e=a.fn.collapse;a.fn.collapse=c,a.fn.collapse.Constructor=d,a.fn.collapse.noConflict=function(){return a.fn.collapse=e,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(d){var e=a(this);e.attr("data-target")||d.preventDefault();var f=b(e),g=f.data("bs.collapse"),h=g?"toggle":a.extend({},e.data(),{trigger:this});c.call(f,h)})}(jQuery),+function(a){"use strict";function b(b){b&&3===b.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=c(d),f={relatedTarget:this};e.hasClass("open")&&(e.trigger(b=a.Event("hide.bs.dropdown",f)),b.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger("hidden.bs.dropdown",f)))}))}function c(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function d(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".dropdown-backdrop",f='[data-toggle="dropdown"]',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.3.0",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=c(e),g=f.hasClass("open");if(b(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a('<div class="dropdown-backdrop"/>').insertAfter(a(this)).on("click",b);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger("shown.bs.dropdown",h)}return!1}},g.prototype.keydown=function(b){if(/(38|40|27|32)/.test(b.which)){var d=a(this);if(b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled")){var e=c(d),g=e.hasClass("open");if(!g&&27!=b.which||g&&27==b.which)return 27==b.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.divider):visible a",i=e.find('[role="menu"]'+h+', [role="listbox"]'+h);if(i.length){var j=i.index(b.target);38==b.which&&j>0&&j--,40==b.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=d,a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",b).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f,g.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="menu"]',g.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="listbox"]',g.prototype.keydown)}(jQuery),+function(a){"use strict";function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.3.0",c.TRANSITION_DURATION=300,c.BACKDROP_TRANSITION_DURATION=150,c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var d=this,e=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.$body.addClass("modal-open"),this.setScrollbar(),this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.backdrop(function(){var e=a.support.transition&&d.$element.hasClass("fade");d.$element.parent().length||d.$element.appendTo(d.$body),d.$element.show().scrollTop(0),e&&d.$element[0].offsetWidth,d.$element.addClass("in").attr("aria-hidden",!1),d.enforceFocus();var f=a.Event("shown.bs.modal",{relatedTarget:b});e?d.$element.find(".modal-dialog").one("bsTransitionEnd",function(){d.$element.trigger("focus").trigger(f)}).emulateTransitionEnd(c.TRANSITION_DURATION):d.$element.trigger("focus").trigger(f)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(c.TRANSITION_DURATION):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$body.removeClass("modal-open"),a.resetScrollbar(),a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var d=this,e=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var f=a.support.transition&&e;if(this.$backdrop=a('<div class="modal-backdrop '+e+'" />').prependTo(this.$element).on("click.dismiss.bs.modal",a.proxy(function(a){a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),f&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;f?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var g=function(){d.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",g).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):g()}else b&&b()},c.prototype.checkScrollbar=function(){this.scrollbarWidth=this.measureScrollbar()},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.scrollbarWidth&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},c.prototype.measureScrollbar=function(){if(document.body.clientWidth>=window.innerWidth)return 0;var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b,g=f&&f.selector;(e||"destroy"!=b)&&(g?(e||d.data("bs.tooltip",e={}),e[g]||(e[g]=new c(this,f))):e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",a,b)};c.VERSION="3.3.0",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(this.options.viewport.selector||this.options.viewport);for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c&&c.$tip&&c.$tip.is(":visible")?void(c.hoverState="in"):(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top"),f.detach().css({top:0,left:0,display:"block"}).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.options.container?a(this.options.container):this.$element.parent(),p=this.getPosition(o);h="bottom"==h&&k.bottom+m>p.bottom?"top":"top"==h&&k.top-m<p.top?"bottom":"right"==h&&k.right+l>p.width?"left":"left"==h&&k.left-l<p.left?"right":h,f.removeClass(n).addClass(h)}var q=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(q,h);var r=function(){var a=e.hoverState;e.$element.trigger("shown.bs."+e.type),e.hoverState=null,"out"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",r).emulateTransitionEnd(c.TRANSITION_DURATION):r()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top=b.top+g,b.left=b.left+h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(b){function d(){"in"!=e.hoverState&&f.detach(),e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),b&&b()}var e=this,f=this.tip(),g=a.Event("hide.bs."+this.type);return this.$element.trigger(g),g.isDefaultPrevented()?void 0:(f.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this)},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=d?{top:0,left:0}:b.offset(),g={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},h=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,g,h,f)},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.width&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),
c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type)})};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b,g=f&&f.selector;(e||"destroy"!=b)&&(g?(e||d.data("bs.popover",e={}),e[g]||(e[g]=new c(this,f))):e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.3.0",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},c.prototype.tip=function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip};var d=a.fn.popover;a.fn.popover=b,a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),+function(a){"use strict";function b(c,d){var e=a.proxy(this.process,this);this.$body=a("body"),this.$scrollElement=a(a(c).is("body")?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",e),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.3.0",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b="offset",c=0;a.isWindow(this.$scrollElement[0])||(b="position",c=this.$scrollElement.scrollTop()),this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight();var d=this;this.$body.find(this.selector).map(function(){var d=a(this),e=d.data("target")||d.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[b]().top+c,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){d.offsets.push(this[0]),d.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<e[0])return this.activeTarget=null,this.clear();for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(!e[a+1]||b<=e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,this.clear();var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")},b.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new c(this)),"string"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION="3.3.0",c.TRANSITION_DURATION=150,c.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a"),f=a.Event("hide.bs.tab",{relatedTarget:b[0]}),g=a.Event("show.bs.tab",{relatedTarget:e[0]});if(e.trigger(f),b.trigger(g),!g.isDefaultPrevented()&&!f.isDefaultPrevented()){var h=a(d);this.activate(b.closest("li"),c),this.activate(h,h.parent(),function(){e.trigger({type:"hidden.bs.tab",relatedTarget:b[0]}),b.trigger({type:"shown.bs.tab",relatedTarget:e[0]})})}}},c.prototype.activate=function(b,d,e){function f(){g.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),b.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),h?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),e&&e()}var g=d.find("> .active"),h=e&&a.support.transition&&(g.length&&g.hasClass("fade")||!!d.find("> .fade").length);g.length&&h?g.one("bsTransitionEnd",f).emulateTransitionEnd(c.TRANSITION_DURATION):f(),g.removeClass("in")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this};var e=function(c){c.preventDefault(),b.call(a(this),"show")};a(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',e).on("click.bs.tab.data-api",'[data-toggle="pill"]',e)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof b&&b;e||d.data("bs.affix",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};c.VERSION="3.3.0",c.RESET="affix affix-top affix-bottom",c.DEFAULTS={offset:0,target:window},c.prototype.getState=function(a,b,c,d){var e=this.$target.scrollTop(),f=this.$element.offset(),g=this.$target.height();if(null!=c&&"top"==this.affixed)return c>e?"top":!1;if("bottom"==this.affixed)return null!=c?e+this.unpin<=f.top?!1:"bottom":a-d>=e+g?!1:"bottom";var h=null==this.affixed,i=h?e:f.top,j=h?g:b;return null!=c&&c>=i?"top":null!=d&&i+j>=a-d?"bottom":!1},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass("affix");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b=this.$element.height(),d=this.options.offset,e=d.top,f=d.bottom,g=a("body").height();"object"!=typeof d&&(f=e=d),"function"==typeof e&&(e=d.top(this.$element)),"function"==typeof f&&(f=d.bottom(this.$element));var h=this.getState(g,b,e,f);if(this.affixed!=h){null!=this.unpin&&this.$element.css("top","");var i="affix"+(h?"-"+h:""),j=a.Event(i+".bs.affix");if(this.$element.trigger(j),j.isDefaultPrevented())return;this.affixed=h,this.unpin="bottom"==h?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(i).trigger(i.replace("affix","affixed")+".bs.affix")}"bottom"==h&&this.$element.offset({top:g-b-f})}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},null!=d.offsetBottom&&(d.offset.bottom=d.offsetBottom),null!=d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery);var FactoryIoC=function(){function FactoryIoC(strType){this.listClass=[],this.init(strType)}return FactoryIoC.prototype={init:function(strType){switch(strType){case"analysis":this.initAnalysisModule();break;case"dashboard":this.initDashboardModule()}},add:function(entityClass){this.listClass.push(entityClass)},getModel:function(strModelName){for(var i=0,len=this.listClass.length;len>i;i++)if(strModelName==this.listClass[i].name)return this.listClass[i];return null},getList:function(){return this.listClass},initAnalysisModule:function(){this.add(AnlzTendency),this.add(AnlzSpectrum),this.add(AnlzScatter),this.add(AnlzHistoryCompare),this.add(AnlzHistoryCompare_Line),this.add(AnlzStack),this.add(AnlzPieRealtime),this.add(AnlzEnergy),this.add(AnlzCluster),this.add(AnlzCluster_AHU),this.add(AnlzCluster_Chiller)},initDashboardModule:function(){this.add(ModalNone),this.add(ModalAnalysis),this.add(ModalHistoryChart),this.add(ModalHistoryChartNormal),this.add(ModalHistoryChartEnergyConsume),this.add(ModalHistoryChartYearOnYearLine),this.add(ModalHistoryChartYearOnYearBar),this.add(ModalChart),this.add(ModalRealtimePieEnegBrkd),this.add(ModalRealtimeLineOutdoor),this.add(ModalRealtimeGauge),this.add(modalRealtimeBarEnegBrkd),this.add(ModalKPIChart)}},FactoryIoC}(),beop=beop||{};beop.constant={project_img_path:"/static/images/project_img/",project_default_img:"default.jpg"};var FullScreenManager=function(){return{init:function(onChange,onError){"function"==typeof onChange&&($(document).off("webkitfullscreenchange"),$(document).on("webkitfullscreenchange",function(){onChange({isFullScreen:!!document.webkitFullscreenElement})}),$(document).off("mozfullscreenchange"),$(document).on("mozfullscreenchange",function(){onChange({isFullScreen:!!document.mozFullScreenElement})}),$(document).off("msfullscreenchange"),$(document).on("msfullscreenchange",function(){onChange({isFullScreen:!!document.msFullscreenElement})})),"function"==typeof onError&&($(document).off("webkitfullscreenerror"),$(document).on("webkitfullscreenerror",onError),$(document).off("mozfullscreenerror"),$(document).on("mozfullscreenerror",onError),$(document).off("msfullscreenerror"),$(document).on("msfullscreenerror",onError))},toggle:function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}}(),ScreenManager=function(){function ScreenManager(){}var slice=Array.prototype.slice;return ScreenManager.show=function(){if(0!==arguments.length){var screenClass=arguments[0];if("function"==typeof screenClass){var screenObj=Object.create(screenClass.prototype);ScreenCurrent&&ScreenCurrent.close(),ScreenCurrent=screenClass.apply(screenObj,slice.call(arguments,1))||screenObj,ScreenCurrent.show()}}},ScreenManager}();StringBuilder.prototype.append=function(){return this.data.push(arguments[0]),this},StringBuilder.prototype.toString=function(){return this.data.join("")},StringBuilder.prototype.getLength=function(){return this.data.length},String.prototype.format||(String.prototype.format=function(){if(void 0===arguments[0])return"";if(arguments[0].constructor===Array)var args=arguments[0];else var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return"undefined"!=typeof args[number]?args[number]:match})}),String.prototype.formatEL||(String.prototype.formatEL=function(o){var str=this.toString();if(!str||!o)return"";for(var p in o)o.hasOwnProperty(p)&&(str=str.replace(new RegExp("{"+p+"}","g"),o[p]));return str}),Alert.type={danger:"danger",warning:"warning",success:"success",info:"info"},Alert.prototype.show=function(duration){if(duration){var _this=this;setTimeout(function(){_this.close()},duration)}return $(this.element).append(this.$alert),this},Alert.prototype.close=function(){var _this=this;this.$alert.fadeOut(3e3,function(){_this.$alert.remove(),_this=null})},Alert.prototype.setMessage=function(msg){return msg?void this.$alert.find(".alert-msg").text(msg):!1},Alert.prototype.setStyle=function(style){return style&&"string"!=typeof style&&this.$alert.css(style),this},Alert.prototype.showAtTop=function(duration){this.setStyle({position:"absolute",top:0,left:0,right:0,margin:"auto",width:"50%",textAlign:"center"}),this.show(duration)},Date.prototype.format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},week={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(fmt)&&(fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(fmt)&&(fmt=fmt.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+week[this.getDay()+""]));for(var k in o)new RegExp("("+k+")").test(fmt)&&(fmt=fmt.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return fmt};var DateUtil=function(){function getWeekNumber(d){d=new Date(+d),d.setHours(0,0,0),d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1),weekNo=Math.ceil(((d-yearStart)/864e5+1)/7);return[d.getFullYear(),weekNo]}function getLastWeekNumberOf(y,w){return w-=1,0===w&&(y-=1,w=52),[y,w]}function getNextWeekNumberOf(y,w){return w+=1,53===w&&(y+=1,w=1),[y,w]}function isLeapYear(y){return"[object Date]"===Object.prototype.toString.call(y)&&(y=y.getUTCFullYear()),y%4===0&&y%100!==0||y%400===0}function daysInMonth(dt){var m=dt.getUTCMonth();return 1===m?isLeapYear(dt)?29:28:[31,28,31,30,31,30,31,31,30,31,30,31][m]}function getFirstDayOfWeek(year,week){var d=new Date(year,0,1),offset=d.getTimezoneOffset();return d.setDate(d.getDate()+4-(d.getDay()||7)),d.setTime(d.getTime()+6048e5*(week+(year==d.getFullYear()?-1:0))),d.setTime(d.getTime()+60*(d.getTimezoneOffset()-offset)*1e3),d.setDate(d.getDate()-3),d}function getDateRangeOnWeekNumber(year,week){if(year&&week){var firstDay=getFirstDayOfWeek(year,week),lastDay=new Date(firstDay);return lastDay.setDate(firstDay.getDate()+6),[firstDay,lastDay]}}function parseStringToDate(str){var tempStrs=str.split(" "),dateStrs=tempStrs[0].split("-"),year=parseInt(dateStrs[0],10),month=parseInt(dateStrs[1],10)-1,day=parseInt(dateStrs[2],10),timeStrs=tempStrs[1].split(":"),hour=timeStrs[0]?parseInt(timeStrs[0],10):0,minute=timeStrs[1]?parseInt(timeStrs[1],10):0,second=timeStrs[2]?parseInt(timeStrs[2],10):0,date=new Date(year,month,day,hour,minute,second);return date}function getMonthName(index,language){var monthList=language&&language in dateLocale.month?dateLocale.month[language].month_names:dateLocale.month.en.month_names;return monthList[index]}function getMonthNameShort(index,language){var monthList=language&&language in dateLocale.month?dateLocale.month[language].month_names_short:dateLocale.month.en.month_names_short;return monthList[index]}function getLastMonth(currentMonth){return currentMonth||(currentMonth=(new Date).getMonth()+1),1===currentMonth?12:currentMonth-1}function getNextMonth(currentMonth){return currentMonth||(currentMonth=(new Date).getMonth()+1),12===currentMonth?1:currentMonth+1}function getRelativeDateInfo(date1,date2){var value1,value2,ts,info,now=new Date,lang=I18n.type;if(!date1&&!date2)return"";switch(value1=(date1||now).valueOf(),value2=(date2||now).valueOf(),ts=Math.floor(Math.abs(value1-value2)/1e3),!0){case 60>ts:info=ts+(1===ts?" second":" seconds");break;case 3600>ts:ts=Math.floor(ts/60),info=ts+(1===ts?" minute":" minutes");break;case 86400>ts:ts=Math.floor(ts/3600),info=ts+(1===ts?" hour":" hours");break;case 31536e3>ts:ts=Math.floor(ts/86400),info=ts+(1===ts?" day":" days");break;default:ts=Math.floor(ts/31536e3),info=ts+(1===ts?" year":" years")}return info+=value1>value2?" ago":" later","zh"===lang&&(info=info.replace(/\s(seconds?|minutes?|hours?|days?|years?)\s(ago|later)$/,function($0,$1,$2){var rs="";return $1.indexOf("second")>-1&&(rs+="秒钟"),$1.indexOf("minute")>-1&&(rs+="分钟"),$1.indexOf("hour")>-1&&(rs+="小时"),$1.indexOf("day")>-1&&(rs+="天"),$1.indexOf("year")>-1&&(rs+="年"),"ago"===$2&&(rs+="前"),"later"===$2&&(rs+="后"),rs})),info}var dateLocale={month:{en:{month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],month_names_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},zh:{month_names:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],month_names_short:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]}}};return{getWeekNumber:getWeekNumber,isLeapYear:isLeapYear,daysInMonth:daysInMonth,getLastWeekNumberOf:getLastWeekNumberOf,getNextWeekNumberOf:getNextWeekNumberOf,getDateRangeOnWeekNumber:getDateRangeOnWeekNumber,getFirstDayOfWeek:getFirstDayOfWeek,parseStringToDate:parseStringToDate,getMonthName:getMonthName,getMonthNameShort:getMonthNameShort,getLastMonth:getLastMonth,getNextMonth:getNextMonth,getRelativeDateInfo:getRelativeDateInfo}}(),StringUtil=function(){function invert(obj){for(var result={},keys=Object.keys(obj),i=0,length=keys.length;length>i;i++)result[obj[keys[i]]]=keys[i];return result}function padLeft(oldStr,padNum,padStr){return padStr?Array(padNum-String(oldStr).length+1).join(padStr)+oldStr:oldStr}function htmlEscape(text){if(!text)return text;var source="(?:"+Object.keys(HTML_ENTITIES).join("|")+")",replaceRegexp=RegExp(source,"g");return text.replace(replaceRegexp,function(character){return HTML_ENTITIES[character]})}function htmlUnEscape(text){if(!text)return text;var source="(?:"+Object.keys(HTML_ENTITIES_INVERT).join("|")+")",replaceRegexp=RegExp(source,"g");return text.replace(replaceRegexp,function(character){return HTML_ENTITIES_INVERT[character]})}var HTML_ENTITIES={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;","`":"&#x60;"},HTML_ENTITIES_INVERT=invert(HTML_ENTITIES),getI18nProjectName=function(project){if(!I18n||!project)return"";var result="";switch(I18n.type){case"en":result=project.name_english;break;case"zh":result=project.name_cn;break;default:result=project.name_english}return result||""};return{padLeft:padLeft,htmlEscape:htmlEscape,htmlUnEscape:htmlUnEscape,getI18nProjectName:getI18nProjectName}}(),BEOPUtil=function(){function getFunctionName(func){if(!func||typeof func!=jsType["function"])return"";var ret=func.toString();return ret=ret.substr("function ".length),ret=ret.substr(0,ret.indexOf("("))}function isUndefined(obj){return typeof obj===jsType.undefined}var jsType={"function":typeof $.noop,number:"number",string:"string",undefined:"undefined"},projectImgPath=beop.constant.project_img_path,setRelativePosition=function($obj,$target,topOffset,leftOffset){var offset=$obj.offset(),topOffset=topOffset||10,leftOffset=leftOffset||5,top=offset.top+topOffset,left=offset.left+$obj.width()+leftOffset;$target.css({left:left,top:top})},projectDefaultImgPath=projectImgPath+beop.constant.project_default_img,getProjectImgPath=function(project){return project?project.pic?projectImgPath+project.pic:projectDefaultImgPath:void 0};return{setRelativePosition:setRelativePosition,getProjectImgPath:getProjectImgPath,getFunctionName:getFunctionName,isUndefined:isUndefined}}();!function(){var beop_tmpl_cache={};this.beopTmpl=function tmpl(str,data){var fn=/\W/.test(str)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+str.replace(/[\r\t\n]/g," ").split(/<!/).join("	").replace(/((^|!>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)!>/g,"',$1,'").split("	").join("');").split(/!>/).join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):beop_tmpl_cache[str]=beop_tmpl_cache[str]||tmpl(document.getElementById(str).innerHTML);return data?fn(data):fn}}();var SidebarMenuEffect=function(){function SidebarMenuEffect(){}return SidebarMenuEffect.prototype.init=function(center,left,right){var _this=this;this.$paneCt=$(center),this.$leftBtn=$(center).find("#leftCt"),this.$rightBtn=$(center).find("#rightCt");var container=document.getElementById("st-container"),buttons=Array.prototype.slice.call(document.querySelectorAll(".sideTrans")),refresh=function(){var leftCol=0,rightCol=0,centerCol=0,leftArrow='<span class="glyphicon glyphicon-chevron-left"></span>',rightArrow='<span class="glyphicon glyphicon-chevron-right"></span>';_this.$leftBtn.length>0&&(container.className.indexOf("st-effect-7")>0?(leftCol=2,_this.$leftBtn.removeClass("leftCtClose").addClass("leftCtOpen").html(leftArrow)):(leftCol=0,_this.$leftBtn.removeClass("leftCtOpen").addClass("leftCtClose").html(rightArrow))),_this.$rightBtn.length>0&&(container.className.indexOf("st-effect-1")>0?(rightCol=3,_this.$rightBtn.removeClass("rightCtClose").addClass("rightCtOpen").html(rightArrow)):(rightCol=0,_this.$rightBtn.removeClass("rightCtOpen").addClass("rightCtClose").html(leftArrow))),centerCol=12-leftCol-rightCol,_this.$paneCt.removeClass().addClass("col-sm-"+centerCol+" st-content")};buttons.forEach(function(el,i){{var effect=el.getAttribute("data-effect");document.getElementById("st-container").className.indexOf("st-menu-open")}el.addEventListener("click",function(ev){var target=null!=ev.target.getAttribute("data-effect")?ev.target.getAttribute("data-effect"):ev.target.parentNode.getAttribute("data-effect"),stCtClass=document.getElementById("st-container").className;stCtClass.indexOf(target)<0?(ev.stopPropagation(),ev.preventDefault(),container.classList.add(effect),setTimeout(function(){container.classList.add("st-menu-open"),refresh()},250)):(container.classList.remove(target),refresh())})})},SidebarMenuEffect}();!function(window){var unknown="-",screenSize="";if(screen.width){var width=screen.width?screen.width:"",height=screen.height?screen.height:"";screenSize+=""+width+" x "+height}var nameOffset,verOffset,ix,nVer=navigator.appVersion,nAgt=navigator.userAgent,browser=navigator.appName,version=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10);-1!=(verOffset=nAgt.indexOf("Opera"))?(browser="Opera",version=nAgt.substring(verOffset+6),-1!=(verOffset=nAgt.indexOf("Version"))&&(version=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("MSIE"))?(browser="Microsoft Internet Explorer",version=nAgt.substring(verOffset+5)):-1!=(verOffset=nAgt.indexOf("Chrome"))?(browser="Chrome",version=nAgt.substring(verOffset+7)):-1!=(verOffset=nAgt.indexOf("Safari"))?(browser="Safari",version=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(version=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Firefox"))?(browser="Firefox",version=nAgt.substring(verOffset+8)):-1!=nAgt.indexOf("Trident/")?(browser="Microsoft Internet Explorer",version=nAgt.substring(nAgt.indexOf("rv:")+3)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(browser=nAgt.substring(nameOffset,verOffset),version=nAgt.substring(verOffset+1),browser.toLowerCase()==browser.toUpperCase()&&(browser=navigator.appName)),-1!=(ix=version.indexOf(";"))&&(version=version.substring(0,ix)),-1!=(ix=version.indexOf(" "))&&(version=version.substring(0,ix)),-1!=(ix=version.indexOf(")"))&&(version=version.substring(0,ix)),majorVersion=parseInt(""+version,10),isNaN(majorVersion)&&(version=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10));var mobile=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(nVer),cookieEnabled=navigator.cookieEnabled?!0:!1;"undefined"!=typeof navigator.cookieEnabled||cookieEnabled||(document.cookie="testcookie",cookieEnabled=-1!=document.cookie.indexOf("testcookie")?!0:!1);var os=unknown,clientStrings=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var id in clientStrings){var cs=clientStrings[id];if(cs.r.test(nAgt)){os=cs.s;break}}var osVersion=unknown;switch(/Windows/.test(os)&&(osVersion=/Windows (.*)/.exec(os)[1],os="Windows"),os){case"Mac OS X":osVersion=/Mac OS X (10[\.\_\d]+)/.exec(nAgt)[1];break;case"Android":osVersion=/Android ([\.\_\d]+)/.exec(nAgt)[1];break;case"iOS":osVersion=/OS (\d+)_(\d+)_?(\d+)?/.exec(nVer),osVersion=osVersion[1]+"."+osVersion[2]+"."+(0|osVersion[3])}window.jscd={screen:screenSize,browser:browser,browserVersion:version,mobile:mobile,os:os,osVersion:osVersion,cookies:cookieEnabled}}(this);var WebAPI=function(){function WebAPI(){}return WebAPI.post=function(url,data){return $.ajax({url:url,type:"POST",data:JSON.stringify(data),contentType:"application/json"})},WebAPI.get=function(url){return $.ajax({url:url,type:"Get",contentType:"application/json"})},WebAPI.getHistoryDS=function(callback){},WebAPI.getHistory=function(callback){},WebAPI}();window.BeopCache=function(window,undefined){function Cache(){this.mode="sessionStorage"}function DSCache(){Cache.call(this,arguments),this.keyTpl="anal_{id}_{fmt}_{start}_{end}"}var TIME_STAMP={m1:6e4,m5:3e5,h1:36e5,d1:864e5};return Cache.prototype.setItem=function(key,value){return"object"==typeof value&&(value=JSON.stringify(value)),window[this.mode].setItem(key,value)},Cache.prototype.getItem=function(key){var rs=window[this.mode].getItem(key);try{rs=JSON.parse(rs)}catch(e){}return rs},Cache.prototype.removeItem=function(key){return window[this.mode].removeItem(key)},Cache.prototype.each=function(handler){for(var key,value,storage=window[this.mode],i=0,len=storage.length;len>i;i++){key=storage.key(i),value=storage.getItem(key);try{value=JSON.parse(value)}catch(e){}if(handler.call(value,key,value)===!1)break}},DSCache.prototype=Object.create(Cache.prototype),DSCache.prototype.constructor=DSCache,DSCache.prototype.set=function(data,tmFmt,tmStart,tmEnd){var id,key;"string"==typeof tmStart&&(tmStart=new Date(tmStart)),"string"==typeof tmEnd&&(tmEnd=new Date(tmEnd)),tmStart=this.formatTime(tmStart,tmFmt),tmEnd=this.formatTime(tmEnd,tmFmt);for(var i=0,len=data.list.length;len>i;i++)id=data.list[i].dsItemId,key=this.keyTpl.formatEL({id:id,fmt:tmFmt,start:tmStart.valueOf(),end:tmEnd.valueOf()}),this.merge2Cache(key,{list:[data.list[i]],timeShaft:data.timeShaft})},DSCache.prototype.get=function(id,tmFmt,tmStart,tmEnd){var key,rs,index1,index2,_this=this;return"string"==typeof tmStart&&(tmStart=new Date(tmStart)),"string"==typeof tmEnd&&(tmEnd=new Date(tmEnd)),tmStart=this.formatTime(tmStart,tmFmt),tmEnd=this.formatTime(tmEnd,tmFmt),key=this.keyTpl.formatEL({id:id,fmt:tmFmt,start:tmStart.valueOf(),end:tmEnd.valueOf()}),rs=this.getItem(key),null!==rs?rs:(tmStart=tmStart.format("yyyy-MM-dd HH:mm:ss"),tmEnd=tmEnd.format("yyyy-MM-dd HH:mm:ss"),this.each(function(key,value){return _this.isExist(key,id,tmFmt,tmStart,tmEnd)?(index1=value.timeShaft.indexOf(tmStart),index2=value.timeShaft.indexOf(tmEnd),value.list[0].data=value.list[0].data.slice(index1,index2+1),value.timeShaft=value.timeShaft.slice(index1,index2+1),rs=value,!1):void 0}),rs)},DSCache.prototype.getBatch=function(ids,tmFmt,tmStart,tmEnd){for(var find=[],rs=null,i=0,len=ids.length;len>i;i++)find=this.get(ids[i],tmFmt,tmStart,tmEnd),null!==find&&(ids.splice(i,1),i--,len--,null===rs?rs=find:rs.list.push(find.list[0]));return rs},DSCache.prototype.merge2Cache=function(newKey,newValue){var arr=newKey.split("_"),kk=[arr[0],arr[1],arr[2]].join("_"),filter=[];return this.each(function(key,value){key.indexOf(kk)>-1&&filter.push({key:key,value:value})}),0===filter.length?void this.setItem(newKey,newValue):void this.merge2group({key:newKey,value:newValue,fmt:arr[2],start:parseInt(arr[3]),end:parseInt(arr[4])},filter)},DSCache.prototype.merge2group=function(row,group){for(var arr,ts,item,start1,end1,start2,end2,srcData,timeArr=[],i=0,len=group.length;len>i;i++)arr=group[i].key.split("_"),item={key:group[i].key,fmt:arr[2],start:parseInt(arr[3]),end:parseInt(arr[4])},timeArr.push(item);if(ts=TIME_STAMP[row.fmt],ts!==undefined){for(start1=row.start-ts,end1=row.end+ts,srcData={key:row.key,value:row.value},i=0,len=timeArr.length;len>i;i++)start2=timeArr[i].start,end2=timeArr[i].end,start1>end2||start2>end1||(srcData=this.mergeData(srcData,{key:timeArr[i].key,value:this.getItem(timeArr[i].key)}));srcData!==undefined&&this.setItem(srcData.key,srcData.value)}},DSCache.prototype.mergeData=function(d1,d2){var start1,end1,start2,end2,start,end,index,data,ts,key1=d1.key,key2=d2.key,item1=d1.value,item2=d2.value,arr=key1.split("_"),dsId=arr[1],prefix=this.keyTpl.formatEL({id:arr[1],fmt:arr[2]});if(startStr1=item1.timeShaft[0],endStr1=item1.timeShaft[item1.timeShaft.length-1],startStr2=item2.timeShaft[0],endStr2=item2.timeShaft[item2.timeShaft.length-1],start1=new Date(startStr1).valueOf(),end1=new Date(endStr1).valueOf(),start2=new Date(startStr2).valueOf(),end2=new Date(endStr2).valueOf(),start=Math.min(start1,start2),end=Math.max(end1,end2),start!==start2||end!==end2){if(start===start1&&end===end1)return this.removeItem(key2),{key:key1,value:item1};if(start===start1&&end===end2){if(index=item1.timeShaft.indexOf(startStr2),-1===index)return;return data=item1.list[0].data.slice(0,index).concat(item2.list[0].data),ts=item1.timeShaft.slice(0,index).concat(item2.timeShaft),this.removeItem(key2),{key:prefix.formatEL({start:start1,end:end2}),value:{list:[{data:data,dsItemId:dsId}],timeShaft:ts}}}if(start===start2&&end===end1){if(index=item1.timeShaft.indexOf(endStr2),-1===index)return;return data=item2.list[0].data.concat(item1.list[0].data.slice(index)),ts=item2.timeShaft.concat(item1.timeShaft.slice(index)),this.removeItem(key2),{key:prefix.formatEL({start:start2,end:end1}),value:{list:[{data:data,dsItemId:dsId}],timeShaft:ts}}}}},DSCache.prototype.isExist=function(key,id,tmFmt,tmStart,tmEnd){var arr=[];return-1===key.indexOf("anal_"+id+"_"+tmFmt)?!1:(arr=key.split("_"),"string"==typeof tmStart&&(tmStart=new Date(tmStart)),"string"==typeof tmEnd&&(tmEnd=new Date(tmEnd)),tmStart=tmStart.valueOf(),tmEnd=tmEnd.valueOf(),tmStart>=parseInt(arr[3])&&tmEnd<=parseInt(arr[4])?!0:!1);

},DSCache.prototype.formatTime=function(time,fmt,mode){var ts=TIME_STAMP[fmt];return mode="up"===mode?"ceil":"floor",ts!==undefined?("string"==typeof time&&(time=new Date(time)),time=time.valueOf(),time=new Date(Math[mode](time/ts)*ts).format("d1"===fmt?"yyyy-MM-dd 00:mm:ss":"yyyy-MM-dd HH:mm:ss"),new Date(time)):void 0},{ds:new DSCache}}(window);var Internationalization=function(){function Internationalization(){this.type=localStorage.language,this.resource=JSON.parse(localStorage.i18n)}return Internationalization.prototype={getResource:function(){return this.resource},fillPage:function(){this.fill2($("[i18n]"))},fillArea:function(element){this.fill2(element.find("[i18n]"))},fillAreaAttribute:function(element,attributeName){this.fill(element.find("[i18n]["+attributeName+"]"),attributeName)},fill:function(arrElement,attributeName){for(var arrPath,text,i=0,len=arrElement.length;len>i;i++){arrPath=arrElement[i].attributes.i18n.value.split("."),text=this.resource;for(var j=0;j<arrPath.length;j++)text=text&&text[arrPath[j]];attributeName?arrElement[i].setAttribute(attributeName,text):arrElement[i].textContent=text}},getI18nValue:function(i18nKey){if(!i18nKey)return"";for(var arrPath=i18nKey.split("."),text=this.resource,j=0;j<arrPath.length;j++)text=text&&text[arrPath[j]];return text},fill2:function(arrElement){for(var i=0,len=arrElement.length;len>i;i++)for(var item,i18nValue,attrMap,i18nValue=arrElement[i].attributes.i18n,items=i18nValue.value.split(";"),j=0;j<items.length;j++)if(item=items[j])if(-1===item.indexOf("="))i18nValue=this.getI18nValue(item),arrElement[i].textContent=i18nValue;else{if(attrMap=item.split("="),!attrMap[0])continue;arrElement[i].setAttribute(attrMap[0],this.getI18nValue(attrMap[1]))}},findContent:function(strPath){for(var arrPath=strPath.split("."),text=this.resource,i=0,len=arrPath.length;len>i;i++)text=text&&text[arrPath[i]];return text}},Internationalization}(),EnergyScreen=function(){function EnergyScreen(id,store){id?this.id=id:this.id=ScreenCurrent.id,this.factoryIoC=void 0,this.factoryIoCAnalysis=void 0,this.listEntity=void 0,this.mapRefresh={},this.arrEntityOrder=void 0,this.requestPoints=[],this.configParams=void 0,this.store=store?store:void 0,this.container=void 0,this.isForReport=store?!0:!1,this.modalConfigPane=void 0,this.isConfigMode=!1,this.workerUpdate=void 0,this.paneDatasource=void 0,this.arrColor=echarts.config.color,this.spinnerRender=new LoadingSpinner({color:"#00FFFF"})}return EnergyScreen.prototype={show:function(){var _this=this;ElScreenContainer.innerHTML="",$.get("/static/views/observer/energyScreen.html").done(function(resultHtml){var divMain=document.createElement("div");divMain.className="indexContent st-pusher",divMain.innerHTML=resultHtml;var stCt=$('<div id="st-container" class="st-container">')[0];stCt.appendChild(divMain),ElScreenContainer.appendChild(stCt),_this.container=document.getElementById("paneCenter"),_this.modalConfigPane=new modalConfigurePane(document.getElementById("energyModal"),_this,"dashboard"),_this.modalConfigPane.show(),_this.init()})},close:function(){for(var key in this.listEntity)this.listEntity[key].chart&&this.listEntity[key].chart.clear();this.workerUpdate&&this.workerUpdate.terminate(),this.workerUpdate=null,this.factoryIoC=null,this.factoryIoCAnalysis=null,this.listEntity=null,this.arrEntityOrder=null,this.store=null,this.container=null,this.UNIT_WIDTH=null,this.UNIT_HEIGHT=null,AppConfig.datasource=null,$("#ulTools").html(""),this.paneDatasource&&this.paneDatasource.close&&this.paneDatasource.close()},stop:function(){this.workerUpdate&&this.workerUpdate.terminate()},init:function(){function initByData(){WebAPI.get("/datasource/get/"+AppConfig.userId).done(function(result){_this.store.group=JSON.parse(result).group,_this.paneDatasource=new DataSource(_this),AppConfig.datasource=_this.paneDatasource,_this.initIoc(),_this.initLayout(),_this.initToolBar(),_this.initWorkerForUpdating()}).always(function(e){Spinner.stop()})}var _this=this;Spinner.spin(ElScreenContainer),this.store?(initByData(),Spinner.stop()):WebAPI.get("/spring/get/"+this.id).done(function(result){_this.store=JSON.parse(result),initByData()}).error(function(e){Spinner.stop()}),$("#btnModalAdd").off("click").click(function(e){var entity=new ModalNone(_this,{id:(+new Date).toString(),spanC:6,spanR:2,modal:{type:"ModalNone"}});_this.arrEntityOrder.push(entity.entity.id),_this.listEntity[entity.entity.id]=entity,entity.render(),entity.configure()})},initToolBar:function(){var _this=this;if(!AppConfig.isMobile){if(this.isForReport)var btnMode=$("<span>").addClass("badge grow").text("sure").css("cursor","pointer").css("background-color","#5bc0de").click(function(e){_this.saveLayout()});else var btnMode=$("<span>").addClass("badge grow").text(I18n.resource.observer.widgets.CONFIG_MODE).css("cursor","pointer").css("background-color","#5bc0de").click(function(e){_this.isConfigMode?(_this.isConfigMode=!1,e.currentTarget.classList.remove("toolbar-btn-selected"),_this.saveLayout()):(_this.isConfigMode=!0,e.currentTarget.classList.add("toolbar-btn-selected"),_this.showConfigMode(),$(".sideTrans").fadeIn(),document.querySelector("#leftCt").click(),$($(".nav-header")[0]).click(),$(this).text(I18n.resource.observer.widgets.CONFIG_SAVE))});var ulTools=$("#ulTools");ulTools.html(""),btnMode.appendTo($("<li><a>")).appendTo(ulTools)}},initIoc:function(){this.factoryIoC=new FactoryIoC("dashboard"),this.factoryIoCAnalysis=new FactoryIoC("analysis")},initLayout:function(){this.listEntity={},this.arrEntityOrder=[];var side=new SidebarMenuEffect;if(side.init("#paneContent"),I18n.fillArea($("#toolBox")),this.store&&this.store.layout)for(var item,i=0;i<this.store.layout.length;i++)for(var j=0;j<this.store.layout[i].length;j++){item=this.store.layout[i][j];var modelClass,entity;if(item.modal.type&&"ModalNone"!=item.modal.type){if(modelClass=this.factoryIoC.getModel(item.modal.type),entity=new modelClass(this,item),this.listEntity[item.id]=entity,this.arrEntityOrder.push(item.id),item.modal.interval&&item.modal.interval>=0)for(var point,k=0,kLen=item.modal.points.length;kLen>k;k++)point=item.modal.points[k],this.requestPoints.indexOf(point)<0&&this.requestPoints.push(point);entity.render(),this.isForReport&&entity.configure()}else"ModalNone"==item.modal.type&&(modelClass=this.factoryIoC.getModel(item.modal.type),entity=new modelClass(this,item),this.listEntity[item.id]=entity,this.arrEntityOrder.push(item.id),entity.render(),this.isForReport&&entity.configure())}},initWorkerForUpdating:function(){this.workerUpdate=new Worker("/static/views/js/worker/workerUpdate.js"),this.workerUpdate.self=this,this.workerUpdate.addEventListener("message",this.refreshData,!0),this.workerUpdate.addEventListener("error",function(e){console.log(e)},!0),this.workerUpdate.postMessage({pointList:this.requestPoints,type:"datasourceRealtime"})},refreshData:function(e){var _this=this.self?this.self:this;if(e.data.error)new Alert(ElScreenContainer,Alert.type.danger,I18n.resource.code[e.data.error]).showAtTop(5e3);else{for(var point,i=0,iLen=e.data.length;iLen>i;i++)point=e.data[i],_this.mapRefresh[point.dsItemId]=point;var entity,arrUpdataData;for(var key in _this.listEntity)if(entity=_this.listEntity[key],"ModalNone"!=entity.entity.modal.type){arrUpdataData=[];for(var i=0,iLen=e.data.length;iLen>i;i++){var point=entity.entity.modal.points[i];point&&arrUpdataData.push(_this.mapRefresh[point])}entity.update(arrUpdataData)}}},saveLayout:function(){for(var _this=this,arrEntity=[],i=0;i<this.arrEntityOrder.length;i++)("ModalNone"==this.listEntity[this.arrEntityOrder[i]].entity.modal.type||this.listEntity[this.arrEntityOrder[i]].entity.modal.points&&0!=this.listEntity[this.arrEntityOrder[i]].entity.modal.points.length)&&arrEntity.push(this.listEntity[this.arrEntityOrder[i]].entity);var data={creatorId:AppConfig.userId,menuItemId:this.id,layout:[arrEntity]};this.store.id&&(data.id=this.store.id),Spinner.spin(ElScreenContainer),WebAPI.post("/spring/saveLayout",data).done(function(result){if(_this.isForReport){window.open("/share/db/"+AppConfig.userId+"/"+_this.id);var retCon=confirm("Your analysis result has been shared at the new brower tab.");!0===retCon&&ScreenManager.show(AnalysisScreen)}else ScreenManager.show(EnergyScreen)}).always(function(result){Spinner.stop()})},setEntity:function(entity){},replaceEntity:function(sourceId,targetId){var source=($("#divContainer_"+sourceId),$("#divContainer_"+targetId),this.listEntity[sourceId]),target=this.listEntity[targetId];source.entity.id=(+new Date).toString(),target.entity.id=(+new Date+1).toString(),this.listEntity[source.entity.id]=source,this.listEntity[target.entity.id]=target,delete this.listEntity[sourceId],delete this.listEntity[targetId],source.initContainer(targetId).configure(),target.initContainer(sourceId).configure(),this.arrEntityOrder[this.arrEntityOrder.indexOf(targetId)]=source.entity.id,this.arrEntityOrder[this.arrEntityOrder.indexOf(sourceId)]=target.entity.id},rebornEntity:function(entityParams,tragetType,targetTitle){this.removeEntity(entityParams.id),entityParams.modal.type=tragetType,entityParams.modal.title="";var modelClass=this.factoryIoC.getModel(tragetType);entityParams.spanC=modelClass.prototype.optionTemplate.minWidth,entityParams.spanR=modelClass.prototype.optionTemplate.minHeight;var entity=new modelClass(this,entityParams);this.listEntity[entity.entity.id]=entity,this.arrEntityOrder.push(entity.entity.id),entity.configure()},removeEntity:function(id){this.listEntity[id]=null,delete this.listEntity[id],this.arrEntityOrder.splice(this.arrEntityOrder.indexOf(id),1)},render:function(data){for(var key in this.listEntity)this.listEntity[key].render()},showConfigMode:function(){this.stop();for(var key in this.listEntity)this.listEntity[key].configure();this.initToolBox(),this.initDataSourcePanel()},initToolBox:function(){function getModalList(group){var $ul=$('<ul class="nav nav-list accordion-group">'),$liList=$('<li class="rows" style="display: none;">').appendTo($ul);for(var i in group)if(0==i){var $liHd=$('<li class="nav-header">').append('<i class="icon-plus icon-white"></i>'+I18n.findContent(group[i].name)).click(function(){var $otherUl=$(this).parent("ul").siblings("ul");$otherUl.find(".rows").slideUp(),$otherUl.find("i").removeClass("icon-minus").addClass("icon-plus"),$(this).next(".rows").slideToggle();var $i=$(this).find("i"),toggleClass=function(){return $i.hasClass("icon-minus")?"icon-plus icon-white":"icon-minus icon-white"}();$(this).find("i").removeClass().addClass(toggleClass)});$ul.prepend($liHd)}else{var $div=$('<div class="lyrow ui-draggable" draggable="true"> ').html(I18n.findContent(group[i].name)).attr("type",group[i].type);$div[0].ondragstart=function(e){e.dataTransfer.setData("type",$(this).attr("type")),e.dataTransfer.setData("title",$(this).text())},$liList.append($div)}return $ul}var list,template,option,$toolBox=$($(".col-sm-2")[0].children[0]),$modals=$('<div id="modalCt" class="panel-body">').appendTo($toolBox),groupList=[];list=this.factoryIoC.getList();for(var ele=0;ele<list.length;ele++)template=list[ele],option=template.prototype.optionTemplate,option&&null!=option.parent&&(groupList[option.parent]||(groupList[option.parent]=new Array),groupList[option.parent].push(option));for(var i=0;i<groupList.length;i++)$modals.append(getModalList(groupList[i]))},initDataSourcePanel:function(){var _this=this;_this.paneDatasource.show()},hideAnlsPane:function(){$("#paneCenter").hide(),$("#energyModal").hide()},showAnlsPane:function(){$("#paneCenter").show(),$("#energyModal").show()},getDSItemById:function(datasourceItemId){for(var i=0,len=this.store.datasources[0].list.length;len>i;i++)if(this.store.datasources[0].list[i].id===datasourceItemId)return this.store.datasources[0].list[i];return null},updateDataSources:function(updateData){this.store.group=updateData}},EnergyScreen}(),ElScreenContainer=document.getElementById("indexMain"),ScreenCurrent=void 0,ScreenModal=void 0,ScreenPrevious=void 0,ToolCurrent=void 0,Spinner=new LoadingSpinner({color:"#00FFFF"}),AppConfig={projectId:1,projectName:void 0,userId:void 0,account:void 0,level:void 0,projectList:void 0,isMobile:!1},I18n=void 0,start=function($,window,undefined){var InitI18nResource=function(strLanguage,isForce){""!=strLanguage&&(isForce?localStorage.isUserSelectedLanguage=strLanguage:localStorage.isUserSelectedLanguage&&(strLanguage=localStorage.isUserSelectedLanguage),$.getScript("/static/views/js/i18n/"+strLanguage+".js").done(function(e){localStorage.language=strLanguage,localStorage.i18n=JSON.stringify(i18n_resource),Init()}).error(function(e){localStorage.i18n||$.getScript("/static/views/js/i18n/en.js").done(function(e){localStorage.language="en",localStorage.i18n=JSON.stringify(i18n_resource),Init()})}))},Init=function(){var hidData=JSON.parse($("#hidData").html());AppConfig.userId=hidData.userId,I18n=new Internationalization,ScreenManager.show(EnergyScreen,hidData.menuId)};return function(){$(function(){navigator.userAgent.match(/iP(ad|hone|od)/i)&&(AppConfig.isMobile=!0),ElScreenContainer.innerHTML="",InitI18nResource(navigator.language.split("-")[0])})}}(jQuery,window),modalConfigurePane=function(){function modalConfigurePane(container,screen,modalType){_this=this,this.container=container,this.screen=screen,this.modalType=modalType,this.templateObj=void 0,this.optionType=void 0,this.option=void 0}var _this;return modalConfigurePane.prototype={show:function(){$.get("/static/views/observer/widgets/modalConfigurePane.html").done(function(resultHtml){_this.container.innerHTML+=resultHtml,"dataAnalysis"==_this.modalType?document.getElementById("startConfig").setAttribute("i18n","modalConfig.btnStartConfig.TYPE1"):"dashboard"==_this.modalType&&document.getElementById("startConfig").setAttribute("i18n","modalConfig.btnStartConfig.TYPE2"),I18n.fillArea($("#modalConfig"))})},showModalInit:function(optionType,option,templateObj){if(this.optionType=optionType,this.option=option,this.templateObj=templateObj,!_this.option.dataTypeMaxNum){_this.option.dataTypeMaxNum=[];for(var i=0;i<this.option.rowDataType.length;i++)_this.option.dataTypeMaxNum[i]=5}this.init(),$("#modalConfig").modal("show")},init:function(){var $modalConfig=$("#modalConfig");$modalConfig.off("show.bs.modal").on("show.bs.modal",function(e){return"bs.modal"!==e.namespace?!0:(_this.initOption(),_this.initConfigData(),$("#inputAddGroup").click(function(e){$(e.target).focus()}),void("dashboard"==_this.modalType&&_this.toggleDataSource(!0)))}),$modalConfig.off("shown.bs.modal").on("shown.bs.modal",function(){_this.initTime(),_this.initDrag(),_this.initConfigStart()}),$modalConfig.off("hidden.bs.modal").on("hidden.bs.modal",function(){$modalConfig.find("#dataConfig").html('<div><span I18n="modalConfig.data.DATA_CONFIG_TITLE"></span></div>'),I18n.fillArea($modalConfig.find("#dataConfig")),"dashboard"==_this.modalType&&_this.toggleDataSource(!1)})},toggleDataSource:function(bool){var colCount=$("#paneContent")[0].classList.contains("col-sm-10");bool&&colCount&&document.getElementById("rightCt").click(),bool||colCount||document.getElementById("rightCt").click()},initDataTypeWidth:function(ele){ele.addClass(window.innerWidth>1200?ele.outerWidth()<ele.parent().outerWidth()/4?"col-lg-3":ele.outerWidth()<ele.parent().outerWidth()/2?"col-lg-6":ele.outerWidth()<3*ele.parent().outerWidth()/4?"col-lg-9":"col-lg-12":ele.outerWidth()<ele.parent().outerWidth()/3?"col-xs-4":ele.outerWidth()<2*ele.parent().outerWidth()/3?"col-xs-8":"col-xs-12")},initOption:function(){function initMode(mode){sessionStorage.setItem("mode",$inputMode.val()),$divMode.siblings().css("display","none"),$inputInterval.children().removeClass("forbid");for(var i=0;i<totalModeType[mode].length;i++)totalModeType[mode][i].css("display","block");switch(mode){case"easy":initPeriodDropDown(mode),initInterval(mode);break;case"recent":initInterval(mode);break;case"easyEnergy":initPeriodDropDown(mode),initInterval(mode);break;case"compareSensor":initCompareDate();break;case"compareMeter":initCompareDate();break;case"weather":$dataConfig.css("display","none"),$startConfig.addClass("alwaysEnable");break;case"easyCompareAnalyz":$inputComparePeriod.val("month"),initCompareDate();break;case"easyCompare":$inputComparePeriod.val("day")}}function initInterval(mode){if($inputInterval.children().addClass("forbid"),"recent"==mode){switch($inputPeriodUnit.children(":selected").val()){case"second":firstSelect="m5",secondSelect="m1";break;case"minute":firstSelect="m5",secondSelect="m1";break;case"hour":firstSelect="h1",secondSelect="m5";break;case"day":firstSelect="d1",secondSelect="h1";break;case"month":firstSelect="M1",secondSelect="d1"}$inputInterval.find('option[value="'+secondSelect+'"]').removeClass("forbid")}if("easy"==mode)switch($inputPeriodDropDown.val()){case"today":firstSelect="h1";break;case"yesterday":firstSelect="h1";break;case"thisWeek":firstSelect="d1";break;case"lastWeek":firstSelect="d1";break;case"thisYear":firstSelect="M1"}$inputInterval.find('option[value="'+firstSelect+'"]').removeClass("forbid").attr("selected",!0),sessionStorage.setItem("interval",$inputInterval.val())}function initPeriodDropDown(mode){$inputPeriodDropDown.children("").removeClass("forbid"),"easy"==mode?$inputPeriodDropDown.children().eq(1).addClass("forbid"):"easyEnergy"==mode&&($inputPeriodDropDown.children().eq(2).addClass("forbid"),$inputPeriodDropDown.children().eq(4).addClass("forbid"),$inputPeriodDropDown.children().eq(5).addClass("forbid"))}function initCompareDate(){var $compareDate=$(".form_datetime.compare"),periodType=$inputComparePeriod.val();switch(periodType){case"hour":$compareDate.datetimepicker("remove"),$compareDate.datetimepicker({format:"yyyy-mm-dd hh:ii:ss",minView:"day",startView:"day",autoclose:!0,todayBtn:!0,initialDate:new Date});break;case"day":$compareDate.datetimepicker("remove"),$compareDate.datetimepicker({format:"yyyy-mm-dd",minView:"month",startView:"month",autoclose:!0,todayBtn:!0,initialDate:new Date});break;case"week":$compareDate.datetimepicker("remove"),$compareDate.datetimepicker({format:"yyyy-mm-dd",minView:"month",startView:"month",autoclose:!0,todayBtn:!0,initialDate:new Date});break;case"month":$compareDate.datetimepicker("remove"),$compareDate.datetimepicker({format:"yyyy-mm-dd",minView:"year",startView:"year",autoclose:!0,todayBtn:!0,initialDate:new Date})}}function initGaugeMode(){var green='<span class="input-group-addon gaugeGreen" i18n="modalConfig.option.GAUGE_GREEN"></span>',red='<span class="input-group-addon gaugeRed" i18n="modalConfig.option.GAUGE_RED"></span>';"high"==$gaugeMode.val()?($gaugeLowerLimit.next().remove(),$gaugeLowerLimit.after(green),$normalUpperLimit.next().remove(),$normalUpperLimit.after(red)):"low"==$gaugeMode.val()&&($gaugeLowerLimit.next().remove(),$gaugeLowerLimit.after(red),$normalUpperLimit.next().remove(),$normalUpperLimit.after(green)),I18n.fillArea($("#divGauge"))}var i,$inputMode=$("#inputMode"),$divMode=$inputMode.parent(),$inputInterval=$("#inputInterval"),$divInterval=$inputInterval.parent(),$divInputGroupPeriod=$("#divInputGroupPeriod"),$divPeriod=$divInputGroupPeriod.parent(),$inputPeriodUnit=$("#inputPeriodUnit"),$inputPeriodValue=$("#inputPeriodValue"),$inputPeriodDropDown=$("#inputPeriodDropDown"),$divPeriodDropDown=$inputPeriodDropDown.parent(),$divInputGroupTimeRange=$("#divInputGroupTimeRange"),$divTimeRange=$divInputGroupTimeRange.parent(),$inputTimeStart=$("#inputTimeStart"),$inputTimeEnd=$("#inputTimeEnd"),$gaugeMode=$("#gaugeMode"),$divGaugeMode=$gaugeMode.parent(),$divGauge=$("#divGauge"),$gaugeLowerLimit=$("#gaugeLowerLimit"),$gaugeUpperLimit=$("#gaugeUpperLimit"),$normalLowerLimit=$("#normalLowerLimit"),$normalUpperLimit=$("#normalUpperLimit"),$inputComparePeriod=$("#inputComparePeriod"),$divComparePeriod=$inputComparePeriod.parent(),$divCompareDate=($("#inputCompareDate1"),$("#inputCompareDate2"),$("#divCompareDate")),$inputRealTimeInterval=$("#inputRealTimeInterval"),$divRealTimeInterval=$inputRealTimeInterval.parent(),$divHistoryRange=$("#divHistoryRange"),$inputHistoryRange=$("#inputHistoryRange"),totalModeType={easy:[$divPeriodDropDown],fixed:[$divInterval,$divTimeRange],recent:[$divInterval,$divPeriod],realTime:[],easyEnergy:[$divPeriodDropDown],realTimeDashboard:[$divRealTimeInterval],easyCompareAnalyz:[$divCompareDate],easyCompare:[$divComparePeriod],compareSensor:[$divInterval,$divComparePeriod,$divCompareDate],compareMeter:[$divInterval,$divComparePeriod,$divCompareDate],gauge:[$divGauge,$divGaugeMode],weather:[],easyHistory:[$divHistoryRange]},$dataConfig=$("#dataConfig"),$startConfig=$("#startConfig");$dataConfig.css("display","block"),$startConfig.removeClass("alwaysEnable"),$inputMode.children().css("display","none");var modeSelectInit=!1;for(i=0;i<_this.option.modeUsable.length;i++)$inputMode.children("option[value="+_this.option.modeUsable[i]+"]").css("display","block"),_this.optionType?sessionStorage.getItem("mode")!=_this.option.modeUsable[i]||modeSelectInit||($inputMode.val(_this.option.modeUsable[i]),modeSelectInit=!0):"fixed"!=_this.option.modeUsable[i]||modeSelectInit||($inputMode.val("fixed"),modeSelectInit=!0);modeSelectInit||$inputMode.val(_this.option.modeUsable[0]),this.optionType?null!=sessionStorage.getItem("interval")?$inputInterval.val($inputInterval.children('option[value="'+sessionStorage.getItem("interval")+'"]').hasClass("forbid")?$inputInterval.children(":not(.forbid)").first():sessionStorage.getItem("interval")):sessionStorage.setItem("interval",$inputInterval.val()):$inputInterval.val(_this.option.optionPara.interval?_this.option.optionPara.interval:$inputInterval.children(":not(.forbid)").first()),$inputInterval.change(function(e){sessionStorage.setItem("interval",$(e.target).val())});var firstSelect,secondSelect;this.optionType&&(sessionStorage.getItem("periodValue")&&$inputPeriodValue.val(sessionStorage.getItem("periodValue")),sessionStorage.getItem("periodUnit")&&$inputPeriodUnit.val(sessionStorage.getItem("periodUnit")),sessionStorage.getItem("periodDropDown")&&($inputPeriodDropDown.children('option[value="'+sessionStorage.getItem("periodDropDown")+'"]').hasClass("forbid")&&$inputPeriodDropDown.val($inputPeriodDropDown.children(":not(.forbid)").first()),$inputPeriodDropDown.val(sessionStorage.getItem("periodDropDown")))),$inputPeriodValue.off("change").change(function(e){sessionStorage.setItem("periodValue",e.target.value)}),$inputPeriodUnit.off("change").change(function(e){sessionStorage.setItem("periodUnit",e.target.value),initInterval($inputMode.val())}),$divPeriodDropDown.off("change").change(function(e){sessionStorage.setItem("periodDropDown",e.target.value),initInterval($inputMode.val())}),$inputTimeStart.val(_this.optionType&&null!=sessionStorage.getItem("timeStart")?sessionStorage.getItem("timeStart"):_this.option.optionPara.startTime),$inputTimeStart.change(function(e){""!=e.target.value&&sessionStorage.setItem("timeStart",e.target.value)}),$inputTimeEnd.val(_this.optionType&&null!=sessionStorage.getItem("timeEnd")?sessionStorage.getItem("timeEnd"):_this.option.optionPara.endTime),$inputTimeEnd.change(function(e){""!=e.target.value&&sessionStorage.setItem("timeEnd",e.target.value)}),_this.option.optionPara.timeType&&"easyCompare"==$inputMode.val()?$inputComparePeriod.val(_this.option.optionPara.timeType):null!=sessionStorage.getItem("comparePeriod")&&$inputComparePeriod.val(sessionStorage.getItem("comparePeriod")),$inputComparePeriod.change(function(){sessionStorage.setItem("comparePeriod",$inputComparePeriod.val()),initCompareDate()}),null!=sessionStorage.getItem("gaugeMode")&&$gaugeMode.val(sessionStorage.getItem("gaugeMode")),$gaugeMode.change(function(){sessionStorage.setItem("gaugeMode",$gaugeMode.val())}),initGaugeMode(),$gaugeMode.change(function(){initGaugeMode()}),_this.option.optionPara.scaleList&&_this.option.optionPara.scaleList.sort(function(a,b){return a>b?1:-1}),_this.optionType&&null!=sessionStorage.getItem("gaugeLowerLimit")?$gaugeLowerLimit.val(sessionStorage.getItem("gaugeLowerLimit")):!_this.optionType&&_this.option.optionPara.scaleList&&$gaugeLowerLimit.val(_this.option.optionPara.scaleList[0]),$gaugeLowerLimit.change(function(){sessionStorage.setItem("gaugeLowerLimit",$gaugeLowerLimit.val())}),_this.optionType&&null!=sessionStorage.getItem("gaugeUpperLimit")?$gaugeUpperLimit.val(sessionStorage.getItem("gaugeUpperLimit")):!_this.optionType&&_this.option.optionPara.scaleList&&$gaugeUpperLimit.val(_this.option.optionPara.scaleList[3]),$gaugeUpperLimit.change(function(){sessionStorage.setItem("gaugeUpperLimit",$gaugeUpperLimit.val())}),_this.optionType&&null!=sessionStorage.getItem("normalLowerLimit")?$normalLowerLimit.val(sessionStorage.getItem("normalLowerLimit")):!_this.optionType&&_this.option.optionPara.scaleList&&$normalLowerLimit.val(_this.option.optionPara.scaleList[1]),$normalLowerLimit.change(function(){sessionStorage.setItem("normalLowerLimit",$normalLowerLimit.val())}),_this.optionType&&null!=sessionStorage.getItem("normalUpperLimit")?$normalUpperLimit.val(sessionStorage.getItem("normalUpperLimit")):!_this.optionType&&_this.option.optionPara.scaleList&&$normalUpperLimit.val(_this.option.optionPara.scaleList[2]),$normalUpperLimit.change(function(){sessionStorage.setItem("normalUpperLimit",$normalUpperLimit.val())}),_this.option.optionPara.timeType&&"realTimeDashboard"==$inputMode.val()?$inputHistoryRange.val(_this.option.optionPara.timeType):null!=sessionStorage.getItem("historyRange")&&$inputHistoryRange.val(sessionStorage.getItem("historyRange")),$inputHistoryRange.change(function(){sessionStorage.setItem("historyRange",$inputHistoryRange.val())}),_this.option.optionPara.timeType&&"easyHistory"==$inputMode.val()?$inputHistoryRange.val(_this.option.optionPara.timeType):null!=sessionStorage.getItem("historyRange")&&$inputHistoryRange.val(sessionStorage.getItem("historyRange")),$inputHistoryRange.change(function(){sessionStorage.setItem("historyRange",$inputHistoryRange.val())}),initMode($inputMode.val()),$inputMode.change(function(e){initMode($inputMode.val())})},initConfigData:function(){function initDataTipAndButton(){for(var NumOfDataTypeWithValue=0,$rowDataValue=$(".rowDataValue"),i=0;i<$rowDataValue.length;++i)$rowDataValue.eq(i).children().length>1&&(NumOfDataTypeWithValue+=1),$rowDataValue.eq(i).children().length>_this.option.dataTypeMaxNum[i]?$(".dataDragTip").get(i).style.display="none":$(".dataDragTip").get(i).style.display="block";1==_this.option.allDataNeed?NumOfDataTypeWithValue==$rowDataValue.length?$("#startConfig").removeClass("disabled"):$("#startConfig").addClass("disabled"):NumOfDataTypeWithValue?$("#startConfig").removeClass("disabled"):$("#startConfig").addClass("disabled")}for(var $dataConfig=$("#dataConfig"),strTempDataMaxNum="<span>"+I18n.resource.modalConfig.data.DATA_TYPE_MAX_NUM+"</span>",arrTempDataMaxNum=[],i=0;i<_this.option.dataTypeMaxNum.length;++i)arrTempDataMaxNum.push(strTempDataMaxNum.replace("<%maxNum%>",_this.option.dataTypeMaxNum[i]));for(var strConfigModalBody=$dataConfig.html(),i=0;i<_this.option.rowDataType.length;++i)strConfigModalBody+='<div class="divConfigData" dataType="'+_this.option.rowDataType[i]+'">\r\n                                                <div class="dataTypeName">'+_this.option.rowDataType[i]+arrTempDataMaxNum[i]+'</div>\r\n                                                <div class="row rowDataValue"><div class="dataDragTip col-lg-3 col-xs-4"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></div></div>\r\n                                    </div>';$dataConfig.html(strConfigModalBody);var btnStartConfigEnable;for(i=0;i<_this.option.optionPara.dataItem.length;++i){var $dataDragTip=$dataConfig.find('[dataType="'+_this.option.optionPara.dataItem[i].dsType+'"]').find(".dataDragTip");0==$dataDragTip.length&&($dataDragTip=$(".dataDragTip").eq(i));for(var strDSConfig,j=0;j<_this.option.optionPara.dataItem[i].dsId.length;++j)strDSConfig='<div class="col-lg-3 col-xs-4 divDSConfigure grow" dsid="'+_this.option.optionPara.dataItem[i].dsId[j]+'"><span class="contentDS">'+_this.option.optionPara.dataItem[i].dsName[j]+'</span><span class="glyphicon glyphicon-remove btnRemoveDS" aria-hidden="true" ></span></div>',$dataDragTip.before(strDSConfig),btnStartConfigEnable=!0}initDataTipAndButton(),$(".alwaysEnable").removeClass("disabled"),$(".divDSConfigure span").on("click",function(e){var $thisPar=$(e.target).parent();$thisPar.remove(),initDataTipAndButton()})},initTime:function(){var $inputTimeStart=$("#inputTimeStart"),$inputTimeEnd=$("#inputTimeEnd");if($inputTimeStart.datetimepicker({format:"yyyy-mm-dd hh:ii",minView:"hour",autoclose:!0,todayBtn:!0,initialDate:new Date}),$inputTimeEnd.datetimepicker({format:"yyyy-mm-dd hh:ii",minView:"hour",autoclose:!0,todayBtn:!0,initialDate:new Date}),_this.optionType){var now=new Date,time=new Date(now-2592e5).format("yyyy-MM-dd HH:mm");sessionStorage.getItem("timeStart")||$inputTimeStart.val(time),now=now.format("yyyy-MM-dd HH:mm"),sessionStorage.getItem("timeEnd")||$inputTimeEnd.val(now)}var mode=$("#inputMode").val();"easyCompareAnalyz"==mode&&($("#inputCompareDate1").val(new Date(new Date((new Date).setMonth((new Date).getMonth()-2)).setDate(1)).format("yyyy-MM-dd")+" 00:00:00"),$("#inputCompareDate2").val(new Date(new Date((new Date).setMonth((new Date).getMonth()-1)).setDate(1)).format("yyyy-MM-dd")+" 00:00:00")),("compareMeter"==mode||"compareSensor"==mode)&&$("#inputComparePeriod").change(function(){$(this).val()})},initDrag:function(){function initBtnStartAndDragTip(indexOfDataType){var tempDivDS=$divConfigData.find(".rowDataValue").eq(indexOfDataType).children();if(1==_this.option.allDataNeed){initBtnStartEnable=!0;for(var i=0;i<$divConfigData.length;++i)if($divConfigData.find(".rowDataValue").eq(i).children().length<=1){initBtnStartEnable=!1;break}tempDivDS.length>1?tempDivDS.length>_this.option.dataTypeMaxNum[indexOfDataType]?initDragTipShow[indexOfDataType]=!1:initDragTipShow[indexOfDataType]=!0:(initBtnStartEnable-=1,initDragTipShow[indexOfDataType]=!0)}else initBtnStartEnable=$divConfigData.find(".divDSConfigure").length>0?!0:!1,tempDivDS.length>_this.option.dataTypeMaxNum[indexOfDataType]?initDragTipShow[indexOfDataType]=!1:initDragTipShow[indexOfDataType]=!0;initBtnStartEnable>0?$btnConfigStart.removeClass("disabled"):$btnConfigStart.addClass("disabled"),initDragTipShow[indexOfDataType]?tempDivDS.last().css("display","block"):tempDivDS.last().css("display","none")}var $divConfigData=$(".divConfigData"),$btnConfigStart=$("#startConfig"),_this=this;$divConfigData.on("dragover",function(e){e.preventDefault(),$(e.currentTarget).find(".dataDragTip").addClass("addData")}),$divConfigData.on("dragleave",function(e){e.preventDefault(),$(e.currentTarget).find(".dataDragTip").removeClass("addData")});var targetId,targetContent,initBtnStartEnable,index,initDragTipShow=[];$divConfigData.on("drop",function(e){for(var j=0;j<$divConfigData.length;++j)$divConfigData.find(".rowDataValue").eq(j).children().length<_this.option.dataTypeMaxNum[j]+1?initDragTipShow[j]=!0:initDragTipShow[j]=!1;if(index=$(e.currentTarget).index()-1,!initDragTipShow[index])return void new Alert($("#configAlert"),"danger","<strong>"+I18n.resource.modalConfig.err.TYPE1+"</strong>").show().close();var $rowTempData=$(e.currentTarget).find(".rowDataValue"),$dataDragTip=$rowTempData.find(".dataDragTip");if(targetId=e.originalEvent.dataTransfer.getData("dsItemId"),""!=targetId){if(targetContent=AppConfig.datasource.getDSItemById(targetId).alias,$rowTempData.find('.divDSConfigure[dsid="'+targetId+'"]').length>0)return void new Alert($("#configAlert"),"danger","<strong>"+I18n.resource.modalConfig.err.TYPE2+"</strong>").show().close();var strDSConfig='<div class="col-lg-3 col-xs-4 divDSConfigure grow" dsid="'+targetId+'"><span class="contentDS">'+targetContent+'</span><span class="glyphicon glyphicon-remove btnRemoveDS" aria-hidden="true" ></span></div>';$dataDragTip.before(strDSConfig),initBtnStartAndDragTip(index),
$(e.currentTarget).find(".divDSConfigure span").last().on("click",function(e){{var $thisPar=$(e.target).parent();$thisPar.attr("dsid")}$thisPar.remove(),initBtnStartAndDragTip(index);var $dataConfig=$("#dataConfig");$dataConfig.height(""),$dataConfig.height()>window.innerHeight-80&&$dataConfig.css("height","100%")});var $dataConfig=$("#dataConfig");$dataConfig.height(""),$dataConfig.height()>window.innerHeight-80&&$dataConfig.css("height","100%")}})},initConfigStart:function(){var $modalConfig=$("#modalConfig"),$inputModal=$("#inputMode");document.getElementById("startConfig").onclick=function(){function getTimeOfMidnightZero(date){var tempDate;return tempDate=date?date:new Date,new Date(date.format("yyyy-MM-dd")+" 00:00:00")}for(var tempStartTime,tempEndTime,tempPeriodTime,tempDSId,tempDS,timeType,scaleList,now,tempInterval=0,$inputPeriodValue=$("#inputPeriodValue"),periodValue=$inputPeriodValue.val(),arrItemDS=[],$rowDataValue=$(".rowDataValue"),$inputInterval=$("#inputInterval"),$inputTimeStart=$("#inputTimeStart"),$inputTimeEnd=$("#inputTimeEnd"),$inputPeriodUnit=$("#inputPeriodUnit"),$inputPeriodDropDown=$("#inputPeriodDropDown"),$inputCompareDate1=$("#inputCompareDate1"),$inputCompareDate2=$("#inputCompareDate2"),$inputComparePeriod=$("#inputComparePeriod"),$gaugeMode=$("#gaugeMode"),$gaugeLowerLimit=$("#gaugeLowerLimit"),$gaugeUpperLimit=$("#gaugeUpperLimit"),$normalLowerLimit=$("#normalLowerLimit"),$normalUpperLimit=$("#normalUpperLimit"),i=0;i<$rowDataValue.length;++i){tempDS={},tempDS.type=$rowDataValue[i].parentNode.getAttribute("dataType"),tempDSId=[];for(var j=0;j<$rowDataValue[i].children.length-1;++j)tempDSId.push($rowDataValue[i].children[j].getAttribute("dsid"));tempDS.arrId=tempDSId,arrItemDS.push(tempDS)}var totalModeType={easy:"easy",fixed:"fixed",recent:"recent",realTime:"realTime",easyCompareAnalyz:"easyCompareAnalyz",easyCompare:"easyCompare",compareSensor:"compareSensor",compareMeter:"compareMeter",realTimeDashboard:"realTimeDashboard",gauge:"gauge",weather:"weather",easyHistory:"easyHistory"};switch($inputModal.val()){case totalModeType.fixed:if(tempStartTime=new Date($inputTimeStart.val()).format("yyyy-MM-dd HH:mm:ss"),tempEndTime=new Date($inputTimeEnd.val()).format("yyyy-MM-dd HH:mm:ss"),new Date(tempStartTime)>=new Date(tempEndTime))return void new Alert($("#configAlert"),"danger","<strong>"+I18n.resource.modalConfig.err.TYPE3+"</strong>").show().close();if(new Date(tempEndTime)>=new Date)return void new Alert($("#configAlert"),"danger","<strong>"+I18n.resource.modalConfig.err.TYPE4+"</strong>").show().close();break;case totalModeType.recent:switch(tempEndTime=(new Date).format("yyyy-MM-dd HH:mm:ss"),$inputPeriodUnit.val()){case"hour":tempPeriodTime=36e5*periodValue;break;case"day":tempPeriodTime=864e5*periodValue;break;case"month":tempPeriodTime=2592e6*periodValue;break;case"year":tempPeriodTime=31536e6*periodValue}now=new Date,tempStartTime=new Date(now-tempPeriodTime).format("yyyy-MM-dd HH:mm:ss");break;case totalModeType.realTime:tempStartTime="",tempEndTime="";break;case totalModeType.easy:switch(now=new Date,$inputPeriodDropDown.val()){case"today":tempPeriodTime=864e5,tempEndTime=now.format("yyyy-MM-dd HH:mm:ss"),tempStartTime=new Date(now-tempPeriodTime).format("yyyy-MM-dd HH:mm:ss");break;case"yesterday":var yesterday=new Date;yesterday=new Date(yesterday.setDate(yesterday.getDate()-1)),tempEndTime=new Date(getTimeOfMidnightZero(now).getTime()-1e3).format("yyyy-MM-dd HH:mm:ss"),tempStartTime=getTimeOfMidnightZero(yesterday).format("yyyy-MM-dd HH:mm:ss");break;case"thisWeek":tempPeriodTime=6048e5,tempEndTime=now.format("yyyy-MM-dd HH:mm:ss"),tempStartTime=new Date(now-tempPeriodTime).format("yyyy-MM-dd HH:mm:ss");break;case"lastWeek":tempPeriodTime=6048e5,tempEndTime=getTimeOfMidnightZero(new Date(now-864e5*(now.getDay()+1))).format("yyyy-MM-dd HH:mm:ss"),tempStartTime=getTimeOfMidnightZero(new Date(now-864e5*(now.getDay()+7))).format("yyyy-MM-dd HH:mm:ss");break;case"thisYear":tempPeriodTime=31536e6,tempEndTime=now.format("yyyy-MM-dd HH:mm:ss"),tempStartTime=new Date(now-tempPeriodTime).format("yyyy-MM-dd HH:mm:ss")}break;case totalModeType.realTimeDashboard:tempStartTime="",tempEndTime="",tempInterval=$inputInterval.val(),timeType=$("#inputRealTimeInterval").val();break;case totalModeType.easyCompareAnalyz:tempStartTime=$inputCompareDate1.val(),tempEndTime=$inputCompareDate2.val(),tempPeriodTime="month",$inputInterval.val("h1"),timeType=$inputComparePeriod.val();break;case totalModeType.easyCompare:tempPeriodTime="month",$inputInterval.val("h1"),timeType=$inputComparePeriod.val();break;case totalModeType.compareSensor:tempStartTime=$inputCompareDate1.val(),tempEndTime=$inputCompareDate2.val(),tempPeriodTime=$inputComparePeriod.val(),timeType=$inputComparePeriod.val();break;case totalModeType.compareMeter:tempStartTime=$inputCompareDate1.val(),tempEndTime=$inputCompareDate2.val(),tempPeriodTime=$inputComparePeriod.val(),timeType=$inputComparePeriod.val();break;case totalModeType.gauge:for(scaleList="high"==$gaugeMode.val()?[$gaugeLowerLimit.val(),$normalLowerLimit.val(),$normalUpperLimit.val(),$gaugeUpperLimit.val()]:[$gaugeUpperLimit.val(),$normalUpperLimit.val(),$normalLowerLimit.val(),$gaugeLowerLimit.val()],i=0;i<scaleList.length;i++){if(isNaN(Number(scaleList[i])))return void new Alert($("#configAlert"),"danger","<strong>"+I18n.resource.modalConfig.err.TYPE10+"</strong>").show().close();scaleList[i]=parseFloat(scaleList[i])}var tempArr=scaleList.concat();if(tempArr.sort("high"==$gaugeMode.val()?function(a,b){return a>b?1:-1}:function(a,b){return b>a?1:-1}),tempArr.toString()!=scaleList.toString())return void new Alert($("#configAlert"),"danger","<strong>"+I18n.resource.modalConfig.err.TYPE5+"</strong>").show().close();break;case totalModeType.weather:tempStartTime="",tempEndTime="";break;case totalModeType.easyHistory:timeType=$("#inputHistoryRange").val()}if("dataAnalysis"==_this.modalType)_this.screen.curModal={startTime:tempStartTime,endTime:tempEndTime,format:$inputInterval.val(),mode:$inputModal.val(),type:_this.option.templateType,itemDS:arrItemDS,comparePeriod:tempPeriodTime};else if("dashboard"==_this.modalType){_this.templateObj.configParams={};var $divDSConfigure=$(".divDSConfigure");_this.templateObj.entity.modal.title=$(".springSel .chartTitle").val(),_this.templateObj.entity.modal.points=[],_this.templateObj.entity.modal.StartTime=tempStartTime,_this.templateObj.entity.modal.EndTime=tempEndTime;for(var i=0;i<$divDSConfigure.length;++i)_this.templateObj.entity.modal.points.push($divDSConfigure.get(i).attributes.dsid.value);var option={};timeType&&(option.timeType=timeType),scaleList&&(option.scaleList=scaleList)}$modalConfig.modal("hide"),_this.newPageFlag=!0,"dataAnalysis"==_this.modalType?_this.screen.renderModal():"dashboard"==_this.modalType&&(_this.templateObj.setModalOption(option),_this.templateObj.render())}},close:function(){this.screen=null,this.container=null,this.modalType=null}},modalConfigurePane}(),ModalBase=function(){function ModalBase(parent,entity,_funcRender,_funcUpdate,_funcConfigMode){parent&&(this.screen=parent,this.entity=entity,this.container=void 0,this.chart=void 0,this.spinner=void 0,this.executeRender=_funcRender,this.executeConfigMode=_funcConfigMode,this.executeUpdate=_funcUpdate,this.initContainer())}return ModalBase.prototype={UNIT_WIDTH:8.3,UNIT_HEIGHT:16.5,initContainer:function(replacedElementId){var divParent=document.getElementById("divContainer_"+this.entity.id),isNeedCreateDivParent=!1;if(!divParent||replacedElementId)var isNeedCreateDivParent=!0;if(isNeedCreateDivParent&&(divParent=document.createElement("div"),divParent.id="divContainer_"+this.entity.id),replacedElementId){var $old=$("#divContainer_"+replacedElementId);$(divParent).insertAfter($old),$old.remove()}else isNeedCreateDivParent&&this.screen.container.appendChild(divParent);return divParent.className="springContainer",AppConfig.isMobile?(divParent.style.height=this.UNIT_HEIGHT*this.entity.spanR*2+"%",divParent.style.width=this.UNIT_WIDTH*this.entity.spanC*2+"%"):(divParent.style.height=this.UNIT_HEIGHT*this.entity.spanR+"%",divParent.style.width=this.UNIT_WIDTH*this.entity.spanC+"%"),this.entity.modal.title||""==this.entity.modal.title?divParent.innerHTML='<div class="panel panel-default">\r\n                    <div class="panel-heading springHead">\r\n                        <h3 class="panel-title" style="font-weight: bold;">'+this.entity.modal.title+'</h3>\r\n                    </div>\r\n                    <div class="panel-body springContent"></div>\r\n                </div>':divParent.innerHTML='<div class="panel panel-default" style="background: none;">\r\n                    <div class="panel-body springContent" style="height:100%;"></div>\r\n                </div>',this.container=divParent.getElementsByClassName("springContent")[0],this.spinner=new LoadingSpinner({color:"#00FFFF"}),this.spinner.spin(this.container),this},render:function(){this.executeRender(),this.chart&&this.chart.on("resize",function(param){this.resize()})},update:function(options){options&&0!=options.length&&(this.executeUpdate(options),this.spinner&&this.spinner.stop())},configure:function(){function btnConfig_clickEvent(e){$(".springSel").removeClass("springSel"),$(e.target).parents(".springContainer").addClass("springSel"),_this.modalInit()}this.spinner.stop();var _this=this;this.chart&&this.chart.clear(),this.divResizeByMouseInit();var divMask=document.createElement("div");if(divMask.className="springConfigMask",divMask.draggable="true",!this.screen.isForReport){var btnConfig=document.createElement("span");btnConfig.className="glyphicon glyphicon-cog springConfigBtn grow",btnConfig.title="Options",btnConfig.onclick=btnConfig_clickEvent,divMask.appendChild(btnConfig)}var btnRemove=document.createElement("span");btnRemove.className="glyphicon glyphicon-remove-circle springConfigRemoveBtn grow",btnRemove.title="Remove",btnRemove.onclick=function(e){_this.chart&&_this.chart.clear(),_this.screen.removeEntity(_this.entity.id),$("#divContainer_"+_this.entity.id).remove(),_this=null},divMask.appendChild(btnRemove);var btnHeightResize=document.createElement("div"),maxHeight=this.optionTemplate.maxHeight,maxWidth=this.optionTemplate.maxWidth,minHeight=this.optionTemplate.minHeight,minWidth=this.optionTemplate.minWidth;btnHeightResize.className="divResize divHeightResize",btnHeightResize.innerHTML='<label for="heightResize" >H: </label><input type="range" class="inputResize" id="heightResize" name="points" step="0.5" min="'+minHeight+'" max="'+maxHeight+'" value="'+_this.entity.spanR+'"/><h5 class="rangeVal">'+_this.entity.spanR+' /6</h5><input type="text" class="rangeChange" value="'+_this.entity.spanR+'"/>',divMask.appendChild(btnHeightResize);var btnWidthResize=document.createElement("div");btnWidthResize.className="divResize divWidthResize",btnWidthResize.innerHTML='<label for="widthResize" >W: </label><input type="range" class="inputResize" id="widthResize" name="points" step="0.5" min="'+minWidth+'" max="'+maxWidth+'" value="'+_this.entity.spanC+'"/><h5 class="rangeVal">'+_this.entity.spanC+' /12</h5><input type="text" class="rangeChange" value="'+_this.entity.spanC+'"/>',divMask.appendChild(btnWidthResize);var inputChartTitle=document.createElement("input");inputChartTitle.className="form-control chartTitle",inputChartTitle.value=this.entity.modal.title,inputChartTitle.setAttribute("placeholder",I18n.resource.dashboard.show.TITLE_TIP),""!=this.entity.modal.title&&(inputChartTitle.style.display="none"),inputChartTitle.setAttribute("type","text"),divMask.appendChild(inputChartTitle);var chartType=document.createElement("p");chartType.className="chartType",chartType.innerHTML=I18n.findContent(this.optionTemplate.name),divMask.appendChild(chartType);var chartTitleShow=document.createElement("p");chartTitleShow.innerHTML=inputChartTitle.value,chartTitleShow.className="chartTitleShow",divMask.appendChild(chartTitleShow),""==this.entity.modal.title&&(chartTitleShow.style.display="none"),chartTitleShow.onclick=function(){chartTitleShow.style.display="none",inputChartTitle.style.display="block",inputChartTitle.focus()},inputChartTitle.onblur=function(){""!=inputChartTitle.value&&(inputChartTitle.style.display="none",chartTitleShow.style.display="block"),chartTitleShow.innerHTML=inputChartTitle.value,_this.entity.modal.title=inputChartTitle.value},this.container.parentNode.appendChild(divMask),this.divResizeByToolInit();var divContainer=$(this.container).closest(".springContainer")[0];divMask.ondragstart=function(e){e.dataTransfer.setData("id",$(e.target).closest(".springContainer").get(0).id.replace("divContainer_",""))},divMask.ondragover=function(e){e.preventDefault()},divMask.ondragleave=function(e){e.preventDefault()},divContainer.ondrop=function(e){e.preventDefault();var sourceId=e.dataTransfer.getData("id");if(sourceId){var targetId=$(e.target).closest(".springContainer").get(0).id.replace("divContainer_","");_this.screen.replaceEntity(sourceId,targetId)}},this.executeConfigMode()},setModalOption:function(option){},modalInit:function(){var option,_this=this,dataItem=[{dsId:[],dsType:"",dsName:[]}];if(void 0!=_this.entity.modal.points)for(var i=0;i<_this.entity.modal.points.length;i++)dataItem[0].dsId.push(_this.entity.modal.points[i]),dataItem[0].dsName.push(AppConfig.datasource.getDSItemById(_this.entity.modal.points[i]).alias);if("custom"===_this.optionTemplate.mode)return void _this.showConfigModal();var tempOptionPara;tempOptionPara=_this.entity.modal.option?_this.entity.modal.option:{},tempOptionPara.dataItem=dataItem,option={modeUsable:_this.optionTemplate.mode,allDataNeed:!0,rowDataType:[I18n.resource.analysis.paneConfig.DATA_TYPE_DEFAULT],dataTypeMaxNum:[_this.optionTemplate.maxNum],templateType:_this.optionTemplate.type,optionPara:tempOptionPara},0==dataItem[0].dsId.length?_this.screen.modalConfigPane.showModalInit(!0,option,_this):_this.screen.modalConfigPane.showModalInit(!1,option,_this)},divResizeByToolInit:function(){{var _this=this,$divContainer=$("#divContainer_"+_this.entity.id);$(".divResize"),$(".inputResize")}$divContainer.find("#heightResize").mousedown(function(e){$(".springConfigMask").attr("draggable","false"),$(".springContent").attr("draggable","false"),$(e.target).mousemove(function(e){$(e.target).parents(".springContainer").css("height",$(e.target).val()*_this.UNIT_HEIGHT+"%"),_this.entity.spanR=Number($(e.target).val()),$(e.target).next().text($(e.target).val()+" /6"),_this.screen.setEntity(_this.entity)})}).mouseup(function(e){$(".springConfigMask").attr("draggable","true"),$(".springContent").attr("draggable","true"),$(e.target).off("mousemove"),_this.chart&&_this.chart.resize()}),$divContainer.find("#widthResize").mousedown(function(e){$(".springConfigMask").attr("draggable","false"),$(".springContent").attr("draggable","false"),$(e.target).mousemove(function(e){$(e.target).parents(".springContainer").css("width",$(e.target).val()*_this.UNIT_WIDTH+"%"),_this.entity.spanC=Number($(e.target).val()),$(e.target).next().text($(e.target).val()+" /12"),_this.screen.setEntity(_this.entity)})}).mouseup(function(e){$(".springConfigMask").attr("draggable","true"),$(".springContent").attr("draggable","true"),$(e.target).off("mousemove"),_this.chart&&_this.chart.resize()}),$divContainer.find(".rangeVal").click(function(e){e.stopPropagation();var valueCurrent=Number($(e.target).prev().val()),valuePre=$(e.target).prev().val(),valueMax=Number($(e.target).prevAll(".inputResize").attr("max")),valueMin=Number($(e.target).prevAll(".inputResize").attr("min"));$(e.target).nextAll(".rangeChange").css("display","inline-block").focus().off("blur").blur(function(e){valueCurrent=Number($(e.target).val()),valueMax>=valueCurrent&&valueCurrent>=valueMin?($(e.target).prevAll(".inputResize").val(valueCurrent.toString()),"widthResize"==$(e.target).prevAll(".inputResize").attr("id")?($(e.target).parents(".springContainer").css("width",$(e.target).val()*_this.UNIT_WIDTH+"%"),_this.entity.spanC=Number($(e.target).val()),_this.screen.setEntity(_this.entity),$(e.target).prev().text($(e.target).val()+" /12"),_this.chart&&_this.chart.resize()):($(e.target).parents(".springContainer").css("height",$(e.target).val()*_this.UNIT_HEIGHT+"%"),_this.entity.spanR=Number($(e.target).val()),_this.screen.setEntity(_this.entity),$(e.target).prev().text($(e.target).val()+" /6"),_this.chart&&_this.chart.resize()),$(e.target).css("display","none")):valueCurrent>valueMax?(new Alert($("#resizeAlert"),"danger","<strong>"+I18n.resource.dashboard.resize.ERR1+"</strong>").show().close(),$(e.target).val(valuePre).css("display","none")):valueMin>valueCurrent?(new Alert($("#resizeAlert"),"danger","<strong>"+I18n.resource.dashboard.resize.ERR2+"</strong>").show().close(),$(e.target).val(valuePre).css("display","none")):(""!=$(e.target).val()&&new Alert($("#resizeAlert"),"danger","<strong>"+I18n.resource.dashboard.resize.ERR3+"</strong>").show().close(),$(e.target).val(valuePre).css("display","none"))})})},divResizeByMouseInit:function(){function doResizeOnRight(e){var oEvent=e||event,l=oEvent.clientX-mouseStart.x+rightStart.x;w=l+resizeOnCorner.offsetWidth,w<resizeOnCorner.offsetWidth?w=resizeOnCorner.offsetWidth:w>document.documentElement.clientWidth-divContainer.offsetLeft&&(w=document.documentElement.clientWidth-divContainer.offsetLeft-2),divContainer.style.width=w+"px"}function stopResizeOnRight(e){resizeOnRight.releaseCapture?(tempSpanC=parseInt(100*w/(divContainer.parentNode.clientWidth*_this.UNIT_WIDTH)),rangeJudge(),$widthResize.val(tempSpanC.toString()),$widthResize.next().text(tempSpanC.toString()+" /12"),$widthResize.next().next().val(tempSpanC.toString()),divContainer.style.width=tempSpanC*_this.UNIT_WIDTH+"%",_this.entity.spanC=tempSpanC,resizeOnRight.onmousemove=null,resizeOnRight.onmouseup=null,resizeOnRight.releaseCapture(),_this.chart&&_this.chart.resize()):(tempSpanC=parseInt(100*w/(divContainer.parentNode.clientWidth*_this.UNIT_WIDTH)),rangeJudge(),$widthResize.val(tempSpanC.toString()),$widthResize.next().text(tempSpanC.toString()+" /12"),$widthResize.next().next().val(tempSpanC.toString()),divContainer.style.width=tempSpanC*_this.UNIT_WIDTH+"%",_this.entity.spanC=tempSpanC,document.removeEventListener("mousemove",doResizeOnRight,!0),document.removeEventListener("mouseup",stopResizeOnRight,!0),_this.chart&&_this.chart.resize())}function doResizeOnBottom(e){var oEvent=e||event,t=oEvent.clientY-mouseStart.y+bottomStart.y;h=t+resizeOnCorner.offsetHeight,h<resizeOnCorner.offsetHeight?h=resizeOnCorner.offsetHeight:h>document.documentElement.clientHeight-divContainer.offsetTop&&(h=document.documentElement.clientHeight-divContainer.offsetTop-2),divContainer.style.height=h+"px"}function stopResizeOnBottom(e){resizeOnBottom.releaseCapture?(tempSpanR=parseInt(100*h/(divContainer.parentNode.clientHeight*_this.UNIT_HEIGHT)),rangeJudge(),$heightResize.val(tempSpanR.toString()),$heightResize.next().text(tempSpanR.toString()+" /6"),$heightResize.next().next().val(tempSpanR.toString()),divContainer.style.height=tempSpanR*_this.UNIT_HEIGHT+"%",_this.entity.spanR=tempSpanR,resizeOnBottom.onmousemove=null,resizeOnBottom.onmouseup=null,resizeOnBottom.releaseCapture(),_this.chart&&_this.chart.resize()):(tempSpanR=parseInt(100*h/(divContainer.parentNode.clientHeight*_this.UNIT_HEIGHT)),rangeJudge(),$heightResize.val(tempSpanR.toString()),$heightResize.next().text(tempSpanR.toString()+" /6"),$heightResize.next().next().val(tempSpanR.toString()),divContainer.style.height=tempSpanR*_this.UNIT_HEIGHT+"%",_this.entity.spanR=tempSpanR,document.removeEventListener("mousemove",doResizeOnBottom,!0),document.removeEventListener("mouseup",stopResizeOnBottom,!0),_this.chart&&_this.chart.resize())}function doResizeOnCorner(e){var oEvent=e||event,l=oEvent.clientX-mouseStart.x+divStart.x,t=oEvent.clientY-mouseStart.y+divStart.y;w=l+resizeOnCorner.offsetWidth,h=t+resizeOnCorner.offsetHeight,w<resizeOnCorner.offsetWidth?w=resizeOnCorner.offsetWidth:w>document.documentElement.clientWidth-divContainer.offsetLeft&&(w=document.documentElement.clientWidth-divContainer.offsetLeft-2),h<resizeOnCorner.offsetHeight?h=resizeOnCorner.offsetHeight:h>document.documentElement.clientHeight-divContainer.offsetTop&&(h=document.documentElement.clientHeight-divContainer.offsetTop-2),divContainer.style.width=w+"px",divContainer.style.height=h+"px"}function stopResizeOnCorner(e){resizeOnCorner.releaseCapture?(tempSpanC=parseInt(100*w/(divContainer.parentNode.clientWidth*_this.UNIT_WIDTH)),tempSpanR=parseInt(100*h/(divContainer.parentNode.clientHeight*_this.UNIT_HEIGHT)),rangeJudge(),$widthResize.val(tempSpanC.toString()).get(0).setAttribute("value",tempSpanC.toString()),$widthResize.next().text(tempSpanC.toString()+" /12"),$widthResize.next().next().val(tempSpanC.toString()),$heightResize.val(tempSpanR.toString()).get(0).setAttribute("value",tempSpanR.toString()),$heightResize.next().text(tempSpanR.toString()+" /6"),$heightResize.next().next().val(tempSpanR.toString()),divContainer.style.width=tempSpanC*_this.UNIT_WIDTH+"%",divContainer.style.height=tempSpanR*_this.UNIT_HEIGHT+"%",_this.entity.spanC=tempSpanC,_this.entity.spanR=tempSpanR,resizeOnCorner.onmousemove=null,resizeOnCorner.onmouseup=null,resizeOnCorner.releaseCapture(),_this.chart&&_this.chart.resize()):(tempSpanC=parseInt(100*w/(divContainer.parentNode.clientWidth*_this.UNIT_WIDTH)),tempSpanR=parseInt(100*h/(divContainer.parentNode.clientHeight*_this.UNIT_HEIGHT)),rangeJudge(),$widthResize.val(tempSpanC.toString()),$widthResize.next().text(tempSpanC.toString()+" /12"),$widthResize.next().next().val(tempSpanC.toString()),$heightResize.val(tempSpanR.toString()),$heightResize.next().text(tempSpanR.toString()+" /6"),$heightResize.next().next().val(tempSpanR.toString()),divContainer.style.width=tempSpanC*_this.UNIT_WIDTH+"%",divContainer.style.height=tempSpanR*_this.UNIT_HEIGHT+"%",_this.entity.spanC=tempSpanC,_this.entity.spanR=tempSpanR,document.removeEventListener("mousemove",doResizeOnCorner,!0),document.removeEventListener("mouseup",stopResizeOnCorner,!0),_this.chart&&_this.chart.resize())}function rangeJudge(){tempSpanC>_this.optionTemplate.maxWidth?tempSpanC=_this.optionTemplate.maxWidth:tempSpanC<_this.optionTemplate.minWidth&&(tempSpanC=_this.optionTemplate.minWidth),tempSpanR>_this.optionTemplate.maxHeight?tempSpanR=_this.optionTemplate.maxHeight:tempSpanR<_this.optionTemplate.minHeight&&(tempSpanR=_this.optionTemplate.minHeight)}var $widthResize,$heightResize,_this=this,divContainer=$("#divContainer_"+_this.entity.id).get(0),resizeOnRight=document.createElement("div");resizeOnRight.className="resizeOnRight",divContainer.appendChild(resizeOnRight);var resizeOnBottom=document.createElement("div");resizeOnBottom.className="resizeOnBottom",divContainer.appendChild(resizeOnBottom);var resizeOnCorner=document.createElement("div");resizeOnCorner.className="resizeOnCorner",divContainer.appendChild(resizeOnCorner);var w,h,tempSpanR,tempSpanC,mouseStart={},divStart={},rightStart={},bottomStart={};resizeOnRight.onmousedown=function(e){$widthResize=$(e.target).parent().find("#widthResize");var oEvent=e||event;mouseStart.x=oEvent.clientX,mouseStart.y=oEvent.clientY,rightStart.x=resizeOnRight.offsetLeft,doResizeOnRight(e),resizeOnRight.setCapture?(resizeOnRight.onmousemove=doResizeOnRight,resizeOnRight.onmouseup=stopResizeOnRight,resizeOnRight.setCapture()):(document.addEventListener("mousemove",doResizeOnRight,!0),document.addEventListener("mouseup",stopResizeOnRight,!0))},resizeOnBottom.onmousedown=function(e){$heightResize=$(e.target).parent().find("#heightResize");var oEvent=e||event;mouseStart.x=oEvent.clientX,mouseStart.y=oEvent.clientY,bottomStart.y=resizeOnBottom.offsetTop,doResizeOnBottom(e),resizeOnBottom.setCapture?(resizeOnBottom.onmousemove=doResizeOnBottom,resizeOnBottom.onmouseup=stopResizeOnBottom,resizeOnBottom.setCapture()):(document.addEventListener("mousemove",doResizeOnBottom,!0),document.addEventListener("mouseup",stopResizeOnBottom,!0))},resizeOnCorner.onmousedown=function(e){$widthResize=$(e.target).parent().find("#widthResize"),$heightResize=$(e.target).parent().find("#heightResize");var oEvent=e||event;mouseStart.x=oEvent.clientX,mouseStart.y=oEvent.clientY,divStart.x=resizeOnCorner.offsetLeft,divStart.y=resizeOnCorner.offsetTop,doResizeOnCorner(e),resizeOnCorner.setCapture?(resizeOnCorner.onmousemove=doResizeOnCorner,resizeOnCorner.onmouseup=stopResizeOnCorner,resizeOnCorner.setCapture()):(document.addEventListener("mousemove",doResizeOnCorner,!0),document.addEventListener("mouseup",stopResizeOnCorner,!0))}}},ModalBase}(),ModalNone=function(){function ModalNone(screen,entityParams){ModalBase.call(this,screen,entityParams,this.renderModal,null,null)}return ModalNone.prototype=new ModalBase,ModalNone.prototype.optionTemplate={name:"",mode:["realTime"],maxNum:1,title:"",minHeight:1,minWidth:2,maxHeight:6,maxWidth:12,type:"ModalNone"},ModalNone.prototype.renderModal=function(){I18n.fillArea($("#coalSaveName").parent()),$(this.container).parent().css("visibility","hidden"),this.spinner.stop()},ModalNone.prototype.configure=function(){this.spinner.stop();var _this=this;$(_this.container).parent().css("visibility","");var divAdd=document.createElement("span");divAdd.className="glyphicon glyphicon-plus-sign springConfigBtn",this.container.appendChild(divAdd);var btnRemove=document.createElement("span");btnRemove.className="glyphicon glyphicon-remove-circle springConfigRemoveBtn grow",btnRemove.title="Remove",btnRemove.onclick=function(e){_this.chart&&_this.chart.clear(),_this.screen.removeEntity(_this.entity.id),$("#divContainer_"+_this.entity.id).remove(),_this=null},this.container.appendChild(btnRemove);var btnHeightResize=document.createElement("div"),maxHeight=this.optionTemplate.maxHeight,maxWidth=this.optionTemplate.maxWidth,minHeight=this.optionTemplate.minHeight,minWidth=this.optionTemplate.minWidth;btnHeightResize.className="divResize divHeightResize",btnHeightResize.innerHTML='<label for="heightResize" >H: </label><input type="range" class="inputResize" id="heightResize" name="points" step="0.5" min="'+minHeight+'" max="'+maxHeight+'" value="'+_this.entity.spanR+'"/><h5 class="rangeVal">'+_this.entity.spanR+' /6</h5><input type="text" class="rangeChange" value="'+_this.entity.spanR+'"/>',this.container.appendChild(btnHeightResize);var btnWidthResize=document.createElement("div");btnWidthResize.className="divResize divWidthResize",btnWidthResize.innerHTML='<label for="widthResize" >W: </label><input type="range" class="inputResize" id="widthResize" name="points" step="0.5" min="'+minWidth+'" max="'+maxWidth+'" value="'+_this.entity.spanC+'"/><h5 class="rangeVal">'+_this.entity.spanC+' /12</h5><input type="text" class="rangeChange" value="'+_this.entity.spanC+'"/>',this.container.appendChild(btnWidthResize),this.divResizeByMouseInit(),this.divResizeByToolInit();var divParent=$(this.container).closest(".springContainer")[0],divContent=$(divParent).find(".springContent")[0];divContent.draggable="true",divContent.ondragstart=function(e){e.dataTransfer.setData("id",$(e.target).closest(".springContainer").get(0).id.replace("divContainer_",""))},divContent.ondragover=function(e){e.preventDefault()},divContent.ondragleave=function(e){e.preventDefault()},divParent.ondrop=function(e){if(e.dataTransfer.getData("type")&&e.dataTransfer.getData("title"))_this.screen.rebornEntity(_this.entity,e.dataTransfer.getData("type"),e.dataTransfer.getData("title"));else if(e.dataTransfer.getData("id")){var targetId=$(e.target).closest(".springContainer").get(0).id.replace("divContainer_","");_this.screen.replaceEntity(e.dataTransfer.getData("id"),targetId)}}},ModalNone}(),ModalAnalysis=function(){function ModalAnalysis(screen,entityParams){ModalBase.call(this,screen,entityParams,this.renderModal,this.updateModal,this.showConfigMode),_this=this,this.curModal=this.entity.modal.option.option,this.entityAnalysis=void 0,this.saveModalJudge=$.Deferred()}var _this=void 0;return ModalAnalysis.prototype=new ModalBase,ModalAnalysis.prototype.optionTemplate={name:"toolBox.modal.TRANSIT",parent:2,mode:["realTimeWithoutRange"],maxNum:1,title:"",minHeight:1,minWidth:1,maxHeight:6,maxWidth:12,type:"ModalAnalysis"},ModalAnalysis.prototype.renderModal=function(){var modalClass=this.screen.factoryIoCAnalysis.getModel(this.entity.modal.option.type);this.screen.curModal=this.curModal,this.entityAnalysis=new modalClass(this.container,null,this),this.entityAnalysis.isShareMode=1,this.entityAnalysis.paneChart=this.container,this.entityAnalysis.chartAnimationDuration=500,this.entityAnalysis.show()},ModalAnalysis.prototype.updateModal=function(points){},ModalAnalysis.prototype.showConfigMode=function(){},ModalAnalysis.prototype.setModalOption=function(option){},ModalAnalysis.prototype.alertNoData=function(){},ModalAnalysis.prototype.spinnerStop=function(){},ModalAnalysis.prototype.saveModal=function(){},ModalAnalysis}(),ModalChart=function(){function ModalChart(screen,entityParams){entityParams&&ModalBase.call(this,screen,entityParams,this.renderModal,this.updateModal,this.showConfigMode)}return ModalChart.prototype=new ModalBase,ModalChart.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_CHART",parent:0,mode:["realTime"],maxNum:10,title:"",minHeight:1,minWidth:1,maxHeight:6,maxWidth:12,type:"ModalChart"},ModalChart.prototype.optionDefault={tooltip:{trigger:"axis"},toolbox:{show:!1,feature:{mark:{show:!0},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0},ModalChart.prototype.renderModal=function(){this.chart=echarts.init(this.container).setOption(this.options)},ModalChart.prototype.updateModal=function(pointName,pointValue){},ModalChart.prototype.showConfigMode=function(){},ModalChart}(),ModalRealtimePie=function(){function ModalRealtimePie(screen,entityParams){entityParams&&ModalBase.call(this,screen,entityParams,this.renderModal,this.updateModal,this.showConfigMode)}return ModalRealtimePie.prototype=new ModalBase,ModalRealtimePie.prototype.optionTemplate={name:"",parent:0,mode:["realTimeDashboard"],maxNum:10,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12},ModalRealtimePie.prototype.optionDefault={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",y:"center"},toolbox:{show:!1,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["pie","funnel"],option:{funnel:{x:"25%",width:"50%",funnelAlign:"center",max:1548}}},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,color:["#e84c3d","#293949","#1abc9c","#f1c40f"],series:[{type:"pie",radius:["50%","70%"],center:["60%","50%"],itemStyle:{normal:{label:{show:!0,formatter:"{d}%"},labelLine:{show:!0}},emphasis:{label:{show:!0,position:"center",textStyle:{fontSize:"20",fontWeight:"bold"}}}}}]},ModalRealtimePie.prototype.renderModal=function(){this.chart=echarts.init(this.container).setOption($.extend(!0,{},this.optionDefault,this.option))},ModalRealtimePie.prototype.updateModal=function(points){},ModalRealtimePie.prototype.showConfigMode=function(){},ModalRealtimePie.prototype.dealWithData=function(points,len){for(var arr=[],arrLegend=[],arrSeries=[],i=0;i<points.length;i++){var temp=points[i],pointAlias=AppConfig.datasource.getDSItemById(temp.dsItemId).alias;arrLegend.push(pointAlias);var seriesData={value:tofixed(temp.data),name:pointAlias};arrSeries.push(seriesData)}return arr.push(arrLegend),arr.push(arrSeries),arr},ModalRealtimePie.prototype.setModalOption=function(option){this.entity.modal.interval=5},ModalRealtimePie}(),ModalRealtimeLine=function(){function ModalRealtimeLine(screen,entityParams){entityParams&&ModalBase.call(this,screen,entityParams,this.renderModal,this.updateModal,this.showConfigMode)}return ModalRealtimeLine.prototype=new ModalBase,ModalRealtimeLine.prototype.optionTemplate={name:"",parent:0,mode:["realTimeDashboard"],maxNum:10,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12
},ModalRealtimeLine.prototype.optionDefault={tooltip:{trigger:"axis"},legend:{orient:"vertical",x:"right",y:"top"},grid:{x:70,x2:10,y2:24},toolbox:{show:!1,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,color:["#e84c3d","#1abc9c","#B5C334","#FCCE10","#E87C25","#27727B","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD","#D7504B","#C6E579","#F4E001","#F0805A","#26C0C0"],xAxis:[{type:"category",boundaryGap:!0,splitLine:{show:!1},splitArea:{show:!1},axisTick:{show:!1}}],yAxis:[{type:"value",scale:!0,splitArea:{show:!1}}],series:[{type:"line",symbol:"emptyCircle",smooth:!0}]},ModalRealtimeLine.prototype.renderModal=function(){this.chart=echarts.init(this.container).setOption($.extend(!0,{},this.optionDefault,this.option))},ModalRealtimeLine.prototype.updateModal=function(points){},ModalRealtimeLine.prototype.showConfigMode=function(){},ModalRealtimeLine.prototype.dealWithData=function(points,len){for(var arr=[],arrLegend=[],arrSeries=[],i=0;i<points.list.length;i++){var key=points.list[i].dsItemId,pointAlias=AppConfig.datasource.getDSItemById(key).alias;arrLegend.push(pointAlias);var series={name:pointAlias,type:"line",symbol:"emptyCircle",smooth:!0,data:points.list[i].data};arrSeries.push(series)}return arr.push(arrLegend),arr.push(arrSeries),arr},ModalRealtimeLine.prototype.dealWithAddData=function(points,len){for(var arr=[],i=0;i<points.length;i++){var temp=[i,tofixed(points[i].data),!1,!0];arr.push(temp)}return arr},ModalRealtimeLine.prototype.setModalOption=function(option){this.entity.modal.interval=5},ModalRealtimeLine}(),modalRealtimeBar=function(){function modalRealtimeBar(screen,entityParams){entityParams&&ModalBase.call(this,screen,entityParams,this.renderModal,this.updateModal,this.showConfigMode)}return modalRealtimeBar.prototype=new ModalBase,modalRealtimeBar.prototype.optionTemplate={name:"",parent:0,mode:["realTimeDashboard"],maxNum:10,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12},modalRealtimeBar.prototype.optionDefault={tooltip:{trigger:"item"},calculable:!0,grid:{borderWidth:0,x:70,x2:10,y2:24},xAxis:[{type:"category",show:!0,splitLine:{show:!1},splitArea:{show:!1},axisTick:{show:!1}}],yAxis:[{type:"value",splitArea:{show:!1}}],series:[{type:"bar",itemStyle:{normal:{color:function(params){var colorList=["#C1232B","#B5C334","#FCCE10","#E87C25","#27727B","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD","#D7504B","#C6E579","#F4E001","#F0805A","#26C0C0"];return colorList[params.dataIndex]},label:{show:!1,position:"top",formatter:"{b}\n{c}"},barBorderRadius:[5,5,0,0]}}}]},modalRealtimeBar.prototype.renderModal=function(){this.chart=echarts.init(this.container).setOption($.extend(!0,{},this.optionDefault,this.option))},modalRealtimeBar.prototype.updateModal=function(points){},modalRealtimeBar.prototype.showConfigMode=function(){},modalRealtimeBar.prototype.setModalOption=function(option){this.entity.modal.interval=5},modalRealtimeBar}(),modalRealtimeBarEnegBrkd=function(){function modalRealtimeBarEnegBrkd(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal,showConfigMode=_showConfigMode?_showConfigMode:this.showConfigMode;modalRealtimeBar.call(this,screen,entityParams,renderModal,updateModal,showConfigMode)}}return modalRealtimeBarEnegBrkd.prototype=new modalRealtimeBar,modalRealtimeBarEnegBrkd.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_CHART_BAR_ENERGY",parent:0,mode:["realTimeDashboard"],maxNum:10,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"modalRealtimeBarEnegBrkd"},modalRealtimeBarEnegBrkd.prototype.renderModal=function(){this.isFirstRender=!0},modalRealtimeBarEnegBrkd.prototype.updateModal=function(points){function dealWithData(points,len){for(var temp,arr=[],arrXAxis=[],arrData=[],arrMpData=[],i=0;i<points.length;i++){temp=points[i];var pointAlias=AppConfig.datasource.getDSItemById(temp.dsItemId).alias;arrXAxis.push(pointAlias),arrData.push(tofixed(temp.data)),arrMpData.push({xAxis:i,yAxis:tofixed(temp.data),value:tofixed(temp.data),name:pointAlias,symbolSize:32})}return arr.push(arrXAxis),arr.push(arrData),arr.push(arrMpData),arr}if(!(points.length<1)){var entityItem=dealWithData(points,4);if(this.isFirstRender){var entityData={grid:{x:70,x2:10,y2:24},xAxis:[{data:entityItem[0]}],series:[{data:entityItem[1],markPoint:{data:entityItem[2]}}]};this.chart=echarts.init(this.container,"macarons").setOption($.extend(!0,{},this.optionDefault,entityData)),this.isFirstRender=!1}else this.chart.setSeries([{type:"bar",itemStyle:{normal:{color:function(params){var colorList=["#C1232B","#B5C334","#FCCE10","#E87C25","#27727B","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD","#D7504B","#C6E579","#F4E001","#F0805A","#26C0C0"];return colorList[params.dataIndex]}}},data:entityItem[1],markPoint:{data:entityItem[2]}}])}},modalRealtimeBarEnegBrkd.prototype.setModalOption=function(option){this.entity.modal.interval=5},modalRealtimeBarEnegBrkd}(),ModalRealtimePieEnegBrkd=function(){function ModalRealtimePieEnegBrkd(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal,showConfigMode=_showConfigMode?_showConfigMode:this.showConfigMode;ModalRealtimePie.call(this,screen,entityParams,renderModal,updateModal,showConfigMode)}}return ModalRealtimePieEnegBrkd.prototype=new ModalRealtimePie,ModalRealtimePieEnegBrkd.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_CHART_PIE_ENERGY",parent:0,mode:["realTimeDashboard"],maxNum:10,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"ModalRealtimePieEnegBrkd"},ModalRealtimePieEnegBrkd.prototype.renderModal=function(){this.isFirstRender=!0},ModalRealtimePieEnegBrkd.prototype.updateModal=function(points){if(!(points.length<1))if(this.isFirstRender){var entityItem=this.dealWithData(points,4),entityData={legend:{data:entityItem[0]},series:[{data:entityItem[1]}]};this.chart=echarts.init(this.container).setOption($.extend(!0,{},this.optionDefault,entityData)),this.isFirstRender=!1}else{var seriesData=function(points,len){for(var arr=[],i=0;i<points.length;i++)arr.push({value:tofixed(points[i].data),name:AppConfig.datasource.getDSItemById(points[i].dsItemId).alias});return arr}(points,4);this.chart.setSeries([{type:"pie",radius:["50%","70%"],itemStyle:{normal:{label:{show:!0,formatter:"{d}%"},labelLine:{show:!0}},emphasis:{label:{show:!0,formatter:"{d}%",position:"center",textStyle:{fontSize:"20",fontWeight:"bold"}}}},data:seriesData}],!0)}},ModalRealtimePieEnegBrkd.prototype.setModalOption=function(option){this.entity.modal.interval=5},ModalRealtimePieEnegBrkd}(),ModalRealtimePieDataRoom=function(){function ModalRealtimePieDataRoom(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal,showConfigMode=_showConfigMode?_showConfigMode:this.showConfigMode;ModalRealtimePie.call(this,screen,entityParams,renderModal,updateModal,showConfigMode)}}return ModalRealtimePieDataRoom.prototype=new ModalRealtimePie,ModalRealtimePieDataRoom.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_CHART_PIE_DATAROOM",parent:0,mode:["realTimeDashboard"],maxNum:10,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"ModalRealtimePieDataRoom"},ModalRealtimePieDataRoom.prototype.renderModal=function(){this.isFirstRender=!0},ModalRealtimePieDataRoom.prototype.updateModal=function(points){if(!(points.length<1)){var entityItem=this.dealWithData(points,3);if(this.isFirstRender){var entityData={legend:{data:entityItem[0]},series:[{type:"pie",radius:["50%","70%"],itemStyle:{normal:{label:{show:!0,formatter:"{d}%"},labelLine:{show:!0}},emphasis:{label:{show:!0,position:"center",textStyle:{fontSize:"20",fontWeight:"bold"}}}},data:entityItem[1]}]};this.chart=echarts.init(this.container).setOption($.extend(!0,{},this.optionDefault,entityData)),this.isFirstRender=!1}else this.chart.setSeries([{type:"pie",radius:["50%","70%"],itemStyle:{normal:{label:{show:!0,formatter:"{d}%"},labelLine:{show:!0}},emphasis:{label:{show:!0,position:"center",textStyle:{fontSize:"20",fontWeight:"bold"}}}},data:entityItem[1]}],!0)}},ModalRealtimePieDataRoom.prototype.setModalOption=function(option){this.entity.modal.interval=5},ModalRealtimePieDataRoom}(),ModalRealtimeLineOutdoor=function(){function ModalRealtimeLineOutdoor(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){{var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal;_showConfigMode?_showConfigMode:this.showConfigMode}ModalRealtimeLine.call(this,screen,entityParams,renderModal,updateModal,null)}}return ModalRealtimeLineOutdoor.prototype=new ModalRealtimeLine,ModalRealtimeLineOutdoor.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_CHART_LINE_OUTDOOR",parent:0,mode:["realTimeDashboard"],maxNum:10,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"ModalRealtimeLineOutdoor"},ModalRealtimeLineOutdoor.prototype.renderModal=function(){this.isFirstRender=!0},ModalRealtimeLineOutdoor.prototype.updateModal=function(points){if(!(points.length<1)){var _this=this;if(this.isFirstRender){var pointNameList=function(points){for(var arr=[],i=0;i<points.length;i++)arr.push(points[i].dsItemId);return arr}(points),endTime=(new Date).format("yyyy-MM-dd HH:mm:ss"),startTime=endTime.split(" ")[0]+" 01:00:00";WebAPI.post("/analysis/startWorkspaceDataGenHistogram",{dsItemIds:pointNameList,timeStart:startTime,timeEnd:endTime,timeFormat:"h1"}).done(function(result){var dataSrc=JSON.parse(result);if(!(void 0==dataSrc||dataSrc.length<=0)){var entityItem=_this.dealWithData(dataSrc,2),entityData={legend:{data:entityItem[0]},xAxis:[{data:["01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24:00"]}],series:entityItem[1]};_this.chart=echarts.init(_this.container,"macarons").setOption($.extend(!0,{},_this.optionDefault,entityData)),_this.isFirstRender=!1}}).error(function(e){}).always(function(e){})}else{var crtHour=(new Date).getHours();points&&points.length>0&&this.chart.getSeries()[0].data.length<crtHour&&this.chart.addData(this.dealWithAddData(points,2)),this.chart.getSeries()[0].data.length>23&&(this.isFirstRender=!0)}}},ModalRealtimeLineOutdoor.prototype.setModalOption=function(option){this.entity.modal.interval=5},ModalRealtimeLineOutdoor}(),ModalRealtimeLinePUE=function(){function ModalRealtimeLinePUE(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal,showConfigMode=_showConfigMode?_showConfigMode:this.showConfigMode;ModalRealtimeLine.call(this,screen,entityParams,renderModal,updateModal,showConfigMode)}}return ModalRealtimeLinePUE.prototype=new ModalRealtimeLine,ModalRealtimeLinePUE.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_CHART_LINE_PUE",parent:0,mode:["realTimeDashboard"],maxNum:10,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"ModalRealtimeLinePUE"},ModalRealtimeLinePUE.prototype.renderModal=function(){this.isFirstRender=!0},ModalRealtimeLinePUE.prototype.updateModal=function(points){if(!(points.length<1)){var _this=this;if(this.isFirstRender){var pointNameList=function(points){for(var arr=[],i=0;1>i;i++)arr.push(points[i].dsItemId);return arr}(points),endTime=(new Date).format("yyyy-MM-dd HH:mm:ss"),startTime=endTime.split(" ")[0]+" 01:00:00";WebAPI.post("/analysis/startWorkspaceDataGenHistogram",{dsItemIds:pointNameList,timeStart:startTime,timeEnd:endTime,timeFormat:"h1"}).done(function(result){var dataSrc=JSON.parse(result);if(!(void 0==dataSrc||dataSrc.length<=0)){var entityItem=_this.dealWithData(dataSrc,1),entityData={legend:{data:entityItem[0]},xAxis:[{data:["01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24:00"]}],series:entityItem[1]};_this.chart=echarts.init(_this.container,"macarons").setOption($.extend(!0,{},_this.optionDefault,entityData)),_this.isFirstRender=!1}}).error(function(e){}).always(function(e){})}else{var crtHour=(new Date).getHours();points&&points.length>0&&this.chart.getSeries()[0].data.length<crtHour&&this.chart.addData(this.dealWithAddData(points,1)),this.chart.getSeries()[0].data.length>23&&(this.isFirstRender=!0)}}},ModalRealtimeLinePUE.prototype.setModalOption=function(option){this.entity.modal.interval=5},ModalRealtimeLinePUE}(),ModalRealtimeGauge=function(){function ModalRealtimeGauge(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal,showConfigMode=_showConfigMode?_showConfigMode:this.showConfigMode;ModalBase.call(this,screen,entityParams,renderModal,updateModal,showConfigMode),this.entityOption=entityParams.modal.option}}return ModalRealtimeGauge.prototype=new ModalBase,ModalRealtimeGauge.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_CHART_GAUGE",parent:0,mode:["gauge"],maxNum:1,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"ModalRealtimeGauge"},ModalRealtimeGauge.prototype.optionDefault={tooltip:{formatter:"{c}"},animation:!0,animationDuration:1e3,animationDurationUpdate:1e3,series:[{name:"PUE",type:"gauge",splitNumber:10,axisLine:{show:!0,lineStyle:{width:8}},radius:[0,"90%"],axisTick:{show:!0,splitNumber:5,length:15,lineStyle:{width:1,type:"solid",color:"auto"}},axisLabel:{textStyle:{color:"auto"},formatter:function(v){return v.toFixed(2)}},splitLine:{show:!0,length:20,lineStyle:{color:"auto"}},pointer:{width:5},detail:{formatter:"{value}"}}]},ModalRealtimeGauge.prototype.renderModal=function(){},ModalRealtimeGauge.prototype.updateModal=function(points){if(!(points.length<1)){var _this=this,scaleList=_this.entityOption.scaleList,colorList=["#1abc9c","#3598db","#e84c3d"];scaleList[scaleList.length-1]<scaleList[0]&&(scaleList.reverse(),colorList=["#e84c3d","#3598db","#1abc9c"]),this.optionDefault.series[0].max=scaleList[scaleList.length-1],this.optionDefault.series[0].min=scaleList[0],this.optionDefault.series[0].data=[{value:parseFloat(points[0].data).toFixed(2)}],this.optionDefault.series[0].axisLine.lineStyle.color=function(option){for(var arr=[],colorIndex=0,i=0;i<option.length;i++)0!=i&&(arr.push([((option[i]-option[0])/(_this.optionDefault.series[0].max-_this.optionDefault.series[0].min)).toFixed(3),colorList[colorIndex]]),colorIndex++);return arr}(scaleList),this.chart?this.chart.setOption(this.optionDefault):this.chart=echarts.init(this.container).setOption(this.optionDefault)}},ModalRealtimeGauge.prototype.showConfigMode=function(){},ModalRealtimeGauge.prototype.setModalOption=function(option){this.entity.modal.option={},this.entity.modal.option.scaleList=option.scaleList,this.entity.modal.interval=5},ModalRealtimeGauge}(),ModalRealtimeLineEnegBrkd=function(){function ModalRealtimeLineEnegBrkd(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal,showConfigMode=_showConfigMode?_showConfigMode:this.showConfigMode;ModalRealtimeLine.call(this,screen,entityParams,renderModal,updateModal,showConfigMode)}}return ModalRealtimeLineEnegBrkd.prototype=new ModalRealtimeLine,ModalRealtimeLineEnegBrkd.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_CHART_LINE_ENERGY",parent:0,mode:["realTimeDashboard"],maxNum:10,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"ModalRealtimeLineEnegBrkd"},ModalRealtimeLineEnegBrkd.prototype.renderModal=function(){this.isFirstRender=!0},ModalRealtimeLineEnegBrkd.prototype.updateModal=function(points){if(!(points.length<1)){var _this=this;if(this.isFirstRender){var pointNameList=function(points){for(var arr=[],i=0;i<points.length;i++)arr.push(points[i].dsItemId);return arr}(points),endTime=(new Date).format("yyyy-MM-dd HH:mm:ss"),startTime=endTime.split(" ")[0]+" 01:00:00";WebAPI.post("/analysis/startWorkspaceDataGenHistogram",{dsItemIds:pointNameList,timeStart:startTime,timeEnd:endTime,timeFormat:"h1"}).done(function(result){var dataSrc=JSON.parse(result);if(!(void 0==dataSrc||dataSrc.length<=0)){var entityItem=_this.dealWithData(dataSrc,4),entityData={legend:{data:entityItem[0]},xAxis:[{data:["01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24:00"]}],series:entityItem[1]};_this.chart=echarts.init(_this.container,"macarons").setOption($.extend(!0,{},_this.optionDefault,entityData)),_this.isFirstRender=!1}}).error(function(e){}).always(function(e){})}else{var crtHour=(new Date).getHours();points&&points.length>0&&this.chart.getSeries()[0].data.length<crtHour&&this.chart.addData(this.dealWithAddData(points,4)),this.chart.getSeries()&&this.chart.getSeries()[0].data.length>23&&(this.isFirstRender=!0)}}},ModalRealtimeLineEnegBrkd.prototype.setModalOption=function(option){this.entity.modal.interval=5},ModalRealtimeLineEnegBrkd}(),ModalHistoryChart=function(){function ModalHistoryChart(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal,showConfigMode=_showConfigMode?_showConfigMode:this.showConfigMode;ModalBase.call(this,screen,entityParams,renderModal,updateModal,showConfigMode)}}return ModalHistoryChart.prototype=new ModalBase,ModalHistoryChart.prototype.optionTemplate={name:"toolBox.modal.HIS_CHART",parent:1,mode:["easyHistory"],maxNum:5,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"ModalHistoryChart"},ModalHistoryChart.prototype.optionDefault={tooltip:{trigger:"axis"},toolbox:{show:!1,feature:{dataView:{show:!1,readOnly:!0},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!1,dataZoom:{show:!0},grid:{x:70,x2:10,y2:24},xAxis:[{type:"time",splitLine:{show:!1}}],yAxis:[{type:"value",splitArea:{show:!1}}]},ModalHistoryChart.prototype.renderModal=function(){var timeType,_this=this,hourMilSec=36e5,dayMilSec=864e5,weekMilSec=6048e5+dayMilSec,startDate=new Date,endDate=new Date;if("hour"==_this.entity.modal.option.timeType&&(timeType="m5",startDate.setTime(endDate.getTime()-hourMilSec)),"day"==_this.entity.modal.option.timeType)timeType="h1",startDate.setTime(endDate.getTime()-dayMilSec);else if("week"==_this.entity.modal.option.timeType)timeType="d1",startDate.setTime(endDate.getTime()-weekMilSec);else if("month"==_this.entity.modal.option.timeType){timeType="d1";var year=endDate.getFullYear(),month=endDate.getMonth();0==month?(startDate.setFullYear(year-1),startDate.setMonth(11)):startDate.setMonth(month-1)}else{if("year"!=_this.entity.modal.option.timeType)return;timeType="M1",startDate.setFullYear(endDate.getFullYear()-1)}var optPtName=_this.entity.modal.points;WebAPI.post("/analysis/startWorkspaceDataGenHistogram",{dsItemIds:optPtName,timeStart:startDate.format("yyyy-MM-dd HH:mm:ss"),timeEnd:endDate.format("yyyy-MM-dd HH:mm:ss"),timeFormat:timeType}).done(function(result){var dataSrc=JSON.parse(result);if(!(void 0==dataSrc||0>=dataSrc)){var option=_this.initOption(dataSrc);_this.chart.setOption($.extend(!0,{},_this.optionDefault,option))}}).error(function(e){}).always(function(e){_this.spinner.stop()})},ModalHistoryChart.prototype.updateModal=function(options){},ModalHistoryChart.prototype.showConfigMode=function(){},ModalHistoryChart}(),ModalHistoryChartNormal=function(){function ModalHistoryChartNormal(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal,showConfigMode=_showConfigMode?_showConfigMode:this.showConfigMode;ModalHistoryChart.call(this,screen,entityParams,renderModal,updateModal,showConfigMode),this.chart=echarts.init(this.container,"macarons"),this.spinner.spin(this.container)}}var m_color=["#e74a37","#ff8050","#1abd9b","#3499da","#3e72ac"],m_colorLen=m_color.length;return ModalHistoryChartNormal.prototype=new ModalHistoryChart,ModalHistoryChartNormal.prototype.optionTemplate={name:"toolBox.modal.HIS_CHART_ENERGY_LINE",parent:1,mode:["easyHistory"],maxNum:5,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"ModalHistoryChartNormal"},ModalHistoryChartNormal.prototype.initOption=function(dataSrc){if(void 0!=dataSrc&&void 0!=dataSrc.list[0].data){var xAxis,xLen=dataSrc.timeShaft.length,arrXAxis=[];if("month"==this.entity.modal.option.timeType)for(var i=0;xLen>i;i++)arrXAxis.push(new Date(dataSrc.timeShaft[i].replace(/-/g,"/")).format("MM-dd"));else if("week"==this.entity.modal.option.timeType)for(var i=0;xLen>i;i++)arrXAxis.push(new Date(dataSrc.timeShaft[i].replace(/-/g,"/")).format("yyyy-MM-dd"));else if("day"==this.entity.modal.option.timeType)for(var i=0;xLen>i;i++)arrXAxis.push(new Date(dataSrc.timeShaft[i].replace(/-/g,"/")).format("MM-dd HH:00"));xAxis=[{type:"category",data:arrXAxis}];for(var dataName=[],arrSeries=[],i=0,showColor="#1abd9b",i=0;i<dataSrc.list.length;i++){var key=dataSrc.list[i].dsItemId;dataSrc.list.length>1&&(showColor=m_color[i%m_colorLen]),dataName.push(AppConfig.datasource.getDSItemById(key).alias),arrSeries.push({name:dataName[i],type:this.entity.modal.option.showType,data:dataSrc.list[i].data,markPoint:{data:[{type:"max",name:I18n.resource.dashboard.modalHistoryChart.MAXIMUM},{type:"min",name:I18n.resource.dashboard.modalHistoryChart.MINIMUM}]},itemStyle:{normal:{color:showColor,barBorderRadius:[5,5,0,0]},emphasis:{color:showColor,barBorderRadius:[5,5,0,0]}}}),i++}return dataOption={title:{text:"",subtext:""},legend:{data:dataName},dataZoom:{show:!1},grid:{x:70,x2:20,y2:24},xAxis:xAxis,series:arrSeries},dataOption}},ModalHistoryChartNormal.prototype.setModalOption=function(option){this.entity.modal.option={},this.entity.modal.option.showType="bar",this.entity.modal.option.timeType=option.timeType},ModalHistoryChartNormal}(),ModalHistoryChartEnergyConsume=function(){function ModalHistoryChartEnergyConsume(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal,showConfigMode=_showConfigMode?_showConfigMode:this.showConfigMode;ModalHistoryChart.call(this,screen,entityParams,renderModal,updateModal,showConfigMode),this.chart=echarts.init(this.container,"macarons"),this.spinner.spin(this.container)}}var m_color=["#e74a37","#ff8050","#1abd9b","#3499da","#3e72ac"],m_colorLen=m_color.length;return ModalHistoryChartEnergyConsume.prototype=new ModalHistoryChart,ModalHistoryChartEnergyConsume.prototype.optionTemplate={name:"toolBox.modal.HIS_CHART_ENERGY_BAR",parent:1,mode:["easyHistory"],maxNum:5,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"ModalHistoryChartEnergyConsume"},ModalHistoryChartEnergyConsume.prototype.initOption=function(dataSrc){if(void 0!=dataSrc&&void 0!=dataSrc.list&&void 0!=dataSrc.list[0].data){var xAxis,showColor,xLen=dataSrc.timeShaft.length,arrXAxis=[];if("week"==this.entity.modal.option.timeType){for(var i=0;xLen-1>i;i++){var dayNum=new Date(dataSrc.timeShaft[i].replace(/-/g,"/")).getDay();arrXAxis.push(i18n_resource.dataSource.WEEK[dayNum])}showColor="#3499da"}else if("month"==this.entity.modal.option.timeType){for(var i=0;xLen-1>i;i++)arrXAxis.push(new Date(dataSrc.timeShaft[i].replace(/-/g,"/")).format("MM-dd"));showColor=m_color[0]}else if("year"==this.entity.modal.option.timeType){for(var i=0;xLen-1>i;i++){var monthNum=new Date(dataSrc.timeShaft[i].replace(/-/g,"/")).getMonth();arrXAxis.push(i18n_resource.dataSource.MONTH[monthNum])}showColor="#3e72ac"}else if("day"==this.entity.modal.option.timeType){for(var i=0;xLen-1>i;i++)arrXAxis.push(new Date(dataSrc.timeShaft[i].replace(/-/g,"/")).format("MM-dd HH:00"));showColor="#3e72ac"}xAxis=[{type:"category",data:arrXAxis}];for(var dataName=[],arrSeries=[],i=0,i=0;i<dataSrc.list.length;i++){var key=dataSrc.list[i].dsItemId;dataSrc.list.length>1&&(showColor=m_color[i%m_colorLen]),dataName.push(AppConfig.datasource.getDSItemById(key).alias);for(var defVal,arrData=[],hisLen=dataSrc.list[0].data.length,fixNum=0,j=1;hisLen>j;j++){var preVal=dataSrc.list[0].data[j-1];0!=preVal?(defVal=dataSrc.list[0].data[j]-preVal,fixNum=100>defVal?2:0,arrData.push(parseFloat(defVal.toFixed(fixNum)))):arrData.push(0)}arrSeries.push({name:dataName[i],type:this.entity.modal.option.showType,data:arrData,markPoint:{data:[{type:"max",name:I18n.resource.dashboard.modalHistoryChart.MAXIMUM},{type:"min",name:I18n.resource.dashboard.modalHistoryChart.MINIMUM}]},itemStyle:{normal:{color:showColor,barBorderRadius:[5,5,5,5]},emphasis:{color:showColor,barBorderRadius:[5,5,5,5]}}}),i++}return dataOption={title:{text:"",subtext:""},legend:{show:!1,data:dataName},dataZoom:{show:!1},grid:{x:70,x2:10,y2:24},xAxis:xAxis,series:arrSeries},dataOption}},ModalHistoryChartEnergyConsume.prototype.setModalOption=function(option){this.entity.modal.option={},this.entity.modal.option.showType="bar",this.entity.modal.option.timeType=option.timeType},ModalHistoryChartEnergyConsume}(),ModalHistoryChartYearOnYearLine=function(){function ModalHistoryChartYearOnYearLine(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal,showConfigModal=_showConfigMode?_showConfigMode:this.showConfigMode;ModalBase.call(this,screen,entityParams,renderModal,updateModal,showConfigModal),this.option=entityParams.option,this.chart=echarts.init(this.container,"macarons"),this.spinner.spin(this.container)}}return ModalHistoryChartYearOnYearLine.prototype=new ModalBase,ModalHistoryChartYearOnYearLine.prototype.optionTemplate={name:"toolBox.modal.HIS_CHART_YEAR_LINE",parent:1,mode:["easyCompare"],maxNum:1,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"ModalHistoryChartYearOnYearLine"},ModalHistoryChartYearOnYearLine.prototype.optionDefault={tooltip:{trigger:"axis"},toolbox:{show:!1,feature:{dataView:{show:!1,readOnly:!0},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!1,dataZoom:{show:!1},grid:{x:70,x2:20,y2:24},xAxis:[{type:"time",splitLine:{show:!1}}],yAxis:[{type:"value",splitArea:{show:!1}}]},ModalHistoryChartYearOnYearLine.prototype.renderModal=function(){var timeType,_this=this,hourMilSec=36e5,dayMilSec=864e5,startDate=new Date,endDate=new Date,tmFlag=new Date;if("hour"==_this.entity.modal.option.timeType&&(timeType="m5",startDate.setTime(endDate.getTime()-hourMilSec),startDate.setMinutes(0),startDate.setSeconds(0),tmFlag.setTime(endDate.getTime()),tmFlag.setMinutes(0),tmFlag.setSeconds(0)),"day"==_this.entity.modal.option.timeType){timeType="h1",startDate.setTime(endDate.getTime()-dayMilSec),startDate.setHours(0),startDate.setMinutes(0),startDate.setSeconds(0),tmFlag.setTime(endDate.getTime()),tmFlag.setHours(0),tmFlag.setMinutes(0),tmFlag.setSeconds(0);var optPtName=_this.entity.modal.points;WebAPI.post("/analysis/startWorkspaceDataGenHistogram",{dsItemIds:optPtName,timeStart:startDate.format("yyyy-MM-dd HH:mm:ss"),timeEnd:endDate.format("yyyy-MM-dd HH:mm:ss"),timeFormat:timeType}).done(function(result){var dataSrc=JSON.parse(result);if(void 0!=dataSrc&&void 0!=dataSrc.list[0].data){var arrXAxis=[],flagCount=0,len=dataSrc.timeShaft.length;for(flagCount=0;len>flagCount&&!(new Date(dataSrc.timeShaft[flagCount].replace(/-/g,"/"))>=tmFlag);flagCount++);for(var setVal,fixNum=0,dataName=[],arrSeries=[],k=0,lenK=dataSrc.timeShaft.length;lenK>k;k++)flagCount>k&&arrXAxis.push(new Date(dataSrc.timeShaft[k].replace(/-/g,"/")).format("HH:mm"));for(var currentCount=0,n=0;n<dataSrc.list.length;n++){key=dataSrc.list[n].dsItemId;var dataSrc1=[],dataSrc2=[],eachName=[];1==dataSrc.list.length?(dataName.push(I18n.resource.dataSource.TIME_YESTERDAY),dataName.push(I18n.resource.dataSource.TIME_TODAY),eachName.push(I18n.resource.dataSource.TIME_YESTERDAY),eachName.push(I18n.resource.dataSource.TIME_TODAY)):(dataName.push(key+"_"+I18n.resource.dataSource.TIME_YESTERDAY),dataName.push(key+"_"+I18n.resource.dataSource.TIME_TODAY),eachName.push(key+"_"+I18n.resource.dataSource.TIME_YESTERDAY),eachName.push(key+"_"+I18n.resource.dataSource.TIME_TODAY));for(var j=0,len=dataSrc.list[n].data.length;len>j;j++)setVal=dataSrc.list[n].data[j],fixNum=100>setVal?2:0,setVal=parseFloat(setVal.toFixed(fixNum)),flagCount>j?dataSrc1.push(setVal):dataSrc2.push(setVal);for(var showColor,showData,showMark,i=0;2>i;i++){if(0==i)showColor=0==currentCount?"#1abd9b":echarts.config.color[2*currentCount],showData=dataSrc1,showMark={data:[{type:"max",name:I18n.resource.dashboard.modalHistoryChart.MAXIMUM},{type:"min",name:I18n.resource.dashboard.modalHistoryChart.MINIMUM}]};else if(1==i){showColor=0==currentCount?"#e74a37":echarts.config.color[2*currentCount+1],showData=dataSrc2;var lastCntX=dataSrc2.length-1,lastCntY=Number(dataSrc2[lastCntX]);showMark={symbol:"emptyCircle",symbolSize:10,effect:{show:!0,shadowBlur:0},itemStyle:{normal:{label:{show:!1}},emphasis:{label:{position:"top"}}},data:[{name:"",value:lastCntY,xAxis:lastCntX,yAxis:lastCntY}]}}arrSeries.push({name:eachName[i],type:"line",data:showData,markPoint:showMark,itemStyle:{normal:{color:showColor,barBorderRadius:[5,5,0,0]},emphasis:{color:showColor,barBorderRadius:[5,5,0,0]}},symbolSize:3}),showColor=""}currentCount++}var xAxis=[{type:"category",boundaryGap:!1,data:arrXAxis}],option={title:{text:"",subtext:""},dataZoom:{show:!1},legend:{data:dataName},xAxis:xAxis,series:arrSeries};_this.chart.setOption($.extend(!0,{},_this.optionDefault,option))}}).error(function(e){}).always(function(e){_this.spinner.stop()})}},ModalHistoryChartYearOnYearLine.prototype.updateModal=function(options){if(!(void 0===options||options.length<1||void 0===options[0])){for(var _this=this,addParam=[],i=0,len=options.length;len>i;i++){var item=[1,options[i].data,!1,!0];addParam.push(item)}_this.chart.addData(addParam),_this.chart.delMarkPoint(1,"");var dataSeries=_this.chart.getOption().series;if(!(dataSeries.length<2)){var temp=dataSeries[1].data,lastCntX=temp.length-1,lastCntY=Number(temp[lastCntX]),showMark={symbol:"emptyCircle",symbolSize:10,effect:{show:!0,shadowBlur:0},itemStyle:{normal:{label:{show:!1}},emphasis:{label:{position:"top"}}},data:[{name:"",value:lastCntY,xAxis:lastCntX,yAxis:lastCntY}]};_this.chart.addMarkPoint(1,showMark)}}},ModalHistoryChartYearOnYearLine.prototype.showConfigMode=function(){},ModalHistoryChartYearOnYearLine.prototype.setModalOption=function(option){this.entity.modal.option={},this.entity.modal.option.showType="line",this.entity.modal.option.timeType=option.timeType},ModalHistoryChartYearOnYearLine}(),ModalHistoryChartYearOnYearBar=function(){function ModalHistoryChartYearOnYearBar(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal,showConfigModal=_showConfigMode?_showConfigMode:this.showConfigMode;ModalBase.call(this,screen,entityParams,renderModal,updateModal,showConfigModal),this.option=entityParams.option,this.chart=echarts.init(this.container,"macarons"),this.spinner.spin(this.container)}}var m_color=["#e74a37","#ff8050","#1abd9b","#3499da","#3e72ac"];return ModalHistoryChartYearOnYearBar.prototype=new ModalBase,
ModalHistoryChartYearOnYearBar.prototype.optionTemplate={name:"toolBox.modal.HIS_CHART_YEAR_BAR",parent:1,mode:["easyCompare"],maxNum:1,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"ModalHistoryChartYearOnYearBar"},ModalHistoryChartYearOnYearBar.prototype.optionDefault={tooltip:{trigger:"axis"},toolbox:{show:!1,feature:{dataView:{show:!1,readOnly:!0},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!1,dataZoom:{show:!1},grid:{x:70,x2:10,y2:24},xAxis:[{type:"category",splitLine:{show:!1}}],yAxis:[{type:"value",splitArea:{show:!1}}]},ModalHistoryChartYearOnYearBar.prototype.renderModal=function(){var timeType,_this=this,dayMilSec=864e5,startDate=new Date,endDate=new Date,startDateZero=new Date,endDateZero=new Date;if("day"==_this.entity.modal.option.timeType){timeType="h1",startDate.setTime(endDate.getTime()-dayMilSec),startDateZero.setTime(startDate.getTime()),startDateZero.setHours(0),startDateZero.setMinutes(0),startDateZero.setSeconds(0),endDateZero.setTime(endDate.getTime()),endDateZero.setHours(0),endDateZero.setMinutes(0),endDateZero.setSeconds(0);var optPtName=_this.entity.modal.points;optPtName.length>1||WebAPI.post("/analysis/startWorkspaceDataGenHistogram",{dsItemIds:optPtName,timeStart:startDateZero.format("yyyy-MM-dd HH:mm:ss"),timeEnd:endDate.format("yyyy-MM-dd HH:mm:ss"),timeFormat:timeType}).done(function(result){var dataSrc=JSON.parse(result);if(void 0!=dataSrc&&void 0!=dataSrc.list[0].data){for(var flag1,flag2,len=dataSrc.timeShaft.length,i=0;len>i;i++)if(new Date(dataSrc.timeShaft[i].replace(/-/g,"/"))>=startDate){flag1=i;break}for(var i=0;len>i;i++)if(new Date(dataSrc.timeShaft[i].replace(/-/g,"/"))>=endDateZero){flag2=i;break}for(var arrVal1=[],arrVal2=[],val1=0,val2=0,fixNum1=0,fixNum2=0,preVal=0,i=0;i<dataSrc.list.length;i++){key=dataSrc.list[i].dsItemId;for(var j=0,len=dataSrc.list[i].data.length;len>j;j++)j==flag1?(preVal=dataSrc.list[i].data[0],val1=0==preVal?0:dataSrc.list[i].data[j]-preVal):j==flag2&&(preVal=dataSrc.list[i].data[j],val2=0==preVal?0:dataSrc.list[i].data[len-1]-preVal);fixNum1=100>val1?2:0,fixNum2=100>val2?2:0,arrVal1.push(parseFloat(val1.toFixed(fixNum1))),arrVal2.push(parseFloat(val2.toFixed(fixNum2)));break}var xAxis=[{type:"category",show:!1,boundaryGap:!0,data:optPtName}],dataName=[];dataName.push(I18n.resource.dataSource.TIME_YESTERDAY),dataName.push(I18n.resource.dataSource.TIME_TODAY);var arrSeries=[{name:dataName[0],type:"bar",data:arrVal1,itemStyle:{normal:{color:m_color[2],barBorderRadius:[5,5,0,0]},emphasis:{color:m_color[2],barBorderRadius:[5,5,0,0]}},markPoint:{data:[{type:"max",name:I18n.resource.dashboard.modalHistoryChart.EnergyConsumption}]}},{name:dataName[1],type:"bar",data:arrVal2,itemStyle:{normal:{color:m_color[1],barBorderRadius:[5,5,0,0]},emphasis:{color:m_color[1],barBorderRadius:[5,5,0,0]}},markPoint:{data:[{type:"max",name:I18n.resource.dashboard.modalHistoryChart.EnergyConsumption}]}}],option={title:{text:"",subtext:""},dataZoom:{show:!1},legend:{data:dataName},xAxis:xAxis,series:arrSeries};_this.chart.setOption($.extend(!0,{},_this.optionDefault,option))}}).error(function(e){}).always(function(e){_this.spinner.stop()})}},ModalHistoryChartYearOnYearBar.prototype.updateModal=function(options){},ModalHistoryChartYearOnYearBar.prototype.showConfigMode=function(){},ModalHistoryChartYearOnYearBar.prototype.setModalOption=function(option){this.entity.modal.option={},this.entity.modal.option.showType="bar",this.entity.modal.option.timeType=option.timeType},ModalHistoryChartYearOnYearBar}(),ModalCarbonFootprint=function(){function ModalCarbonFootprint(containerId,entityParams){ModalBase.call(this,containerId,entityParams,this.renderModal,this.updateModal,this.showConfigMode),this.isFirstTime=!0,this.widthRuler=void 0,this.$elMask=void 0,this.elPaneValue=void 0,this.elPaneTitle=void 0,this.maxValue=void 0}return ModalCarbonFootprint.prototype=new ModalBase,ModalCarbonFootprint.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_CARBON_FOOTPRINT",parent:0,mode:["realTimeDashboard"],maxNum:1,title:"",minHeight:3,minWidth:4,maxHeight:6,maxWidth:12,type:"ModalCarbonFootprint"},ModalCarbonFootprint.prototype.renderModal=function(){this.isFirstTime&&this.init()},ModalCarbonFootprint.prototype.init=function(){var _this=this;WebAPI.get("/static/scripts/spring/entities/modalCarbonFootprint.html").done(function(resultHTML){_this.container.innerHTML=resultHTML,_this.initStandard(),_this.isFirstTime=!1,I18n.fillArea($(".divCFTitle").parent())})},ModalCarbonFootprint.prototype.initStandard=function(){$divMain=$(this.container),this.widthRuler=$divMain.find(".cfProcessScale").width(),this.$elMask=$divMain.find(".cfProcessMask"),this.elPaneValue=document.getElementById("cfFootprintDashboardCurrent"),this.elPaneTitle=document.getElementById("divCFTitle");var unitValue=this.entity.modal.option.valueStandard/4;this.maxValue=5*unitValue;for(var tdScaleNums=this.container.getElementsByClassName("cfProcessScaleNum"),i=0,len=tdScaleNums.length;len>i;i++)tdScaleNums[i].textContent=parseInt(unitValue*i).toString();$divMain.find(".cfLegendBarWarning").animate({width:.2*this.widthRuler+"px"},1e3),document.getElementById("cfFootprintDashboardStandard").textContent=this.entity.modal.option.valueStandard},ModalCarbonFootprint.prototype.updateModal=function(points){var value=parseFloat(points[0].data).toFixed(1).toString();this.elPaneValue.textContent=value,this.elPaneTitle.textContent=value,this.$elMask.animate({width:this.widthRuler-value*this.widthRuler/this.maxValue+"px"},1e3)},ModalCarbonFootprint.prototype.showConfigMode=function(){},ModalCarbonFootprint.prototype.setModalOption=function(option){this.entity.modal.option={},this.entity.modal.option.valueStandard=3500},ModalCarbonFootprint}(),ModalWeather=function(){function ModalWeather(screen,entityParams,_renderModal,_updateModal,_showConfigMode){if(screen){var renderModal=_renderModal?_renderModal:this.renderModal,updateModal=_updateModal?_updateModal:this.updateModal,showConfigMode=_showConfigMode?_showConfigMode:this.showConfigMode;ModalBase.call(this,screen,entityParams,renderModal,updateModal,showConfigMode)}}ModalWeather.prototype=new ModalBase,ModalWeather.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_WEATHER",parent:0,mode:["weather"],maxNum:0,title:"",minHeight:2,minWidth:4,maxHeight:6,maxWidth:12,type:"ModalWeather"};var yin='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                <path fill="#009FE3" d="M75.291,34.467C70.5,26.344,61.767,21.32,52.311,21.32c-12.728,0-23.524,8.832-26.105,21.158  c-6.569,2.188-11.324,8.382-11.324,15.676c0,9.111,7.414,16.525,16.526,16.525c3.289,0,6.415-0.945,9.119-2.745  c3.647,1.8,7.688,2.745,11.785,2.745c4.251,0,8.451-1.029,12.205-2.966c3.149,1.939,6.733,2.966,10.492,2.966  c11.089,0,20.11-9.021,20.11-20.109C95.118,43.577,86.249,34.621,75.291,34.467z M75.007,69.104c-3.247,0-6.315-1.046-8.877-3.023  c-1.219-0.941-2.969-0.716-3.91,0.503c-0.018,0.021-0.027,0.047-0.045,0.07c-3.019,1.6-6.42,2.45-9.865,2.45  c-3.653,0-7.255-0.947-10.41-2.74c-0.795-0.451-1.713-0.461-2.488-0.123c-0.447,0.072-0.883,0.245-1.263,0.542  c-1.94,1.519-4.271,2.32-6.744,2.32c-6.038,0-10.95-4.911-10.95-10.949s4.912-10.951,10.95-10.951c3.048,0,5.979,1.285,8.048,3.521  c1.044,1.132,2.809,1.201,3.938,0.157c1.131-1.045,1.202-2.809,0.157-3.938c-2.941-3.187-7.042-5.088-11.354-5.296  C34.91,32.951,42.94,26.893,52.31,26.893c6.688,0,12.931,3.178,16.885,8.443c-2.639,0.797-5.108,2.118-7.232,3.93  c-1.171,0.999-1.311,2.761-0.313,3.932c1,1.172,2.762,1.31,3.932,0.31c2.624-2.239,5.973-3.472,9.428-3.472  c8.014,0,14.535,6.52,14.535,14.534C89.542,62.584,83.021,69.104,75.007,69.104z"/>\r\n                </svg>',dayu='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                <g>\r\n                    <path fill="#009FE3" d="M75.293,23.69c-4.791-8.123-13.525-13.147-22.981-13.147c-12.726,0-23.525,8.832-26.107,21.159   c-6.568,2.188-11.323,8.381-11.323,15.675c0,9.112,7.414,16.526,16.525,16.526c3.289,0,6.415-0.945,9.119-2.744   c3.648,1.797,7.689,2.744,11.786,2.744c4.25,0,8.452-1.029,12.206-2.966c3.149,1.938,6.732,2.966,10.492,2.966   c11.088,0,20.108-9.021,20.108-20.11C95.118,32.798,86.251,23.841,75.293,23.69z M75.01,58.326c-3.246,0-6.315-1.045-8.877-3.023   c-1.22-0.941-2.971-0.717-3.91,0.503c-0.019,0.021-0.027,0.047-0.043,0.069c-3.021,1.601-6.422,2.451-9.867,2.451   c-3.656,0-7.256-0.947-10.411-2.74c-0.794-0.453-1.713-0.461-2.491-0.123c-0.444,0.074-0.879,0.244-1.26,0.543   c-1.938,1.52-4.271,2.32-6.743,2.32c-6.038,0-10.951-4.912-10.951-10.95c0-6.038,4.913-10.951,10.951-10.951   c3.045,0,5.979,1.285,8.047,3.523c1.047,1.131,2.81,1.202,3.939,0.156c1.131-1.045,1.201-2.81,0.156-3.938   c-2.942-3.185-7.043-5.086-11.354-5.294c2.718-8.697,10.748-14.755,20.117-14.755c6.69,0,12.929,3.177,16.885,8.443   c-2.64,0.797-5.109,2.118-7.233,3.93c-1.17,0.999-1.311,2.76-0.312,3.931c0.999,1.172,2.759,1.311,3.931,0.311   c2.624-2.239,5.973-3.472,9.43-3.472c8.014,0,14.533,6.52,14.533,14.534C89.544,51.806,83.023,58.326,75.01,58.326z"/>\r\n                    <path fill="#009FE3" d="M44.751,79.875c0,3.084-2.5,5.582-5.583,5.582s-5.583-2.498-5.583-5.582s5.583-11.408,5.583-11.408   S44.751,76.791,44.751,79.875z"/>\r\n                    <path fill="#009FE3" d="M59.557,79.875c0,3.084-2.5,5.582-5.582,5.582c-3.084,0-5.583-2.498-5.583-5.582s5.583-11.408,5.583-11.408   S59.557,76.791,59.557,79.875z"/>\r\n                    <path fill="#009FE3" d="M74.362,79.875c0,3.084-2.499,5.582-5.583,5.582c-3.083,0-5.583-2.498-5.583-5.582   s5.583-11.408,5.583-11.408S74.362,76.791,74.362,79.875z"/>\r\n                </g>\r\n                </svg>',baoyu='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                <g>\r\n                    <path fill="#009FE3" d="M75.292,23.756c-4.791-8.123-13.524-13.146-22.98-13.146c-12.729,0-23.527,8.832-26.107,21.159   c-6.569,2.187-11.324,8.381-11.324,15.675c0,9.112,7.414,16.526,16.526,16.526c3.29,0,6.416-0.946,9.118-2.745   c3.648,1.799,7.69,2.745,11.787,2.745c4.25,0,8.452-1.03,12.206-2.967c3.148,1.939,6.731,2.967,10.492,2.967   c11.088,0,20.109-9.021,20.109-20.11C95.119,32.865,86.25,23.909,75.292,23.756z M75.008,58.394c-3.246,0-6.316-1.046-8.878-3.024   c-1.219-0.94-2.969-0.716-3.909,0.503c-0.019,0.021-0.027,0.047-0.045,0.07c-3.02,1.6-6.421,2.451-9.865,2.451   c-3.655,0-7.256-0.948-10.412-2.741c-0.795-0.451-1.713-0.461-2.49-0.122c-0.445,0.074-0.881,0.244-1.261,0.542   c-1.94,1.519-4.271,2.321-6.743,2.321c-6.038,0-10.951-4.912-10.951-10.95s4.913-10.951,10.951-10.951   c3.046,0,5.979,1.285,8.047,3.522c1.044,1.132,2.808,1.2,3.938,0.156c1.132-1.045,1.202-2.809,0.157-3.938   c-2.94-3.187-7.042-5.087-11.354-5.295c2.717-8.697,10.748-14.755,20.118-14.755c6.688,0,12.928,3.177,16.884,8.442   c-2.641,0.797-5.11,2.118-7.234,3.931c-1.171,0.999-1.31,2.76-0.313,3.931c1,1.172,2.762,1.31,3.932,0.31   c2.623-2.238,5.973-3.472,9.428-3.472c8.016,0,14.535,6.521,14.535,14.534C89.543,51.872,83.021,58.394,75.008,58.394z"/>\r\n                    <path fill="#009FE3" d="M30.448,85.391c-0.531,0-1.067-0.149-1.543-0.47c-1.281-0.854-1.628-2.584-0.773-3.864l9.026-13.539   c0.854-1.28,2.584-1.629,3.865-0.772c1.281,0.854,1.627,2.584,0.773,3.865L32.77,84.151C32.232,84.955,31.348,85.391,30.448,85.391   z"/>\r\n                    <path fill="#009FE3" d="M45.313,85.391c-0.53,0-1.067-0.149-1.543-0.47c-1.281-0.854-1.627-2.584-0.772-3.864l9.026-13.539   c0.854-1.28,2.585-1.629,3.865-0.772c1.281,0.854,1.627,2.584,0.773,3.865l-9.026,13.541   C47.099,84.955,46.214,85.391,45.313,85.391z"/>\r\n                    <path fill="#009FE3" d="M60.182,85.391c-0.53,0-1.067-0.149-1.543-0.47c-1.283-0.854-1.627-2.584-0.772-3.864l9.024-13.539   c0.854-1.28,2.586-1.629,3.867-0.772c1.279,0.854,1.627,2.584,0.772,3.865l-9.027,13.541   C61.967,84.955,61.083,85.391,60.182,85.391z"/>\r\n                </g>\r\n                </svg>',duoyun='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                    <g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M59.271,34.332c-4.592-8.123-12.961-13.146-22.021-13.146c-12.197,0-22.546,8.832-25.019,21.159    C5.936,44.531,1.379,50.726,1.379,58.02c0,9.111,7.104,16.525,15.836,16.525c3.152,0,6.148-0.945,8.739-2.745    c3.495,1.8,7.368,2.745,11.295,2.745c4.074,0,8.098-1.029,11.696-2.966c3.017,1.939,6.451,2.966,10.053,2.966    c10.627,0,19.271-9.021,19.271-20.109C78.271,43.441,69.772,34.485,59.271,34.332z M58.998,68.97    c-3.109,0-6.051-1.047-8.506-3.024c-1.168-0.94-2.845-0.715-3.747,0.503c-0.017,0.021-0.025,0.047-0.042,0.07    c-2.893,1.601-6.153,2.452-9.453,2.452c-3.504,0-6.953-0.948-9.977-2.741c-0.759-0.45-1.639-0.46-2.384-0.123    c-0.428,0.074-0.846,0.244-1.211,0.542c-1.86,1.519-4.096,2.321-6.463,2.321c-5.787,0-10.494-4.912-10.494-10.95    s4.707-10.951,10.494-10.951c2.92,0,5.729,1.285,7.711,3.521c1.003,1.134,2.692,1.202,3.775,0.157    c1.084-1.045,1.15-2.809,0.147-3.938c-2.817-3.187-6.749-5.087-10.88-5.295c2.604-8.697,10.3-14.755,19.277-14.755    c6.411,0,12.39,3.177,16.181,8.442c-2.528,0.797-4.897,2.118-6.934,3.93c-1.121,0.999-1.254,2.761-0.296,3.932    c0.959,1.171,2.645,1.31,3.767,0.31c2.514-2.238,5.722-3.472,9.033-3.472c7.682,0,13.93,6.52,13.93,14.534    C72.928,62.448,66.68,68.97,58.998,68.97z"/>\r\n                            <g>\r\n                                <path fill="#009FE3" d="M93.438,42.01c-3.744-6.411-10.431-10.365-17.66-10.365c-3.071,0-6.082,0.715-8.819,2.063     c1.803,1.117,3.451,2.482,4.896,4.05c1.271-0.351,2.588-0.537,3.923-0.537c4.587,0,8.882,2.146,11.767,5.744     c-1.765,0.665-3.414,1.654-4.861,2.941c-1.121,1-1.254,2.759-0.297,3.931c0.957,1.17,2.644,1.312,3.767,0.313     c1.874-1.67,4.269-2.59,6.735-2.59c5.729,0,10.388,4.861,10.388,10.839c0,5.977-4.659,10.84-10.388,10.84     c-2.319,0-4.514-0.78-6.344-2.256c-1.148-0.927-2.791-0.718-3.701,0.452c-2.168,1.176-4.6,1.804-7.064,1.804     c-0.736,0-1.473-0.063-2.195-0.17c-1.275,1.733-2.77,3.286-4.441,4.603c2.129,0.752,4.373,1.145,6.638,1.145     c3.188,0,6.343-0.781,9.181-2.25c2.396,1.469,5.099,2.25,7.93,2.25c8.675,0,15.73-7.365,15.73-16.416     C108.619,49.538,101.856,42.316,93.438,42.01z"/>\r\n                            </g>\r\n                        </g>\r\n                        <path fill="#009FE3" d="M59.271,34.332c-4.592-8.123-12.961-13.146-22.021-13.146c-12.197,0-22.546,8.832-25.019,21.159   C5.936,44.531,1.379,50.726,1.379,58.02c0,9.111,7.104,16.525,15.836,16.525c3.152,0,6.148-0.945,8.739-2.745   c3.495,1.8,7.368,2.745,11.295,2.745c4.074,0,8.098-1.029,11.696-2.966c3.017,1.939,6.451,2.966,10.053,2.966   c10.627,0,19.271-9.021,19.271-20.109C78.271,43.441,69.772,34.485,59.271,34.332z M58.998,68.97c-3.109,0-6.051-1.047-8.506-3.024   c-1.168-0.94-2.845-0.715-3.747,0.503c-0.017,0.021-0.025,0.047-0.042,0.07c-2.893,1.601-6.153,2.452-9.453,2.452   c-3.504,0-6.953-0.948-9.977-2.741c-0.759-0.45-1.639-0.46-2.384-0.123c-0.428,0.074-0.846,0.244-1.211,0.542   c-1.86,1.519-4.096,2.321-6.463,2.321c-5.787,0-10.494-4.912-10.494-10.95s4.707-10.951,10.494-10.951   c2.92,0,5.729,1.285,7.711,3.521c1.003,1.134,2.692,1.202,3.775,0.157c1.084-1.045,1.15-2.809,0.147-3.938   c-2.817-3.187-6.749-5.087-10.88-5.295c2.604-8.697,10.3-14.755,19.277-14.755c6.411,0,12.39,3.177,16.181,8.442   c-2.528,0.797-4.897,2.118-6.934,3.93c-1.121,0.999-1.254,2.761-0.296,3.932c0.959,1.171,2.645,1.31,3.767,0.31   c2.514-2.238,5.722-3.472,9.033-3.472c7.682,0,13.93,6.52,13.93,14.534C72.928,62.448,66.68,68.97,58.998,68.97z"/>\r\n                    </g>\r\n                    </svg>',xiaoyu='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                <g>\r\n                    <path fill="#009FE3" d="M75.293,23.69c-4.791-8.123-13.523-13.147-22.98-13.147c-12.727,0-23.526,8.831-26.107,21.159   c-6.567,2.188-11.323,8.382-11.323,15.675c0,9.112,7.414,16.526,16.525,16.526c3.289,0,6.415-0.945,9.119-2.744   c3.647,1.799,7.688,2.744,11.786,2.744c4.25,0,8.451-1.029,12.205-2.966c3.147,1.938,6.731,2.966,10.492,2.966   c11.09,0,20.108-9.021,20.108-20.11C95.118,32.798,86.25,23.842,75.293,23.69z M75.009,58.326c-3.246,0-6.316-1.047-8.877-3.023   c-1.22-0.941-2.971-0.717-3.91,0.501c-0.02,0.021-0.027,0.048-0.045,0.069c-2.15,1.142-4.495,1.896-6.912,2.238l-6.184-0.043   c-2.521-0.39-4.963-1.224-7.183-2.482c-0.795-0.453-1.716-0.463-2.493-0.121c-0.443,0.074-0.877,0.244-1.256,0.539   c-1.942,1.52-4.274,2.322-6.745,2.322c-6.038,0-10.951-4.912-10.951-10.951c0-6.038,4.913-10.951,10.951-10.951   c3.046,0,5.979,1.285,8.048,3.523c1.044,1.13,2.811,1.2,3.939,0.156c1.129-1.044,1.2-2.81,0.155-3.938   c-2.941-3.185-7.043-5.086-11.354-5.294c2.716-8.697,10.747-14.755,20.116-14.755c6.689,0,12.929,3.177,16.885,8.443   c-2.639,0.797-5.107,2.118-7.232,3.93c-1.173,1-1.313,2.76-0.313,3.931c0.997,1.17,2.758,1.312,3.93,0.313   c2.625-2.24,5.975-3.473,9.431-3.473c8.015,0,14.534,6.519,14.534,14.534C89.544,51.808,83.024,58.326,75.009,58.326z"/>\r\n                    <path fill="#009FE3" d="M59.558,79.875c0,3.084-2.5,5.582-5.583,5.582s-5.583-2.498-5.583-5.582s5.583-11.408,5.583-11.408   S59.558,76.791,59.558,79.875z"/>\r\n                </g>\r\n                </svg>',qing_duoyun='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                <g>\r\n                    <g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M90.923,16.534c1.333,0.771,1.79,2.479,1.021,3.811l-3.938,6.816c-0.77,1.334-2.475,1.791-3.809,1.021     c-1.332-0.771-1.79-2.477-1.02-3.811l3.938-6.814C87.885,16.225,89.588,15.768,90.923,16.534z"/>\r\n                        </g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M103.951,29.564c0.771,1.334,0.313,3.039-1.021,3.809l-6.818,3.938c-1.332,0.771-3.039,0.313-3.809-1.02     c-0.77-1.336-0.314-3.039,1.02-3.811l6.818-3.938C101.477,27.773,103.18,28.232,103.951,29.564z"/>\r\n                        </g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M108.721,47.36c0,1.541-1.25,2.787-2.787,2.787h-7.873c-1.541,0.002-2.789-1.248-2.789-2.787     c0-1.541,1.248-2.785,2.789-2.787l7.873,0.002C107.471,44.575,108.719,45.819,108.721,47.36z"/>\r\n                        </g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M103.951,65.157c-0.77,1.334-2.475,1.789-3.809,1.021l-6.817-3.938c-1.333-0.77-1.79-2.475-1.021-3.807     c0.771-1.336,2.475-1.791,3.809-1.021l6.818,3.938C104.266,62.118,104.721,63.823,103.951,65.157z"/>\r\n                        </g>\r\n                        <path fill="#009FE3" d="M62.053,28.184c-1.332,0.77-3.037,0.313-3.808-1.021l-3.937-6.818c-0.771-1.332-0.314-3.035,1.02-3.809    c1.333-0.77,3.038-0.313,3.807,1.021l3.938,6.814C63.844,25.708,63.387,27.413,62.053,28.184z"/>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M73.126,25.215c-1.541,0-2.788-1.247-2.788-2.787v-7.873c0-1.539,1.247-2.787,2.788-2.787     c1.54,0,2.787,1.248,2.787,2.787v7.873C75.913,23.969,74.666,25.215,73.126,25.215z"/>\r\n                        </g>\r\n                    </g>\r\n                    <g>\r\n                        <path fill="#009FE3" d="M61.691,44.021c-4.791-8.123-13.524-13.15-22.981-13.15c-12.727,0-23.525,8.83-26.105,21.16    C6.035,54.22,1.279,60.412,1.279,67.707c0,9.111,7.414,16.525,16.526,16.525c3.29,0,6.415-0.947,9.118-2.746    c3.648,1.799,7.691,2.746,11.787,2.746c4.251,0,8.451-1.031,12.205-2.965c3.15,1.938,6.732,2.965,10.493,2.965    c11.088,0,20.108-9.021,20.108-20.109C81.518,53.127,72.648,44.172,61.691,44.021z M61.406,78.654    c-3.247,0-6.317-1.045-8.879-3.025c-1.217-0.939-2.969-0.715-3.909,0.505c-0.017,0.022-0.027,0.048-0.046,0.067    c-3.02,1.604-6.42,2.453-9.864,2.453c-3.655,0-7.255-0.945-10.411-2.742c-0.792-0.449-1.71-0.457-2.485-0.121    c-0.447,0.074-0.884,0.244-1.266,0.541c-1.939,1.521-4.271,2.322-6.742,2.322c-6.038,0-10.951-4.912-10.951-10.949    c0-6.039,4.913-10.951,10.951-10.951c3.047,0,5.979,1.283,8.048,3.523c1.045,1.131,2.809,1.201,3.938,0.156    s1.201-2.809,0.156-3.939c-2.942-3.186-7.042-5.086-11.354-5.295c2.719-8.697,10.748-14.754,20.117-14.754    c6.688,0,12.929,3.176,16.884,8.441c-2.638,0.799-5.109,2.117-7.232,3.932c-1.17,0.998-1.312,2.76-0.312,3.93    s2.761,1.311,3.931,0.313c2.625-2.24,5.973-3.475,9.429-3.475c8.014,0,14.534,6.521,14.534,14.535    C75.941,72.134,69.421,78.654,61.406,78.654z"/>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M91.902,47.586c0-10.354-8.422-18.775-18.775-18.775c-5.336,0.002-10.3,2.225-13.822,6.068     c1.295,1.174,2.498,2.453,3.584,3.846c2.557-2.959,6.254-4.684,10.238-4.686c7.469,0,13.544,6.076,13.544,13.547     c0,3.023-0.987,5.854-2.702,8.139c0.727,1.932,1.217,3.977,1.42,6.1C89.443,58.344,91.902,53.208,91.902,47.586z"/>\r\n                            <g>\r\n                                <path fill="#009FE3" d="M91.943,74.377l-3.938-6.816c-0.55-0.951-1.574-1.445-2.604-1.379c-0.172,2.033-0.6,3.998-1.25,5.855      l2.961,5.126c0.77,1.334,2.475,1.791,3.808,1.021C92.256,77.414,92.713,75.711,91.943,74.377z"/>\r\n                            </g>\r\n                        </g>\r\n                    </g>\r\n                    <path fill="#009FE3" d="M61.691,44.021c-4.791-8.123-13.524-13.15-22.981-13.15c-12.727,0-23.525,8.83-26.105,21.16   C6.035,54.22,1.279,60.412,1.279,67.707c0,9.111,7.414,16.525,16.526,16.525c3.29,0,6.415-0.947,9.118-2.746   c3.648,1.799,7.691,2.746,11.787,2.746c4.251,0,8.451-1.031,12.205-2.965c3.15,1.938,6.732,2.965,10.493,2.965   c11.088,0,20.108-9.021,20.108-20.109C81.518,53.127,72.648,44.172,61.691,44.021z M61.406,78.654   c-3.247,0-6.317-1.045-8.879-3.025c-1.217-0.939-2.969-0.715-3.909,0.505c-0.017,0.022-0.027,0.048-0.046,0.067   c-3.02,1.604-6.42,2.453-9.864,2.453c-3.655,0-7.255-0.945-10.411-2.742c-0.792-0.449-1.71-0.457-2.485-0.121   c-0.447,0.074-0.884,0.244-1.266,0.541c-1.939,1.521-4.271,2.322-6.742,2.322c-6.038,0-10.951-4.912-10.951-10.949   c0-6.039,4.913-10.951,10.951-10.951c3.047,0,5.979,1.283,8.048,3.523c1.045,1.131,2.809,1.201,3.938,0.156   s1.201-2.809,0.156-3.939c-2.942-3.186-7.042-5.086-11.354-5.295c2.719-8.697,10.748-14.754,20.117-14.754   c6.688,0,12.929,3.176,16.884,8.441c-2.638,0.799-5.109,2.117-7.232,3.932c-1.17,0.998-1.312,2.76-0.312,3.93   s2.761,1.311,3.931,0.313c2.625-2.24,5.973-3.475,9.429-3.475c8.014,0,14.534,6.521,14.534,14.535   C75.941,72.134,69.421,78.654,61.406,78.654z"/>\r\n                </g>\r\n                </svg>',qing='<svg  x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n				<g>\r\n					<path fill="#009FE3" d="M54.999,67c-10.354,0-18.776-8.424-18.776-18.774c0-10.354,8.425-18.776,18.776-18.776   c10.354,0,18.775,8.424,18.775,18.776C73.776,58.576,65.354,67,54.999,67z M54.999,34.681c-7.469,0-13.545,6.076-13.545,13.545   c0,7.47,6.076,13.545,13.545,13.545c7.468,0,13.545-6.075,13.545-13.545C68.544,40.756,62.468,34.681,54.999,34.681z"/>\r\n					<g>\r\n						<g>\r\n							<path fill="#009FE3" d="M43.927,67.176c1.333,0.771,1.79,2.479,1.021,3.811l-3.938,6.816c-0.769,1.332-2.476,1.791-3.808,1.023     c-1.334-0.773-1.791-2.479-1.021-3.813l3.938-6.818C40.889,66.865,42.594,66.408,43.927,67.176z"/>\r\n							<path fill="#009FE3" d="M72.796,17.174c1.333,0.771,1.79,2.476,1.021,3.81l-3.938,6.815c-0.771,1.334-2.476,1.791-3.808,1.022     c-1.334-0.77-1.791-2.475-1.021-3.809l3.938-6.818C69.758,16.861,71.462,16.404,72.796,17.174z"/>\r\n						</g>\r\n						<g>\r\n							<path fill="#009FE3" d="M35.821,59.07c0.771,1.334,0.313,3.039-1.021,3.811l-6.817,3.936c-1.334,0.77-3.039,0.313-3.81-1.02     c-0.771-1.334-0.313-3.036,1.021-3.809l6.816-3.938C33.346,57.281,35.052,57.738,35.821,59.07z"/>\r\n							<path fill="#009FE3" d="M85.825,30.204c0.77,1.334,0.313,3.039-1.021,3.807l-6.816,3.938c-1.334,0.77-3.039,0.313-3.811-1.021     c-0.77-1.336-0.313-3.039,1.021-3.809l6.816-3.938C83.351,28.413,85.054,28.87,85.825,30.204z"/>\r\n						</g>\r\n						<g>\r\n							<path fill="#009FE3" d="M32.854,48c0,1.539-1.246,2.785-2.787,2.785h-7.873c-1.539,0-2.787-1.248-2.787-2.785     c0-1.541,1.246-2.787,2.787-2.787l7.873-0.002C31.608,45.211,32.854,46.459,32.854,48z"/>\r\n							<path fill="#009FE3" d="M90.593,48c0,1.539-1.248,2.785-2.788,2.785h-7.872c-1.541,0.002-2.787-1.248-2.787-2.785     c0-1.541,1.246-2.787,2.787-2.789l7.872,0.002C89.345,45.213,90.593,46.459,90.593,48z"/>\r\n						</g>\r\n						<g>\r\n							<path fill="#009FE3" d="M35.821,36.926c-0.771,1.336-2.475,1.791-3.809,1.021l-6.816-3.938c-1.334-0.768-1.791-2.473-1.021-3.807     c0.771-1.334,2.477-1.791,3.809-1.021l6.817,3.938C36.134,33.89,36.591,35.595,35.821,36.926z"/>\r\n							<path fill="#009FE3" d="M85.825,65.797c-0.771,1.334-2.475,1.789-3.811,1.02l-6.816-3.936c-1.332-0.77-1.791-2.477-1.021-3.809     c0.771-1.334,2.476-1.791,3.81-1.021l6.817,3.937C86.137,62.758,86.594,64.463,85.825,65.797z"/>\r\n						</g>\r\n						<g>\r\n							<path fill="#009FE3" d="M43.927,28.822c-1.334,0.769-3.038,0.312-3.809-1.021l-3.938-6.817c-0.77-1.334-0.313-3.037,1.021-3.808     c1.332-0.771,3.037-0.313,3.808,1.021l3.938,6.818C45.717,26.349,45.26,28.054,43.927,28.822z"/>\r\n							<path fill="#009FE3" d="M72.796,78.824c-1.333,0.771-3.038,0.313-3.809-1.021l-3.938-6.815c-0.77-1.334-0.313-3.039,1.021-3.809     c1.332-0.77,3.037-0.313,3.808,1.021l3.938,6.816C74.586,76.35,74.129,78.053,72.796,78.824z"/>\r\n						</g>\r\n						<g>\r\n							<path fill="#009FE3" d="M54.999,25.854c-1.54,0-2.788-1.248-2.788-2.787v-7.873c0-1.538,1.248-2.786,2.788-2.786     c1.539,0,2.787,1.248,2.787,2.786v7.873C57.788,24.607,56.54,25.854,54.999,25.854z"/>\r\n							<path fill="#009FE3" d="M54.999,83.592c-1.54,0-2.788-1.246-2.788-2.787v-7.871c0-1.541,1.248-2.789,2.788-2.789     c1.539,0,2.787,1.248,2.787,2.789v7.871C57.788,82.346,56.54,83.592,54.999,83.592z"/>\r\n						</g>\r\n					</g>\r\n				</g>\r\n			</svg>',duoyun_zhenyu='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                        <g>\r\n                            <g>\r\n                                <g>\r\n                                    <g>\r\n                                        <path fill="#009FE3" d="M90.924,5.36c1.334,0.771,1.791,2.476,1.021,3.81l-3.938,6.817c-0.77,1.334-2.475,1.791-3.809,1.021      c-1.332-0.771-1.789-2.476-1.021-3.81l3.939-6.815C87.885,5.049,89.59,4.592,90.924,5.36z"/>\r\n                                    </g>\r\n                                    <g>\r\n                                        <path fill="#009FE3" d="M103.953,18.39c0.77,1.334,0.313,3.039-1.021,3.807l-6.818,3.938c-1.332,0.771-3.037,0.313-3.809-1.021      c-0.77-1.334-0.313-3.039,1.021-3.809l6.818-3.938C101.477,16.599,103.18,17.056,103.953,18.39z"/>\r\n                                    </g>\r\n                                    <g>\r\n                                        <path fill="#009FE3" d="M108.721,36.187c0,1.541-1.248,2.787-2.787,2.787h-7.873c-1.543,0-2.787-1.248-2.787-2.787      c0-1.541,1.244-2.787,2.785-2.787h7.873C107.473,33.399,108.719,34.646,108.721,36.187z"/>\r\n                                    </g>\r\n                                    <g>\r\n                                        <path fill="#009FE3" d="M103.953,53.983c-0.771,1.334-2.477,1.789-3.811,1.021l-6.816-3.937      c-1.334-0.771-1.791-2.476-1.021-3.808c0.771-1.336,2.477-1.79,3.809-1.021l6.816,3.938      C104.264,50.944,104.721,52.649,103.953,53.983z"/>\r\n                                    </g>\r\n                                    <path fill="#009FE3" d="M62.053,17.008c-1.332,0.771-3.037,0.313-3.807-1.021l-3.938-6.818c-0.77-1.334-0.313-3.037,1.021-3.808     c1.332-0.771,3.037-0.313,3.807,1.021l3.939,6.815C63.844,14.534,63.387,16.239,62.053,17.008z"/>\r\n                                    <g>\r\n                                        <path fill="#009FE3" d="M73.127,14.041c-1.539,0-2.787-1.247-2.787-2.788V3.38c0-1.539,1.248-2.786,2.787-2.786      c1.541,0,2.789,1.247,2.789,2.786v7.873C75.916,12.794,74.668,14.041,73.127,14.041z"/>\r\n                                    </g>\r\n                                </g>\r\n                                <g>\r\n                                    <path fill="#009FE3" d="M61.691,32.845c-4.791-8.121-13.523-13.148-22.98-13.148c-12.729,0-23.527,8.83-26.107,21.16     C6.035,43.043,1.279,49.235,1.279,56.532c0,9.111,7.414,16.523,16.525,16.523c3.291,0,6.416-0.945,9.121-2.742     c3.646,1.797,7.689,2.742,11.785,2.742c4.252,0,8.453-1.031,12.207-2.966c3.148,1.938,6.73,2.966,10.492,2.966     c11.088,0,20.107-9.021,20.107-20.109C81.516,41.952,72.65,32.998,61.691,32.845z M61.408,67.48     c-3.246,0-6.316-1.045-8.879-3.025c-1.219-0.939-2.971-0.716-3.91,0.505c-0.018,0.021-0.027,0.047-0.043,0.067     c-3.02,1.604-6.422,2.453-9.867,2.453c-3.654,0-7.254-0.947-10.41-2.742c-0.793-0.449-1.711-0.459-2.488-0.121     c-0.445,0.074-0.883,0.244-1.264,0.541c-1.939,1.521-4.271,2.322-6.744,2.322c-6.039,0-10.951-4.912-10.951-10.949     c0-6.041,4.914-10.953,10.951-10.953c3.047,0,5.98,1.285,8.047,3.523c1.045,1.133,2.811,1.203,3.941,0.155     c1.131-1.043,1.199-2.808,0.154-3.938c-2.939-3.187-7.043-5.088-11.354-5.295c2.717-8.697,10.748-14.756,20.115-14.756     c6.689,0,12.93,3.178,16.885,8.442c-2.639,0.799-5.109,2.116-7.234,3.931c-1.172,1-1.311,2.76-0.311,3.932     c1,1.17,2.76,1.31,3.93,0.312c2.623-2.239,5.973-3.474,9.43-3.474c8.014,0,14.533,6.521,14.533,14.533S69.422,67.48,61.408,67.48     z"/>\r\n                                    <g>\r\n                                        <path fill="#009FE3" d="M91.904,36.411c0-10.354-8.424-18.773-18.777-18.773c-5.336,0-10.301,2.225-13.822,6.068      c1.295,1.173,2.498,2.453,3.584,3.846c2.557-2.96,6.254-4.684,10.238-4.686c7.469,0,13.547,6.076,13.547,13.545      c0,3.025-0.99,5.854-2.705,8.141c0.727,1.932,1.217,3.977,1.42,6.098C89.445,47.166,91.904,42.034,91.904,36.411z"/>\r\n                                        <g>\r\n                                            <path fill="#009FE3" d="M91.945,63.203l-3.939-6.819c-0.549-0.948-1.574-1.442-2.604-1.377c-0.174,2.034-0.6,3.998-1.248,5.856       l2.959,5.125c0.771,1.336,2.477,1.791,3.809,1.021C92.258,66.24,92.715,64.537,91.945,63.203z"/>\r\n                                        </g>\r\n                                    </g>\r\n                                </g>\r\n                                <path fill="#009FE3" d="M61.691,32.845c-4.791-8.121-13.523-13.148-22.98-13.148c-12.729,0-23.527,8.83-26.107,21.16    C6.035,43.043,1.279,49.235,1.279,56.532c0,9.111,7.414,16.523,16.525,16.523c3.291,0,6.416-0.945,9.121-2.742    c3.646,1.797,7.689,2.742,11.785,2.742c4.252,0,8.453-1.031,12.207-2.966c3.148,1.938,6.73,2.966,10.492,2.966    c11.088,0,20.107-9.021,20.107-20.109C81.516,41.952,72.65,32.998,61.691,32.845z M61.408,67.48c-3.246,0-6.316-1.045-8.879-3.025    c-1.219-0.939-2.971-0.716-3.91,0.505c-0.018,0.021-0.027,0.047-0.043,0.067c-3.02,1.604-6.422,2.453-9.867,2.453    c-3.654,0-7.254-0.947-10.41-2.742c-0.793-0.449-1.711-0.459-2.488-0.121c-0.445,0.074-0.883,0.244-1.264,0.541    c-1.939,1.521-4.271,2.322-6.744,2.322c-6.039,0-10.951-4.912-10.951-10.949c0-6.041,4.914-10.953,10.951-10.953    c3.047,0,5.98,1.285,8.047,3.523c1.045,1.133,2.811,1.203,3.941,0.155c1.131-1.043,1.199-2.808,0.154-3.938    c-2.939-3.187-7.043-5.088-11.354-5.295c2.717-8.697,10.748-14.756,20.115-14.756c6.689,0,12.93,3.178,16.885,8.442    c-2.639,0.799-5.109,2.116-7.234,3.931c-1.172,1-1.311,2.76-0.311,3.932c1,1.17,2.76,1.31,3.93,0.312    c2.623-2.239,5.973-3.474,9.43-3.474c8.014,0,14.533,6.521,14.533,14.533S69.422,67.48,61.408,67.48z"/>\r\n                            </g>\r\n                            <path fill="#009FE3" d="M39.525,89.822c0,3.086-2.5,5.584-5.582,5.584c-3.084,0-5.584-2.498-5.584-5.584   c0-3.082,5.584-11.406,5.584-11.406S39.525,86.74,39.525,89.822z"/>\r\n                            <path fill="#009FE3" d="M54.332,89.822c0,3.086-2.5,5.584-5.582,5.584c-3.084,0-5.584-2.498-5.584-5.584   c0-3.082,5.584-11.406,5.584-11.406S54.332,86.74,54.332,89.822z"/>\r\n                        </g>\r\n                        </svg>',dalei='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                <g>\r\n                    <g>\r\n                        <path fill="#009FE3" d="M75.294,27.418c-4.791-8.121-13.525-13.146-22.98-13.146c-12.729,0-23.527,8.83-26.107,21.16    c-6.57,2.187-11.324,8.379-11.324,15.674c0,9.11,7.414,16.524,16.525,16.524c3.291,0,6.416-0.945,9.119-2.744    c0.365,0.181,0.738,0.347,1.111,0.508c0.352-0.805,1.945-5.232,1.945-5.232c-0.57-0.261-1.137-0.537-1.682-0.849    c-0.795-0.449-1.51-0.694-2.453-0.248c-0.445,0.073-0.918,0.37-1.301,0.67c-1.938,1.519-4.271,2.319-6.742,2.319    c-6.037,0-10.949-4.912-10.949-10.948c0-6.039,4.912-10.951,10.949-10.951c3.047,0,5.979,1.283,8.047,3.523    c1.047,1.131,2.811,1.201,3.939,0.156s1.199-2.808,0.156-3.938c-2.943-3.187-7.045-5.088-11.354-5.293    c2.717-8.699,10.746-14.756,20.115-14.756c6.689,0,12.93,3.176,16.887,8.441c-2.641,0.801-5.109,2.118-7.234,3.934    c-1.172,0.998-1.311,2.758-0.311,3.928c0.996,1.172,2.758,1.312,3.93,0.312c2.623-2.24,5.973-3.474,9.43-3.474    c8.014,0,14.535,6.521,14.535,14.535c0,8.015-6.521,14.532-14.535,14.532c-2.246,0-4.402-0.51-6.369-1.475    c-0.469,1.172-2.086,5.172-2.086,5.172c2.625,1.228,5.48,1.879,8.455,1.879c11.088,0,20.107-9.021,20.107-20.108    C95.118,36.528,86.251,27.571,75.294,27.418z"/>\r\n                    </g>\r\n                    <path fill="#009FE3" d="M56.185,45.789c0.055-0.529-0.09-0.57-0.32-0.093l-9.371,19.437c-0.23,0.479,0.016,0.871,0.545,0.871h6.012   c0.529,0,0.936,0.432,0.896,0.961l-1,14.333c-0.035,0.529,0.129,0.576,0.367,0.103l10.475-20.774c0.24-0.476,0-0.869-0.529-0.881   l-7.525-0.149c-0.527-0.011-0.92-0.451-0.863-0.979L56.185,45.789z"/>\r\n                </g>\r\n                </svg>',dalei_baoyu='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                        <g>\r\n                            <g>\r\n                                <g>\r\n                                    <path fill="#009FE3" d="M75.293,20.978C70.502,12.855,61.768,7.832,52.311,7.832c-12.727,0-23.523,8.83-26.104,21.159     c-6.57,2.187-11.326,8.38-11.326,15.675c0,9.11,7.414,16.524,16.525,16.524c3.289,0,6.416-0.944,9.119-2.744     c0.365,0.181,0.738,0.345,1.111,0.509c0.35-0.806,1.947-5.234,1.947-5.234c-0.572-0.26-1.137-0.535-1.684-0.848     c-0.795-0.449-1.508-0.695-2.453-0.248c-0.445,0.073-0.918,0.373-1.301,0.668c-1.938,1.52-4.27,2.319-6.742,2.319     c-6.037,0-10.949-4.909-10.949-10.946c0-6.039,4.912-10.953,10.949-10.953c3.047,0,5.979,1.285,8.049,3.524     c1.047,1.132,2.809,1.201,3.938,0.156s1.201-2.809,0.156-3.938c-2.939-3.187-7.043-5.089-11.354-5.295     c2.719-8.697,10.748-14.755,20.115-14.755c6.691,0,12.932,3.175,16.887,8.441c-2.641,0.799-5.109,2.119-7.234,3.932     c-1.17,1-1.311,2.759-0.311,3.929c1,1.174,2.76,1.311,3.932,0.313c2.623-2.24,5.971-3.473,9.426-3.473     c8.016,0,14.535,6.521,14.535,14.535c0,8.012-6.521,14.53-14.535,14.53c-2.244,0-4.4-0.511-6.367-1.476     c-0.471,1.174-2.086,5.174-2.086,5.174c2.625,1.229,5.482,1.88,8.453,1.88c11.09,0,20.111-9.021,20.111-20.108     C95.119,30.088,86.252,21.131,75.293,20.978z"/>\r\n                                </g>\r\n                                <path fill="#009FE3" d="M56.182,39.349c0.055-0.529-0.09-0.57-0.32-0.092L46.49,58.693c-0.229,0.479,0.018,0.869,0.547,0.869    h6.012c0.531,0,0.936,0.435,0.896,0.961l-1,14.332c-0.035,0.529,0.129,0.576,0.365,0.104l10.479-20.774    c0.236-0.476,0-0.869-0.529-0.881l-7.525-0.15c-0.529-0.01-0.92-0.45-0.865-0.979L56.182,39.349z"/>\r\n                            </g>\r\n                            <path fill="#009FE3" d="M69.432,88.168c-0.484,0-0.979-0.127-1.426-0.396c-1.322-0.786-1.754-2.495-0.965-3.821l5.5-9.219   c0.787-1.322,2.502-1.753,3.82-0.968c1.322,0.793,1.756,2.502,0.967,3.824l-5.502,9.219C71.307,87.68,70.383,88.168,69.432,88.168z   "/>\r\n                            <path fill="#009FE3" d="M40.76,88.168c-0.486,0-0.98-0.127-1.426-0.396c-1.322-0.786-1.756-2.495-0.967-3.821l5.5-9.219   c0.789-1.322,2.502-1.753,3.822-0.968c1.322,0.793,1.756,2.502,0.967,3.824l-5.502,9.219C42.635,87.68,41.709,88.168,40.76,88.168z   "/>\r\n                            <path fill="#009FE3" d="M26.424,88.168c-0.486,0-0.979-0.127-1.426-0.396c-1.322-0.786-1.754-2.495-0.967-3.821l5.502-9.219   c0.789-1.322,2.502-1.753,3.82-0.968c1.322,0.793,1.756,2.502,0.967,3.824l-5.5,9.219C28.299,87.68,27.375,88.168,26.424,88.168z"/>\r\n                            <path fill="#009FE3" d="M55.096,88.168c-0.486,0-0.979-0.127-1.426-0.396c-1.322-0.786-1.754-2.495-0.967-3.821l5.5-9.219   c0.789-1.322,2.504-1.753,3.822-0.968c1.322,0.793,1.754,2.502,0.967,3.824l-5.502,9.219C56.971,87.68,56.047,88.168,55.096,88.168   z"/>\r\n                        </g>\r\n                        </svg>',daxue='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                <g>\r\n                    <path fill="#009FE3" d="M75.294,18.086C70.503,9.963,61.771,4.94,52.313,4.94c-12.729,0-23.525,8.828-26.107,21.158   c-6.568,2.187-11.324,8.381-11.324,15.676c0,9.11,7.414,16.524,16.525,16.524c3.291,0,6.416-0.946,9.119-2.745   c3.648,1.797,7.689,2.745,11.787,2.745c4.25,0,8.451-1.032,12.205-2.967c3.146,1.938,6.73,2.967,10.492,2.967   c11.088,0,20.107-9.022,20.107-20.11C95.12,27.196,86.251,18.237,75.294,18.086z M75.011,52.721c-3.248,0-6.316-1.048-8.877-3.022   c-1.219-0.941-2.971-0.716-3.91,0.5c-0.02,0.022-0.027,0.049-0.045,0.073c-3.021,1.599-6.42,2.449-9.865,2.449   c-3.654,0-7.254-0.944-10.41-2.742c-0.795-0.45-1.715-0.461-2.492-0.123c-0.445,0.074-0.881,0.248-1.26,0.546   c-1.939,1.518-4.271,2.319-6.744,2.319c-6.037,0-10.951-4.912-10.951-10.946c0-6.041,4.914-10.955,10.951-10.955   c3.047,0,5.98,1.284,8.047,3.526c1.045,1.129,2.809,1.198,3.939,0.153c1.129-1.045,1.201-2.812,0.156-3.938   c-2.941-3.185-7.043-5.088-11.355-5.295c2.717-8.696,10.748-14.754,20.117-14.754c6.689,0,12.93,3.176,16.885,8.44   c-2.639,0.799-5.111,2.119-7.234,3.932c-1.172,1-1.311,2.763-0.311,3.932c1,1.17,2.76,1.313,3.93,0.313   c2.623-2.241,5.973-3.477,9.428-3.477c8.016,0,14.533,6.521,14.533,14.536C89.544,46.204,83.026,52.721,75.011,52.721z"/>\r\n                    <g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M45.401,65.618c0.529,0.918,0.217,2.09-0.701,2.621l-10.115,5.84c-0.918,0.528-2.09,0.215-2.617-0.703     c-0.529-0.918-0.217-2.088,0.699-2.619l10.117-5.84C43.7,64.387,44.872,64.702,45.401,65.618z"/>\r\n                        </g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M45.401,73.375c-0.529,0.918-1.701,1.232-2.619,0.703l-10.115-5.84c-0.918-0.531-1.229-1.703-0.701-2.621     c0.529-0.916,1.701-1.229,2.617-0.701l10.117,5.84C45.616,71.288,45.931,72.457,45.401,73.375z"/>\r\n                        </g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M38.683,77.255c-1.059,0-1.916-0.856-1.916-1.92v-11.68c0-1.059,0.857-1.918,1.916-1.918     s1.918,0.859,1.918,1.918v11.68C40.601,76.398,39.741,77.255,38.683,77.255z"/>\r\n                        </g>\r\n                    </g>\r\n                    <g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M76.196,65.618c0.529,0.918,0.215,2.09-0.701,2.621l-10.115,5.84c-0.918,0.528-2.09,0.215-2.619-0.701     c-0.529-0.92-0.215-2.09,0.701-2.621l10.115-5.84C74.495,64.387,75.667,64.702,76.196,65.618z"/>\r\n                        </g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M76.196,73.375c-0.529,0.918-1.701,1.232-2.617,0.703l-10.117-5.84c-0.916-0.531-1.23-1.703-0.701-2.621     c0.529-0.916,1.701-1.229,2.619-0.701l10.115,5.84C76.411,71.288,76.726,72.457,76.196,73.375z"/>\r\n                        </g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M69.479,77.255c-1.061,0-1.916-0.856-1.916-1.92v-11.68c0-1.059,0.855-1.918,1.916-1.918     c1.059,0,1.916,0.859,1.916,1.918v11.68C71.396,76.398,70.538,77.255,69.479,77.255z"/>\r\n                        </g>\r\n                    </g>\r\n                    <g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M60.798,79.425c0.529,0.916,0.217,2.089-0.701,2.615l-10.115,5.842c-0.916,0.527-2.088,0.218-2.619-0.7     c-0.529-0.916-0.215-2.091,0.703-2.619l10.115-5.839C59.097,78.192,60.269,78.505,60.798,79.425z"/>\r\n                        </g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M60.798,87.182c-0.527,0.918-1.701,1.229-2.617,0.7l-10.115-5.84c-0.918-0.528-1.232-1.701-0.703-2.617     c0.531-0.919,1.703-1.233,2.619-0.702l10.117,5.839C61.013,85.091,61.327,86.266,60.798,87.182z"/>\r\n                        </g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M54.079,91.06c-1.059,0-1.916-0.857-1.916-1.916V77.462c0-1.059,0.857-1.916,1.916-1.916     c1.061,0,1.918,0.857,1.918,1.916v11.682C55.997,90.202,55.138,91.06,54.079,91.06z"/>\r\n                        </g>\r\n                    </g>\r\n                </g>\r\n                </svg>',yujiaxue='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                    <g>\r\n                        <path fill="#009FE3" d="M60.281,85.717c0,3.082-2.5,5.582-5.582,5.582c-3.084,0-5.584-2.5-5.584-5.582s5.584-11.406,5.584-11.406   S60.281,82.635,60.281,85.717z"/>\r\n                        <path fill="#009FE3" d="M75.291,17.851C70.5,9.728,61.766,4.701,52.311,4.701c-12.727,0-23.525,8.832-26.107,21.16   c-6.568,2.187-11.322,8.381-11.322,15.674c0,9.115,7.414,16.525,16.525,16.525c3.289,0,6.414-0.944,9.117-2.74   c3.648,1.796,7.691,2.74,11.787,2.74c4.252,0,8.451-1.028,12.205-2.964c3.15,1.939,6.734,2.964,10.494,2.964   c11.088,0,20.109-9.021,20.109-20.107C95.117,26.961,86.248,18.004,75.291,17.851z M75.006,52.488   c-3.246,0-6.316-1.048-8.877-3.025c-1.219-0.94-2.969-0.717-3.91,0.5c-0.018,0.022-0.029,0.049-0.045,0.074   c-3.02,1.598-6.42,2.451-9.865,2.451c-3.656,0-7.256-0.949-10.412-2.742c-0.795-0.453-1.713-0.463-2.492-0.123   c-0.441,0.074-0.879,0.246-1.258,0.543c-1.939,1.521-4.27,2.322-6.744,2.322c-6.037,0-10.951-4.913-10.951-10.954   c0-6.037,4.914-10.948,10.951-10.948c3.047,0,5.98,1.284,8.049,3.522c1.043,1.131,2.809,1.201,3.939,0.156   c1.131-1.045,1.201-2.81,0.158-3.938c-2.941-3.184-7.043-5.086-11.355-5.297c2.717-8.694,10.746-14.752,20.117-14.752   c6.689,0,12.928,3.176,16.883,8.441c-2.639,0.799-5.109,2.119-7.232,3.932c-1.17,1.002-1.311,2.76-0.311,3.928   c1,1.175,2.76,1.313,3.93,0.313c2.623-2.24,5.971-3.473,9.428-3.473c8.014,0,14.535,6.521,14.535,14.534   C89.543,45.969,83.021,52.488,75.006,52.488z"/>\r\n                        <g>\r\n                            <g>\r\n                                <path fill="#009FE3" d="M45.396,65.385c0.531,0.916,0.215,2.088-0.701,2.617L34.58,73.844c-0.918,0.529-2.09,0.213-2.619-0.7     c-0.529-0.918-0.215-2.091,0.701-2.621l10.115-5.838C43.695,64.154,44.869,64.469,45.396,65.385z"/>\r\n                            </g>\r\n                            <g>\r\n                                <path fill="#009FE3" d="M45.396,73.142c-0.529,0.913-1.701,1.229-2.619,0.7L32.662,68c-0.916-0.529-1.23-1.701-0.701-2.617     s1.701-1.229,2.617-0.701l10.117,5.839C45.611,71.053,45.928,72.223,45.396,73.142z"/>\r\n                            </g>\r\n                            <g>\r\n                                <path fill="#009FE3" d="M38.68,77.021c-1.061,0-1.918-0.858-1.918-1.918V63.42c0-1.057,0.857-1.918,1.918-1.918     c1.059,0,1.916,0.861,1.916,1.918v11.683C40.596,76.162,39.738,77.021,38.68,77.021z"/>\r\n                            </g>\r\n                        </g>\r\n                        <g>\r\n                            <g>\r\n                                <path fill="#009FE3" d="M76.191,65.383c0.531,0.918,0.217,2.09-0.699,2.619l-10.117,5.842c-0.918,0.529-2.09,0.213-2.619-0.7     c-0.529-0.918-0.215-2.091,0.701-2.621l10.117-5.838C74.492,64.154,75.666,64.469,76.191,65.383z"/>\r\n                            </g>\r\n                            <g>\r\n                                <path fill="#009FE3" d="M76.193,73.142c-0.529,0.913-1.701,1.229-2.617,0.7L63.459,68c-0.918-0.529-1.23-1.701-0.703-2.617     c0.529-0.916,1.701-1.229,2.619-0.701l10.117,5.839C76.408,71.053,76.723,72.223,76.193,73.142z"/>\r\n                            </g>\r\n                            <g>\r\n                                <path fill="#009FE3" d="M69.475,77.021c-1.061,0-1.916-0.858-1.916-1.918V63.42c0-1.057,0.855-1.918,1.916-1.918     s1.918,0.861,1.918,1.918v11.683C71.393,76.162,70.535,77.021,69.475,77.021z"/>\r\n                            </g>\r\n                        </g>\r\n                    </g>\r\n                    </svg>',leizhenyu='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                <g>\r\n                    <path fill="#009FE3" d="M44.017,83.052c0,3.084-2.5,5.582-5.582,5.582c-3.084,0-5.582-2.498-5.582-5.582   c0-3.085,5.582-11.407,5.582-11.407S44.017,79.967,44.017,83.052z"/>\r\n                    <path fill="#009FE3" d="M61.212,83.052c0,3.084-2.5,5.582-5.584,5.582c-3.082,0-5.582-2.498-5.582-5.582   c0-3.085,5.582-11.407,5.582-11.407S61.212,79.967,61.212,83.052z"/>\r\n                    <path fill="#009FE3" d="M78.733,83.052c0,3.084-2.498,5.582-5.58,5.582c-3.084,0-5.584-2.498-5.584-5.582   c0-3.085,5.584-11.407,5.584-11.407S78.733,79.967,78.733,83.052z"/>\r\n                    <g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M48.616,38.884c0.053-0.528-0.09-0.569-0.32-0.091l-9.371,19.436c-0.23,0.479,0.016,0.869,0.545,0.869     h6.012c0.531,0,0.936,0.435,0.896,0.963l-1,14.336c-0.035,0.528,0.129,0.573,0.367,0.102l10.477-20.775     c0.238-0.474,0-0.869-0.529-0.881l-7.523-0.15c-0.529-0.011-0.92-0.449-0.865-0.979L48.616,38.884z"/>\r\n                        </g>\r\n                    </g>\r\n                    <g>\r\n                        <path fill="#009FE3" d="M48.616,38.884c0.053-0.528-0.09-0.569-0.32-0.091l-9.371,19.436c-0.23,0.479,0.016,0.869,0.545,0.869    h6.012c0.531,0,0.936,0.435,0.896,0.963l-1,14.336c-0.035,0.528,0.129,0.573,0.367,0.102l10.477-20.775    c0.238-0.474,0-0.869-0.529-0.881l-7.523-0.15c-0.529-0.011-0.92-0.449-0.865-0.979L48.616,38.884z"/>\r\n                    </g>\r\n                    <g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M68.927,38.884c0.055-0.528-0.092-0.569-0.32-0.091l-9.373,19.436c-0.23,0.479,0.016,0.869,0.545,0.869     h6.012c0.531,0,0.936,0.435,0.898,0.963l-1,14.336c-0.037,0.528,0.127,0.573,0.367,0.102L76.53,53.723     c0.238-0.474,0-0.869-0.531-0.881l-7.523-0.15c-0.531-0.011-0.92-0.449-0.865-0.979L68.927,38.884z"/>\r\n                        </g>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M95.118,40.618c0-10.994-8.869-19.951-19.826-20.104c-4.791-8.123-13.523-13.148-22.98-13.148     c-12.727,0-23.523,8.834-26.105,21.157c-6.57,2.189-11.324,8.386-11.324,15.679c0,9.11,7.414,16.521,16.523,16.521     c1.021,0,2.023-0.098,3.008-0.273c-0.52-1.365-0.461-2.908,0.207-4.295l0.863-1.793c-1.283,0.514-2.654,0.788-4.078,0.788     c-6.039,0-10.949-4.911-10.949-10.948c0-6.041,4.91-10.953,10.949-10.953c3.045,0,5.98,1.285,8.049,3.524     c1.043,1.132,2.809,1.199,3.938,0.154c1.131-1.045,1.201-2.807,0.156-3.938c-2.941-3.184-7.043-5.086-11.354-5.293     c2.717-8.699,10.746-14.754,20.117-14.754c6.689,0,12.928,3.176,16.885,8.442c-2.641,0.797-5.111,2.115-7.236,3.928     c-1.17,1.002-1.309,2.761-0.309,3.933c1,1.17,2.76,1.311,3.93,0.311c2.623-2.242,5.973-3.475,9.428-3.475     c8.016,0,14.533,6.521,14.533,14.537c0,5.723-3.336,10.674-8.156,13.041c-0.041,0.752-0.23,1.506-0.588,2.213l-2.289,4.543     C87.935,58.754,95.118,50.512,95.118,40.618z"/>\r\n                        </g>\r\n                    </g>\r\n                    <g>\r\n                        <path fill="#009FE3" d="M68.927,38.884c0.055-0.528-0.092-0.569-0.32-0.091l-9.373,19.436c-0.23,0.479,0.016,0.869,0.545,0.869    h6.012c0.531,0,0.936,0.435,0.898,0.963l-1,14.336c-0.037,0.528,0.127,0.573,0.367,0.102L76.53,53.723    c0.238-0.474,0-0.869-0.531-0.881l-7.523-0.15c-0.531-0.011-0.92-0.449-0.865-0.979L68.927,38.884z"/>\r\n                    </g>\r\n                </g>\r\n                </svg>',ye_yin='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                <g>\r\n                    <path fill="#009FE3" d="M77.502,43.357c-5.789-9.226-3.951-21.271,3.67-29.865c-2.723,0.771-5.41,1.939-7.963,3.545   C65.748,21.723,61.068,29,59.826,36.529c-4.893-4.662-11.439-7.381-18.389-7.381c-12.727,0-23.525,8.832-26.105,21.161   C8.764,52.496,4.008,58.689,4.008,65.982c0,9.109,7.414,16.525,16.525,16.525c3.287,0,6.416-0.949,9.117-2.744   c3.648,1.793,7.691,2.744,11.787,2.744c4.252,0,8.451-1.031,12.205-2.967c3.15,1.938,6.734,2.967,10.492,2.967   c10.787,0,19.611-8.535,20.088-19.205c5.082-0.135,10.33-1.639,15.113-4.643c2.555-1.604,4.775-3.51,6.656-5.631   C94.941,56.162,83.291,52.578,77.502,43.357z M64.137,76.932c-3.246,0-6.314-1.047-8.877-3.021c-1.219-0.943-2.969-0.717-3.91,0.5   c-0.018,0.021-0.025,0.049-0.043,0.068c-3.02,1.604-6.422,2.453-9.867,2.453c-3.654,0-7.256-0.945-10.41-2.74   c-0.795-0.451-1.713-0.459-2.488-0.123c-0.445,0.072-0.881,0.248-1.262,0.545c-1.941,1.518-4.273,2.318-6.744,2.318   c-6.037,0-10.949-4.91-10.949-10.949c0-6.037,4.912-10.949,10.949-10.949c3.047,0,5.979,1.283,8.049,3.521   c1.045,1.129,2.809,1.201,3.938,0.156s1.201-2.809,0.156-3.939c-2.943-3.184-7.045-5.086-11.354-5.297   c2.717-8.693,10.746-14.754,20.115-14.754c6.691,0,12.93,3.177,16.887,8.441c-2.639,0.799-5.109,2.117-7.234,3.932   c-1.17,1-1.313,2.758-0.313,3.93c0.998,1.172,2.758,1.311,3.932,0.313c2.625-2.24,5.973-3.475,9.428-3.475   c8.016,0,14.535,6.521,14.535,14.534C78.672,70.412,72.15,76.932,64.137,76.932z"/>\r\n                    <polygon fill="#009FE3" points="91.719,25.223 95.803,23.078 95.021,27.626 98.326,30.843 93.762,31.509 91.719,35.648    89.676,31.509 85.109,30.843 88.412,27.626 87.635,23.078  "/>\r\n                    <polygon fill="#009FE3" points="52.994,19.479 55.869,17.97 55.32,21.171 57.648,23.441 54.432,23.908 52.994,26.824    51.555,23.908 48.338,23.441 50.664,21.171 50.117,17.97  "/>\r\n                </g>\r\n                </svg>',ye_qing='<svg x="0px" y="0px" width="110px" height="76px" viewBox="0 0 110 96" enable-background="new 0 0 110 96" xml:space="preserve">\r\n                    <g>\r\n                        <polygon fill="#009FE3" points="64.13,36.086 68.216,33.936 67.435,38.487 70.739,41.709 66.173,42.369 64.13,46.507    62.087,42.369 57.522,41.709 60.825,38.487 60.046,33.936  "/>\r\n                        <polygon fill="#009FE3" points="68.909,51.216 71.786,49.707 71.237,52.91 73.565,55.179 70.347,55.645 68.909,58.559    67.472,55.645 64.253,55.179 66.581,52.91 66.032,49.707  "/>\r\n                        <g>\r\n                            <path fill="#009FE3" d="M61.856,77.953c-0.002,0-0.002,0-0.002,0c-11.102-0.002-21.279-5.582-27.236-14.936    c-4.629-7.266-6.15-15.896-4.283-24.311c1.865-8.414,6.896-15.594,14.162-20.224c0.977-0.623,2.24-0.575,3.17,0.119    c0.928,0.697,1.328,1.896,1.004,3.011c-0.043,0.15-4.369,15.786,4.723,29.371c8.965,13.393,24.672,16.801,24.828,16.83    c1.109,0.23,1.973,1.111,2.176,2.229c0.203,1.115-0.285,2.246-1.242,2.854C73.962,76.203,67.981,77.953,61.856,77.953z     M42.101,27.705c-3.113,3.405-5.299,7.582-6.324,12.209c-1.543,6.959-0.285,14.102,3.545,20.109    c4.926,7.734,13.35,12.352,22.533,12.352c0,0,0,0,0.002,0c2.838,0,5.639-0.453,8.309-1.332    c-6.154-2.521-15.107-7.549-21.402-16.953C42.384,44.563,41.64,34.421,42.101,27.705z"/>\r\n                        </g>\r\n                    </g>\r\n                    </svg>';

return ModalWeather.prototype.renderModal=function(){function formatTemp(temprt){return temprt.substring(temprt.indexOf("温")+1)}function getWeatherPic(weathType,type){var resultPic;switch(weathType){case"阴":resultPic=yin,2==type&&(resultPic=ye_yin);break;case"大雨":resultPic=dayu;break;case"暴雨":resultPic=baoyu;break;case"多云":resultPic=duoyun,2==type&&(resultPic=ye_yin);break;case"小雨":resultPic=xiaoyu;break;case"晴转多云":resultPic=qing_duoyun;break;case"晴":resultPic=qing,2==type&&(resultPic=ye_qing);break;case"阵雨":resultPic=duoyun_zhenyu;break;case"打雷":resultPic=dalei;break;case"打雷暴雨":resultPic=dalei_baoyu;break;case"大雪":resultPic=daxue;break;case"雨夹雪":resultPic=yujiaxue;break;case"雷阵雨":resultPic=leizhenyu;break;default:resultPic=qing}return resultPic}function getWeatherStatus(){WebAPI.get("/dashboard/get_weather/1").done(function(result){var rslt=JSON.parse(result);if(rslt){var tempdata=rslt.data,weatherCrtCt="",weatherCrtPic="",tempday=tempdata.forecast[0].date,day=tempday.substring(tempday.indexOf("星期")),crtTemp=tempdata.wendu,crtDate=new Date,_date=crtDate.getMonth()+1+"月"+crtDate.getDate()+"日",today=getWeatherPic(tempdata.forecast[0].type),todaytTemp=formatTemp(tempdata.forecast[0].high),tonight=getWeatherPic(tempdata.forecast[0].type,2),tonightTemp=formatTemp(tempdata.forecast[0].low);weatherCrtCt='<dl class="weathCrtDayCt" style="margin-left: 4%;"><dt class="weathCrtDay dtTop">'+day+'</dt><dd class="weathCrtTemprt">'+crtTemp+'℃</dd><dd class="ddBottom weatherDate"> '+_date+"</dd></dl>",weatherCrtPic='<dl class="weathCrtDayPic" style="left:42%;">\r\n                                        <dt class="weathCrtToday dtTop">白 天</dt>\r\n                                        <dd class="temprtIconBig">'+today+'</dd>\r\n                                        <dd class="ddBottom">'+todaytTemp+'</dd>\r\n                                    </dl>\r\n                                    <dl class="weathCrtDayPic" style="left:66%;">\r\n                                        <dt class="weathCrtToday dtTop">晚 上</dt>\r\n                                        <dd class="temprtIconBig">'+tonight+'</dd>\r\n                                        <dd class="ddBottom">'+tonightTemp+"</dd>\r\n                                    </dl>";var weatherStatus="";for(var i in tempdata.forecast)if(0!=i){var _day=tempdata.forecast[i].date.substring(tempdata.forecast[i].date.indexOf("日")+1),_tempArange=formatTemp(tempdata.forecast[i].high)+"/"+formatTemp(tempdata.forecast[i].low),temp='<dl class="weathFuture">\r\n                                        <dt>'+_day+"</dt>\r\n                                        <dd>"+qing+"</dd>\r\n                                        <dd> "+_tempArange+"</dd>\r\n                                    </dl>";weatherStatus+=temp}}if(_this.isFirstRender){if(_this.tempList=[],_this.xData=[],_this.chart=void 0,rslt.tempHistory.length>0){for(var i=rslt.tempHistory.length-1;i>0;i--)if(_this.xData.length<12){var time=rslt.tempHistory[i].time.replace(" GMT","");time=new Date(time).getHours(),time!=_this.xData[_this.xData.length-1]&&(_this.xData.unshift(parseInt(time)),_this.tempList.unshift(rslt.tempHistory[i].temp))}for(;_this.xData.length<12;){var xMax=_this.xData[_this.xData.length-1];(new Date).getHours()>xMax&&_this.tempList.push(crtTemp),_this.xData.push(xMax>23?0:_this.xData[_this.xData.length-1]+1)}_this.isFirstRender=!0}else{_this.tempList.push(crtTemp);for(var xDataFirst=(new Date).getHours(),tempXDataLen=_this.xData.length,i=0;12-tempXDataLen>i;i++)23>xDataFirst?_this.xData.push(xDataFirst++):(_this.xData.push(xDataFirst),xDataFirst=0);_this.isFirstRender=!1}crtContainer.innerHTML=getDaysWeather(weatherCrtCt,weatherCrtPic,weatherStatus),_this.optionChart={title:{text:I18n.resource.dashboard.modalWeather.REAL_TIME_TEMPERATURE,y:2,x:38,textStyle:{color:"#5c5e62",fontFamily:"Microsoft YaHei",fontSize:12}},tooltip:{trigger:"axis"},backgroundColor:"#f7f9fa",calculable:!1,color:["#1abc9c"],xAxis:[{type:"category",boundaryGap:!0,splitLine:{show:!1},axisTick:{show:!1},data:function(xData){for(var arr=[],i=0;i<xData.length;i++)arr.push(xData[i]<10?"0"+xData[i]+":00":xData[i]+":00");return arr}(_this.xData)}],yAxis:[{type:"value",splitNumber:5,scale:!0}],grid:{height:"56%",width:"86%",y:24,x:60},series:[{type:"line",symbol:"emptyCircle",smooth:!0,data:_this.tempList}]},_this.chart=echarts.init(document.getElementById("modalWeatherChart")).setOption(_this.optionChart)}else{$(".weatherWrap").html("<div>"+weatherCrtCt+weatherCrtPic+'</div><div style="width: 50%;right:0;position: absolute;top:0">'+weatherStatus+"</div>");var nowTime=(new Date).getHours();if(_this.xData[_this.tempList.length-1]<nowTime){if(_this.chart.getSeries()[0].data.length>11){var xDataLabel=_this.xData[_this.xData.length-1]+1;xDataLabel>23&&(xDataLabel=0),_this.xData.splice(0,1),_this.xData.push(xDataLabel);var xDataLabelFmt=xDataLabel+":00";10>xDataLabel&&(xDataLabelFmt="0"+xDataLabelFmt),_this.chart.addData([[0,rslt.data.wendu,!1,!1,xDataLabelFmt]]),_this.tempList.splice(0,1)}else _this.chart.addData([[0,rslt.data.wendu,!1,!0]]);_this.tempList.push(rslt.data.wendu)}}})}function getDaysWeather(weatherCrtCt,weatherCrtPic,weatherStatus){var str='\r\n                                                <style>\r\n                                                 .weatherWrap{\r\n                                                    background: #fff;border-radius: 4px;height: 100%;position:relative;\r\n                                                }\r\n                                                .weatherWrap dl{\r\n                                                    display: inline-block;font-family: "Microsoft YaHei";text-align: center;height: 100%;\r\n                                                }\r\n                                                .weathCrtDayCt{\r\n                                                    width: 33%;position: absolute;top: 0;\r\n                                                }\r\n                                                .weathCrtDayCt *{\r\n                                                    position: absolute;left: 23%;\r\n                                                }\r\n                                                @media screen and (max-width: 1920px) {\r\n                                                    .weathFuture{width: 22%;margin-top: 14.5%;}\r\n                                                    .weathCrtDay, .weathCrtToday{margin-top: 4%;}\r\n                                                    .weathCrtDayPic dd svg {\r\n                                                        width: 100%;height: 100%;\r\n                                                    }\r\n                                                    .temprtIconBig{position: relative;top: 24%;left: -30%;}\r\n                                                }\r\n                                                @media screen and (max-width: 1366px) {\r\n                                                    .weathFuture{width: 24%;margin-top: 11%; }\r\n                                                    .temprtIconBig{position: relative;top: 24%;  left: -24%;}\r\n                                                }\r\n                                                @media screen and (max-height: 768px) {\r\n                                                    .weathCrtTemprt{top: 30% !important;left: 20% !important; font-size: 3rem !important; transform: scaley(1.2) !important;}\r\n                                                }\r\n                                                .weathCrtDayCt, .weatherDate{\r\n                                                    color: #009fe3;font-weight: 800;font-size: 18px;font-family: "Microsoft YaHei";\r\n                                                }\r\n                                                .weatherDate{\r\n                                                      left: 23% !important;\r\n                                                }\r\n                                                .weathCrtTemprt{\r\n                                                    font-size: 3.5rem;color: #009fe3;  top: 33%;left: 20%;  transform: scaley(1.3);\r\n                                                }\r\n                                                .weathCrtToday{\r\n                                                    color: #5c5e62;font-size: 18px;font-weight: 300;\r\n                                                }\r\n                                                .weathFuture dd svg g path{\r\n                                                    fill: #626262;\r\n                                                }\r\n                                                .weathFuture dd svg {\r\n                                                    width: 70%;height: 100%\r\n                                                }\r\n                                                .weathFuture *{\r\n                                                    color: #5c5e62;font-size: 12px;font-family: "Microsoft YaHei";\r\n                                                }\r\n                                                .weathCrtDayPic{\r\n                                                    width: 30%;position: absolute;\r\n                                                }\r\n                                                .weathCrtDayPic > * {\r\n                                                    color: #5c5e62;font-size: 18px;font-family: "Microsoft YaHei";\r\n                                                }\r\n                                                .weatherWrap div{\r\n                                                    display: inline-block;width: 50%;position: relative;height:100%\r\n                                                }\r\n                                                .dtTop{  top:0; position: absolute;  }\r\n                                                .ddBottom{ bottom:0;  left: 5px;  position: absolute; }\r\n                                                </style>\r\n                                                <div style="width: 100%; height: 48%;">\r\n                                                <div class="weatherWrap">\r\n                                                    <div>'+weatherCrtCt+weatherCrtPic+'</div><div style="width: 50%;right:0;position: absolute;top:0">'+weatherStatus+'</div></div>\r\n                                                </div>\r\n                                                <div id="modalWeatherChart" style="width: 98%; height: 49%;margin: 1%;"></div>';return str}var timeTicket,crtContainer=this.container,_this=this;_this.isFirstRender=!0,_this.chart=void 0,getWeatherStatus(),timeTicket&&clearInterval(timeTicket),timeTicket=setInterval(getWeatherStatus,6e5),this.container.style.background="#fff",this.container.style.borderRadius="4px"},ModalWeather.prototype.showConfigMode=function(){},ModalWeather}(),ModalEnergySaveRate=function(){function ModalEnergySaveRate(screen,entityParams){ModalBase.call(this,screen,entityParams,this.renderModal,this.updateModal,this.showConfigMode)}return ModalEnergySaveRate.prototype=new ModalBase,ModalEnergySaveRate.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_ENERGY_SAVE_RATE",parent:0,mode:["realTimeDashboard"],maxNum:1,title:"",minHeight:1,minWidth:2,maxHeight:6,maxWidth:12,type:"ModalEnergySaveRate"},ModalEnergySaveRate.prototype.renderModal=function(){var _this=this;WebAPI.get("/static/scripts/spring/entities/modalEnergySaveRate.html").done(function(resultHtml){_this.container.innerHTML=resultHtml,I18n.fillArea($("#energySaveName").parent())})},ModalEnergySaveRate.prototype.updateModal=function(points){var show=parseFloat(points[0].data).toFixed(1).toString()+"%";$("#energySavePerVal").text(show),$("#progressItem").css("width",show)},ModalEnergySaveRate.prototype.showConfigMode=function(){},ModalEnergySaveRate.prototype.setModalOption=function(option){this.entity.modal.interval=5},ModalEnergySaveRate}(),ModalCoalSaveTotal=function(){function ModalCoalSaveTotal(screen,entityParams){ModalBase.call(this,screen,entityParams,this.renderModal,this.updateModal,this.showConfigMode)}ModalCoalSaveTotal.prototype=new ModalBase,ModalCoalSaveTotal.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_COAL_SAVE_TOTAL",parent:0,mode:["realTimeDashboard"],maxNum:1,title:"",minHeight:1,minWidth:2,maxHeight:6,maxWidth:12,type:"ModalCoalSaveTotal"},ModalCoalSaveTotal.prototype.renderModal=function(){this.container.innerHTML=template,I18n.fillArea($("#coalSaveName").parent())},ModalCoalSaveTotal.prototype.updateModal=function(points){var show=parseFloat(points[0].data).toFixed(1).toString()+" Ton";$("#coalSaveVal").text(show)},ModalCoalSaveTotal.prototype.showConfigMode=function(){},ModalCoalSaveTotal.prototype.setModalOption=function(option){this.entity.modal.interval=5};var template='<style type="text/css">\r\n        .frameCtl {position: relative;height: 100%;}\r\n        .imgBackground {position: absolute;width: 100%;height: 100%;right: 0;bottom: 0;top: 0;left: 0;z-index: -1;}\r\n        #coalSaveVal {position: absolute;left: 60px;top: 40px;width: 220px;font-size: 25px;font-weight: 500;color: #eeeeee;}\r\n        #coalSaveName {position: absolute;left: 60px;top: 80px;width: 220px;font-size: 25px;font-weight: 500;color: #eeeeee;}\r\n    </style>\r\n    <div class="frameCtl">\r\n        <img src="/static/images/spring/entities/modalCoalSaveTotal.png" class="imgBackground" alt="Background image">\r\n        <div id="coalSaveVal"> Ton</div>\r\n        <div id="coalSaveName" i18n="dashboard.carbonFootprint.STANDARD_COAL_SAVING"></div>\r\n    </div>';return ModalCoalSaveTotal}(),ModalCo2SaveTotal=function(){function ModalCo2SaveTotal(screen,entityParams){ModalBase.call(this,screen,entityParams,this.renderModal,this.updateModal,this.showConfigMode)}ModalCo2SaveTotal.prototype=new ModalBase,ModalCo2SaveTotal.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_CO2_SAVE_TOTAL",parent:0,mode:["realTimeDashboard"],maxNum:1,title:"",minHeight:1,minWidth:2,maxHeight:6,maxWidth:12,type:"ModalCo2SaveTotal"},ModalCo2SaveTotal.prototype.renderModal=function(){this.container.innerHTML=template,I18n.fillArea($("#co2Name").parent())},ModalCo2SaveTotal.prototype.updateModal=function(points){var show=parseFloat(points[0].data).toFixed(1).toString()+" Ton";$("#co2SaveVal").text(show)},ModalCo2SaveTotal.prototype.showConfigMode=function(){},ModalCo2SaveTotal.prototype.setModalOption=function(option){this.entity.modal.interval=5};var template='<style type="text/css">\r\n        .frameCtl {position: relative;height: 100%;}\r\n        .imgBackground {position: absolute;width: 100%;height: 100%;right: 0;bottom: 0;top: 0;left: 0;z-index: -1;}\r\n        #co2SaveVal {position: absolute;left: 60px;top: 40px;width: 220px;font-size: 25px;font-weight: 500;color: #eeeeee;}\r\n        #co2Name {position: absolute;left: 60px;top: 80px;width: 220px;font-size: 25px;font-weight: 500;color: #eeeeee;}\r\n    </style>\r\n    <div class="frameCtl">\r\n        <img src="/static/images/spring/entities/modalCo2SaveTotal.png" class="imgBackground" alt="Background image">\r\n        <div id="co2SaveVal"></div>\r\n        <div id="co2Name" i18n="dashboard.carbonFootprint.CO2_SAVING"></div>\r\n    </div>';return ModalCo2SaveTotal}(),ModalKPIConfig=function($,window,undefined){function ModalKPIConfig(options){_this=this,this.options=$.extend({},DEFAULTS,options),this.$wrap=null}var _this;ModalKPIConfig.prototype.show=function(){var domPanelContent=document.getElementById("paneContent");return $("#modalKPIConfigWrap").length>0?void this.$modal.modal("show"):(Spinner.spin(domPanelContent),void $.get("/static/views/observer/widgets/modalKPIConfig.html",function(html){Spinner.stop(),_this.$wrap=$('<div class="modal-kpi-config-wrap" id="modalKPIConfigWrap">').appendTo(domPanelContent).html(html),_this.$modal=_this.$wrap.children(".modal"),_this.init(),_this.$modal.modal("show")}))},ModalKPIConfig.prototype.init=function(){this.$formWrap=$("#formWrap"),this.$btnClose=$(".close"),this.$btnWarnMode=$("#btnWarnMode","#formWrap"),this.$ulWarnMode=$("#ulWarnMode","#formWrap"),this.$btnWarnTimeMode=$("#btnWarnTimeMode","#formWrap"),this.$ulWarnTimeMode=$("#ulWarnTimeMode","#formWrap"),this.$btnPreWarnMode=$("#btnPreWarnMode","#formWrap"),this.$ulPreWarnMode=$("#ulPreWarnMode","#formWrap"),this.$btnPreWarnTimeMode=$("#btnPreWarnTimeMode","#formWrap"),this.$ulPreWarnTimeMode=$("#ulPreWarnTimeMode","#formWrap"),this.$btnDataCycleMode=$("#btnDataCycleMode","#formWrap"),this.$ulDataCycleMode=$("#ulDataCycleMode","#formWrap"),this.$btnStartMonth=$("#btnStartMonth","#formWrap"),this.$ulStartMonth=$("#ulStartMonth","#formWrap"),this.$btnHistoryValUsage=$("#btnHistoryValUsage","#formWrap"),this.$ulHistoryValUsage=$("#ulHistoryValUsage","#formWrap"),this.$btnPreHistoryValUsage=$("#btnPreHistoryValUsage","#formWrap"),this.$ulPreHistoryValUsage=$("#ulPreHistoryValUsage","#"),this.$fgWarnRange=$("#fgWarnRange","#formWrap"),this.$fgWarnTime=$("#fgWarnTime","#formWrap"),this.$fgWarnTimeRange=$("#fgWarnTimeRange","#formWrap"),this.$fgPreWarnRange=$("#fgPreWarnRange","#formWrap"),this.$fgPreWarnTime=$("#fgPreWarnTime","#formWrap"),this.$fgPreWarnTimeRange=$("#fgPreWarnTimeRange","#formWrap"),this.$fgiStartMonth=$("#fgiStartMonth","#formWrap"),this.$iptChartName=$("#iptChartName","#formWrap"),this.$iptChartLowerLimit=$("#iptChartLowerLimit","#formWrap"),this.$iptChartUpperLimit=$("#iptChartUpperLimit","#formWrap"),this.$divTargetPoint=$("#divTargetPoint","#formWrap"),this.$divReferencePoint=$("#divReferencePoint","#formWrap"),this.$btnCondition=$("#btnCondition","#formWrap"),this.$iptConditionVal=$("#iptConditionVal","#formWrap"),this.$btnIsShowRC=$("#btnIsShowRC","#formWrap"),this.$iptLowerWarnVal=$("#iptLowerWarnVal","#formWrap"),this.$iptUpperWarnVal=$("#iptUpperWarnVal","#formWrap"),this.$iptPreGreaterThan=$("#iptPreGreaterThan","#formWrap"),this.$iptPreLessThan=$("#iptPreLessThan","#formWrap"),this.$iptWarnTimeRangeStart=$("#iptWarnTimeRangeStart","#formWrap"),this.$iptPreWarnTimeRangeStart=$("#iptPreWarnTimeRangeStart","#formWrap"),this.$dropArea=$(".drop-area","#formWrap"),this.$btnSubmit=$("#btnSubmit"),this.attachEvents(),this.initValidator(),$(".datetime").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,todayBtn:!0,startView:"year",minView:"year",pickerPosition:"top-right"})},ModalKPIConfig.prototype.initValidator=function(){},ModalKPIConfig.prototype.displayField=function(animArr,doAnim){var showLen,$all,$animWrap=animArr[0].$ele.parent(".optional"),actionGroup={$show:$(),$hide:$()},curShowLen=$animWrap.children(".on").length;doAnim===undefined&&(doAnim=!0);for(var i=0,len=animArr.length;len>i;i++)actionGroup["$"+animArr[i].action]=actionGroup["$"+animArr[i].action].add(animArr[i].$ele);return showLen=actionGroup.$show.length,doAnim?($all=actionGroup.$hide.add(actionGroup.$show).filter(".on"),$all.filter(".on").eq(0).one("transitionend",function(e){e=e.originalEvent,"opacity"===e.propertyName&&($all.css("display","none"),showLen!==curShowLen?($animWrap.height(49*showLen),$animWrap.off("transitionend").on("transitionend",function(e){e=e.originalEvent,"height"===e.propertyName&&(actionGroup.$show.css("display",""),window.setTimeout(function(){actionGroup.$show.addClass("on")},0)),e.stopPropagation()})):(actionGroup.$show.css("display",""),window.setTimeout(function(){actionGroup.$show.addClass("on")},0))),e.stopPropagation()}),void $all.removeClass("on")):(actionGroup.$hide.removeClass("on").css("display","none"),actionGroup.$show.addClass("on").css("display",""),void $animWrap.height(49*showLen))},ModalKPIConfig.prototype.reset=function(name){var animArr=[];name="string"==typeof name?[name]:name,name||(this.$iptChartName.val(""),this.$iptChartLowerLimit.val(""),this.$iptChartUpperLimit.val(""),this.$divTargetPoint.attr("data-value","").html('<span class="glyphicon glyphicon-plus"></span>'),this.$divReferencePoint.attr("data-value","").html('<span class="glyphicon glyphicon-plus"></span>'),this.$btnCondition.attr("data-value",0).children("span").eq(0).text("Equal To (=)"),this.$iptConditionVal.val(""),this.$btnWarnMode.attr("data-value",0).children("span").eq(0).text("From User Input"),this.$btnHistoryValUsage.attr("data-value",0).children("span").eq(0).text("Use As Lower Limit"),this.$iptWarnTimeRangeStart.val(""),this.$iptLowerWarnVal.val(""),this.$iptUpperWarnVal.val(""),this.$btnPreWarnMode.attr("data-value",0).children("span").eq(0).text("From User Input"),this.$iptPreGreaterThan.val(""),this.$iptPreLessThan.val(""),animArr=[],animArr.push({$ele:this.$fgWarnRange,action:"show"}),animArr.push({$ele:this.$fgWarnTime,action:"hide"}),animArr.push({$ele:this.$fgWarnTimeRange,action:"hide"}),this.displayField(animArr,!1),animArr=[],animArr.push({$ele:this.$fgPreWarnRange,action:"show"}),animArr.push({$ele:this.$fgPreWarnTime,action:"hide"}),animArr.push({$ele:this.$fgPreWarnTimeRange,action:"hide"}),this.displayField(animArr,!1)),(!name||name.indexOf("warn-time")>-1)&&(this.$btnWarnTimeMode.attr("data-value",0),this.$btnWarnTimeMode.children("span").eq(0).text("From User Input"),this.$btnHistoryValUsage.attr("data-value",0),this.$btnHistoryValUsage.children("span").eq(0).text("Use As Lower Limit")),(!name||name.indexOf("start-month")>-1)&&(this.$btnStartMonth.attr("data-value",""),this.$btnStartMonth.children("span").eq(0).text("Start Month")),(!name||name.indexOf("pre-warn-time")>-1)&&(this.$btnPreWarnTimeMode.attr("data-value",0),this.$btnPreWarnTimeMode.children("span").eq(0).text("From User Input"))},ModalKPIConfig.prototype.recoverForm=function(form){var name,animArr=[],animArr2=[],_this=this;form&&(this.$iptChartName.val(form.chartName),this.$iptChartLowerLimit.val(form.chartLowerLimit),this.$iptChartUpperLimit.val(form.chartUpperLimit),name=AppConfig.datasource.getDSItemById(form.targetPointId).alias,this.$divTargetPoint.attr({"data-value":form.targetPointId,title:name}).html("<span>"+name+"</span>"),name=AppConfig.datasource.getDSItemById(form.referencePointId).alias,name&&this.$divReferencePoint.attr({"data-value":form.referencePointId,title:name}).html("<span>"+name+"</span>"),this.$btnCondition.attr("data-value",form.referenceCondition).children("span").eq(0).text(form.referenceConditionName),this.$iptConditionVal.val(form.referenceConditionVal),this.$btnDataCycleMode.attr("data-value",form.dataCycleMode).children("span").eq(0).text(form.dataCycleModeName),this.$btnWarnMode.attr("data-value",form.warnMode).children("span").eq(0).text(form.warnModeName),this.$btnWarnTimeMode.attr("data-value",form.warnTimeMode).children("span").eq(0).text(form.warnTimeModeName),this.$btnHistoryValUsage.attr("data-value",form.historyValUsage).children("span").eq(0).text(form.historyValUsageName),this.$iptWarnTimeRangeStart.val(form.warnTimeRangeStart),1===form.warnMode&&(animArr.push({$ele:this.$fgWarnRange,action:"hide"}),animArr.push({$ele:this.$fgWarnTime,action:"show"}),animArr.push(0===form.warnTimeMode?{$ele:this.$fgWarnTimeRange,action:"show"}:{$ele:this.$fgWarnTimeRange,action:"hide"}),window.setTimeout(function(){_this.displayField(animArr)},1200)),this.$iptLowerWarnVal.val(form.warnLowerLimit),this.$iptUpperWarnVal.val(form.warnUpperLimit),this.$btnPreWarnMode.attr("data-value",form.preWarnMode).children("span").eq(0).text(form.preWarnModeName),this.$iptPreGreaterThan.val(form.preGreaterThan),this.$iptPreLessThan.val(form.preLessThan),this.$btnPreWarnTimeMode.attr("data-value",form.preWarnTimeMode).children("span").eq(0).text(form.preWarnTimeModeName),this.$btnPreHistoryValUsage.attr("data-value",form.preHistoryValUsage).children("span").eq(0).text(form.preHistoryValUsageName),this.$iptPreWarnTimeRangeStart.val(form.preWarnTimeRangeStart),1===form.preWarnMode&&(animArr2.push({$ele:this.$fgPreWarnRange,action:"hide"}),animArr2.push({$ele:this.$fgPreWarnTime,action:"show"}),animArr2.push(0===form.preWarnTimeMode?{$ele:this.$fgPreWarnTimeRange,action:"show"}:{$ele:this.$fgPreWarnTimeRange,action:"hide"}),window.setTimeout(function(){_this.displayField(animArr2)},1200)))},ModalKPIConfig.prototype.setOptions=function(options){this.options=$.extend({},this.options,options)},ModalKPIConfig.prototype.attachEvents=function(){$(".dropdown-menu").off("click.selected").on("click.selected","a",function(e){var $this=$(this),$btn=$this.parents(".dropdown-wrap").children("button"),value=$this.attr("data-value"),text=$this.text();$btn.attr("data-value",value),$btn.children("span").eq(0).text(text),e.preventDefault()}),this.$modal.off("show.bs.modal").on("show.bs.modal",function(e){var $rightCt;return"bs.modal"!==e.namespace?!0:($rightCt=$("#rightCt"),_this.recoverForm(_this.options.modalIns.entity.modal.option),void($rightCt.hasClass("rightCtOpen")||$rightCt.click()))}),this.$modal.off("hide.bs.modal").on("hide.bs.modal",function(e){var $rightCt;return"bs.modal"!==e.namespace?!0:($rightCt=$("#rightCt"),_this.reset(),void($rightCt.hasClass("rightCtOpen")&&$rightCt.click()))}),this.$ulWarnMode.find("a").off().on("click",function(e){var value=parseInt($(this).attr("data-value")),lastValue=parseInt(_this.$btnWarnMode.attr("data-value")),animArr=[];value!==lastValue&&(_this.$btnWarnMode.attr("data-value",value),0===value?(animArr.push({$ele:_this.$fgWarnRange,action:"show"}),animArr.push({$ele:_this.$fgWarnTime,action:"hide"}),animArr.push({$ele:_this.$fgWarnTimeRange,action:"hide"})):(_this.reset(["warn-time"]),animArr.push({$ele:_this.$fgWarnRange,action:"hide"}),animArr.push({$ele:_this.$fgWarnTime,action:"show"}),animArr.push({$ele:_this.$fgWarnTimeRange,action:"show"})),_this.displayField(animArr))}),this.$ulWarnTimeMode.find("a").off().on("click",function(e){var value=parseInt($(this).attr("data-value")),lastValue=parseInt(_this.$btnWarnTimeMode.attr("data-value")),animArr=[];value!==lastValue&&(_this.$btnWarnTimeMode.attr("data-value",value),0===value?(animArr.push({$ele:_this.$fgWarnRange,action:"hide"}),animArr.push({$ele:_this.$fgWarnTime,action:"show"}),animArr.push({$ele:_this.$fgWarnTimeRange,action:"show"})):(animArr.push({$ele:_this.$fgWarnRange,action:"hide"}),animArr.push({$ele:_this.$fgWarnTime,action:"show"}),animArr.push({$ele:_this.$fgWarnTimeRange,action:"hide"})),_this.displayField(animArr))}),this.$ulPreWarnMode.find("a").off().on("click",function(e){var value=parseInt($(this).attr("data-value")),lastValue=parseInt(_this.$btnPreWarnMode.attr("data-value")),animArr=[];value!==lastValue&&(_this.$btnPreWarnMode.attr("data-value",value),0===value?(animArr.push({$ele:_this.$fgPreWarnRange,action:"show"}),animArr.push({$ele:_this.$fgPreWarnTime,action:"hide"}),animArr.push({$ele:_this.$fgPreWarnTimeRange,action:"hide"})):(_this.reset("pre-warn-time"),animArr.push({$ele:_this.$fgPreWarnRange,action:"hide"}),animArr.push({$ele:_this.$fgPreWarnTime,action:"show"}),animArr.push({$ele:_this.$fgPreWarnTimeRange,action:"show"})),_this.displayField(animArr))}),this.$ulPreWarnTimeMode.find("a").off().on("click",function(e){var value=parseInt($(this).attr("data-value")),lastValue=parseInt(_this.$btnPreWarnTimeMode.attr("data-value")),animArr=[];value!==lastValue&&(_this.$btnPreWarnTimeMode.attr("data-value",value),0===value?(animArr.push({$ele:_this.$fgPreWarnRange,action:"hide"}),animArr.push({$ele:_this.$fgPreWarnTime,action:"show"}),animArr.push({$ele:_this.$fgPreWarnTimeRange,action:"show"})):(animArr.push({$ele:_this.$fgPreWarnRange,action:"hide"}),animArr.push({$ele:_this.$fgPreWarnTime,action:"show"}),animArr.push({$ele:_this.$fgPreWarnTimeRange,action:"hide"})),_this.displayField(animArr))}),this.$ulDataCycleMode.find("a").off().on("click",function(e){var lastMonth,lastMonth2,nowMonth,lang,value=parseInt($(this).attr("data-value")),lastValue=parseInt(_this.$btnDataCycleMode.attr("data-value")),arrHtml=[],liTmpl='<li><a href="javascript:;" data-value="{0}">{1}</a></li>';value!==lastValue&&(_this.$btnDataCycleMode.attr("data-value",value),0===value?_this.$fgiStartMonth.removeClass("on"):(lang=I18n.type,nowMonth=DateUtil.getNextMonth((new Date).getMonth()),lastMonth=DateUtil.getLastMonth(nowMonth),lastMonth2=DateUtil.getLastMonth(lastMonth),arrHtml.push(liTmpl.format(lastMonth2,DateUtil.getMonthNameShort(lastMonth2-1,lang))),arrHtml.push(liTmpl.format(lastMonth,DateUtil.getMonthNameShort(lastMonth-1,lang))),arrHtml.push(liTmpl.format(nowMonth,DateUtil.getMonthNameShort(nowMonth-1,lang))),_this.$ulStartMonth.html(arrHtml.join("")),_this.reset("start-month"),_this.$fgiStartMonth.addClass("on")))}),this.$dropArea.off("dragover").on("dragover",function(e){e.preventDefault()}),this.$dropArea.off("dragenter").on("dragenter",function(e){$(e.target).addClass("on"),e.preventDefault(),e.stopPropagation()}),this.$dropArea.off("dragleave").on("dragleave",function(e){$(e.target).removeClass("on"),e.stopPropagation()}),this.$dropArea.off("drop").on("drop",function(e){var name,transfer=e.originalEvent.dataTransfer,itemId=transfer.getData("dsItemId"),$target=$(e.target);itemId&&($target.removeClass("on"),name=AppConfig.datasource.getDSItemById(itemId).alias,$target.attr({"data-value":itemId,title:name}),$target.html("<span>"+name+"</span>"),e.stopPropagation())}),this.$btnSubmit.off().click(function(){var form={};form.chartName=_this.$iptChartName.val(),form.chartLowerLimit=parseFloat(_this.$iptChartLowerLimit.val()),form.chartUpperLimit=parseFloat(_this.$iptChartUpperLimit.val()),form.targetPointId=_this.$divTargetPoint.attr("data-value"),form.referencePointId=_this.$divReferencePoint.attr("data-value"),form.referenceCondition=parseInt(_this.$btnCondition.attr("data-value")),form.referenceConditionName=_this.$btnCondition.children("span").eq(0).text(),form.referenceConditionVal=parseFloat(_this.$iptConditionVal.val()),form.dataCycleMode=parseInt(_this.$btnDataCycleMode.attr("data-value")),form.dataCycleModeName=_this.$btnDataCycleMode.children("span").eq(0).text(),form.btnStartMonth=_this.$btnStartMonth.attr("data-value"),form.warnMode=parseInt(_this.$btnWarnMode.attr("data-value")),form.warnModeName=_this.$btnWarnMode.children("span").eq(0).text(),form.isShowRC=parseInt(_this.$btnIsShowRC.attr("data-value")),form.isShowRCName=_this.$btnIsShowRC.children("span").eq(0).text(),form.warnLowerLimit=parseFloat(_this.$iptLowerWarnVal.val()),form.warnUpperLimit=parseFloat(_this.$iptUpperWarnVal.val()),form.warnTimeMode=parseInt(_this.$btnWarnTimeMode.attr("data-value")),form.warnTimeModeName=_this.$btnWarnTimeMode.children("span").eq(0).text(),form.historyValUsage=parseInt(_this.$btnHistoryValUsage.attr("data-value")),form.historyValUsageName=_this.$btnHistoryValUsage.children("span").eq(0).text(),form.warnTimeRangeStart=_this.$iptWarnTimeRangeStart.val(),form.preWarnMode=parseInt(_this.$btnPreWarnMode.attr("data-value")),form.preWarnModeName=_this.$btnPreWarnMode.children("span").eq(0).text(),form.preGreaterThan=parseFloat(_this.$iptPreGreaterThan.val()),form.preLessThan=parseFloat(_this.$iptPreLessThan.val()),form.preWarnTimeMode=parseInt(_this.$btnPreWarnTimeMode.attr("data-value")),form.preWarnTimeModeName=_this.$btnPreWarnTimeMode.children("span").eq(0).text(),form.preHistoryValUsage=parseInt(_this.$btnPreHistoryValUsage.attr("data-value")),form.preHistoryValUsageName=_this.$btnPreHistoryValUsage.children("span").eq(0).text(),form.preWarnTimeRangeStart=_this.$iptPreWarnTimeRangeStart.val(),_this.options.onSubmit.call(_this.options.modalIns,form),_this.$btnClose.trigger("click")})},ModalKPIConfig.prototype.detachEvents=function(){},ModalKPIConfig.prototype.destroy=function(){this.detachEvents(),this.$wrap.remove()};var DEFAULTS={};return ModalKPIConfig}(jQuery,window),ModalKPIChart=function($){function ModalKPIChart(screen,entityParams){ModalBase.call(this,screen,entityParams,this._render,null,this._showConfig),this.options=$.extend(!0,{},DEFAULTS),this.historyChartOptions=$.extend(!0,{},HISTORY_CHART_DEFAULTS),this.startline=null,this.endline=null,this.targetPointData=null,
this.referencePointData=null,this.refreshTimesInOneHour=1,this.period=null,this.indicators={},this.samplingPeriod={format:"h1",value2ms:36e5},this.historyChart=null,this.$lkUpdateTime=null}var PRECISION=3;ModalKPIChart.prototype=Object.create(ModalBase.prototype),ModalKPIChart.prototype.constructor=ModalKPIChart,ModalKPIChart.prototype.optionTemplate={name:"toolBox.modal.REAL_TIME_KPI_CHART",parent:0,mode:"custom",maxNum:1,title:"",minHeight:2,minWidth:3,maxHeight:6,maxWidth:12,type:"ModalKPIChart"},ModalKPIChart.prototype._render=function(){var postData,_this=this,option=this.entity.modal.option,min=option.chartLowerLimit||0,max=option.chartUpperLimit||100,warnMode=option.warnMode,warnLower=option.warnLowerLimit,warnUpper=option.warnUpperLimit,preWarnMode=option.preWarnMode,preWarnLower=warnLower+option.preGreaterThan,preWarnUpper=warnUpper-option.preLessThan,historyValUsage=option.historyValUsage,targetPointId=option.targetPointId,referencePointId=option.referencePointId,period=(option.dataCycleMode,this.period=this.getTimePeriod()),ids=referencePointId?[targetPointId,referencePointId]:[targetPointId];postData=[{dsItemIds:ids,timeStart:period.nowStart,timeEnd:period.nowEnd,timeFormat:this.samplingPeriod.format}],1===warnMode&&postData.push({dsItemIds:ids,timeStart:period.refStart,timeEnd:period.refEnd,timeFormat:this.samplingPeriod.format}),this.initHistoryModal(),this.options.series[0].data[0].value=min,this.options.series[0].min=min,this.options.series[0].max=max,this.historyChartOptions.yAxis[0].min=min,this.historyChartOptions.yAxis[0].max=max,this.options.tooltip.formatter=function(p){return p.seriesName+": <strong>"+p.value+"</strong><br/>From: "+_this.store.timeShaft[0]+"<br/>To: "+_this.store.timeShaft[_this.store.timeShaft.length-1]},this.spinner.spin(this.container),WebAPI.post("/analysis/startWorkspaceDataGenHistogramMulti",postData).done(function(rs){var maxIndex,axisColor=_this.options.series[0].axisLine.lineStyle.color,range=max-min;rs=JSON.parse(rs),_this.store={list:{},timeShaft:rs[0].timeShaft};for(var i=0,len=rs[0].list.length;len>i;i++)_this.store.list[rs[0].list[i].dsItemId]=rs[0].list[i].data;if(void 0!==rs[1])for(_this.store2={list:{},timeShaft:rs[1].timeShaft},i=0,len=rs[1].list.length;len>i;i++)_this.store2.list[rs[1].list[i].dsItemId]=rs[1].list[i].data;_this.filterPointData(),_this.initIndicators(),_this.setTimeParams(),maxIndex=_this.store.fullTimeShaft.length-1,0===warnMode?(void 0!==warnLower&&warnLower-min>0&&(axisColor.push([(warnLower-min)/range,"#ff4500"]),_this.historyChartOptions.series[0].markLine.data.push([{name:"Lower Warn Line",value:warnLower,xAxis:0,yAxis:warnLower,itemStyle:{normal:{color:"#ff4500",lineStyle:{type:"solid"}}}},{xAxis:_this.store.deadline,yAxis:warnLower}])),void 0!==preWarnLower&&preWarnLower-min>0&&(axisColor.push([(preWarnLower-min)/range,"orange"]),_this.historyChartOptions.series[0].markLine.data.push([{name:"Lower Pre-Warn Line",value:preWarnLower,xAxis:0,yAxis:preWarnLower,itemStyle:{normal:{color:"orange",lineStyle:{type:"solid"}}}},{xAxis:_this.store.deadline,yAxis:preWarnLower}])),void 0!==preWarnUpper&&preWarnUpper-min>0&&(axisColor.push([(preWarnUpper-min)/range,"lightgreen"]),_this.historyChartOptions.series[0].markLine.data.push([{name:"Upper Pre-Warn Line",value:preWarnUpper,xAxis:0,yAxis:preWarnUpper,itemStyle:{normal:{color:"orange",lineStyle:{type:"solid"}}}},{xAxis:maxIndex,yAxis:preWarnUpper}])),void 0!==warnUpper&&warnUpper-min>0&&(axisColor.push([(warnUpper-min)/range,"orange"]),_this.historyChartOptions.series[0].markLine.data.push([{name:"Upper Warn Line",value:warnUpper,xAxis:0,yAxis:warnUpper,itemStyle:{normal:{color:"#ff4500",lineStyle:{type:"solid"}}}},{xAxis:maxIndex,yAxis:warnUpper}])),axisColor.push([1,"#ff4500"])):0===historyValUsage?(axisColor.push([(_this.indicators.average2-min)/range,"#ff4500"]),0===preWarnMode?(preWarnLower=_this.indicators.average2+option.preGreaterThan,void 0!==preWarnLower&&preWarnLower-min>0&&(axisColor.push([(preWarnLower-min)/range,"orange"]),_this.historyChartOptions.series[0].markLine.data.push([{name:"Lower Pre-Warn Line",value:preWarnLower.toFixed(PRECISION),xAxis:0,yAxis:preWarnLower,itemStyle:{normal:{color:"orange",lineStyle:{type:"solid"}}}},{xAxis:_this.store.deadline,yAxis:preWarnLower}]))):1===preWarnMode&&_this.indicators.preWarnValue>_this.indicators.average2&&(axisColor.push([(_this.indicators.preWarnValue-min)/range,"orange"]),_this.historyChartOptions.series[0].markLine.data.push([{name:"Lower Pre-Warn Line",value:_this.indicators.preWarnValue.toFixed(PRECISION),xAxis:0,yAxis:_this.indicators.preWarnValue,itemStyle:{normal:{color:"orange",lineStyle:{type:"solid"}}}},{xAxis:_this.store.deadline,yAxis:_this.indicators.preWarnValue}])),axisColor.push([1,"lightgreen"]),_this.historyChartOptions.series[0].markLine.data.push([{name:"Lower Warn Line",value:_this.indicators.average2.toFixed(PRECISION),xAxis:0,yAxis:_this.indicators.average2,itemStyle:{normal:{color:"#ff4500",lineStyle:{type:"solid"}}}},{xAxis:_this.store.deadline,yAxis:_this.indicators.average2}])):(0===preWarnMode?(preWarnUpper=_this.indicators.average2-option.preLessThan,void 0!==preWarnUpper&&preWarnUpper-min>0&&(axisColor.push([(preWarnUpper-min)/range,"lightgreen"]),axisColor.push([(_this.indicators.average2-min)/range,"orange"]),_this.historyChartOptions.series[0].markLine.data.push([{name:"Upper Pre-Warn Line",value:preWarnUpper.toFixed(PRECISION),xAxis:0,yAxis:preWarnUpper,itemStyle:{normal:{color:"orange",lineStyle:{type:"solid"}}}},{xAxis:_this.store.deadline,yAxis:preWarnUpper}]))):1===preWarnMode&&_this.indicators.preWarnValue<_this.indicators.average2?(axisColor.push([(_this.indicators.preWarnValue-min)/range,"lightgreen"]),axisColor.push([(_this.indicators.average2-min)/range,"orange"]),_this.historyChartOptions.series[0].markLine.data.push([{name:"Upper Pre-Warn Line",value:_this.indicators.preWarnValue.toFixed(PRECISION),xAxis:0,yAxis:_this.indicators.preWarnValue,itemStyle:{normal:{color:"orange",lineStyle:{type:"solid"}}}},{xAxis:_this.store.deadline,yAxis:_this.indicators.preWarnValue}])):axisColor.push([(_this.indicators.average2-min)/range,"lightgreen"]),axisColor.push([1,"#ff4500"]),_this.historyChartOptions.series[0].markLine.data.push([{name:"Upper Warn Line",value:_this.indicators.average2.toFixed(PRECISION),xAxis:0,yAxis:_this.indicators.average2,itemStyle:{normal:{color:"#ff4500",lineStyle:{type:"solid"}}}},{xAxis:_this.store.deadline,yAxis:_this.indicators.average2}])),_this.chart=echarts.init(_this.container,"macarons").setOption(_this.options),_this.reloadChart()}).always(function(){_this.spinner.stop()})},ModalKPIChart.prototype.filterPointData=function(){var option=this.entity.modal.option,warnMode=option.warnMode,cond=option.referenceCondition,condVal=option.referenceConditionVal,tPoints=null,rPoints=null;if(option.referencePointId&&(tPoints=this.store.list[option.targetPointId],rPoints=this.store.list[option.referencePointId],tPoints.length===rPoints.length)){for(var i=0,len=rPoints.length;len>i;i++)tPoints[i]=parseFloat(tPoints[i]),rPoints[i]=parseFloat(rPoints[i]),this.isPointRuled(rPoints[i],condVal,cond)||(tPoints[i]="-");if(delete this.store.list[option.referencePointId],1===warnMode){if(tPoints=this.store2.list[option.targetPointId],rPoints=this.store2.list[option.referencePointId],tPoints.length!==rPoints.length)return;for(var i=0,len=rPoints.length;len>i;i++)tPoints[i]=parseFloat(tPoints[i]),rPoints[i]=parseFloat(rPoints[i]),this.isPointRuled(rPoints[i],condVal,cond)||(tPoints[i]="-");delete this.store2.list[option.referencePointId]}}},ModalKPIChart.prototype.isPointRuled=function(pointVal,condVal,cond){if(null===condVal)return!0;switch(cond){case 0:return pointVal===condVal;case 1:return condVal>pointVal;case 2:return pointVal>condVal;default:return!0}},ModalKPIChart.prototype.setAnimation=function(){var option=this.entity.modal.option,warnMode=option.warnMode,historyValUsage=option.historyValUsage,warnLower=option.warnLowerLimit,warnUpper=option.warnUpperLimit,preWarnLower=warnLower+option.preGreaterThan,preWarnUpper=warnUpper-option.preLessThan,$parent=$(this.container).parents(".panel"),curVal=this.indicators.average;if($parent.removeClass("warn-anim pre-warn-anim"),1===warnMode)(0===historyValUsage&&curVal<this.indicators.average2||1===historyValUsage&&curVal>this.indicators.average2)&&$parent.addClass("warn-anim");else switch(!0){case preWarnLower>curVal:$parent.addClass("pre-warn-anim");break;case warnLower>curVal:$parent.addClass("warn-anim");break;case preWarnUpper>curVal:break;case warnUpper>curVal:$parent.addClass("pre-warn-anim");break;default:$parent.addClass("warn-anim")}},ModalKPIChart.prototype.initHistoryModal=function(){var _this=this,$modalKPI=$("#modalKPIHistory"),$btnShowHistory=$('<a href="javascript:;" title="Show History" class="lk-show-history"><span class="glyphicon glyphicon-stats"></span></a>'),$panel=$(this.container).parents(".panel");0===$modalKPI.length&&($modalKPI=$('\r\n            <div class="modal" id="modalKPIHistory">\r\n            <div class="modal-dialog" style="width: 1000px;margin-top: 110px;">\r\n                <div class="modal-content">\r\n                    <div class="modal-body">\r\n                        <div style="height: 550px;" id="divKPIHistoryPanel"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            </div>').appendTo(document.getElementById("paneContent"))),$btnShowHistory.click(function(){$modalKPI.one("shown.bs.modal",function(){var option=_this.entity.modal.option,targetPointId=option.targetPointId,list=_this.store.list[targetPointId],lastTime=_this.store.timeShaft[_this.store.timeShaft.length-1];_this.historyChartOptions.series[0].data=_this.store.list[option.targetPointId],_this.historyChartOptions.series[0].markPoint.data=[{name:lastTime,value:parseFloat(list[list.length-1]).toFixed(PRECISION),xAxis:list.length-1,yAxis:list[list.length-1]}],_this.historyChartOptions.series[0].markLine.data.push([{name:"Average",value:_this.indicators.average.toFixed(PRECISION),xAxis:0,yAxis:_this.indicators.average,itemStyle:{normal:{lineStyle:{type:"solid"}}}},{xAxis:_this.store.deadline,yAxis:_this.indicators.average}]),_this.historyChartOptions.xAxis[0].data=_this.store.fullTimeShaft,1===option.warnMode&&(_this.historyChartOptions.series[1]={name:"Historic Comparison",type:"line",symbolSize:0,data:_this.store2.list[option.targetPointId]},_this.historyChartOptions.legend.data[1]="Historic Comparison",_this.historyChartOptions.tooltip.formatter=function(p){var name;return 2===p.length?(name=new Date(new Date(p[0].name).valueOf()-_this.period.lag).format("yyyy-MM-dd HH:mm:ss"),"{0}<br/>{1}: {2}<br/>{3}<br/>{4}: {5}".format(p[0].name,p[0].seriesName,p[0].value,name,p[1].seriesName,p[1].value)):"Historic Comparison"===p[0].seriesName?(name=new Date(new Date(p[0].name).valueOf()-_this.period.lag).format("yyyy-MM-dd HH:mm:ss"),"{0}<br/>{1}: {2}".format(name,p[0].seriesName,p[0].value)):"{0}<br/>{1}: {2}".format(p[0].name,p[0].seriesName,p[0].value)}),_this.historyChart=echarts.init(document.getElementById("divKPIHistoryPanel"),"macarons"),_this.historyChart.setOption(_this.historyChartOptions),_this.historyChartOptions.series[0].markLine.data.pop()}),window.setTimeout(function(){$modalKPI.modal("show")},0),$modalKPI.one("hiden.bs.modal",function(){_this.historyChart.dispose(),document.getElementById("divKPIHistoryPanel").innerHTML=""})}).appendTo($panel),this.$lkUpdateTime=$('<div class="lk-update-time" title="Last Update Time"><span class="glyphicon glyphicon-time"></span><span>updating...</span></div>').appendTo($panel)},ModalKPIChart.prototype.update=function(rs){var targetPointData,referencePointData,lastTick,nowTick,option=this.entity.modal.option,targetPointId=option.targetPointId,referencePointId=option.referencePointId;if(this.store&&(lastTick=this.store.timeShaft[this.store.timeShaft.length-1],lastTick=new Date(lastTick).valueOf()+6e4,nowTick=(new Date).valueOf(),!(lastTick>nowTick))){for(var i=0,len=rs.length;len>i;i++)targetPointId===rs[i].dsItemId&&(targetPointData=parseFloat(rs[i].data)),referencePointId===rs[i].dsItemId&&(referencePointData=parseFloat(rs[i].data));isNaN(targetPointData)||(this.appendData(targetPointData,referencePointData),this.reloadChart())}},ModalKPIChart.prototype.reloadChart=function(){this.options.series[0].data[0].value=this.indicators.average.toFixed(PRECISION),this.chart.setSeries(this.options.series,!0),this.setAnimation(),this.$lkUpdateTime.children("span").eq(1).text((new Date).format("HH:mm"))},ModalKPIChart.prototype._showConfig=function(){},ModalKPIChart.prototype.showConfigModal=function(container,options){this.configModal.setOptions({modalIns:this}),this.configModal.show()},ModalKPIChart.prototype.setOptions=function(options){this.options=$.extend({},this.opitons,options)},ModalKPIChart.prototype.destroy=function(){},ModalKPIChart.prototype.saveConfig=function(form){this.entity.modal.title=form.chartName,this.entity.modal.points=[form.targetPointId],form.referencePointId&&this.entity.modal.points.push(form.referencePointId),this.entity.modal.option=form,this.entity.modal.interval=6e4},ModalKPIChart.prototype.configModal=new ModalKPIConfig({onSubmit:function(form){this.saveConfig(form)}}),ModalKPIChart.prototype.getTimePeriod=function(){var now=new Date,period={},option=this.entity.modal.option,warnMode=option.warnMode,warnStart=(option.historyValUsage,option.warnTimeRangeStart),warnTimeMode=option.warnTimeMode,circleMode=(option.warnTimeRangeStart,option.dataCycleMode);if(0===circleMode){if(period.nowStart=now.format("yyyy-MM-01 00:00:00"),period.nowEnd=now.format("yyyy-MM-dd HH:mm:ss"),0===warnMode)return period;0===warnTimeMode?(period.refStart=new Date(warnStart).format("yyyy-MM"),period.refEnd=period.refStart+"-"+DateUtil.daysInMonth(new Date(period.refStart))+" 23:59:59",period.refStart+="-01 00:00:00"):(period.refStart=now.format("yyyy")-1+now.format("-MM"),period.refEnd=period.refStart+"-"+DateUtil.daysInMonth(new Date(period.refStart))+" 23:59:59",period.refStart+="-01 00:00:00"),period.lag=new Date(period.nowStart).valueOf()-new Date(period.refStart).valueOf()}return period},ModalKPIChart.prototype.initIndicators=function(){for(var option=this.entity.modal.option,warnMode=option.warnMode,preWarnMode=option.preWarnMode,dsId=option.targetPointId,data=this.store.list[dsId],average=0,i=0,len=data.length;len>i;i++)isNaN(data[i])||(average+=1*data[i]);if(isNaN(average)?this.indicators.average=this.entity.modal.option.chartLowerLimit:this.indicators.average=average/len,1===warnMode){average=0,data=this.store2.list[dsId];for(var i=0,len=data.length;len>i;i++)isNaN(parseFloat(data[i]))||(average+=1*data[i]);isNaN(average)?this.indicators.average2=this.entity.modal.option.chartLowerLimit:this.indicators.average2=average/len}1===preWarnMode&&this.setPreWarnValue()},ModalKPIChart.prototype.setPreWarnValue=function(){for(var option=this.entity.modal.option,targetPointId=option.targetPointId,warnMode=option.warnMode,preHistoryValUsage=option.preHistoryValUsage,list1=this.store.list[targetPointId],list2=this.store2.list[targetPointId],sum=0,validNum=0,i=0,len1=list1.length,len2=list2.length;len2>i;i++){if(i>=len1){if(isNaN(list2[i]))continue;sum+=list2[i]}else{if(isNaN(list1[i]))continue;sum+=list1[i]}validNum+=1}1===warnMode?this.indicators.preWarnValue=this.indicators.average+this.indicators.average2-sum/validNum:0===preHistoryValUsage?this.indicators.preWarnValue=this.indicators.average+option.warnLowerLimit-sum/validNum:this.indicators.preWarnValue=this.indicators.average+option.warnUpperLimit-sum/validNum},ModalKPIChart.prototype.appendData=function(tValue,rValue){var lastValue,newLastValue,timeStamp,lastTick=this.store.timeShaft[this.store.timeShaft.length-1],option=this.entity.modal.option,preWarnMode=option.preWarnMode,targetPointId=option.targetPointId,targetPointList=this.store.list[targetPointId],cond=option.referenceCondition,condVal=option.referenceConditionVal,len=this.store.list[targetPointId].length,nowStr=(new Date).format("yyyy-MM-dd HH:00:00");(isNaN(rValue)||this.isPointRuled(rValue,condVal,cond))&&(tValue=1*tValue.toFixed(3),lastTick!==nowStr?(timeStamp=new Date(lastTick).valueOf(),new Date(nowStr).valueOf()-timeStamp>36e5&&this.store.timeShaft.push(new Date(timeStamp+36e5).format("yyyy-MM-dd HH:00:00")),this.store.timeShaft.push(nowStr),this.refreshTimesInOneHour=0,this.indicators.average=(this.indicators.average*len+tValue)/(len+1),targetPointList.push(tValue)):(lastValue=targetPointList[targetPointList.length-1],newLastValue=(lastValue*this.refreshTimesInOneHour+tValue)/(this.refreshTimesInOneHour+1),targetPointList[targetPointList.length-1]=1*newLastValue.toFixed(3),this.indicators.average=(this.indicators.average*len-lastValue+newLastValue)/len,this.refreshTimesInOneHour+=1),1===preWarnMode&&this.setPreWarnValue())},ModalKPIChart.prototype.setTimeParams=function(){var lastTick=new Date(this.store.timeShaft[this.store.timeShaft.length-1]).valueOf(),option=this.entity.modal.option,tick=lastTick+this.samplingPeriod.value2ms,now=new Date;if(this.store.fullTimeShaft=this.store.timeShaft.concat(),0===option.dataCycleMode)for(this.store.deadline=new Date(now.format("yyyy-MM-"+DateUtil.daysInMonth(now)+" 23:55:00"));tick<=this.store.deadline;)tick+=this.samplingPeriod.value2ms,this.store.fullTimeShaft.push(new Date(tick).format("yyyy-MM-dd HH:mm:ss"))};var DEFAULTS={tooltip:{},series:[{name:"KPI Indicator",type:"gauge",precision:2,splitNumber:10,startAngle:140,endAngle:-140,axisLine:{show:!0,lineStyle:{width:30,color:[]}},axisTick:{show:!0,splitNumber:5,length:8,lineStyle:{color:"#eee",width:1,type:"solid"}},splitLine:{show:!0,length:30,lineStyle:{color:"#eee",width:2,type:"solid"}},pointer:{length:"80%",width:8},title:{show:!0,offsetCenter:["-65%",-20],textStyle:{color:"#333",fontSize:15}},detail:{offsetCenter:["-65%",-15]},data:[{name:""}]}]},HISTORY_CHART_DEFAULTS={title:{text:"History Data"},legend:{data:["Target Point"]},tooltip:{trigger:"axis"},dataZoom:{show:!1,realtime:!0,start:0,end:100},grid:{y2:80},xAxis:[{type:"category"}],yAxis:[{type:"value"}],series:[{name:"Target Point",type:"line",symbolSize:0,markLine:{precision:3,symbol:"none",data:[]},markPoint:{symbol:"emptyCircle",effect:{show:!0,shadowBlur:0},data:[]}}]};return ModalKPIChart}(jQuery),AnlzBase=function(){function AnlzBase(container,option,screen){_this=this,this.container=container,this.options=option,this.screen=screen,this.paneChart=void 0,this.paneNotes=void 0,this.chart=void 0,this.noteCount=0,this.chartAnimationDuration=500,this.spinnerRender=new LoadingSpinner({color:"#00FFFF"})}var _this;return AnlzBase.prototype={show:function(){this.initTools(),this.container.innerHTML="",this.paneNotes=$('<div style="position: relative; width: 100%; height: 100%;">')[0],$(this.container).append($('<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">').append(this.paneNotes)),this.screen.curModal.noteList?_this.initNotes(this.screen.curModal.noteList):this.screen.curModal.noteList=[],$divBackgroundContainer=$('<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">'),this.paneChart?$(this.container).append($divBackgroundContainer):(this.paneChart=$('<div style="width: 100%; height: 100%;">')[0],$(this.container).append($divBackgroundContainer).append(this.paneChart)),_this.spinnerRender.spin(this.container),this.init()},renderModal:function(data){_this=this,_this.render(data),setTimeout(function(){_this.screen.saveModalJudge.resolveWith(_this.screen,[_this.screen,_this.chart,$("#divWSPane .selected"),_this.screen.curModal,!0]),_this.spinnerRender.stop()},_this.chartAnimationDuration)},spinnerStop:function(){Spinner.stop(),_this.spinnerRender.stop()},close:function(){},init:function(){},errAlert:function(err){var $dataAlert=$("#dataAlert");switch(err){case"no data history":new Alert($dataAlert,"danger","<strong>"+I18n.resource.modalConfig.err.TYPE6+"</strong>").show().close();break;case"time":new Alert($dataAlert,"danger","<strong>"+I18n.resource.modalConfig.err.TYPE7+"</strong>").show().close();break;case"invalid time string":new Alert($dataAlert,"danger","<strong>"+I18n.resource.modalConfig.err.TYPE8+"</strong>").show().close();break;default:new Alert($dataAlert,"danger","<strong>"+I18n.resource.modalConfig.err.TYPE9+"</strong>").show().close()}setTimeout(function(){_this.screen.refreshPaneCenter(new AnalysisTemplate(_this.screen))},500)},initTools:function(){var _this=this;$(".itemTools .glyphicon-log-out").off("click").on("click",function(){_this.screen.refreshPaneCenter(new AnalysisTemplate(_this.screen)),$(".divPage.selected").removeClass("selected"),$(".itemTools .glyphicon-cog").off("click")}),$(".itemTools .glyphicon-cog").off("click").on("click",function(){for(var optionTemplate=_this.screen.factoryIoC.getModel(_this.screen.curModal.type).prototype.optionTemplate,data=[],i=0;i<_this.screen.curModal.itemDS.length;i++){data.push({}),data[i].dsType=_this.screen.curModal.itemDS[i].type,data[i].dsId=_this.screen.curModal.itemDS[i].arrId,data[i].dsName=[];for(var j=0;j<_this.screen.curModal.itemDS[i].arrId.length;j++)data[i].dsName.push(AppConfig.datasource.getDSItemById(_this.screen.curModal.itemDS[i].arrId[j]).alias)}var option={};option={modeUsable:optionTemplate.chartConfig,allDataNeed:"all"==optionTemplate.templateParams.paraAnlysMode,rowDataType:optionTemplate.templateParams.paraName,dataTypeMaxNum:optionTemplate.templateParams.dataTypeMaxNum,templateType:_this.screen.curModal.type,optionPara:{mode:_this.screen.curModal.mode,startTime:_this.screen.curModal.startTime,endTime:_this.screen.curModal.endTime,interval:_this.screen.curModal.format,dataItem:data}},_this.screen.modalConfig.showModalInit(!1,option)}),$(".itemTools .glyphicon-bookmark").off("click").click(function(){_this.createNote()})},createNote:function(note){function getDivNotePos(){var pos={},$lastNote=$(".divNote:nth-last-child(1)");return $lastNote[0]?$lastNote[0].offsetLeft<100?(pos.x=0,pos.y=$lastNote[0].offsetTop+$lastNote[0].offsetHeight+20,_this.noteCount=0):(++_this.noteCount,pos.x=130*_this.noteCount,pos.y=$lastNote[0].offsetTop):(pos.x=0,pos.y=0),pos}function getDomPosOffsetWindow(el){for(var _x=0,_y=0;el&&!isNaN(el.offsetLeft)&&!isNaN(el.offsetTop);)_x+=el.offsetLeft-el.scrollLeft,_y+=el.offsetTop-el.scrollTop,el=el.offsetParent;return{top:_y,left:_x}}var origZIndex;this.noteDefaultWidth=440,this.noteDefaultHeight=220;var notePos=getDivNotePos(),$divNote=$('<div class="divNote">').click(function(){$(".divNote").length>1&&(_this.curtNote=$divNote[0],this.style.zIndex<_this.getNoteMaxZIndex()&&(this.style.zIndex=_this.getNoteMaxZIndex()+1,origZIndex=this.style.zIndex))}).hover(function(e){this.style.zIndex<_this.getNoteMaxZIndex()&&(origZIndex=getComputedStyle(this).zIndex,this.style.zIndex=_this.getNoteMaxZIndex()+1)}).attr("id",note?note.id:(new Date).valueOf()).css({zIndex:_this.getNoteMaxZIndex()+1,left:note?note.x:"auto",right:note?"auto":notePos.x+"px",top:note?note.y:notePos.y,width:note?note.width:this.noteDefaultWidth+"px",height:note?note.height:this.noteDefaultHeight+"px"}).mousedown(_this.doDown).mouseup(_this.doUp),$divTitle=$('<div class="title">').appendTo($divNote),panePos=getDomPosOffsetWindow(document.getElementById("paneContent"));$divTitle[0].draggable=!0,$divTitle[0].ondragstart=function(e){this.dragParent=$(this).closest(".divNote"),this.dragParent[0].style.width=getComputedStyle(this.dragParent[0]).width,this.lastOffset={x:e.offsetX,y:e.offsetY}},$divTitle[0].ondragend=function(e){if(this.dragParent){var note={id:this.dragParent.attr("id"),x:(this.dragParent.position().left/this.dragParent.offsetParent().width()*100).toFixed(2)+"%",y:(this.dragParent.position().top/this.dragParent.offsetParent().height()*100).toFixed(2)+"%"};_this.saveNote(note),this.dragParent=null}},$divTitle[0].ondrag=function(e){if(this.dragParent&&e.clientX>0){var isTop=e.clientY-panePos.top-60<0,isLeft=e.clientX-panePos.left-this.dragParent[0].offsetWidth<0;isTop||isLeft?(isTop&&!isLeft&&this.dragParent.css({top:0,left:e.clientX-panePos.left-this.dragParent[0].offsetWidth,width:this.dragParent[0].style.width}),!isTop&&isLeft&&this.dragParent.css({top:e.clientY-panePos.top-60,left:0,width:this.dragParent[0].style.width}),isTop&&isLeft&&this.dragParent.css({top:0,left:0,width:this.dragParent[0].style.width})):this.dragParent.css({top:e.clientY-panePos.top-60,left:e.clientX-panePos.left-this.dragParent[0].offsetWidth,width:this.dragParent[0].style.width}),this.dragParent.offsetParent()[0].offsetWidth-this.dragParent[0].offsetLeft-this.dragParent[0].offsetWidth<0&&this.dragParent.css({left:"auto",right:0,width:this.dragParent[0].style.width}),this.dragParent.offsetParent()[0].offsetHeight-this.dragParent[0].offsetTop-this.dragParent[0].offsetHeight<0&&this.dragParent.css({top:"auto",bottom:0,width:this.dragParent[0].style.width})}};var $divPin=$('<div class="glyphicon glyphicon-pushpin pinIcon grow">').appendTo($divTitle);$divPin.click(function(){_this.removeNote(this)});var $divText=$('<div class="divText">').appendTo($divNote);$divText.click(function(e){function saveText(obj,strTemp){if($.trim(obj.value)!=$.trim(strTemp)){var note={id:$(obj).closest(".divNote").attr("id"),text:obj.value};_this.saveNote(note)}}function getToolbar(){var btnHtml='<div class="btn-toolbar" data-role="editor-toolbar" data-target="#editor" style="display:none;"> \r\n                    <div class="btn-group"> \r\n                    <a class="btn dropdown-toggle" data-toggle="dropdown" title="" data-original-title="Font"><i class="icon-font"></i><b class="caret"></b></a> \r\n                      <ul class="dropdown-menu"> \r\n                      <li><a data-edit="fontName Serif" style="font-family:\'Serif\'">Serif</a></li><li><a data-edit="fontName Sans" style="font-family:\'Sans\'">Sans</a></li><li><a data-edit="fontName Arial" style="font-family:\'Arial\'">Arial</a></li><li><a data-edit="fontName Arial Black" style="font-family:\'Arial Black\'">Arial Black</a></li><li><a data-edit="fontName Courier" style="font-family:\'Courier\'">Courier</a></li><li><a data-edit="fontName Courier New" style="font-family:\'Courier New\'">Courier New</a></li><li><a data-edit="fontName Comic Sans MS" style="font-family:\'Comic Sans MS\'">Comic Sans MS</a></li><li><a data-edit="fontName Helvetica" style="font-family:\'Helvetica\'">Helvetica</a></li><li><a data-edit="fontName Impact" style="font-family:\'Impact\'">Impact</a></li><li><a data-edit="fontName Lucida Grande" style="font-family:\'Lucida Grande\'">Lucida Grande</a></li><li><a data-edit="fontName Lucida Sans" style="font-family:\'Lucida Sans\'">Lucida Sans</a></li><li><a data-edit="fontName Tahoma" style="font-family:\'Tahoma\'">Tahoma</a></li><li><a data-edit="fontName Times" style="font-family:\'Times\'">Times</a></li><li><a data-edit="fontName Times New Roman" style="font-family:\'Times New Roman\'">Times New Roman</a></li><li><a data-edit="fontName Verdana" style="font-family:\'Verdana\'">Verdana</a></li></ul> \r\n                    </div> \r\n                  <div class="btn-group"> \r\n                    <a class="btn dropdown-toggle" data-toggle="dropdown" title="" data-original-title="Font Size"><i class="icon-text-height"></i>&nbsp;<b class="caret"></b></a> \r\n                      <ul class="dropdown-menu"> \r\n                      <li><a data-edit="fontSize 5"><font size="5">Huge</font></a></li> \r\n                      <li><a data-edit="fontSize 3"><font size="3">Normal</font></a></li> \r\n                      <li><a data-edit="fontSize 1"><font size="1">Small</font></a></li> \r\n                      </ul> \r\n                  </div> \r\n                  <div class="btn-group"> \r\n                    <a class="btn" data-edit="bold" title="" data-original-title="Bold (Ctrl/Cmd+B)"><i class="icon-bold"></i></a>\r\n                    <a class="btn" data-edit="italic" title="" data-original-title="Italic (Ctrl/Cmd+I)"><i class="icon-italic"></i></a>\r\n                    <a class="btn" data-edit="strikethrough" title="" data-original-title="Strikethrough"><i class="icon-strikethrough"></i></a>\r\n                    <a class="btn" data-edit="underline" title="" data-original-title="Underline (Ctrl/Cmd+U)"><i class="icon-underline"></i></a>\r\n                  </div>\r\n                  <div class="btn-group">\r\n                    <a class="btn" data-edit="insertunorderedlist" title="" data-original-title="Bullet list"><i class="icon-list-ul"></i></a>\r\n                    <a class="btn" data-edit="insertorderedlist" title="" data-original-title="Number list"><i class="icon-list-ol"></i></a>\r\n                    <a class="btn" data-edit="outdent" title="" data-original-title="Reduce indent (Shift+Tab)"><i class="icon-indent-left"></i></a>\r\n                    <a class="btn" data-edit="indent" title="" data-original-title="Indent (Tab)"><i class="icon-indent-right"></i></a>\r\n                  </div>\r\n                  <div class="btn-group">\r\n                    <a class="btn btn-info" data-edit="justifyleft" title="" data-original-title="Align Left (Ctrl/Cmd+L)"><i class="icon-align-left"></i></a>\r\n                    <a class="btn" data-edit="justifycenter" title="" data-original-title="Center (Ctrl/Cmd+E)"><i class="icon-align-center"></i></a>\r\n                    <a class="btn" data-edit="justifyright" title="" data-original-title="Align Right (Ctrl/Cmd+R)"><i class="icon-align-right"></i></a>\r\n                    <a class="btn" data-edit="justifyfull" title="" data-original-title="Justify (Ctrl/Cmd+J)"><i class="icon-align-justify"></i></a>\r\n                  </div>\r\n                  <div class="btn-group">\r\n                      <a class="btn dropdown-toggle" data-toggle="dropdown" title="" data-original-title="Hyperlink"><i class="icon-link"></i></a>\r\n                        <div class="dropdown-menu input-append">\r\n                            <input class="span2" placeholder="URL" type="text" data-edit="createLink">\r\n                            <button class="btn" type="button">Add</button>\r\n                    </div>\r\n                    <a class="btn" data-edit="unlink" title="" data-original-title="Remove Hyperlink"><i class="icon-cut"></i></a>\r\n                  </div>\r\n                  <div class="btn-group">\r\n                    <a class="btn" title="" id="pictureBtn" data-original-title="Insert picture (or just drag &amp; drop)"><i class="icon-picture"></i></a>\r\n                    <input type="file" data-role="magic-overlay" data-target="#pictureBtn" data-edit="insertImage" style="opacity: 0; position: absolute; top: 0px; left: 0px; width: 41px; height: 30px;">\r\n                  </div>\r\n                  <div class="btn-group">\r\n                    <a class="btn" data-edit="undo" title="" data-original-title="Undo (Ctrl/Cmd+Z)"><i class="icon-undo"></i></a>\r\n                    <a class="btn" data-edit="redo" title="" data-original-title="Redo (Ctrl/Cmd+Y)"><i class="icon-repeat"></i></a>\r\n                  </div>\r\n                  <input type="text" data-edit="inserttext" id="voiceBtn" x-webkit-speech="" style="display: none;">\r\n                </div>';return btnHtml}var thisDiv=this,strTemp=this.textContent;this.style.display="none";var $editor=$divNote.find(".divTextEditor");if(0==$editor.length){$divNote.append($(getToolbar()));var $divTextEditor=$('<div class="divTextEditor"/>').keydown(function(){13==event.keyCode&&saveText(this,strTemp)}).appendTo($divNote).focus(function(){$divNote.find(".btn-toolbar").slideDown("1000"),$divNote.find(".divTextEditor").addClass("editing"),_this.curtNote=$divNote[0],$divNote.find(".divTextEditor").show(),$(thisDiv).hide()}).wysiwyg();$divTextEditor.show().focus().html(note?note.text:"")}else $editor.show().focus()}),$divText.html(note?note.text:""),$(this.paneNotes).append($divNote),
$(document).on("click","#st-container",_this.doClick),$(document).on("mousemove","#st-container",_this.doMove)},removeNote:function(obj){if(confirm(i18n_resource.analysis.workspace.CONFIRM_NOTE_DELETE)){var $divNote=$(obj).closest(".divNote");$divNote.remove();var index=_this.getNoteListIndex($divNote.attr("id"));void 0!=index&&(_this.screen.curModal.noteList.splice(index,1),_this.screen.saveModal(),_this.screen.saveModalJudge.resolveWith(_this.screen,[_this.screen,_this.chart,$("#divWSPane .selected"),_this.screen.curModal,!0]))}},initNotes:function(notes){if(notes.length>0)for(var i=0;i<notes.length;i++)_this.createNote(notes[i])},hideNotes:function(){},showNotes:function(){},getNoteMaxZIndex:function(){for(var divNoteList=$(".divNote"),maxZIndex=1,i=0;i<divNoteList.length;i++){var zIndex=parseInt(getComputedStyle(divNoteList[i]).zIndex);zIndex>maxZIndex&&(maxZIndex=zIndex)}return maxZIndex},getNoteListIndex:function(id){for(var i=0;i<_this.screen.curModal.noteList.length;i++)if(_this.screen.curModal.noteList[i].id==id)return i},resizeObject:function(){this.el=null,this.dir="",this.grabx=null,this.graby=null,this.width=null,this.height=null,this.left=null,this.top=null},getDirection:function(el){var xPos,yPos,offset,dir;return dir="",xPos=window.event.offsetX,yPos=window.event.offsetY,offset=8,offset>yPos?dir+="n":yPos>el.offsetHeight-offset&&(dir+="s"),offset>xPos?dir+="w":xPos>el.offsetWidth-offset&&(dir+="e"),dir},doDown:function(){if(this.style.cursor.indexOf("-resize")>-1){$(".divTextEditor").blur();var el=_this.getReal(event.srcElement,"className","divNote");if(null==el)return void(_this.theobject=null);if(el.className&&el.className.indexOf("divNote")<0)return;if(_this.dir=_this.getDirection(el),""==_this.dir)return;_this.leftObject=new _this.resizeObject,_this.leftObject.el=el,_this.leftObject.dir=_this.dir,_this.leftObject.grabx=window.event.clientX,_this.leftObject.graby=window.event.clientY,_this.leftObject.width=el.offsetWidth,_this.leftObject.height=el.offsetHeight,_this.leftObject.left=el.offsetLeft,_this.leftObject.top=el.offsetTop,window.event.returnValue=!1,window.event.cancelBubble=!0}},doUp:function(e){if(!e.target.classList.contains("pinIcon")&&null!=_this.leftObject){var note={id:_this.leftObject.el.id,width:_this.leftObject.el.style.width,height:_this.leftObject.el.style.height};_this.saveNote(note),_this.leftObject=null}},doMove:function(e){var el,str,xMin,yMin;xMin=_this.noteDefaultWidth,yMin=_this.noteDefaultHeight-60,el=_this.getReal(event.srcElement,"className","divNote"),el&&(el.className&&"string"==typeof el.className&&el.className.indexOf("divNote")>-1&&(str=_this.getDirection(el),""==str?str="default":str+="-resize",el.style.cursor=str),null!=_this.leftObject&&(-1!=_this.dir.indexOf("e")&&(_this.leftObject.el.style.width=Math.max(xMin,_this.leftObject.width+window.event.clientX-_this.leftObject.grabx)+"px"),-1!=_this.dir.indexOf("s")&&(_this.leftObject.el.style.height=Math.max(yMin,_this.leftObject.height+window.event.clientY-_this.leftObject.graby)+"px"),-1!=_this.dir.indexOf("w")&&(_this.leftObject.el.style.left=Math.min(_this.leftObject.left+window.event.clientX-_this.leftObject.grabx,_this.leftObject.left+_this.leftObject.width-xMin)+"px",_this.leftObject.el.style.width=Math.max(xMin,_this.leftObject.width-window.event.clientX+_this.leftObject.grabx)+"px"),-1!=_this.dir.indexOf("n")&&(_this.leftObject.el.style.top=Math.min(_this.leftObject.top+window.event.clientY-_this.leftObject.graby,_this.leftObject.top+_this.leftObject.height-yMin)+"px",_this.leftObject.el.style.height=Math.max(yMin,_this.leftObject.height-window.event.clientY+_this.leftObject.graby)+"px"),window.event.returnValue=!1,window.event.cancelBubble=!0))},doClick:function(e){if(_this.screen&&_this.screen.curModal&&_this.curtNote){if(e.target.classList.contains("pinIcon"))return;if(e.target==_this.curtNote||$(e.target).closest(".divNote")[0]==_this.curtNote)_this.curtNote.style.zIndex=_this.getNoteMaxZIndex()+1;else{var $thisEditor=$(_this.curtNote).find(".divTextEditor");$(_this.curtNote).find(".btn-toolbar").slideUp("1000",function(){$thisEditor.hide(),$(_this.curtNote).find(".divText").html($thisEditor.html()).show()}),$thisEditor.removeClass("editing");var id=$(_this.curtNote).attr("id"),note=(_this.getNoteListIndex(id),{id:id,text:$(_this.curtNote).find(".divTextEditor").html(),width:$(_this.curtNote).css("width"),height:$(_this.curtNote).css("height")});_this.saveNote(note)}}},getReal:function(el,type,value){for(var temp=el;null!=temp&&"BODY"!=temp.tagName;){if(eval("temp."+type)==value)return el=temp;temp=temp.parentElement}return el},saveNote:function(note){function doSave(){_this.screen.saveModal(),_this.screen.saveModalJudge.resolveWith(_this.screen,[_this.screen,_this.chart,$("#divWSPane .selected"),_this.screen.curModal,!0])}var id=note.id,isSave=!1;if(void 0!=_this.screen.curModal.noteList){var index=_this.getNoteListIndex(id);if(void 0==index){if(!note.text||0==$.trim(note.text.length))return;var $divNote=$("#"+id),pos=$divNote.position(),note={id:id,x:(pos.left/$divNote.offsetParent().width()*100).toFixed(2)+"%",y:(pos.top/$divNote.offsetParent().height*100).toFixed(2)+"%",width:note.width,height:note.height,text:note.text};_this.screen.curModal.noteList.push(note),doSave()}else{var note_old=_this.screen.curModal.noteList[index];note.x&&note.x!=note_old.x&&(isSave=!0),!isSave&&note.y&&note.y!=note_old.y&&(isSave=!0),!isSave&&note.width&&note.width!=note_old.width&&(isSave=!0),!isSave&&note.height&&note.height!=note_old.height&&(isSave=!0),!isSave&&note.text&&note.text!=note_old.text&&(isSave=!0),isSave&&(_this.screen.curModal.noteList[index]={id:id,x:note.x?note.x:note_old.x,y:note.y?note.y:note_old.y,width:note.width?note.width:note_old.width,height:note.height?note.height:note_old.height,text:note.text?note.text:note_old.text},doSave())}}}},AnlzBase}(),AnlzChart=function(){function AnlzChart(containerId,entityParams){}return AnlzChart.prototype.renderModal=function(){this.container.innerHTML=template},AnlzChart.prototype.updateModal=function(name,value){},AnlzChart.prototype.showConfigMode=function(){},AnlzChart}(),AnlzPieRealtime=function(){function AnlzPieRealtime(container,option,screen){AnlzBase.call(this,container,option,screen),_this=this,this.paneChart=void 0,this.chart=void 0,this.dictLegend={},this.postData={},this.interv=void 0}var _this;return AnlzPieRealtime.prototype=new AnlzBase,AnlzPieRealtime.prototype.optionTemplate={imgName:"anlsPieRealtime.png",imgIndex:5,imgColor:"211,97,78",templateName:"analysis.modalType.PIE_REAL_TIME",templateParams:{paraName:["X"],paraAnlysMode:"all"},chartConfig:["realTime"]},AnlzPieRealtime.prototype.close=function(){this.container=null,this.options=null,this.screen=null,this.paneChart=null,this.chart=null,this.dictLegend=null,clearInterval(_this.interv)},AnlzPieRealtime.prototype.init=function(){_this.postData={dsItemIds:_this.screen.curModal.itemDS[0].arrId},WebAPI.post("/analysis/startWorkspaceDataGenPieChart",_this.postData).done(function(result){if(result&&""!=result){var rslt=JSON.parse(result);if(rslt.error&&rslt.error.length>0)return alert(rslt.error),void _this.spinnerStop();_this.renderModal(rslt)}}).error(function(e){_this.screen.alertNoData(),_this.spinnerStop()}),_this.interv=setInterval(function(){_this.spinnerRender.spin(this.container),WebAPI.post("/analysis/startWorkspaceDataGenPieChart",_this.postData).done(function(result){var data=JSON.parse(result);if(data.error&&data.error.length>0)return _this.errAlert(data.error),void _this.spinnerStop();if(data&&""!=data){for(var item,arrData=[],i=0;i<data.length;i++){item=data[i];var itemName=AppConfig.datasource.getDSItemById(item.dsItemId).alias;arrData.push({value:parseFloat(item.data),name:itemName})}var series=[{type:"pie",radius:"55%",center:["50%","60%"],data:arrData}];_this.chart.setSeries(series,!0)}}).error(function(e){_this.screen.alertNoData(),_this.spinnerStop()})},6e4)},AnlzPieRealtime.prototype.render=function(data){for(var item,arrLabel=[],arrData=[],i=0;i<data.length;i++){item=data[i];var itemName=AppConfig.datasource.getDSItemById(item.dsItemId).alias;arrLabel.push(itemName),arrData.push({value:parseFloat(item.data),name:itemName})}var option={title:{text:"",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:arrLabel},toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["pie","funnel"],option:{funnel:{x:"25%",width:"50%",funnelAlign:"left",max:1548}}},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,series:[{type:"pie",radius:"55%",center:["50%","60%"],data:arrData}],animationDuration:this.chartAnimationDuration,animationDurationUpdate:this.chartAnimationDuration/4};this.chart=echarts.init(this.paneChart).setOption(option)},AnlzPieRealtime}(),AnlzHistoryCompare=function(){function AnlzHistoryCompare(container,option,screen){AnlzBase.call(this,container,option,screen),_this=this,this.curIndex=1}var _this;return AnlzHistoryCompare.prototype=new AnlzBase,AnlzHistoryCompare.prototype.optionTemplate={imgName:"anlsHistory.png",imgIndex:3,imgColor:"65,131,189",templateName:"analysis.modalType.HISTORY_COMPARE",templateParams:{paraName:["X"],paraAnlysMode:"all"},chartConfig:["easyCompareAnalyz","compareSensor","compareMeter"]},AnlzHistoryCompare.prototype.show=function(){this.container.innerHTML="",this.initTools(),this.paneNotes=$('<div style="position: relative; width: 100%; height: 100%;">')[0],$(this.container).append($('<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">').append(this.paneNotes)),this.screen.curModal.noteList?this.initNotes(this.screen.curModal.noteList):this.screen.curModal.noteList=[],$(".itemTools .glyphicon-bookmark").off("click").click(function(){_this.createNote()});var temp;this.paneChart=document.createElement("div"),temp=this.paneChart.style,temp.cssFloat="left",temp.width="100%",temp.height="100% ",this.container.appendChild(this.paneChart),temp=null,_this.spinnerRender.spin(this.container),this.init()},AnlzHistoryCompare.prototype.close=function(){this.container=null,this.options=null,this.screen=null,this.paneChart=null,this.chart=null,this.dictLegend=null,this.curIndex=null},AnlzHistoryCompare.prototype.init=function(){AppConfig.datasource.getDSItemDataMulti(this,this.screen.curModal.itemDS[0].arrId)},AnlzHistoryCompare.prototype.render=function(data){this.chart?this.refreshChart(data):this.initChart(data)},AnlzHistoryCompare.prototype.initChart=function(data){this.createSeries(data);var option={title:{text:""},tooltip:{trigger:"axis",backgroundColor:"rgba(100,100,100,0.7)",axisPointer:{type:"shadow"}},legend:{x:"right",data:this.arrLegendData},toolbox:{show:!1,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,grid:{x:60,x2:20,y:60,borderColor:"#eee"},xAxis:[{type:"category",data:this.screen.curModal.arrComparePeriodLabel}],yAxis:[{type:"value"}],series:this.arrSeries};this.chart=echarts.init(this.paneChart).setOption(option)},AnlzHistoryCompare.prototype.refreshChart=function(data){var item=data.list[0];if(!this.dictLegend[item.dsItemId]){var arrTemp=this.chart.getSeries();arrTemp.push(this.createSeries(item.data)),this.chart.setSeries(arrTemp),arrTemp=null,this.screen.curModal.itemDS[0].arrId.push(item.dsItemId);this.screen.saveModal()}},AnlzHistoryCompare.prototype.createSeries=function(data){var arrSeries=[],arrLegendData=[],calcResult=[],arrId=[],mode=this.screen.curModal.mode;if("easyCompareAnalyz"==mode||"compareSensor"==mode)for(var i=0;i<data.length;i++){var item=data[i];calcResult[i]=[];for(var j=0;j<item.list.length;j++){var point=item.list[j];calcResult[i][j]=0,0==i&&(arrId.push(point.dsItemId),arrLegendData.push(AppConfig.datasource.getDSItemById(point.dsItemId).alias));for(var k=0;k<point.data.length;k++)calcResult[i][j]+=parseFloat(point.data[k]);calcResult[i][j]=calcResult[i][j]/point.data.length}}else if("compareMeter"==mode)for(var i=0;i<data.length;i++){var item=data[i];calcResult[i]=[];for(var j=0;j<item.list.length;j++){var point=item.list[j];0==i&&arrLegendData.push(AppConfig.datasource.getDSItemById(point.dsItemId).alias),calcResult[i][j]=point.data[point.data.length-1]-point.data[0]}}for(var i=0;i<data[0].list.length;i++){for(var seriesData=[],j=(AppConfig.datasource.getDSItemById(data[0].list[i]).alias,0);j<data.length;j++)seriesData.push(calcResult[j][i]);var color=echarts.config.color[this.curIndex++],series={id:arrId[i],name:arrLegendData[i],type:"bar",data:seriesData,itemStyle:{normal:{lineStyle:{color:color},barBorderRadius:[5,5,5,5]}}};arrSeries.push(series)}this.arrSeries=arrSeries,this.arrLegendData=arrLegendData},AnlzHistoryCompare}(),AnlzHistoryCompare_Line=function(){function AnlzHistoryCompare_Line(container,option,screen){AnlzHistoryCompare.call(this,container,option,screen)}return AnlzHistoryCompare_Line.prototype=new AnlzHistoryCompare,AnlzHistoryCompare_Line.prototype.optionTemplate={imgName:"anlsHistory.png",imgIndex:3,imgColor:"65,131,189",templateName:"analysis.modalType.HISTORY_COMPARE_LINE",templateParams:{paraName:["X"],paraAnlysMode:"all"},chartConfig:["easyCompareAnalyz","compareSensor","compareMeter"]},AnlzHistoryCompare_Line.prototype.initChart=function(data){this.createSeries(data);var option={title:{text:""},tooltip:{trigger:"axis",backgroundColor:"rgba(100,100,100,0.7)",axisPointer:{type:"shadow"}},legend:{x:"right",data:this.arrLegendData},toolbox:{show:!1,feature:{dataView:{show:!1,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!1,grid:{x:60,x2:20,y:60,borderColor:"#eee"},dataZoom:{show:!1},xAxis:[{type:"category",data:data[0].timeShaft,splitLine:{show:!1}}],yAxis:[{type:"value",scale:!0}],series:this.arrSeries};this.chart=echarts.init(this.paneChart).setOption(option)},AnlzHistoryCompare_Line.prototype.createSeries=function(data){var arrSeries=[],arrLegendData=[],pointData=[],arrId=[],mode=this.screen.curModal.mode;if("easyCompareAnalyz"==mode||"compareSensor"==mode)for(var i=0;i<data.length;i++){var item=data[i];pointData[i]=[];for(var j=0;j<item.list.length;j++){var point=item.list[j];pointData[i][j]=[],0==i&&(arrId.push(point.dsItemId),arrLegendData.push(this.screen.curModal.arrComparePeriodLabel[0]+AppConfig.datasource.getDSItemById(point.dsItemId).alias),arrLegendData.push(this.screen.curModal.arrComparePeriodLabel[1]+AppConfig.datasource.getDSItemById(point.dsItemId).alias));for(var k=0;k<point.data.length;k++)pointData[i][j].push(parseFloat(point.data[k]))}}else if("compareMeter"==mode)for(var i=0;i<data.length;i++){pointData[i]=[];for(var item=data[i],j=0;j<item.list.length;j++){pointData[i][j]=[];var point=item.list[j];0==i&&(arrLegendData.push(this.screen.curModal.arrComparePeriodLabel[0]+AppConfig.datasource.getDSItemById(point.dsItemId).alias),arrLegendData.push(this.screen.curModal.arrComparePeriodLabel[1]+AppConfig.datasource.getDSItemById(point.dsItemId).alias));for(var k=0;k<point.data.length;k++)pointData[i][j].push(parseFloat(point.data[k]))}}for(var index=0,i=0;i<data[0].list.length;i++)for(var seriesData=[],j=(AppConfig.datasource.getDSItemById(data[0].list[i]).alias,0);j<data.length;j++){seriesData=pointData[j][i];var series=(echarts.config.color[this.curIndex++],{id:arrId[i],name:arrLegendData[index],type:"line",data:seriesData,itemStyle:{normal:{barBorderRadius:[5,5,5,5]}}});arrSeries.push(series),index+=1}this.arrSeries=arrSeries,this.arrLegendData=arrLegendData},AnlzHistoryCompare_Line}(),AnlzScatter=function(){function AnlzScatter(container,option,screen){AnlzBase.call(this,container,option,screen)}return AnlzScatter.prototype=new AnlzBase,AnlzScatter.prototype.optionTemplate={imgName:"anlsScatter.png",imgIndex:2,imgColor:"211,97,78",templateName:"analysis.modalType.SCATTER",templateParams:{paraName:["X","Y"],paraAnlysMode:"all",dataTypeMaxNum:[1,5]},chartConfig:["easy","fixed","recent"]},AnlzScatter.prototype.init=function(){var _this=this,arrIds=[];arrIds.push(this.screen.curModal.itemDS[0].arrId[0]),arrIds=arrIds.concat(this.screen.curModal.itemDS[1].arrId);var postData={dsItemIds:arrIds,timeStart:this.screen.curModal.startTime.format("yyyy-MM-dd HH:mm:ss"),timeEnd:this.screen.curModal.endTime.format("yyyy-MM-dd HH:mm:ss"),timeFormat:this.screen.curModal.format};WebAPI.post("/analysis/startWorkspaceDataGenScatterChart",postData).done(function(result){var data=JSON.parse(result);return data.error&&data.error.length>0?(_this.errAlert(data.error),void _this.spinnerStop()):void _this.renderModal(data)}).error(function(e){_this.screen.alertNoData(),_this.spinnerStop()})},AnlzScatter.prototype.render=function(data){for(var arrXAxis=data.list[0].data,arrData=[],arrLegend=[],arrSeries=[],i=1;i<data.list.length;i++)arrData.push([]),arrLegend.push(AppConfig.datasource.getDSItemById(data.list[i].dsItemId).alias);for(var valueX,i=0;i<arrXAxis.length;i++){valueX=data.list[0].data[i];for(var j=0,jLen=data.list.length-1;jLen>j;j++)arrData[j].push([valueX,data.list[j+1].data[i]])}for(var i=0;i<arrData.length;i++)arrSeries.push({name:arrLegend[i],type:"scatter",data:arrData[i],markLine:{data:[{type:"average",name:I18n.resource.observer.analysis.AVERAGE}]}});var option={title:{text:"X: "+AppConfig.datasource.getDSItemById(data.list[0].dsItemId).alias,subtext:"Scatter"},tooltip:{trigger:"axis",showDelay:0,axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}}},legend:{data:arrLegend},toolbox:{show:!0,feature:{mark:{show:!0},dataZoom:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},xAxis:[{type:"value",scale:!0}],yAxis:[{type:"value",scale:!0}],series:arrSeries,animationDuration:this.chartAnimationDuration,animationDurationUpdate:this.chartAnimationDuration/4};this.chart=echarts.init(this.paneChart).setOption(option)},AnlzScatter}(),AnlzSpectrum=function(){function AnlzSpectrum(container,option,screen){AnlzBase.call(this,container,option,screen)}return AnlzSpectrum.prototype=new AnlzBase,AnlzSpectrum.prototype.optionTemplate={imgName:"anlsSpectrum.png",imgIndex:1,imgColor:"148,193,142",templateName:"analysis.modalType.SPECTRUM",templateParams:{paraName:["X"],paraAnlysMode:"all",dataTypeMaxNum:[1]},chartConfig:["easy","fixed","recent"]},AnlzSpectrum.prototype.init=function(){var _this=this,postData={dsItemIds:this.screen.curModal.itemDS[0].arrId,timeStart:this.screen.curModal.startTime.format("yyyy-MM-dd HH:mm:ss"),timeEnd:this.screen.curModal.endTime.format("yyyy-MM-dd HH:mm:ss"),timeFormat:this.screen.curModal.format};WebAPI.post("/analysis/startWorkspaceDataGenPattern",postData).done(function(result){var data=JSON.parse(result);return data.error&&data.error.length>0?(_this.errAlert(data.error),void _this.spinnerStop()):void _this.renderModal(data)}).error(function(e){_this.screen.alertNoData(),_this.spinnerStop()})},AnlzSpectrum.prototype.render=function(data){for(var item,arrLabel=[],arrData=[],i=0;i<data.list.length;i++)item=data.list[i],arrLabel.push(item.data),arrData.push(item.pattern);var option={title:{text:AppConfig.datasource.getDSItemById(this.screen.curModal.itemDS[0].arrId[0]).alias,subtext:"Spectrum"},tooltip:{trigger:"axis"},toolbox:{show:!0,feature:{mark:{show:!0},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,xAxis:[{type:"category",boundaryGap:!0,data:arrLabel}],yAxis:[{type:"value"}],series:[{type:"bar",data:arrData,itemStyle:{normal:{color:"#5bc0de",barBorderRadius:[5,5,0,0]}},markLine:{data:[{type:"average",name:I18n.resource.observer.analysis.AVERAGE}]}}],animationDuration:this.chartAnimationDuration,animationDurationUpdate:this.chartAnimationDuration/4};this.chart=echarts.init(this.paneChart).setOption(option)},AnlzSpectrum}(),AnlzTendency=function(){function AnlzTendency(container,option,screen){AnlzBase.call(this,container,option,screen),this.paneLegend=void 0,this.dictLegend={},this.dictTooltip={},this.curIndex=0,this.legendType={NORMAL:0,Prediction:1,Regression:2},this.screen=screen,_this=this}var _this;return AnlzTendency.prototype=new AnlzBase,AnlzTendency.prototype.optionTemplate={imgName:"anlsTendency.png",imgIndex:0,imgColor:"65,131,189",templateName:"analysis.modalType.TENDENCY",templateParams:{paraName:["X"],paraAnlysMode:"all"},chartConfig:["easy","fixed","recent"]},AnlzTendency.prototype.show=function(){this.container.innerHTML="",this.initTools(),this.paneNotes=$('<div style="position: relative; width: 100%; height: 100%;">')[0],$(this.container).append($('<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">').append(this.paneNotes)),this.screen.curModal.noteList?this.initNotes(this.screen.curModal.noteList):this.screen.curModal.noteList=[],$(".itemTools .glyphicon-bookmark").off("click").click(function(){_this.createNote()});var temp;this.paneChart=document.createElement("div"),this.paneChart.className="divPaneChart",temp=this.paneChart.style,temp.cssFloat="left",temp.width="100%",temp.height="calc(100% - 170px)",this.paneLegend=document.createElement("div"),this.paneLegend.className="divHover",temp=this.paneLegend.style,temp.marginTop="10px",temp.padding="10px",temp.cssFloat="left",temp.width="100%",temp.height="160px",temp.position="absolute",temp.bottom="0px",this.container.appendChild(this.paneChart),this.container.appendChild(this.paneLegend),1===this.isShareMode&&$(this.container).addClass("read-mode"),temp=null,_this.spinnerRender.spin(this.container),this.init()},AnlzTendency.prototype.close=function(){this.container=null,this.options=null,this.screen=null,this.paneLegend=null,this.paneChart=null,this.chart=null,this.dictLegend=null,this.curIndex=null},AnlzTendency.prototype.init=function(){var _this=this;AppConfig.datasource.getDSItemData(this,this.screen.curModal.itemDS[0].arrId),this.paneLegend.ondragover=function(e){return e.currentTarget.classList.add("dragHover"),!1},this.paneLegend.ondragleave=function(e){return e.currentTarget.classList.remove("dragHover"),!1},this.paneLegend.ondrop=function(e){_this.spinnerRender.spin(_this.container);var $ele=$(e.currentTarget),dsItemId=e.dataTransfer.getData("dsItemId");if(e.currentTarget.classList.remove("dragHover"),dsItemId){if($ele.find('[id="'+dsItemId+'"]').length>0)return void _this.spinnerStop();AppConfig.datasource.getDSItemData(_this,[e.dataTransfer.getData("dsItemId")])}else _this.spinnerStop()}},AnlzTendency.prototype.render=function(data){this.chart?this.refreshChart(data):this.initChart(data),this.spinnerRender.stop()},AnlzTendency.prototype.initChart=function(data){var series,item,i,option,arrSeries=[],legend=[];for(i=0;i<data.list.length;i++)item=data.list[i],series=this.createSeries(item.dsItemId,item.data),legend.push(series.name),arrSeries.push(series);option=this.initOption(arrSeries,data.timeShaft),1===this.isShareMode&&(option.legend={data:legend}),this.chart=echarts.init(this.paneChart).setOption(option)},AnlzTendency.prototype.initOption=function(series,timeSHaft){return{tooltip:{trigger:"axis"},grid:{x:60,x2:20,y:60,borderColor:"#eee"},toolbox:{show:!0,feature:{magicType:{show:!0,type:["line","bar"]},dataZoom:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,dataZoom:{show:!0,start:0,end:100},xAxis:[{type:"category",boundaryGap:!1,data:timeSHaft}],yAxis:[{type:"value",scale:!0}],series:series,animationDuration:this.chartAnimationDuration,animationDurationUpdate:this.chartAnimationDuration/4}},AnlzTendency.prototype.refreshChart=function(data){var item=data.list[0];if(!this.dictLegend[item.dsItemId]){var arrTemp=this.chart.getSeries();arrTemp.push(this.createSeries(item.dsItemId,item.data)),this.chart.setSeries(arrTemp),arrTemp=null,this.screen.curModal.itemDS[0].arrId.push(item.dsItemId);this.screen.saveModal()}},AnlzTendency.prototype.createSeries=function(id,data,type){type||(type=this.legendType.NORMAL);var name;type==this.legendType.NORMAL?name=AppConfig.datasource.getDSItemById(id).alias:(name=id.split("_"),name=AppConfig.datasource.getDSItemById(name[0]).alias+"_"+id[1]);var color=echarts.config.color[this.curIndex++];return this.renderLegend(id,name,type,color),{id:id,name:name,type:"line",symbol:"none",data:data,itemStyle:{normal:{lineStyle:{color:color}}}}},AnlzTendency.prototype.removeSeries=function(id){var _this=this;delete this.dictLegend[id],$("#"+id).remove();for(var option=this.chart.getOption(),arrSeries=option.series,i=0;i<arrSeries.length;i++)if(arrSeries[i].id==id){arrSeries.splice(i,1);break}for(var arrIds=this.screen.curModal.itemDS[0].arrId,i=0;i<arrIds.length;i++)arrIds[i]==id&&arrIds.splice(i,1);this.screen.curModal.itemDS[0].arrId=arrIds,this.chart=echarts.init(this.paneChart).setOption(this.initOption(arrSeries,option.xAxis[0].data)),window.setTimeout(function(){_this.screen.saveModal(),_this.screen.saveModalJudge.resolveWith(_this.screen,[_this.screen,_this.chart,$("#divWSPane .selected"),_this.screen.curModal,!0])},500)},AnlzTendency.prototype.getDataById=function(id){for(var arrSeries=this.chart.getSeries(),i=0;i<arrSeries.length;i++)if(arrSeries[i].id==id)return arrSeries[i].data},AnlzTendency.prototype.renderLegend=function(id,name,type,color){var _this=this,name=name,div=document.createElement("div"),closeBtn='<button type="button" class="close"><span>&times;</span></button>';switch(div.id=id,div.className="divLegend",div.draggable=!0,div.style.backgroundColor=color,div.setAttribute("ty",type),type){case this.legendType.Regression:div.innerHTML="<div class='divTxtWrap'><span class='glyphicon glyphicon-retweet' style='margin-right: 10px;'></span>"+name.split("_Regression_")[0]+"_Regression</div>"+closeBtn,this.initGeneralRegressorTooltip(id,div);break;case this.legendType.Prediction:div.innerHTML="<div class='divTxtWrap'><span class='glyphicon glyphicon-retweet' style='margin-right: 10px;'></span>"+name.split("_Prediction_")[0]+"_Prediction</div>"+closeBtn,this.initGeneralPredictorTooltip(id,div);break;default:div.innerHTML="<div class='divTxtWrap'><span class='glyphicon glyphicon-stats' style='margin-right: 10px;'></span>"+name+"</div>"+closeBtn}div.getElementsByClassName("close")[0].onclick=function(e){var $ele=$(e.currentTarget).parent(),id=$ele[0].id;$(".divLegend").length>1?($ele.tooltip("destroy"),_this.removeSeries(id)):alert("The only parameters can't be removed"),e.stopPropagation()},div.ondragstart=function(e){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("id",e.currentTarget.id),e.dataTransfer.setData("source","legend")},div.ondragover=function(e){return!1},div.ondrop=function(e){function generateRegressor(e,sourceId,targetId){var data={source:[_this.getDataById(sourceId).map(function(row,i){return row+""})],target:_this.getDataById(targetId).map(function(row,i){return row+""}),sourceNames:sourceId,targetName:targetId};_this.spinnerRender.spin(_this.container),WebAPI.post("/analysis/generalRegressor",data).done(function(result){var id=targetId+"_Regression_"+ +new Date,data=JSON.parse(result),arrTemp=_this.chart.getSeries();data.SourceId=sourceId,data.TargetId=targetId,_this.dictTooltip[id]=data,arrTemp.push(_this.createSeries(id,data.PredicatedResults,_this.legendType.Regression)),_this.chart.setSeries(arrTemp),arrTemp=null,_this.spinnerRender.stop()}).error(function(result){_this.spinnerRender.stop()})}function generatePredictor(e,sourceId,targetId){for(var arrCoefficient=_this.dictTooltip[e.currentTarget.id].Coefficients,i=0;i<arrCoefficient.length;i++)arrCoefficient[i]=arrCoefficient[i].toString();var data={source:[_this.getDataById(sourceId).map(function(row,i){return row+""})],Coefficients:arrCoefficient};_this.spinnerRender.spin(_this.container),WebAPI.post("/analysis/generalPredictor",data).done(function(result){var id=targetId.split("_")[0]+"_Prediction_"+ +new Date,arrTemp=_this.chart.getSeries(),data=JSON.parse(result);data.PredicatedResults&&(arrTemp.push(_this.createSeries(id,data.PredicatedResults,_this.legendType.Prediction)),_this.chart.setSeries(arrTemp)),_this.spinnerRender.stop()}).error(function(result){_this.spinnerRender.stop()})}var srcId=e.dataTransfer.getData("id"),toId=e.currentTarget.id;if(e.stopPropagation(),srcId!==toId){var source=e.dataTransfer.getData("source");source&&"legend"==source&&(e.currentTarget.getAttribute("ty")==_this.legendType.Regression?generatePredictor(e,srcId,toId):generateRegressor(e,srcId,toId))}},this.paneLegend.appendChild(div)},AnlzTendency.prototype.initGeneralRegressorTooltip=function(id,element){var data=this.dictTooltip[id],sb=new StringBuilder;sb.append('<div class="tooltip" role="tooltip">'),sb.append('    <div class="tooltipTitle tooltip-inner">GeneralRegressor</div>'),sb.append('    <div class="tooltipContent">'),sb.append('        <p style="white-space:nowrap;">RSquared: ').append(data.RSquared).append("</p> "),sb.append('        <p>Formula: </p><p style="margin-left: 20px; white-space:nowrap;">').append(data.Formula).append("</p> "),sb.append('        <p style="margin-left: 20px; white-space:nowrap;">x: ').append(AppConfig.datasource.getDSItemById(data.SourceId).alias).append("</p>"),sb.append('        <p style="margin-left: 20px; white-space:nowrap;">y: ').append(AppConfig.datasource.getDSItemById(data.TargetId).alias).append("</p>"),sb.append("    </div>"),sb.append('    <div class="tooltip-arrow"></div>'),sb.append("</div>");var options={placement:"top",title:"GeneralRegressor",template:sb.toString()};$(element).tooltip(options)},AnlzTendency.prototype.initGeneralPredictorTooltip=function(id,element){var sb=(this.dictTooltip[id],new StringBuilder);sb.append('<div class="tooltip" role="tooltip">'),sb.append('    <div class="tooltipTitle tooltip-inner">GeneralPredictor</div>'),sb.append('    <div class="tooltipContent">'),sb.append('        <p style="white-space:nowrap;">Source: ').append(AppConfig.datasource.getDSItemById(id.split("_")[0]).alias).append("</p> "),sb.append("    </div>"),sb.append('    <div class="tooltip-arrow"></div>'),sb.append("</div>");var options={placement:"top",title:"GeneralPredictor",template:sb.toString()};$(element).tooltip(options)},AnlzTendency}(),AnlzStack=function(){function AnlzStack(container,option,screen){AnlzBase.call(this,container,option,screen),this.screen=screen,_this=this}var _this;return AnlzStack.prototype=new AnlzBase,AnlzStack.prototype.optionTemplate={imgName:"anlsStack.png",imgIndex:4,imgColor:"148,193,142",templateName:"analysis.modalType.STACK",templateParams:{paraName:["X"],paraAnlysMode:"all"},chartConfig:["easy","fixed","recent"]},AnlzStack.prototype.show=function(){this.initTools(),this.container.innerHTML="";var temp;this.paneChart=document.createElement("div"),temp=this.paneChart.style,temp.cssFloat="left",temp.width="100%",temp.height="100%",this.container.appendChild(this.paneChart),this.spinnerRender.spin(this.container),this.init(),this.paneNotes=$('<div style="position: relative; width: 100%; height: 100%;">')[0],$(this.container).append($('<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">').append(this.paneNotes)),this.screen.curModal.noteList?_this.initNotes(this.screen.curModal.noteList):this.screen.curModal.noteList=[],$(".itemTools .glyphicon-bookmark").off("click").click(function(){_this.createNote()})},AnlzStack.prototype.close=function(){this.container=null,this.options=null,this.screen=null,this.paneChart=null,this.chart=null},AnlzStack.prototype.init=function(){AppConfig.datasource.getDSItemData(this,this.screen.curModal.itemDS[0].arrId)},AnlzStack.prototype.render=function(data){this.initChart(data)},AnlzStack.prototype.initChart=function(data){for(var arrSeries=[],arrLengend=[],i=0;i<data.list.length;i++){var item=data.list[i];arrSeries.push(this.createSeries(item.dsItemId,item.data)),arrLengend.push(arrSeries[i].name)}this.chart=echarts.init(this.paneChart).setOption(this.initOption(arrSeries,arrLengend,data.timeShaft))},AnlzStack.prototype.initOption=function(series,arrLengend,timeSHaft){return{tooltip:{trigger:"axis"},legend:{data:arrLengend},grid:{x:60,x2:20,y:60,borderColor:"#eee"
},toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar","stack","tiled"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,dataZoom:{show:!0,start:0,end:100},xAxis:[{type:"category",boundaryGap:!1,data:timeSHaft}],yAxis:[{type:"value",scale:!0}],series:series,animationDuration:this.chartAnimationDuration,animationDurationUpdate:this.chartAnimationDuration/4}},AnlzStack.prototype.createSeries=function(id,data,type){return{id:id,name:AppConfig.datasource.getDSItemById(id).alias,type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{type:"default"}}},symbol:"none",stack:I18n.resource.observer.analysis.TOTAL_AMOUNT,data:data}},AnlzStack}(),AnlzCluster=function(){function AnlzCluster(container,option,screen){AnlzBase.call(this,container,option,screen),this.m_panelTrend=void 0,this.m_panelScatter=void 0}return AnlzCluster.prototype=new AnlzBase,AnlzCluster.prototype.optionTemplate={imgName:"anlsPattern.png",imgIndex:6,imgColor:"65,131,189",templateName:"analysis.modalType.CLUSTER",templateParams:{paraName:["X"],paraAnlysMode:"part"},chartConfig:["easy","fixed","recent"],type:""},AnlzCluster.prototype.show=function(){var _this=this;this.initTools(),this.container.innerHTML="",this.paneNotes=$('<div style="position: relative; width: 100%; height: 100%;">')[0],$(this.container).append($('<div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">').append(this.paneNotes)),this.screen.curModal.noteList?this.initNotes(this.screen.curModal.noteList):this.screen.curModal.noteList=[],$(".itemTools .glyphicon-bookmark").off("click").click(function(){_this.createNote()}),$(this.container).append($('<div style="width: 100%; height: 450px;">\r\n                <ul class="nav nav-tabs" role="tablist" id="myTab">\r\n                    <li role="presentation" class="active">\r\n                        <a id="aTendency" href="#tabTendency" role="tab" data-toggle="tab" style="cursor:pointer;"><span i18n="analysis.paneConfig.TREND_DISTRIBUTE"></span></a>\r\n                    </li>\r\n                    <li role="presentation">\r\n                        <a id="aScatter" href="#tabScatter" role="tab" data-toggle="tab" style="cursor:pointer;"><span i18n="analysis.paneConfig.TYPE_POINT"></span></a>\r\n                    </li>\r\n                </ul>\r\n                <div class="tab-content">\r\n                    <div role="tabpanel" class="tab-pane fade in active" id="tabTendency" style="height: 400px;"></div>\r\n                    <div role="tabpanel" class="tab-pane fade" id="tabScatter" style="height: 400px;"></div>\r\n                </div>\r\n             </div>\r\n             <div class="panel panel-default" style="height: calc(100% - 450px);">\r\n                 <div class="panel-heading"><span i18n="analysis.paneConfig.TYPICAL_CONDITION"></span></div>\r\n                 <div class="panel-body" style="padding: 0; height: calc(100% - 40px); overflow-y: auto;">\r\n                     <table class="table" id="tableGroup" style="overflow-x: auto;"></table>\r\n                 </div>\r\n             </div>')),I18n.fillArea($(this.container)),_this.spinnerRender.spin(this.container),this.init()},AnlzCluster.prototype.init=function(){for(var _this=this,arrIds=[],arrType=[],arrDSItems=this.screen.curModal.itemDS,i=0;i<arrDSItems.length;i++){var arrTemp=arrDSItems[i].arrId;arrTemp&&arrTemp.length>0&&(arrIds=arrIds.concat(arrTemp),arrType.push(this.optionTemplate.templateParams.paraName[i]))}var postData={dsItemIds:arrIds,timeStart:this.screen.curModal.startTime.format("yyyy-MM-dd HH:mm:ss"),timeEnd:this.screen.curModal.endTime.format("yyyy-MM-dd HH:mm:ss"),timeFormat:this.screen.curModal.format,pointType:arrType,systemType:this.optionTemplate.type};WebAPI.post("/analysis/startWorkspaceDataGenCluster",postData).done(function(result){var data=JSON.parse(result);return data.error&&data.error.length>0?(_this.errAlert(data.error),void _this.spinnerStop()):void _this.renderModal(data)}).error(function(e){_this.screen.alertNoData(),_this.spinnerStop()})},AnlzCluster.prototype.render=function(data){var _this=this;this.initTable(data),this.initTendency(data),$("#aScatter").on("shown.bs.tab",function(e){0==$("#tabScatter div").length&&_this.initScatter(data)}),_this.spinnerStop()},AnlzCluster.prototype.initTable=function(data){var table=$("#tableGroup");table.html("");for(var tr,td,divLegend,details,tbody=document.createElement("tbody"),i=0;i<data.dataAnalysisResult.Pattern.length;i++)if(details=data.dataAnalysisResult.Pattern[i].Diagnosis,tr=document.createElement("tr"),td=document.createElement("td"),td.rowSpan=details?details.length:1,divLegend=document.createElement("span"),divLegend.textContent="Group "+data.dataAnalysisResult.Pattern[i].name,divLegend.className="label label-warning",divLegend.style.padding="3px",divLegend.style.backgroundColor=echarts.config.color[i],td.appendChild(divLegend),tr.appendChild(td),td=document.createElement("td"),details&&(td.innerHTML='<span class="label label-warning" style="margin-right: 8px;">'+details[0].name+"</span>"+details[0].detail),tr.appendChild(td),tbody.appendChild(tr),details&&details.length>1)for(var j=1;j<details.length;j++)tr=document.createElement("tr"),td=document.createElement("td"),td.innerHTML='<span class="label label-warning" style="margin-right: 8px;">'+details[j].name+"</span>"+details[j].detail,tr.appendChild(td),tbody.appendChild(tr);$("#tableGroup").append(tbody)},AnlzCluster.prototype.initTendency=function(data){for(var arrSeries=new Array,arrLegend=new Array,i=0;i<data.dataAnalysisResult.Pattern.length;i++){var item=data.dataAnalysisResult.Pattern[i];arrLegend.push(item.name),arrSeries.push({name:item.name,type:"line",stack:"总量",itemStyle:{normal:{areaStyle:{type:"default"}}},data:item.TrendValue})}var option={tooltip:{trigger:"axis"},legend:{data:arrLegend},toolbox:{show:!0,feature:{magicType:{show:!0,type:["line","bar","stack","tiled"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:data.dataAnalysisResult.Pattern[0].TrendLabel}],yAxis:[{min:0,max:100,type:"value"}],series:arrSeries};this.m_panelTrend=echarts.init(document.getElementById("tabTendency")),this.m_panelTrend.setOption(option),this.chart=this.m_panelTrend},AnlzCluster.prototype.initScatter=function(data){for(var item,name,arrData,series=new Array,seriesNames=new Array,i=0,len=data.dataAnalysisResult.ScatterChart.length;len>i;i++){item=data.dataAnalysisResult.ScatterChart[i],name=item.name[0],arrData=new Array;for(var itemPoint,j=0;j<item.data.length;j++)itemPoint=item.data[j],arrData.push(itemPoint.split(","));seriesNames.push(name),series.push({name:name,type:"scatter",symbolSize:5,data:arrData})}var option={title:{},tooltip:{trigger:"item",formatter:function(params){return params.seriesName+"<br/>"+params.value[0]+", "+params.value[1]}},toolbox:{show:!0,feature:{dataZoom:{show:!0},restore:{show:!0},saveAsImage:{show:!0}}},legend:{data:seriesNames},xAxis:[{type:"value",scale:!0}],yAxis:[{type:"value",scale:!0}],animation:!0,series:series},myChart=echarts.init(document.getElementById("tabScatter"));myChart.setOption(option)},AnlzCluster}(),AnlzCluster_AHU=function(){function AnlzCluster_AHU(container,option,screen){AnlzCluster.call(this,container,option,screen)}return AnlzCluster_AHU.prototype=new AnlzCluster,AnlzCluster_AHU.prototype.optionTemplate={imgName:"anlsClusterAhu.png",imgIndex:7,imgColor:"148,193,142",templateName:"analysis.modalType.CLUSTER_AHU",templateParams:{paraName:["MATemp","SATemp","RACO2","OATemp","RATemp","RATempSetting","SATempSetting","RACO2Setting","HWTemp","CWTemp","OperationMode","OADamperRatio","HCDamperRatio","CCDamperRatio","SAStaticPressure","SAStaticPressureSetting","FanVSDFrequency","CWRetrunTemp"],paraAnlysMode:"part"},chartConfig:["easy","fixed","recent"],type:"AHU"},AnlzCluster_AHU}(),AnlzCluster_Chiller=function(){function AnlzCluster_Chiller(container,option,screen){AnlzCluster.call(this,container,option,screen)}return AnlzCluster_Chiller.prototype=new AnlzCluster,AnlzCluster_Chiller.prototype.optionTemplate={imgName:"anlsClusterChiller.png",imgIndex:8,imgColor:"211,97,78",templateName:"analysis.modalType.CLUSTER_CHILLER",templateParams:{paraName:["OADryTemp","OAWetBulbTemp","AmperRatio","ChwSupplyTemp","ChwReturnTemp","CwReturnTemp","CwSupplyTemp","EvpTemp","CondTemp"],paraAnlysMode:"part"},chartConfig:["easy","fixed","recent"],type:"Chiller"},AnlzCluster_Chiller}(),AnlzEnergy=function(){function AnlzEnergy(container,option,screen){AnlzBase.call(this,container,option,screen)}return AnlzEnergy.prototype=new AnlzBase,AnlzEnergy.prototype.optionTemplate={imgName:"anlsEnergy.png",imgIndex:9,imgColor:"65,131,189",templateName:"analysis.modalType.ENERGY",templateParams:{paraName:["X"],paraAnlysMode:"all"},chartConfig:["easy","fixed","recent"]},AnlzEnergy.prototype.init=function(){AppConfig.datasource.getDSItemData(this,this.screen.curModal.itemDS[0].arrId)},AnlzEnergy.prototype.optionDefault={tooltip:{trigger:"axis"},toolbox:{show:!1,feature:{dataView:{show:!1,readOnly:!0},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!1,dataZoom:{show:!1},grid:{x:70,x2:10,y2:24},xAxis:[{type:"category",splitLine:{show:!1}}],yAxis:[{type:"value",splitArea:{show:!1}}]},AnlzEnergy.prototype.render=function(dataSrc){var _this=this;if(void 0==dataSrc||dataSrc.length<=0||void 0==dataSrc.timeShaft||dataSrc.timeShaft.length<=0)return _this.screen.saveModalJudge.rejectWith(_this.screen,[_this.screen]),void alert("No data");for(var xAxis,arrXAxis=[],len=dataSrc.timeShaft.length,i=0;len>i;i++)arrXAxis.push(dataSrc.timeShaft[i]);xAxis=[{type:"category",data:arrXAxis}];var showColor,dataName=[],arrSeries=[];len=dataSrc.list.length;for(var i=0;len>i;i++){showColor=echarts.config.color[i];var itemName=AppConfig.datasource.getDSItemById(dataSrc.list[i].dsItemId).alias;dataName.push(itemName);for(var defVal,arrData=[],len2=dataSrc.list[i].data.length,j=1;len2>j;j++)defVal=dataSrc.list[i].data[j]-dataSrc.list[i].data[j-1],arrData.push(parseFloat(defVal.toFixed(1)));arrSeries.push({name:dataName[i],type:"bar",data:arrData,markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},itemStyle:{normal:{color:showColor,barBorderRadius:[5,5,5,5]},emphasis:{color:showColor,barBorderRadius:[5,5,5,5]}}})}dataOption={title:{text:"",subtext:""},legend:{data:dataName},dataZoom:{show:!1},grid:{x:70,x2:10,y2:24},xAxis:xAxis,series:arrSeries},_this.chart=echarts.init(_this.paneChart,"macarons").setOption($.extend(!0,{},_this.optionDefault,dataOption))},AnlzEnergy}(),DataSource=function(){function DataSource(parent){this.m_parent=parent,this.m_newPointList=[],this.m_allPointList=[],this.m_allGroupList=[],this.m_arrProjIdColorMap={},this.m_dataSourceId,this.m_lang=I18n.resource.dataSource,this.m_selectItemId=0,this.m_selectGroupId=0,this.m_groupIconOpen="/static/images/dataSource/group_head_sel.png",this.m_groupIconClose="/static/images/dataSource/group_head_normal.png",this.m_cfgPanel}return DataSource.prototype={show:function(){var _this=this;Spinner.spin(ElScreenContainer),I18n.fillArea($("#divAnlsDatasourcePane")),I18n.fillArea($("#divEnergyAnlsPane")),_this.initContain(),_this.initElement(),_this.loadDataSourceRecord(),_this.initDrag(),Spinner.stop()},close:function(){this.m_newPointList=null,this.m_allPointList=null},initContain:function(){var _this=this,dsContain=$("#dataSrcContain"),panel=$('<div id="dataSrcPanel"></div>');dsContain.append(panel);var addGroup=$('<div id="dataSrcAddGroup"><input type="text" id="inputAddGroup" placeholder="+ Add group" ></input></div>');dsContain.append(addGroup),dsContain.keyup(function(e){13==e.keyCode&&_this.addNewGroup()});var inputAdd=addGroup.find("#inputAddGroup");inputAdd.attr("placeholder",_this.m_lang.ADD_GROUP),inputAdd.blur(function(e){_this.addNewGroup()})},initElement:function(){for(var item,_this=this,len=AppConfig.projectList.length,nColorSize=_this.m_parent.arrColor.length,i=0;len>i;i++)item=AppConfig.projectList[i],_this.m_arrProjIdColorMap[item.id]=_this.m_parent.arrColor[i-parseInt(i/nColorSize)*nColorSize];$("#data_source_add").click(function(e){return 0==_this.m_selectGroupId?void alert(_this.m_lang.NO_SELECT_GROUP):(void 0!=_this.m_cfgPanel&&_this.m_cfgPanel.close(),void WebAPI.get("/static/views/observer/dataSourceAdd.html").done(function(result){_this.m_cfgPanel=new DataSourceConfigure(_this,0,!0,"","","",-1),_this.m_cfgPanel.show()}).error(function(result){}).always(function(e){}))}),$("#data_source_formula_add").click(function(e){return 0==_this.m_selectGroupId?void alert(_this.m_lang.NO_SELECT_GROUP):(void 0!=_this.m_cfgPanel&&_this.m_cfgPanel.close(),void WebAPI.get("/static/views/observer/dataSourceAdd.html").done(function(result){_this.m_cfgPanel=new DataSourceConfigure(_this,1,!0,"","","",-1),_this.m_cfgPanel.show()}).error(function(result){}).always(function(e){}))}),$("#divAnlsDatasourcePane").click(function(e){_this.clearSelect()})},insertIntoDataList:function(customName,ptName,ptDesc,prjName,iconColor,itemId,baseNode,bIsAppend,bIsSelected){var div,_this=this;div=$(bIsSelected?'<div draggable="true" class="dsItem grow dsSelected" style="height:34px"></div>':'<div draggable="true" class="dsItem grow" style="height:34px"></div>'),div.attr("id",itemId),div.click(function(e){_this.clearSelect();var target=$(e.currentTarget);"dsItem grow"==target.attr("class")?target.attr("class","dsItem grow dsSelected"):target.attr("class","dsItem grow"),_this.stopBubble(e)});var icon=$('<div class="dsMark"></div>');icon.css("background-color",iconColor),div.append(icon);var custName=$('<div class="dsValue" style="height:36px;">'+customName+"</div>");div.append(custName);var btnRename=$('<span class="dsBtnRename grow glyphicon glyphicon-wrench"></span>');btnRename.click(function(e){void 0!=_this.m_cfgPanel&&_this.m_cfgPanel.close(),_this.m_selectItemId=$(e.currentTarget).closest(".dsItem").get(0).id;for(var customName,ptDesc,ptName,item,prjId,i=0,len=_this.m_allPointList.length;len>i;i++)if(item=_this.m_allPointList[i],itemId===item.itemId){customName=item.customName,ptName=item.ptName,ptDesc=item.ptDesc,prjId=item.prjId;break}WebAPI.get("/static/views/observer/dataSourceAdd.html").done(function(result){_this.m_cfgPanel=new DataSourceConfigure(_this,0,!1,customName,ptName,ptDesc,prjId),_this.m_cfgPanel.show()}).fail(function(result){}).always(function(e){})}).error(function(e){}),div.append(btnRename);var btnRemove=$('<span class="dsBtnRemove grow glyphicon glyphicon-remove-sign"></span>');btnRemove.click(function(e){var retCon=confirm(_this.m_lang.REMOVE_CONFIRM_TIPS);if(!0===retCon){var div=$(e.currentTarget).closest(".dsItem"),dataSrcItemId=div.attr("id"),dataSrcId=_this.m_dataSourceId;WebAPI.get("/analysis/datasource/removeSingle/"+dataSrcId+"/"+dataSrcItemId+"/"+AppConfig.userId).done(function(result){var data=JSON.parse(result);if(Boolean(data.success)){for(var len=_this.m_allPointList.length,i=0;len>i;i++)if(dataSrcItemId==_this.m_allPointList[i].itemId){_this.m_allPointList.splice(i,1);break}_this.calUpdateDataSources(),div.tooltip("destroy"),div.remove();var arr=data.deleteModal,len=arr.length;if(len>0){for(var delMod,arrDelTitle=[],i=0;len>i;i++)delMod=$("#"+arr[i]),arrDelTitle.push(delMod.find(".newDivPageTitle").val()),delMod.remove();for(var delTitle=_this.m_lang.WORKSPACE+":",i=0,len=arrDelTitle.length;len>i;i++)delTitle+=arrDelTitle[i]+" ";delTitle+=_this.m_lang.REMOVE_RESULT,alert(delTitle)}}}).error(function(){})}}).error(function(e){}),div.append(btnRemove);var divChange=$('<div class="dsDivChange"></div>'),ctlPrjName=$('<div class="form-group"><label style="color:#eee">'+_this.m_lang.PROJECT_NAME+": "+prjName+"</label></div>");ctlPrjName.click(function(e){_this.stopBubble(e)}),divChange.append(ctlPrjName);var ctlPtName=$('<div class="form-group"><label style="color:#eee">'+_this.m_lang.POINT_NAME+": "+ptName+"</label></div>");ctlPtName.click(function(e){_this.stopBubble(e)}),divChange.append(ctlPtName);var inputCustName=$('<div class="form-group"><label style="color:#eee">Custom Name</label><input type="text" class="form-control" value="" placeholder="Custom Name"></input></div>');inputCustName.find("label").text(_this.m_lang.CUSTOM_NAME);var ctlInput=inputCustName.find("input");ctlInput.attr("value",customName),ctlInput.attr("placeholder",_this.m_lang.CUSTOM_NAME),inputCustName.click(function(e){_this.stopBubble(e)}),divChange.append(inputCustName);var inputDesc=$('<div class="form-group"><label style="color:#eee">Description</label><input type="text" class="form-control" value="" placeholder="Description"></input></div>');inputDesc.find("label").text(_this.m_lang.POINT_DESC),ctlInput=inputDesc.find("input"),ctlInput.attr("value",ptDesc),ctlInput.attr("placeholder",_this.m_lang.POINT_DESC),inputDesc.click(function(e){_this.stopBubble(e)}),divChange.append(inputDesc);var btnOk=$('<button class="btn btn-default btn-sm" style="position:absolute; right:70px;">OK</button>');btnOk.text(_this.m_lang.SURE),btnOk.click(function(e){for(var prjId,ptName,item,temp=$(e.currentTarget).closest(".dsDivChange").find("input"),strName=$(temp[0]).val(),strDesc=$(temp[1]).val(),i=0,len=_this.m_allPointList.length;len>i;i++)if(item=_this.m_allPointList[i],itemId==item.itemId){prjId=item.prjId,ptName=item.ptName;break}var postData={datasourceId:_this.m_dataSourceId,itemList:[{id:itemId,type:0,projId:prjId,alias:strName,note:strDesc,value:ptName,groupId:""}]};WebAPI.post("/analysis/datasource/saveMulti/"+AppConfig.userId,postData).done(function(result){for(var data=JSON.parse(result),id=data.itemIdList[0].id,i=0,len=_this.m_allPointList.length;len>i;i++)if(id==_this.m_allPointList[i].itemId){_this.m_allPointList[i].customName=strName,_this.m_allPointList[i].ptDesc=strDesc;break}_this.setToolTipsCustomName(div,strName),_this.setToolTipsDesc(div,strDesc),_this.calUpdateDataSources(),$("#"+id).find(".dsValue").text(strName)}).error(function(e){})}),divChange.append(btnOk);var btnCancel=$('<button class="btn btn-default btn-sm" style="position:absolute; right:15px;">Cancel</button>');btnCancel.text(_this.m_lang.CANCEL),btnCancel.click(function(e){}),divChange.append(btnCancel),div.append(divChange),bIsAppend?baseNode.append(div):baseNode.after(div)},initToolTips:function(parent,customName,projectName,pointName,pointDesc){var _this=this,show=new StringBuilder;show.append('<div class="tooltip" role="tooltip" style="z-index:10;position:fixed;max-width:300px;">'),show.append('    <div class="tooltipTitle tooltip-inner">GeneralRegressor</div>'),show.append('    <div class="tooltipContent">'),show.append('        <p class="customName" style="word-break:break-all;"><span style="font-weight:bold">').append(_this.m_lang.CUSTOM_NAME).append("</span>: ").append(customName).append("</p>"),show.append('        <p class="projectName" style="word-break:break-all;"><span style="font-weight:bold">').append(_this.m_lang.PROJECT_NAME).append("</span>: ").append(projectName).append("</p> "),show.append('        <p class="pointName" style="word-break:break-all;"><span style="font-weight:bold">').append(_this.m_lang.POINT_NAME).append("</span>: ").append(pointName).append("</p> "),show.append('        <p class="pointDesc" style="word-break:break-all;"><span style="font-weight:bold">').append(_this.m_lang.POINT_DESC).append("</span>: ").append(pointDesc).append("</p> "),show.append("    </div>"),show.append('    <div class="tooltip-arrow"></div>'),show.append("</div>");var options={placement:"left",title:_this.m_lang.PARAM,template:show.toString()};parent.tooltip(options),parent.tooltip("show"),parent.tooltip("hide")},setToolTipsAll:function(row,userName,customName,projectName,pointName,pointDesc){var tip=row.data("bs.tooltip").$tip;userName=": "+userName,customName=": "+customName,projectName=": "+projectName,pointName=": "+pointName,pointDesc=": "+pointDesc,tip.find(".userName").text(this.m_lang.USER_NAME+userName),tip.find(".customName").text(this.m_lang.CUSTOM_NAME+customName),tip.find(".projectName").text(this.m_lang.PROJECT_NAME+projectName),tip.find(".pointName").text(this.m_lang.POINT_NAME+pointName),tip.find(".pointDesc").text(this.m_lang.POINT_DESC+pointDesc)},setToolTipsCustomName:function(row,customName){var tip=row.data("bs.tooltip").$tip;tip.find(".customName").text(this.m_lang.CUSTOM_NAME+": "+customName)},setToolTipsDesc:function(row,ptDesc){var tip=row.data("bs.tooltip").$tip;tip.find(".pointDesc").text(this.m_lang.POINT_DESC+": "+ptDesc)},renderTabel:function(){var _this=this,len=_this.m_newPointList.length;if(!(0>=len)){{var item,eachItem,postData,div=$("#dataSrcPanel");div.find(".dsItem").length}if(len=_this.m_newPointList.length,len>0){postData=_this.m_dataSourceId?{datasourceId:_this.m_dataSourceId,itemList:[]}:{itemList:[]};for(var i=0;len>i;i++)item=_this.m_newPointList[i],eachItem={type:0,projId:item.prjId,alias:item.customName,note:item.ptDesc,value:item.ptName,groupId:item.groupId},postData.itemList.push(eachItem);var projName=_this.m_newPointList[0].prjName,iconColor=_this.m_newPointList[0].iconColor;WebAPI.post("/analysis/datasource/saveMulti/"+AppConfig.userId,postData).done(function(result){if(""!=result){var data=JSON.parse(result);""!=data.id&&(_this.m_dataSourceId=data.id);for(var list=data.itemIdList,len=list.length,i=0;len>i;i++)_this.m_newPointList[i].customName==list[i].alias&&(_this.m_newPointList[i].itemId=list[i].id);var divInsert=$("#"+_this.m_selectGroupId);if(void 0!=divInsert)for(var i=0;len>i;i++)_this.insertTreeItem(divInsert,list[i].id,iconColor,list[i].alias,0,"",!0),_this.initToolTips($("#"+list[i].id),list[i].alias,projName,list[i].value,list[i].note);_this.m_allPointList=_this.m_allPointList.concat(_this.m_newPointList),_this.calUpdateDataSources()}}).error(function(){}).always(function(){})}}},modifyTable:function(){var item,eachItem,postData,_this=this,len=_this.m_newPointList.length;len>0&&(postData=_this.m_dataSourceId?{datasourceId:_this.m_dataSourceId,itemList:[]}:{itemList:[]},item=_this.m_newPointList[0],eachItem={id:item.itemId,type:0,projId:item.prjId,alias:item.customName,note:item.ptDesc,value:item.ptName,groupId:item.groupId},postData.itemList.push(eachItem),WebAPI.post("/analysis/datasource/saveMulti/"+AppConfig.userId,postData).done(function(result){if(""!=result){var data=JSON.parse(result);""!=data.id&&(_this.m_dataSourceId=data.id);for(var i=0,len=_this.m_allPointList.length;len>i;i++)if(item.itemId===_this.m_allPointList[i].itemId){_this.m_allPointList[i].prjId=item.prjId,_this.m_allPointList[i].prjName=_this.m_newPointList[0].prjName,_this.m_allPointList[i].customName=item.customName,_this.m_allPointList[i].ptName=item.ptName,_this.m_allPointList[i].ptDesc=item.ptDesc;break}var divItem=$("#"+item.itemId);divItem.find(".showName").text(item.customName),_this.setToolTipsAll(divItem,item.userName,item.customName,item.prjName,item.ptName,item.ptDesc),_this.calUpdateDataSources()}}).error(function(){}).always(function(){}))},initDrag:function(){var _this=this;_this.dragOperateSrc($("#dataSrcPanel").get(0)),_this.dragOperateCfg($(".springConfigMask").parent().get(0))},dragOperateSrc:function(tableList){if(void 0!=tableList){var _this=this;tableList.ondragstart=function(e){var tar=$(e.target),className=tar.attr("class");if("nav nav-list tree-group"==className){var dragSrcId=tar.attr("id");e.dataTransfer.setData("dsGroupId",dragSrcId)}else{if("treeRow ui-draggable"!=className)return;var dragSrcId=tar.attr("id");e.dataTransfer.setData("dsItemId",dragSrcId)}$(".templatePara").css("display","block")},tableList.ondragover=function(e){e.preventDefault()},tableList.ondrop=function(e){var tarItem=$(e.target),tarId=0,tarParentGroupId=0,dragParentGroupId=0,rowClass=tarItem.attr("class"),dragType=-1,draggedID=0;if("nav nav-list tree-group"==rowClass||"dsTreeHeader"==rowClass)tarId=tarItem.closest(".nav").attr("id"),draggedID=e.dataTransfer.getData("dsGroupId"),""!=draggedID?dragType=0:(draggedID=e.dataTransfer.getData("dsItemId"),""!=draggedID&&(dragType=2,tarId=tarItem.closest(".nav").attr("id"),tarParentGroupId=tarId,dragParentGroupId=$("#"+draggedID).closest(".nav").attr("id")));else{if("showName"!=rowClass&&"treeRow ui-draggable"!=rowClass)return;dragType=1,draggedID=e.dataTransfer.getData("dsItemId"),tarId=tarItem.closest(".treeRow").attr("id"),tarParentGroupId=tarItem.closest(".nav").attr("id"),dragParentGroupId=$("#"+draggedID).closest(".nav").attr("id")}if(draggedID!=tarId&&""!=draggedID&&0!=draggedID)if(0===dragType){for(var item,groupName,i=0,len=_this.m_allGroupList.length;len>i;i++)if(item=_this.m_allGroupList[i],draggedID==item.id){groupName=item.name;break}$("#"+draggedID).remove(),_this.insertTreeGroup(draggedID,groupName,1,$("#"+tarId));for(var i=0,len=_this.m_allPointList.length;len>i;i++)if(item=_this.m_allPointList[i],draggedID==item.groupId){_this.insertTreeItem($("#"+draggedID),item.itemId,item.iconColor,item.customName,0,"",!0);var prjName=_this.getProjectNameFromId(item.prjId);_this.initToolTips($("#"+item.itemId),item.customName,prjName,item.ptName,item.ptDesc)}var groups=$("#dataSrcPanel .nav"),arrTemp=[];$.each(groups,function(i,n){var id=n.id;""!=id&&("groupEmpty"==id&&(id=""),arrTemp.push(id))});var postData={groupIdList:arrTemp};WebAPI.post("/datasource/saveDataSourceGroupLayout/"+AppConfig.userId,postData).done(function(result){var data=JSON.parse(result);"successful"==data.error}).error(function(){}).always(function(){})}else if(1===dragType||2===dragType){for(var itemType=0,iconColor="",custName="",projId=0,pointName="",pointDesc="",i=0,len=_this.m_allPointList.length;len>i;i++)if(draggedID==_this.m_allPointList[i].itemId){_this.m_allPointList[i].groupId=tarParentGroupId,itemType=_this.m_allPointList[i].itemType,iconColor=_this.m_allPointList[i].iconColor,custName=_this.m_allPointList[i].customName,projId=_this.m_allPointList[i].prjId,pointName=_this.m_allPointList[i].ptName,pointDesc=_this.m_allPointList[i].ptDesc;break}var selItem=$("#"+draggedID);if(selItem.tooltip("destroy"),selItem.remove(),_this.insertTreeItem($("#"+tarParentGroupId),draggedID,iconColor,custName,dragType,$("#"+tarId),!0),0==itemType){var prjName=_this.getProjectNameFromId(projId);_this.initToolTips($("#"+draggedID),custName,prjName,showName,pointDesc)}else{if(1!=itemType)return;var showName=_this.getShowNameFromFormula(pointName);_this.initFormulaToolTips($("#"+draggedID),custName,showName,pointDesc)}var lyItem=$("#dataSrcPanel .treeRow"),arrTemp=[];$.each(lyItem,function(i,n){var id=n.id;""!=id&&arrTemp.push(id)});var postData={datasourceId:_this.m_dataSourceId,list:arrTemp};WebAPI.post("/analysis/datasource/saveLayout/"+AppConfig.userId,postData).done(function(result){var data=JSON.parse(result);if(data.success&&tarParentGroupId!=dragParentGroupId){var postData2;postData2=_this.m_dataSourceId?{datasourceId:_this.m_dataSourceId,itemList:[]}:{itemList:[]};var eachPostItem={id:draggedID,type:itemType,projId:projId,alias:custName,note:pointDesc,value:pointName,groupId:tarParentGroupId};postData2.itemList.push(eachPostItem),WebAPI.post("/analysis/datasource/saveMulti/"+AppConfig.userId,postData2).done(function(result){if(""!=result){var data=JSON.parse(result);""!=data.id&&(_this.m_dataSourceId=data.id),void 0!=data.itemIdList&&data.itemIdList[0].id==draggedID}}).error(function(){}).always(function(){})}}).error(function(){}).always(function(){})}}}},dragOperateCfg:function(divItem){if(void 0!=divItem){divItem.ondragstart=function(e){var target=$(e.target),className=target.attr("class");if("dsItem grow"==className||"dsItem grow dsSelected"==className){var dragSrcId=target.attr("id");e.dataTransfer.setData("dsItemId",dragSrcId)}},divItem.ondragover=function(e){e.preventDefault()},divItem.ondrop=function(e){$(e.target)}}},saveCurrentRecords:function(){var _this=this;Spinner.spin(ElScreenContainer),WebAPI.post("/delete_data_source_records_by_userid",{userId:AppConfig.userId}).done(function(result){if(0!=result)return void Spinner.stop();var id,newRow,item,newPtList=[],len=_this.m_allPointList.length;$("#dataSrcPanel .dsItem").each(function(){id=$(this).attr("id");for(var i=0;len>i;i++)if(item=_this.m_allPointList[i],id==item.itemId){newRow={itemId:id,userId:item.userId,userName:item.userName,customName:item.customName,prjId:item.prjId,prjName:item.prjName,ptName:item.ptName,ptDesc:item.ptDesc,iconColor:item.iconColor,itemId:item.itemId},newPtList.push(newRow);break}}),_this.m_allPointList=newPtList;for(var row,data=[],len=_this.m_allPointList.length,i=0;len>i;i++)item=_this.m_allPointList[i],row={userId:item.userId,customName:item.customName,projectId:item.prjId,pointName:item.ptName,pointDesc:item.ptDesc,iconColor:item.iconColor},data.push(row);WebAPI.post("/save_data_source_record",{sourceList:data}).done(function(result){}).error(function(result){alert(I18n.resource.observer.widgets.DATABASE_OPERATION_FAILED+"！")})}).error(function(result){alert(I18n.resource.observer.widgets.FAIL_BEFORE_EXECUTING+"！")}).always(function(){Spinner.stop()})},loadDataSourceRecord:function(){var _this=this,groupInfo=($("#dataSrcPanel"),_this.m_parent.store.group);if(void 0!=groupInfo){_this.m_allPointList=[],_this.m_allGroupList=[];for(var m=0,n=groupInfo.length;n>m;m++){var groupId=groupInfo[m].groupId;""==groupId&&(groupId="groupEmpty");var groupName=groupInfo[m].groupName,data=groupInfo[m].datasourceList;if(_this.m_allGroupList.push({id:groupId,name:groupName}),void 0!=data)for(var item,len=data.length,i=0;len>i;i++)item={userId:AppConfig.userId,userName:AppConfig.account,customName:data[i].alias,prjId:data[i].projId,prjName:_this.getProjectNameFromId(data[i].projId),ptName:data[i].value,ptDesc:data[i].note,iconColor:_this.m_arrProjIdColorMap[data[i].projId],itemId:data[i].id,itemType:data[i].type,itemValue:data[i].value,groupId:groupId,groupName:groupName},1==item.itemType&&(item.iconColor="#000000"),_this.m_allPointList.push(item)}for(var i=0,len=_this.m_allGroupList.length;len>i;i++)_this.insertTreeGroup(_this.m_allGroupList[i].id,_this.m_allGroupList[i].name,0,"");for(var i=0,len=_this.m_allPointList.length;len>i;i++){var item=_this.m_allPointList[i],bIsPoint=!0;bIsPoint=0==item.itemType?!0:!1;var parentGroup=$("#"+item.groupId);if(_this.insertTreeItem(parentGroup,item.itemId,item.iconColor,item.customName,0,"",bIsPoint),bIsPoint){var prjName=_this.getProjectNameFromId(item.prjId);_this.initToolTips($("#"+item.itemId),item.customName,prjName,item.ptName,item.ptDesc)}else{var showName=_this.getShowNameFromFormula(item.ptName);_this.initFormulaToolTips($("#"+item.itemId),item.customName,showName,item.ptDesc)}}for(var item,treeAllHead=$(".dsTreeHeader .dsGroupName"),i=0,len=treeAllHead.length;len>i;i++)item=treeAllHead.eq(i),"unassigned"!=item.text()&&item.closest(".dsTreeHeader").click()}},getProjectNameFromId:function(id){for(var name,item,len=AppConfig.projectList.length,i=0;len>i;i++)if(item=AppConfig.projectList[i],id==item.id){name=item.name_cn;break}return name},getProjectIdFromName:function(projectName){for(var id,item,len=AppConfig.projectList.length,i=0;len>i;i++)if(item=AppConfig.projectList[i],projectName==item.name_cn){id=item.id;break}return id},calUpdateDataSources:function(){for(var _this=this,updateData=[],i=0,len=_this.m_allGroupList.length;len>i;i++){for(var groupItem={groupId:_this.m_allGroupList[i].id,groupName:_this.m_allGroupList[i].name,parentId:"",datasourceList:""},dsList=[],j=0,len2=_this.m_allPointList.length;len2>j;j++){var curItem=_this.m_allPointList[j];if(groupItem.groupId==curItem.groupId){var pushItem={id:curItem.itemId,type:curItem.itemType,projId:curItem.prjId,alias:curItem.customName,note:curItem.ptDesc,value:curItem.ptName,groupId:curItem.groupId};dsList.push(pushItem)}}groupItem.datasourceList=dsList,updateData.push(groupItem)}this.m_parent.updateDataSources(updateData)},renderFormula:function(_customName,_formulaVal,_formulaDesc){var postData,_this=this;postData=_this.m_dataSourceId?{datasourceId:_this.m_dataSourceId,
itemList:[]}:{itemList:[]};var prjId=0,eachItem={type:1,projId:prjId,alias:_customName,note:_formulaDesc,value:_formulaVal,groupId:_this.m_selectGroupId};postData.itemList.push(eachItem),WebAPI.post("/analysis/datasource/saveMulti/"+AppConfig.userId,postData).done(function(result){if(""!=result){var data=JSON.parse(result);""!=data.id&&(_this.m_dataSourceId=data.id);for(var item,list=data.itemIdList,i=0,len=list.length;len>i;i++){item={itemId:list[i].id,itemType:1,customName:list[i].alias,itemValue:list[i].value,ptName:list[i].value,prjId:prjId,iconColor:"#000000",ptDesc:_formulaDesc,groupId:list[i].groupId},_this.m_allPointList.push(item),_this.insertTreeItem($("#"+_this.m_selectGroupId),item.itemId,item.iconColor,item.customName,0,"",!1);var showName=_this.getShowNameFromFormula(list[i].value);_this.initFormulaToolTips($("#"+item.itemId),item.customName,showName,_formulaDesc)}_this.calUpdateDataSources()}})},modifyFormula:function(_customName,_formulaVal,_formulaDesc){var postData,_this=this,itemId=_this.m_selectItemId;postData=_this.m_dataSourceId?{datasourceId:_this.m_dataSourceId,itemList:[]}:{itemList:[]};var prjId=Number(AppConfig.projectId),eachItem={id:itemId,type:1,projId:prjId,alias:_customName,note:_formulaDesc,value:_formulaVal,groupId:""};postData.itemList.push(eachItem),WebAPI.post("/analysis/datasource/saveMulti/"+AppConfig.userId,postData).done(function(result){if(""!=result){var data=JSON.parse(result);""!=data.id&&(_this.m_dataSourceId=data.id);var list=data.itemIdList;if(list.length>0){for(var showName=list[0].value,arr=showName.split("<%"),j=0,len2=arr.length;len2>j;j++){var id=arr[j].split("%>")[0];if(""!=id){var retVal=_this.getDSItemById(id);null!=retVal&&(showName=showName.replace(id,retVal.value))}}showName=showName.replace(/<%/g,""),showName=showName.replace(/%>/g,"");for(var i=0,len=_this.m_allPointList.length;len>i;i++)if(itemId===_this.m_allPointList[i].itemId){_this.m_allPointList[i].customName=list[0].alias,_this.m_allPointList[i].ptName=list[0].value,_this.m_allPointList[i].ptDesc=list[0].note;break}var divFormula=$("#"+itemId);divFormula.find(".dsValue").text(list[0].alias),_this.setFormulaToolTipsAll(divFormula,list[0].alias,showName,list[0].note),_this.calUpdateDataSources()}}})},insertFormula:function(itemId,customName,iconColor,formula,desc){var _this=this,div=$('<div draggable="true" class="dsItem grow" style="height:34px"></div>');div.attr("id",itemId),div.click(function(e){_this.clearSelect();var tar=$(e.currentTarget);"dsItem grow"==tar.attr("class")?tar.attr("class","dsItem grow dsSelected"):tar.attr("class","dsItem grow"),_this.stopBubble(e)});var icon=$('<div class="dsMark"></div>');icon.css("background-color",iconColor),div.append(icon);var name=$('<div class="dsValue" style="height:36px"></div>');name.text(customName),div.append(name);var btnRename=$('<span class="dsBtnRename grow glyphicon glyphicon-wrench"></span>');btnRename.click(function(e){var show=$(e.currentTarget).prevAll(".dsValue");show.css("display","none");var target=$(e.currentTarget).nextAll(".dsDivChange");target.attr("class","dsDivChange show"),div.css("height","240px"),div.css("width","100%");for(var item,strName="",strFormula="",strDesc="",i=0,len=_this.m_allPointList.length;len>i;i++)if(item=_this.m_allPointList[i],itemId==item.itemId){strName=item.customName,strFormula=item.ptName,strDesc=item.ptDesc;break}var temp=target.find("input");2==temp.length&&($(temp[0]).val(strName),$(temp[1]).val(strDesc)),_this.stopBubble(e)}).error(function(e){}),div.append(btnRename);var btnRemove=$('<span class="dsBtnRemove grow glyphicon glyphicon-remove-sign"></span>');btnRemove.click(function(e){var retCon=confirm(_this.m_lang.REMOVE_CONFIRM);if(!0===retCon){var div=$(e.currentTarget).closest(".dsItem"),dataSrcId=_this.m_dataSourceId,dataSrcItemId=div.attr("id");WebAPI.get("/analysis/datasource/removeSingle/"+dataSrcId+"/"+dataSrcItemId+"/"+AppConfig.userId).done(function(result){var data=JSON.parse(result);if(Boolean(data.success)){for(var len=_this.m_allPointList.length,i=0;len>i;i++)if(dataSrcItemId==_this.m_allPointList[i].itemId){_this.m_allPointList.splice(i,1);break}_this.calUpdateDataSources(),div.tooltip("destroy"),div.remove()}}).error(function(){})}}),div.append(btnRemove);var divChange=$('<div class="dsDivChange"></div>'),inputCustName=$('<div class="form-group"><label style="color:#eee">Custom Name</label><input type="text" class="form-control" value="" placeholder="Custom Name"></input></div>');inputCustName.find("label").text(_this.m_lang.CUSTOM_NAME);var ctlInput=inputCustName.find("input");ctlInput.attr("value",customName),ctlInput.attr("placeholder",_this.m_lang.CUSTOM_NAME),inputCustName.click(function(e){_this.stopBubble(e)}),divChange.append(inputCustName);var ctlFormula=$('<div class="form-group"><label style="color:#eee">'+_this.m_lang.FORMULA_NAME+": </label></div>"),showFormula=$("<span>"+formula+"</span>");showFormula.appendTo(ctlFormula.find("label")).mathquill(),ctlFormula.click(function(e){_this.stopBubble(e)}),divChange.append(ctlFormula);var inputDesc=$('<div class="form-group"><label style="color:#eee">Description</label><input type="text" class="form-control" value="" placeholder="Description"></input></div>');inputDesc.find("label").text(_this.m_lang.POINT_DESC),ctlInput=inputDesc.find("input"),ctlInput.attr("value",desc),ctlInput.attr("placeholder",_this.m_lang.POINT_DESC),inputDesc.click(function(e){_this.stopBubble(e)}),divChange.append(inputDesc);var btnOk=$('<button class="btn btn-default btn-sm" style="position:absolute; right:70px;">OK</button>');btnOk.text(_this.m_lang.SURE),btnOk.click(function(e){for(var prjId,ptName,item,temp=$(e.currentTarget).closest(".dsDivChange").find("input"),strName=$(temp[0]).val(),strDesc=$(temp[1]).val(),i=0,len=_this.m_allPointList.length;len>i;i++)if(item=_this.m_allPointList[i],itemId==item.itemId){prjId=item.prjId,ptName=item.ptName;break}var postData={datasourceId:_this.m_dataSourceId,itemList:[{id:itemId,type:1,projId:prjId,alias:strName,note:strDesc,value:ptName,groupId:""}]};WebAPI.post("/analysis/datasource/saveMulti/"+AppConfig.userId,postData).done(function(result){var data=JSON.parse(result);if(0!=data.itemIdList.length){for(var id=data.itemIdList[0].id,i=0,len=_this.m_allPointList.length;len>i;i++)if(id==_this.m_allPointList[i].itemId){_this.m_allPointList[i].customName=strName,_this.m_allPointList[i].ptDesc=strDesc;break}_this.setToolTipsCustomName(div,strName),_this.setToolTipsDesc(div,strDesc),_this.calUpdateDataSources(),$("#"+id).find(".dsValue").text(strName)}}).error(function(e){})}),divChange.append(btnOk);var btnCancel=$('<button class="btn btn-default btn-sm" style="position:absolute; right:15px;">Cancel</button>');btnCancel.text(_this.m_lang.CANCEL),btnCancel.click(function(e){}),divChange.append(btnCancel),div.append(divChange),$("#dataSrcPanel").append(div)},initFormulaToolTips:function(parent,customName,formula,desc){var _this=this,show=new StringBuilder;show.append('<div class="tooltip" role="tooltip" style="z-index:10;position:fixed;max-width:400px;">'),show.append('    <div class="tooltipTitle tooltip-inner">GeneralRegressor</div>'),show.append('    <div class="tooltipContent">'),show.append('        <p class="customName" style=word-break:break-all;"><span style="font-weight:bold">').append(_this.m_lang.CUSTOM_NAME).append("</span>: ").append(customName).append("</p>"),show.append('        <p class="formula" style="word-break:normal;"><span style="font-weight:bold">').append(_this.m_lang.FORMULA_NAME).append("</span>: ").append("</p>"),show.append('        <p class="pointDesc" style="word-break:break-all;"><span style="font-weight:bold">').append(_this.m_lang.POINT_DESC).append("</span>: ").append(desc).append("</p>"),show.append("    </div>"),show.append('    <div class="tooltip-arrow"></div>'),show.append("</div>");var showFormula=$("<span>"+formula+"</span>"),showObj=$(show.toString());showFormula.appendTo(showObj.find(".formula")).mathquill();var options={placement:"left",title:_this.m_lang.PARAM,template:showObj};parent.tooltip(options),parent.tooltip("show"),parent.tooltip("hide")},setFormulaToolTipsAll:function(row,customName,formulaVal,formulaDesc){var tip=row.data("bs.tooltip").$tip;customName=": "+customName,formulaVal=": "+formulaVal,formulaDesc=": "+formulaDesc,tip.find(".customName").text(this.m_lang.CUSTOM_NAME+customName),tip.find(".formula").text(this.m_lang.PROJECT_NAME+formulaVal),tip.find(".pointDesc").text(this.m_lang.POINT_NAME+formulaDesc)},checkRepeatWithCustomName:function(_name){var bRet=!1,grids=$("#dataSrcPanel .dsItem .dsValue");return $.each(grids,function(i,n){return _name==$(n).text()?(bRet=!0,!1):void 0}),bRet},stopBubble:function(e){e&&e.stopPropagation?e.stopPropagation():window.event.cancelBubble=!0},clearSelect:function(e){var itemList=$("#dataSrcPanel .dsItem");itemList.attr("class","dsItem grow"),itemList.css("height","34px"),itemList.css("width","33%");var panel=$("#dataSrcPanel");panel.find(".dsDivChange").attr("class","dsDivChange"),panel.find(".dsValue").css("display","inline")},insertTreeGroup:function(groupId,groupName,type,baseGroup){var _this=this,divContain=$("#dataSrcPanel"),$ul=$('<ul class="nav nav-list tree-group" id="'+groupId+'" draggable="true">'),$liHd=$('<li class="dsTreeHeader"><img src="/static/images/dataSource/group_head_sel.png" alt="png" class="dsTreeHeaderIcon"><span class="dsGroupName">'+groupName+"</span></li>"),btnRemove=$('<span class="glyphicon glyphicon-remove-sign panel-heading-btn grow dsTreeBtnDel" aria-hidden="true"></span>');btnRemove.click(function(e){var retCon=confirm(_this.m_lang.REMOVE_CONFIRM);if(!0===retCon){void 0!=_this.m_cfgPanel&&(_this.m_cfgPanel.close(),_this.m_parent.showAnlsPane());var div=$(e.currentTarget).closest(".nav"),groupId=div.attr("id");WebAPI.get("/datasource/deleteDataSourceGroup/"+AppConfig.userId+"/"+groupId).done(function(result){var data=JSON.parse(result);if("successful"==data.error){for(var len=_this.m_allGroupList.length,i=0;len>i;i++)if(groupId==_this.m_allGroupList[i].id){_this.m_allGroupList.splice(i,1),div.remove();break}_this.calUpdateDataSources()}}).fail(function(e){})}}).error(function(e){}),$liHd.append(btnRemove);var btnAddDs=$('<span class="glyphicon glyphicon-plus-sign panel-heading-btn grow dsTreeBtnAdd" aria-hidden="true" id="data_source_add"></span>');btnAddDs.click(function(e){var tar=$(e.currentTarget);_this.m_selectGroupId=tar.closest(".tree-group").get(0).id,_this.stopBubble(e),void 0!=_this.m_cfgPanel&&_this.m_cfgPanel.close(),WebAPI.get("/static/views/observer/dataSourceAdd.html").done(function(result){_this.m_cfgPanel=new DataSourceConfigure(_this,0,!0,"","","",-1),_this.m_cfgPanel.show()}).error(function(result){}).always(function(e){})}),$liHd.append(btnAddDs);var btnAddFormula=$('<span><img src="/static/images/dataSource/formula_add_normal.png" alt="Formula add" class="dsTreeBtnFormula" id="data_source_formula_add" /></span>');btnAddFormula.click(function(e){var tar=$(e.currentTarget);_this.m_selectGroupId=tar.closest(".tree-group").get(0).id,_this.stopBubble(e),void 0!=_this.m_cfgPanel&&_this.m_cfgPanel.close(),WebAPI.get("/static/views/observer/dataSourceAdd.html").done(function(result){_this.m_cfgPanel=new DataSourceConfigure(_this,1,!0,"","","",-1),_this.m_cfgPanel.show()}).error(function(result){}).always(function(e){})}),btnAddFormula.mouseenter(function(e){var img=btnAddFormula.find("img");img.attr("src","/static/images/dataSource/formula_add_hover.png"),img.css("width","23px"),img.css("height","20px")}).error(function(e){}),btnAddFormula.mouseleave(function(e){var img=btnAddFormula.find("img");img.attr("src","/static/images/dataSource/formula_add_normal.png"),img.css("width","21px"),img.css("height","19px")}).error(function(e){}),$liHd.append(btnAddFormula),$liHd.click(function(e){divContain.find(".dsTreeBtnCfg").css("display","none"),divContain.find(".dsTreeBtnRemove").css("display","none");var curTarHead=$(e.currentTarget);curTarHead.find(".dsTreeBtnRemove").css("display","inline"),_this.m_selectGroupId=curTarHead.closest(".tree-group").get(0).id,$(this).next(".rows").slideToggle();var icon=$(this).find(".dsTreeHeaderIcon"),imgPath=icon.attr("src");_this.m_groupIconOpen==imgPath?(icon.attr("src",_this.m_groupIconClose),curTarHead.find(".dsGroupName").css("font-weight","400"),curTarHead.find(".dsTreeBtnFormula").css("display","none"),curTarHead.find(".dsTreeBtnAdd").css("display","none"),curTarHead.find(".dsTreeBtnDel").css("display","none")):(icon.attr("src",_this.m_groupIconOpen),curTarHead.find(".dsGroupName").css("font-weight","700"),curTarHead.find(".dsTreeBtnFormula").css("display","inline"),curTarHead.find(".dsTreeBtnAdd").css("display","inline"),curTarHead.find(".dsTreeBtnDel").css("display","inline"))}),$ul.prepend($liHd);var divLiRow=$('<li class="rows"></li>');$ul.append(divLiRow),0===type?divContain.append($ul):1===type&&""!=baseGroup&&baseGroup.after($ul)},insertTreeItem:function(divParentGroup,itemId,iconColor,itemName,insertType,baseItem,bIsPoint){var _this=this,div=$('<div class="treeRow ui-draggable" id="'+itemId+'" draggable="true"> '),icon=$('<div class="dsMark" style="margin-top: -1px"></div>');icon.css("background-color",iconColor),div.append(icon);var divShowName=$('<span class="showName">'+itemName+"</span>");divShowName.click(function(e){var oldCustName=$(e.currentTarget).text(),input=$('<input type="text" value="'+oldCustName+'" style="width:300px;">');input.blur(function(e){var newCustName=$(e.currentTarget).val();if(oldCustName!=newCustName){for(var item,type,prjId,ptName,ptDesc,groupId,postData,i=0,len=_this.m_allPointList.length;len>i;i++)if(item=_this.m_allPointList[i],itemId==item.itemId){type=item.itemType,prjId=item.prjId,ptName=item.ptName,ptDesc=item.ptDesc,groupId=item.groupId;break}postData=_this.m_dataSourceId?{datasourceId:_this.m_dataSourceId,itemList:[]}:{itemList:[]};var eachItem={id:itemId,type:type,projId:prjId,alias:newCustName,note:ptDesc,value:ptName,groupId:groupId};postData.itemList.push(eachItem),WebAPI.post("/analysis/datasource/saveMulti/"+AppConfig.userId,postData).done(function(result){if(""!=result){var data=JSON.parse(result);""!=data.id&&(_this.m_dataSourceId=data.id);for(var dstId,dstCustomName,list=data.itemIdList,i=0,len=list.length;len>i;i++){dstId=list[i].id,dstCustomName=list[i].alias;for(var j=0,len2=_this.m_allPointList.length;len2>j;j++)if(dstId==_this.m_allPointList[j].itemId){_this.m_allPointList[j].customName=dstCustomName;break}divShowName.text(dstCustomName),_this.setToolTipsCustomName(divShowName.closest(".treeRow"),dstCustomName)}_this.calUpdateDataSources()}})}input.remove(),divShowName.css("display","inline")}),input.keyup(function(e){13==e.keyCode&&input.blur(),_this.stopBubble(e)}),divShowName.after(input),divShowName.css("display","none"),input.select()}),div.append(divShowName);var btnRemove=$('<span class="glyphicon glyphicon-remove-sign panel-heading-btn grow dsTreeBtnRemove" aria-hidden="true"></span>');if(btnRemove.click(function(e){var retCon=confirm(_this.m_lang.REMOVE_CONFIRM_TIPS);if(!0===retCon){void 0!=_this.m_cfgPanel&&(_this.m_cfgPanel.close(),_this.m_parent.showAnlsPane());var div=$(e.currentTarget).closest(".treeRow"),dataSrcItemId=div.attr("id"),dataSrcId=_this.m_dataSourceId;WebAPI.get("/analysis/datasource/removeSingle/"+dataSrcId+"/"+dataSrcItemId+"/"+AppConfig.userId).done(function(result){var data=JSON.parse(result);if(Boolean(data.success)){for(var len=_this.m_allPointList.length,i=0;len>i;i++)if(dataSrcItemId==_this.m_allPointList[i].itemId){_this.m_allPointList.splice(i,1);break}_this.calUpdateDataSources(),div.tooltip("destroy"),div.remove();var arr=data.deleteModal,len=arr.length;if(len>0){for(var delMod,arrDelTitle=[],i=0;len>i;i++)delMod=$("#"+arr[i]),arrDelTitle.push(delMod.find(".newDivPageTitle").val()),delMod.remove();for(var delTitle=_this.m_lang.WORKSPACE+":",i=0,len=arrDelTitle.length;len>i;i++)delTitle+=arrDelTitle[i]+" ";delTitle+=_this.m_lang.REMOVE_RESULT,alert(delTitle)}}}).fail(function(e){})}}).error(function(e){}),div.append(btnRemove),bIsPoint){var btnCfg=$('<img src="/static/images/dataSource/item_edit.png" alt="png" class="dsTreeBtnCfg">');btnCfg.click(function(e){void 0!=_this.m_cfgPanel&&_this.m_cfgPanel.close();var curTar=$(e.currentTarget);_this.m_selectItemId=curTar.closest(".treeRow").get(0).id,_this.m_selectGroupId=curTar.closest(".tree-group").get(0).id;for(var customName,ptDesc,ptName,item,prjId,i=0,len=_this.m_allPointList.length;len>i;i++)if(item=_this.m_allPointList[i],itemId===item.itemId){customName=item.customName,ptName=item.ptName,ptDesc=item.ptDesc,prjId=item.prjId;break}WebAPI.get("/static/views/observer/dataSourceAdd.html").done(function(result){_this.m_cfgPanel=new DataSourceConfigure(_this,0,!1,customName,ptName,ptDesc,prjId),_this.m_cfgPanel.show()}).fail(function(result){}).always(function(e){})}).error(function(e){}),btnCfg.mouseenter(function(e){btnCfg.attr("src","/static/images/dataSource/item_edit_hover.png"),btnCfg.css("width","18px"),btnCfg.css("height","18px")}).error(function(e){}),btnCfg.mouseleave(function(e){btnCfg.attr("src","/static/images/dataSource/item_edit.png"),btnCfg.css("width","16px"),btnCfg.css("height","16px")}).error(function(e){}),div.append(btnCfg)}if(div.click(function(e){var divContain=$("#dataSrcPanel");divContain.find(".dsTreeBtnCfg").css("display","none"),divContain.find(".dsTreeBtnRemove").css("display","none");var curTarItem=$(e.currentTarget);curTarItem.find(".dsTreeBtnCfg").css("display","inline"),curTarItem.find(".dsTreeBtnRemove").css("display","inline"),_this.m_selectGroupId=curTarItem.closest(".tree-group").get(0).id}),0===insertType)divParentGroup.find(".rows").append(div);else if(1===insertType)""!=baseItem&&baseItem.after(div);else if(2===insertType){var lyRow=divParentGroup.find(".rows").find(".treeRow");0==lyRow.length?divParentGroup.find(".rows").append(div):lyRow.eq(0).before(div)}},getDSItemById:function(datasourceItemId){if(void 0!=this.m_parent.store.group)for(var itemGroup,lenItem,i=0,len=this.m_parent.store.group.length;len>i;i++){itemGroup=this.m_parent.store.group[i],lenItem=itemGroup.datasourceList.length;for(var j=0;lenItem>j;j++)if(datasourceItemId==itemGroup.datasourceList[j].id)return itemGroup.datasourceList[j]}if(void 0!=this.m_parent.store.dsInfoList)for(var itemInfo,i=0,len=this.m_parent.store.dsInfoList.length;len>i;i++)if(itemInfo=this.m_parent.store.dsInfoList[i],datasourceItemId==itemInfo.id)return itemInfo;return{}},getDSItemData:function(target,arrDSItemIds){var _this=this.m_parent,tmStart=new Date(_this.curModal.startTime),tmEnd=new Date(_this.curModal.endTime),tmFmt=_this.curModal.format,ids=arrDSItemIds.concat(),postData={dsItemIds:ids,timeStart:tmStart.format("yyyy-MM-dd HH:mm:ss"),timeEnd:tmEnd.format("yyyy-MM-dd HH:mm:ss"),timeFormat:tmFmt},cacheData=BeopCache.ds.getBatch(ids,tmFmt,tmStart,tmEnd);ids.length>0?WebAPI.post("/analysis/startWorkspaceDataGenHistogram",postData).done(function(result){var data=JSON.parse(result);return data.error&&data.error.length>0?(target.errAlert(data.error),void target.spinnerStop()):(BeopCache.ds.set(data,tmFmt,tmStart,tmEnd),null!==cacheData&&(data={list:data.list.concat(cacheData.list),timeShaft:data.timeShaft}),void target.renderModal(data))}).error(function(e){_this.paneCenter.spinnerStop(),_this.alertNoData()}):(target.spinnerStop(),target.renderModal(cacheData))},getDSItemDataMulti:function(target,arrDSItemIds){function getCurrentMonthLastDay(date){var current=new Date(date),currentMonth=current.getMonth(),nextMonth=++currentMonth,nextMonthDayOne=new Date(current.getFullYear(),nextMonth,1);return new Date(nextMonthDayOne.getTime())}function isLeapYear(year){return year%400==0||year%4==0&&year%100!=0}function getMonthDays(year,month){return[31,null,31,30,31,30,31,31,30,31,30,31][month]||(isLeapYear(year)?29:28)}function getWeekNumber(date){for(var now=new Date(date),year=now.getFullYear(),month=now.getMonth(),days=now.getDate(),i=0;month>i;i++)days+=getMonthDays(year,i);var yearFirstDay=new Date(year,0,1).getDay()||7,week=null;return 1==yearFirstDay?week=Math.ceil(days/yearFirstDay):(days-=7-yearFirstDay+1,week=Math.ceil(days/7)+1),week}var _this=this.m_parent;_this.curModal.arrComparePeriodLabel=[];var tmStart=_this.curModal.startTime;tmStart=tmStart.length<=10?tmStart+" 00:00:00":tmStart;var tmEnd=_this.curModal.endTime;tmEnd=tmEnd.length<=10?tmEnd+" 00:00:00":tmEnd;var period1,period2,time,tmFmt=_this.curModal.format,comparePeriod=_this.curModal.comparePeriod,startDate=new Date(tmStart),endDate=new Date(tmEnd);"hour"==comparePeriod&&(time=36e5,period1=new Date(startDate.getTime()+time).format("yyyy-MM-dd HH:mm:ss"),period2=new Date(endDate.getTime()+time).format("yyyy-MM-dd HH:mm:ss"),_this.curModal.arrComparePeriodLabel.push(startDate.getFullYear()+"年"+(startDate.getMonth()+1)+"月"+startDate.getDate()+"日"+startDate.getHours()+":00"),_this.curModal.arrComparePeriodLabel.push(endDate.getFullYear()+"年"+(endDate.getMonth()+1)+"月"+endDate.getDate()+"日"+endDate.getHours()+":00")),"day"==comparePeriod&&(time=864e5,period1=new Date(startDate.getTime()+time).format("yyyy-MM-dd HH:mm:ss"),period2=new Date(endDate.getTime()+time).format("yyyy-MM-dd HH:mm:ss"),_this.curModal.arrComparePeriodLabel.push(startDate.getFullYear()+"年"+(startDate.getMonth()+1)+"月"+startDate.getDate()+"日"),_this.curModal.arrComparePeriodLabel.push(endDate.getFullYear()+"年"+(endDate.getMonth()+1)+"月"+endDate.getDate()+"日")),"week"==comparePeriod&&(time=6048e5,period1=new Date(startDate.getTime()+time).format("yyyy-MM-dd HH:mm:ss"),period2=new Date(endDate.getTime()+time).format("yyyy-MM-dd HH:mm:ss"),_this.curModal.arrComparePeriodLabel.push(startDate.getFullYear()+"年第"+getWeekNumber(tmStart)+"周"),_this.curModal.arrComparePeriodLabel.push(endDate.getFullYear()+"年第"+getWeekNumber(tmEnd)+"周")),"month"==comparePeriod&&(period1=getCurrentMonthLastDay(tmStart),period2=getCurrentMonthLastDay(tmEnd),_this.curModal.arrComparePeriodLabel.push(startDate.getFullYear()+"年"+(startDate.getMonth()+1)+"月"),_this.curModal.arrComparePeriodLabel.push(endDate.getFullYear()+"年"+(endDate.getMonth()+1)+"月"));var postData=[{dsItemIds:arrDSItemIds,timeStart:tmStart.format("yyyy-MM-dd HH:mm:ss"),timeEnd:period1.format("yyyy-MM-dd HH:mm:ss"),timeFormat:tmFmt},{dsItemIds:arrDSItemIds,timeStart:tmEnd.format("yyyy-MM-dd HH:mm:ss"),timeEnd:period2.format("yyyy-MM-dd HH:mm:ss"),timeFormat:tmFmt}],ItemKey="anal_"+tmFmt+"_"+arrDSItemIds[0];WebAPI.post("/analysis/startWorkspaceDataGenHistogramMulti",postData).done(function(result){var data=JSON.parse(result);return data.error&&data.error.length>0?(target.errAlert(data.error),void target.spinnerStop()):(sessionStorage.setItem(ItemKey,result),void target.renderModal(data))}).error(function(e){_this.paneCenter.spinnerStop(),_this.alertNoData()})},getShowNameFromFormula:function(formula){var _this=this,inputStr=formula,nStart=inputStr.indexOf("<%"),nEnd=inputStr.indexOf("%>");if(-1==nStart||-1==nEnd)return inputStr;var id=inputStr.substring(nStart+2,nEnd);if(""==id)return _this.getShowNameFromFormula(inputStr);var retVal=_this.getDSItemById(id);return null==retVal?_this.getShowNameFromFormula(inputStr):(inputStr=inputStr.replace("<%"+id+"%>",retVal.value),_this.getShowNameFromFormula(inputStr))},addNewGroup:function(){var groupName=$("#inputAddGroup").val();if(""!=groupName){var _this=this,postData={groupId:"",name:groupName,parent:"",userId:AppConfig.userId};WebAPI.post("/datasource/saveDataSourceGroup",postData).done(function(result){var data=JSON.parse(result);if(void 0!=data){var groupId=data.groupId;if(24==groupId.length){for(var bIsFind=!1,i=0,len=_this.m_allGroupList.length;len>i;i++)if(groupId===_this.m_allGroupList[i].id){bIsFind=!0;break}if(!bIsFind){_this.m_allGroupList.push({id:groupId,name:data.groupName});var baseGroup=$("#groupEmpty").prev();_this.insertTreeGroup(data.groupId,data.groupName,1,baseGroup),$("#"+data.groupId).find(".dsTreeHeader").click()}$("#inputAddGroup").val("")}}}).fail(function(result){}).always(function(e){})}}},DataSource}();
(function(root,factory){if(typeof exports=='object')module.exports=factory()
else if(typeof define=='function'&&define.amd)define(factory)
else root.LoadingSpinner=factory()}
(this,function(){"use strict";var prefixes=['webkit','Moz','ms','O'],animations={},useCssAnimations;function createEl(tag,prop){var el=document.createElement(tag||'div'),n;for(n in prop)el[n]=prop[n]
return el}
function ins(parent){for(var i=1,n=arguments.length;i<n;i++)
parent.appendChild(arguments[i])
return parent}
var sheet=(function(){var el=createEl('style',{type:'text/css'})
ins(document.getElementsByTagName('head')[0],el)
return el.sheet||el.styleSheet}())
function addAnimation(alpha,trail,i,lines){var name=['opacity',trail,~~(alpha*100),i,lines].join('-'),start=0.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf('Animation')).toLowerCase(),pre=prefix&&'-'+prefix+'-'||''
if(!animations[name]){sheet.insertRule('@'+pre+'keyframes '+name+'{'+'0%{opacity:'+z+'}'+
start+'%{opacity:'+alpha+'}'+
(start+0.01)+'%{opacity:1}'+
(start+trail)%100+'%{opacity:'+alpha+'}'+'100%{opacity:'+z+'}'+'}',sheet.cssRules.length)
animations[name]=1}
return name}
function vendor(el,prop){var s=el.style,pp,i
prop=prop.charAt(0).toUpperCase()+prop.slice(1)
for(i=0;i<prefixes.length;i++){pp=prefixes[i]+prop
if(s[pp]!==undefined)return pp}
if(s[prop]!==undefined)return prop}
function css(el,prop){for(var n in prop)
el.style[vendor(el,n)||n]=prop[n]
return el}
function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i]
for(var n in def)
if(obj[n]===undefined)obj[n]=def[n]}
return obj}
function pos(el){var o={x:el.offsetLeft,y:el.offsetTop}
while((el=el.offsetParent))
o.x+=el.offsetLeft,o.y+=el.offsetTop
return o}
function getColor(color,idx){return typeof color=='string'?color:color[idx%color.length]}
var defaults={lines:12,length:10,width:5,radius:15,rotate:0,corners:1,color:'#000',direction:1,speed:1,trail:100,opacity:1/4,fps:20,zIndex:1001,className:'spinner',top:'50%',left:'50%',position:'absolute'}
function LoadingSpinner(o){this.opts=merge(o||{},LoadingSpinner.defaults,defaults)}
LoadingSpinner.defaults={}
merge(LoadingSpinner.prototype,{spin:function(target){this.stop()
this.opts.target=target;var divMask=document.createElement("div");divMask.className="spinnerMask";divMask.style.width=target.width;divMask.style.height=target.height;target.appendChild(divMask);this.divMask=divMask;var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex}),mid=o.radius+o.length+o.width
css(el,{left:o.left,top:o.top})
if(target){target.insertBefore(el,target.firstChild||null)}
el.setAttribute('role','progressbar')
self.lines(el,self.opts)
if(!useCssAnimations){var i=0,start=(o.lines-1)*(1-o.direction)/2,alpha,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;(function anim(){i++;for(var j=0;j<o.lines;j++){alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity)
self.opacity(el,j*o.direction+start,alpha,o)}
self.timeout=self.el&&setTimeout(anim,~~(1000/fps))})()}
return self},stop:function(){var el=this.el
if(el){clearTimeout(this.timeout)
if(el.parentNode)el.parentNode.removeChild(el)
this.el=undefined
if(this.divMask){if(this.divMask.parentNode)this.divMask.parentNode.removeChild(this.divMask)
this.el=undefined}}
return this},lines:function(el,o){var i=0,start=(o.lines-1)*(1-o.direction)/2,seg
function fill(color,shadow){return css(createEl(),{position:'absolute',width:(o.length+o.width)+'px',height:o.width+'px',background:color,boxShadow:shadow,transformOrigin:'left',transform:'rotate('+~~(360/o.lines*i+o.rotate)+'deg) translate('+o.radius+'px'+',0)',borderRadius:(o.corners*o.width>>1)+'px'})}
for(;i<o.lines;i++){seg=css(createEl(),{position:'absolute',top:1+~(o.width/2)+'px',transform:o.hwaccel?'translate3d(0,0,0)':'',opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,start+i*o.direction,o.lines)+' '+1/o.speed+'s linear infinite'})
if(o.shadow)ins(seg,css(fill('#000','0 0 4px '+'#000'),{top:2+'px'}))
ins(el,ins(seg,fill(getColor(o.color,i),'0 0 1px rgba(0,0,0,.1)')))}
return el},opacity:function(el,i,val){if(i<el.childNodes.length)el.childNodes[i].style.opacity=val}})
function initVML(){function vml(tag,attr){return createEl('<'+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}
sheet.addRule('.spin-vml','behavior:url(#default#VML)')
LoadingSpinner.prototype.lines=function(el,o){var r=o.length+o.width,s=2*r
function grp(){return css(vml('group',{coordsize:s+' '+s,coordorigin:-r+' '+-r}),{width:s,height:s})}
var margin=-(o.width+o.length)*2+'px',g=css(grp(),{position:'absolute',top:margin,left:margin}),i
function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+'deg',left:~~dx}),ins(css(vml('roundrect',{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml('fill',{color:getColor(o.color,i),opacity:o.opacity}),vml('stroke',{opacity:0}))))}
if(o.shadow)
for(i=1;i<=o.lines;i++)
seg(i,-2,'progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)')
for(i=1;i<=o.lines;i++)seg(i)
return ins(el,g)}
LoadingSpinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild
o=o.shadow&&o.lines||0
if(c&&i+o<c.childNodes.length){c=c.childNodes[i+o];c=c&&c.firstChild;c=c&&c.firstChild
if(c)c.opacity=val}}}
var probe=css(createEl('group'),{behavior:'url(#default#VML)'})
if(!vendor(probe,'transform')&&probe.adj)initVML()
else useCssAnimations=vendor(probe,'animation')
return LoadingSpinner}));﻿var ScreenManager=(function(){var slice=Array.prototype.slice;var m_dictScreen={};var panPrjSel;var preScreenName,nowScreenName;var isMobile=false;if(navigator.userAgent.match(/iP(ad|hone|od)|Android|Version/i))isMobile=true;if(!isMobile&&window.history&&history.replaceState){$(window).on("popstate",function(event){var curId=location.hash;if(Boolean(curId)){curId=curId.substring(1,curId.length);if(Boolean(m_dictScreen[curId])){preScreenName=nowScreenName;nowScreenName=m_dictScreen[curId].name;if('PaneProjectSelector'==preScreenName&&'PaneProjectSelector'!=nowScreenName){if(Boolean(panPrjSel)&&Boolean(AppConfig.projectId)){panPrjSel.initProject(AppConfig.projectId,AppConfig.projectName,AppConfig.projectShowName,m_dictScreen[curId].navSelPageId);}}
else{var navLi=$('#ulPages').children('li');if(Boolean(navLi)&&navLi.length){navLi.filter('.active').attr('class','');var navBtnA=navLi.children('a');for(var i=0,len=navBtnA.length;i<len;i++){var item=navBtnA.eq(i);if(item.attr('pageid')==m_dictScreen[curId].navSelPageId){item.closest('li').attr('class','active');break;}}}}
m_dictScreen[curId].screen.show();}}
else{m_dictScreen={};location.href=location.origin;}});}
function ScreenManager(){};ScreenManager.show=function(){if(arguments.length===0){return;}
var screenClass=arguments[0];if(typeof screenClass!=='function'){return;}
var screenObj=Object.create(screenClass.prototype);if(ScreenCurrent){window.onresize=null;if(ScreenCurrent.close()===false){return;}}
ScreenCurrent=(screenClass.apply(screenObj,slice.call(arguments,1))||screenObj);if(ScreenCurrent.onresize)window.onresize=ScreenCurrent.onresize;ScreenCurrent.show();if(!isMobile&&'IndexScreen'!=screenClass.name){nowScreenName=screenClass.name;var navSelPageId=Boolean(arguments[1])?arguments[1]:null;var id=+new Date();location.hash=id;m_dictScreen[id]={'screen':ScreenCurrent,'name':screenClass.name,'navSelPageId':navSelPageId};history.replaceState(null,'',window.location.href);}
if('PaneProjectSelector'==screenClass.name&&Boolean(ScreenCurrent)){panPrjSel=ScreenCurrent;}};ScreenManager.clearHistory=function(){if(isMobile)return;m_dictScreen={};location.hash='';};return ScreenManager;})();﻿
var beop=beop||{};beop.constant={project_img_path:'/static/images/project_img/',project_default_img:'default.jpg'};var ObjectId=function(){var hex8=('00000000'+Math.floor(Math.random()*0xFFFFFFFF).toString(16)).slice(-8);var userId=('000'+(AppConfig.userId||'000')).slice(-3);var timestamp=new Date().valueOf();return hex8+userId+timestamp;};var FullScreenManager=(function(){var manager=Object.create({init:function(){var _this=this;$(document).off('webkitfullscreenchange');$(document).on('webkitfullscreenchange',function(){var isFullScreen=!!document.webkitFullscreenElement;if(isFullScreen){_this.onFullScreenEnter();}else{_this.onFullScreenOut();}});$(document).off('mozfullscreenchange');$(document).on('mozfullscreenchange',function(){var isFullScreen=!!document.webkitFullscreenElement;if(isFullScreen){_this.onFullScreenEnter();}else{_this.onFullScreenOut();}});$(document).off('msfullscreenchange');$(document).on('msfullscreenchange',function(){var isFullScreen=!!document.webkitFullscreenElement;if(isFullScreen){_this.onFullScreenEnter();}else{_this.onFullScreenOut();}});if(typeof onError==='function'){$(document).off('webkitfullscreenerror');$(document).on('webkitfullscreenerror',this.onFullScreenError);$(document).off('mozfullscreenerror');$(document).on('mozfullscreenerror',this.onFullScreenError);$(document).off('msfullscreenerror');$(document).on('msfullscreenerror',this.onFullScreenError);}},onFullScreenEnter:function(){},onFullScreenOut:function(){},onFullScreenError:function(){},toggle:function(){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen();}else if(document.documentElement.msRequestFullscreen){document.documentElement.msRequestFullscreen();}else if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen();}else if(document.documentElement.webkitRequestFullscreen){document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);}}else{if(document.exitFullscreen){document.exitFullscreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}}}});manager.init();return manager;}());function StringBuilder(){this.data=Array("");}
StringBuilder.prototype.append=function(){this.data.push(arguments[0]);return this;};StringBuilder.prototype.toString=function(){return this.data.join("");};StringBuilder.prototype.getLength=function(){return this.data.length;};if(!String.prototype.format){String.prototype.format=function(){if(arguments[0]===undefined){return'';}
if(arguments[0].constructor===Array){var args=arguments[0];}else{var args=arguments;}
return this.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!='undefined'?args[number]:match;});};}
if(!String.prototype.formatEL){String.prototype.formatEL=function(o){var str=this.toString();if(!str||!o)return'';for(var p in o){if(o.hasOwnProperty(p)){str=str.replace(new RegExp('{'+p+'}','g'),o[p]);}}
return str;};}
String.prototype.toDate=function(){var str=this;if(str.indexOf('-')>-1)
str=str.replace('-','/').replace('-','/');return new Date(str);}
Number.prototype.toDate=function(){return new Date(this);};function Alert(targetElement,type,msg){this.element=targetElement;this.str=new StringBuilder();this.str.append('<div class="alert alert-').append(type).append(' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>').append('<div class="alert-msg">'+msg+'</div>').append('</div>');this.$alert=$(this.str.toString());}
Alert.danger=function(targetElement,msg){return new Alert(targetElement,Alert.type.danger,msg).show();};Alert.warning=function(targetElement,msg){return new Alert(targetElement,Alert.type.warning,msg).show();};Alert.success=function(targetElement,msg){return new Alert(targetElement,Alert.type.success,msg).show();};Alert.info=function(targetElement,msg){return new Alert(targetElement,Alert.type.info,msg).show();};Alert.type={danger:'danger',warning:'warning',success:'success',info:'info'};Alert.prototype.show=function(duration){if(duration){var _this=this;setTimeout(function(){_this.close();},duration);}
$(this.element).append(this.$alert);return this;};Alert.prototype.close=function(){var _this=this;this.$alert.fadeOut(3000,function(){_this.$alert.remove();_this=null;});};Alert.prototype.setMessage=function(msg){if(!msg){return false}
this.$alert.find('.alert-msg').text(msg);};Alert.prototype.setStyle=function(style){if(style&&typeof style!=='string'){this.$alert.css(style);}
return this;};Alert.prototype.showAtTop=function(duration){this.setStyle({position:'absolute',top:0,left:0,right:0,margin:'auto',width:'50%',textAlign:'center'})
this.show(duration);};function showDialog(url){return WebAPI.get(url).done(function(resultHtml){$("#dialogContent").html(resultHtml);$('#dialogModal').modal({});});}
function clone(obj){if(obj==null||typeof(obj)!='object')
return obj;var temp=obj.constructor();for(var key in obj){if(obj.hasOwnProperty(key)){temp[key]=clone(obj[key]);}}
return temp;}
Date.prototype.format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};var week={"0":"/u65e5","1":"/u4e00","2":"/u4e8c","3":"/u4e09","4":"/u56db","5":"/u4e94","6":"/u516d"};if(/(y+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));}
if(/(E+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,((RegExp.$1.length>1)?(RegExp.$1.length>2?"/u661f/u671f":"/u5468"):"")+week[this.getDay()+""]);}
for(var k in o){if(new RegExp("("+k+")").test(fmt)){fmt=fmt.replace(RegExp.$1,(RegExp.$1.length==1)?(o[k]):(("00"+o[k]).substr((""+o[k]).length)));}}
return fmt;}
var DateUtil=(function(){var dateLocale={month:{en:{month_names:['January','February','March','April','May','June','July','August','September','October','November','December'],month_names_short:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']},zh:{month_names:['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'],month_names_short:['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月']}}};function getWeekNumber(d){d=new Date(+d);d.setHours(0,0,0);d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1);var weekNo=Math.ceil((((d-yearStart)/86400000)+1)/7)
return[d.getFullYear(),weekNo];}
function getLastWeekNumberOf(y,w){w-=1;if(w===0){y=y-1;w=52;}
return[y,w];}
function getNextWeekNumberOf(y,w){w+=1;if(w===53){y+=1;w=1;}
return[y,w];}
function isLeapYear(y){if(Object.prototype.toString.call(y)==='[object Date]'){y=y.getUTCFullYear();}
return((y%4===0)&&(y%100!==0))||(y%400===0);}
function daysInMonth(dt){var m=dt.getUTCMonth();if(m===1){return isLeapYear(dt)?29:28;}
return[31,28,31,30,31,30,31,31,30,31,30,31][m];}
function getFirstDayOfWeek(year,week){var d=new Date(year,0,1),offset=d.getTimezoneOffset();d.setDate(d.getDate()+4-(d.getDay()||7));d.setTime(d.getTime()+7*24*60*60*1000*(week+(year==d.getFullYear()?-1:0)));d.setTime(d.getTime()
+(d.getTimezoneOffset()-offset)*60*1000);d.setDate(d.getDate()-3);return d;}
function getDateRangeOnWeekNumber(year,week){if(!year||!week){return;}
var firstDay=getFirstDayOfWeek(year,week),lastDay=new Date(firstDay);lastDay.setDate(firstDay.getDate()+6);return[firstDay,lastDay];}
function getMonthName(index,language){var monthList=language&&language in dateLocale.month?dateLocale.month[language].month_names:dateLocale.month['en'].month_names;return monthList[index];}
function getMonthNameShort(index,language){var monthList=language&&language in dateLocale.month?dateLocale.month[language].month_names_short:dateLocale.month['en'].month_names_short;return monthList[index];}
function getLastMonth(currentMonth){if(!currentMonth){currentMonth=new Date().getMonth()+1;}
if(currentMonth===1){return 12;}else{return currentMonth-1;}}
function getNextMonth(currentMonth){if(!currentMonth){currentMonth=new Date().getMonth()+1;}
if(currentMonth===12){return 1;}else{return currentMonth+1;}}
function getRelativeDateInfo(date1,date2){var now=new Date();var lang=I18n.type;var value1,value2,ts,info;if(!date1&&!date2)return'';value1=(date1||now).valueOf();value2=(date2||now).valueOf();ts=Math.floor(Math.abs(value1-value2)/1000);switch(true){case ts<60:info=ts+(ts===1?' second':' seconds');break;case ts<60*60:ts=Math.floor(ts/60);info=ts+(ts===1?' minute':' minutes');break;case ts<60*60*24:ts=Math.floor(ts/(60*60));info=ts+(ts===1?' hour':' hours');break;case ts<60*60*24*365:ts=Math.floor(ts/(60*60*24));info=ts+(ts===1?' day':' days');break;default:ts=Math.floor(ts/(60*60*24*365));info=ts+(ts===1?' year':' years');break;}
info+=value1>value2?' ago':' later';if(lang==='zh'){info=info.replace(/\s(seconds?|minutes?|hours?|days?|years?)\s(ago|later)$/,function($0,$1,$2){var rs='';if($1.indexOf('second')>-1)rs+='秒钟';if($1.indexOf('minute')>-1)rs+='分钟';if($1.indexOf('hour')>-1)rs+='小时';if($1.indexOf('day')>-1)rs+='天';if($1.indexOf('year')>-1)rs+='年';if($2==='ago')rs+='前';if($2==='later')rs+='后';return rs;});}
return info;}
return{getWeekNumber:getWeekNumber,isLeapYear:isLeapYear,daysInMonth:daysInMonth,getLastWeekNumberOf:getLastWeekNumberOf,getNextWeekNumberOf:getNextWeekNumberOf,getDateRangeOnWeekNumber:getDateRangeOnWeekNumber,getFirstDayOfWeek:getFirstDayOfWeek,getMonthName:getMonthName,getMonthNameShort:getMonthNameShort,getLastMonth:getLastMonth,getNextMonth:getNextMonth,getRelativeDateInfo:getRelativeDateInfo}})();var StringUtil=(function(){var HTML_ENTITIES={'&':'&amp;','>':'&gt;','<':'&lt;','"':'&quot;',"'":'&#39;','`':'&#x60;'},HTML_ENTITIES_INVERT=invert(HTML_ENTITIES);function invert(obj){var result={},keys=Object.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i];}
return result;};function padLeft(oldStr,padNum,padStr){if(!padStr){return oldStr;}
return Array(padNum-String(oldStr).length+1).join(padStr)+oldStr;}
function htmlEscape(text){if(!text){return text}
var source='(?:'+Object.keys(HTML_ENTITIES).join('|')+')',replaceRegexp=RegExp(source,'g');return text.replace(replaceRegexp,function(character){return HTML_ENTITIES[character];});}
function htmlUnEscape(text){if(!text){return text}
var source='(?:'+Object.keys(HTML_ENTITIES_INVERT).join('|')+')',replaceRegexp=RegExp(source,'g');return text.replace(replaceRegexp,function(character){return HTML_ENTITIES_INVERT[character];});}
var getI18nProjectName=function(project){if(!I18n||!project){return'';}
var result='';switch(I18n.type){case'en':{result=project.name_english;break;}
case'zh':{result=project.name_cn;break;}
default:{result=project.name_english;}}
return result||'';};return{padLeft:padLeft,htmlEscape:htmlEscape,htmlUnEscape:htmlUnEscape,getI18nProjectName:getI18nProjectName}})();var BEOPUtil=(function(){var jsType={function:typeof $.noop,number:typeof 0,string:typeof'',undefined:typeof undefined};var projectImgPath=beop.constant.project_img_path;var setRelativePosition=function($obj,$target,topOffset,leftOffset){var offset=$obj.offset();var topOffset=topOffset||10;var leftOffset=leftOffset||5;var top=offset.top+topOffset;var left=offset.left+$obj.width()+leftOffset;$target.css({"left":left,"top":top});};var projectDefaultImgPath=projectImgPath+beop.constant.project_default_img;var getProjectImgPath=function(project){if(!project){return;}else{return project.pic?projectImgPath+project.pic:projectDefaultImgPath;}};function getFunctionName(func){if(!func||typeof func!=jsType.function){return'';}
var ret=func.toString();ret=ret.substr('function '.length);ret=ret.substr(0,ret.indexOf('('));return ret;}
function isUndefined(obj){return typeof obj===jsType.undefined;}
return{setRelativePosition:setRelativePosition,getProjectImgPath:getProjectImgPath,getFunctionName:getFunctionName,isUndefined:isUndefined}})();(function(){var beop_tmpl_cache={};this.beopTmpl=function tmpl(str,data){var fn=!/\W/.test(str)?beop_tmpl_cache[str]=beop_tmpl_cache[str]||tmpl(document.getElementById(str).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+
str.replace(/[\r\t\n]/g," ").split(/<!/).join("\t").replace(/((^|!>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)!>/g,"',$1,'").split("\t").join("');").split(/!>/).join("p.push('").split("\r").join("\\'")
+"');}return p.join('');");return data?fn(data):fn;};})();var SidebarMenuEffect=(function(){function SidebarMenuEffect(){}
SidebarMenuEffect.prototype.init=function(center,left,right){var _this=this;this.$paneCt=$(center);this.$leftBtn=$(center).find('#leftCt');this.$rightBtn=$(center).find('#rightCt');var container=document.getElementById('st-container'),buttons=Array.prototype.slice.call(document.querySelectorAll('.sideTrans')),refresh=function(){var leftCol=0,rightCol=0,centerCol=0;var leftArrow='<span class="glyphicon glyphicon-chevron-left"></span>';var rightArrow='<span class="glyphicon glyphicon-chevron-right"></span>';if(_this.$leftBtn.length>0){if(container.className.indexOf('st-effect-7')>0){var prev=_this.$paneCt.prev('div')[0];if(prev&&prev.className.indexOf('col-')>-1){leftCol=parseInt(prev.classList[0].split('-')[2]);}else{leftCol=0;}
_this.$leftBtn.removeClass('leftCtClose').addClass('leftCtOpen').html(leftArrow);}else{leftCol=0;_this.$leftBtn.removeClass('leftCtOpen').addClass('leftCtClose').html(rightArrow);}}
if(_this.$rightBtn.length>0){if(container.className.indexOf('st-effect-1')>0){var next=_this.$paneCt.next('div')[0];if(next&&next.className.indexOf('col-')>-1){rightCol=parseInt(next.classList[0].split('-')[2]);}else{rightCol=0;}
_this.$rightBtn.removeClass('rightCtClose').addClass('rightCtOpen').html(rightArrow);}else{rightCol=0;_this.$rightBtn.removeClass('rightCtOpen').addClass('rightCtClose').html(leftArrow);}}
centerCol=12-leftCol-rightCol;_this.$paneCt.removeClass().addClass('col-sm-'+centerCol+' st-content');};buttons.forEach(function(el,i){var effect=el.getAttribute('data-effect');el.addEventListener('click',function(ev){var target=ev.target.getAttribute('data-effect')!=null?ev.target.getAttribute('data-effect'):ev.target.parentNode.getAttribute('data-effect');var stCtClass=document.getElementById('st-container').className;if(stCtClass.indexOf(target)<0){ev.stopPropagation();ev.preventDefault();container.classList.add(effect);setTimeout(function(){if($(container.children[0]).children('div').length==3){container.classList.add('st-menu-open');}
refresh();},250);}else{container.classList.remove(target)
refresh();}});});}
return SidebarMenuEffect;})();(function(window){{var unknown='-';var screenSize='';if(screen.width){var width=(screen.width)?screen.width:'';var height=(screen.height)?screen.height:'';screenSize+=''+width+" x "+height;}
var nVer=navigator.appVersion;var nAgt=navigator.userAgent;var browser=navigator.appName;var version=''+parseFloat(navigator.appVersion);var majorVersion=parseInt(navigator.appVersion,10);var nameOffset,verOffset,ix;if((verOffset=nAgt.indexOf('Opera'))!=-1){browser='Opera';version=nAgt.substring(verOffset+6);if((verOffset=nAgt.indexOf('Version'))!=-1){version=nAgt.substring(verOffset+8);}}
else if((verOffset=nAgt.indexOf('MSIE'))!=-1){browser='Microsoft Internet Explorer';version=nAgt.substring(verOffset+5);}
else if((verOffset=nAgt.indexOf('Chrome'))!=-1){browser='Chrome';version=nAgt.substring(verOffset+7);}
else if((verOffset=nAgt.indexOf('Safari'))!=-1){browser='Safari';version=nAgt.substring(verOffset+7);if((verOffset=nAgt.indexOf('Version'))!=-1){version=nAgt.substring(verOffset+8);}}
else if((verOffset=nAgt.indexOf('Firefox'))!=-1){browser='Firefox';version=nAgt.substring(verOffset+8);}
else if(nAgt.indexOf('Trident/')!=-1){browser='Microsoft Internet Explorer';version=nAgt.substring(nAgt.indexOf('rv:')+3);}
else if((nameOffset=nAgt.lastIndexOf(' ')+1)<(verOffset=nAgt.lastIndexOf('/'))){browser=nAgt.substring(nameOffset,verOffset);version=nAgt.substring(verOffset+1);if(browser.toLowerCase()==browser.toUpperCase()){browser=navigator.appName;}}
if((ix=version.indexOf(';'))!=-1)version=version.substring(0,ix);if((ix=version.indexOf(' '))!=-1)version=version.substring(0,ix);if((ix=version.indexOf(')'))!=-1)version=version.substring(0,ix);majorVersion=parseInt(''+version,10);if(isNaN(majorVersion)){version=''+parseFloat(navigator.appVersion);majorVersion=parseInt(navigator.appVersion,10);}
var mobile=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(nVer);var cookieEnabled=(navigator.cookieEnabled)?true:false;if(typeof navigator.cookieEnabled=='undefined'&&!cookieEnabled){document.cookie='testcookie';cookieEnabled=(document.cookie.indexOf('testcookie')!=-1)?true:false;}
var os=unknown;var clientStrings=[{s:'Windows 3.11',r:/Win16/},{s:'Windows 95',r:/(Windows 95|Win95|Windows_95)/},{s:'Windows ME',r:/(Win 9x 4.90|Windows ME)/},{s:'Windows 98',r:/(Windows 98|Win98)/},{s:'Windows CE',r:/Windows CE/},{s:'Windows 2000',r:/(Windows NT 5.0|Windows 2000)/},{s:'Windows XP',r:/(Windows NT 5.1|Windows XP)/},{s:'Windows Server 2003',r:/Windows NT 5.2/},{s:'Windows Vista',r:/Windows NT 6.0/},{s:'Windows 7',r:/(Windows 7|Windows NT 6.1)/},{s:'Windows 8.1',r:/(Windows 8.1|Windows NT 6.3)/},{s:'Windows 8',r:/(Windows 8|Windows NT 6.2)/},{s:'Windows NT 4.0',r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:'Windows ME',r:/Windows ME/},{s:'Android',r:/Android/},{s:'Open BSD',r:/OpenBSD/},{s:'Sun OS',r:/SunOS/},{s:'Linux',r:/(Linux|X11)/},{s:'iOS',r:/(iPhone|iPad|iPod)/},{s:'Mac OS X',r:/Mac OS X/},{s:'Mac OS',r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:'QNX',r:/QNX/},{s:'UNIX',r:/UNIX/},{s:'BeOS',r:/BeOS/},{s:'OS/2',r:/OS\/2/},{s:'Search Bot',r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var id in clientStrings){var cs=clientStrings[id];if(cs.r.test(nAgt)){os=cs.s;break;}}
var osVersion=unknown;if(/Windows/.test(os)){osVersion=/Windows (.*)/.exec(os)[1];os='Windows';}
switch(os){case'Mac OS X':osVersion=/Mac OS X (10[\.\_\d]+)/.exec(nAgt)[1];break;case'Android':osVersion=/Android ([\.\_\d]+)/.exec(nAgt)[1];break;case'iOS':osVersion=/OS (\d+)_(\d+)_?(\d+)?/.exec(nVer);osVersion=osVersion[1]+'.'+osVersion[2]+'.'+(osVersion[3]|0);break;}}
window.jscd={screen:screenSize,browser:browser,browserVersion:version,mobile:mobile,os:os,osVersion:osVersion,cookies:cookieEnabled};}(this));var getWysiwyg=function(hasEditor){hasEditor=hasEditor===undefined?true:hasEditor;var wysiwyg='\
        <div class="btn-toolbar" data-role="editor-toolbar" data-target="#editor">\
          <div class="btn-group">\
            <a class="btn dropdown-toggle" data-toggle="dropdown" title="Font" data-original-title="Font"><i class="icon-font"></i><b class="caret"></b></a>\
              <ul class="dropdown-menu">\
              <li><a data-edit="fontName Serif" style="font-family:\'Serif\'">Serif</a></li><li><a data-edit="fontName Sans" style="font-family:\'Sans\'">Sans</a></li><li><a data-edit="fontName Arial" style="font-family:\'Arial\'">Arial</a></li><li><a data-edit="fontName Arial Black" style="font-family:\'Arial Black\'">Arial Black</a></li><li><a data-edit="fontName Courier" style="font-family:\'Courier\'">Courier</a></li><li><a data-edit="fontName Courier New" style="font-family:\'Courier New\'">Courier New</a></li><li><a data-edit="fontName Comic Sans MS" style="font-family:\'Comic Sans MS\'">Comic Sans MS</a></li><li><a data-edit="fontName Helvetica" style="font-family:\'Helvetica\'">Helvetica</a></li><li><a data-edit="fontName Impact" style="font-family:\'Impact\'">Impact</a></li><li><a data-edit="fontName Lucida Grande" style="font-family:\'Lucida Grande\'">Lucida Grande</a></li><li><a data-edit="fontName Lucida Sans" style="font-family:\'Lucida Sans\'">Lucida Sans</a></li><li><a data-edit="fontName Tahoma" style="font-family:\'Tahoma\'">Tahoma</a></li><li><a data-edit="fontName Times" style="font-family:\'Times\'">Times</a></li><li><a data-edit="fontName Times New Roman" style="font-family:\'Times New Roman\'">Times New Roman</a></li><li><a data-edit="fontName Verdana" style="font-family:\'Verdana\'">Verdana</a></li></ul>\
            </div>\
          <div class="btn-group">\
            <a class="btn dropdown-toggle" data-toggle="dropdown" title="Font Size" data-original-title="Font Size"><i class="icon-text-height"></i>&nbsp;<b class="caret"></b></a>\
              <ul class="dropdown-menu">\
              <li><a data-edit="fontSize 5"><font size="5">Huge</font></a></li>\
              <li><a data-edit="fontSize 3"><font size="3">Normal</font></a></li>\
              <li><a data-edit="fontSize 1"><font size="1">Small</font></a></li>\
              </ul>\
          </div>\
          <div class="btn-group">\
            <a class="btn" data-edit="bold" title="Bold (Ctrl/Cmd+B)" data-original-title="Bold (Ctrl/Cmd+B)"><i class="icon-bold"></i></a>\
            <a class="btn" data-edit="italic" title="Italic (Ctrl/Cmd+I)" data-original-title="Italic (Ctrl/Cmd+I)"><i class="icon-italic"></i></a>\
            <a class="btn" data-edit="strikethrough" title="Strikethrough" data-original-title="Strikethrough"><i class="icon-strikethrough"></i></a>\
            <a class="btn" data-edit="underline" title="Underline (Ctrl/Cmd+U)" data-original-title="Underline (Ctrl/Cmd+U)"><i class="icon-underline"></i></a>\
          </div>\
          <div class="btn-group">\
            <a class="btn" data-edit="insertunorderedlist" title="Bullet list" data-original-title="Bullet list"><i class="icon-list-ul"></i></a>\
            <a class="btn" data-edit="insertorderedlist" title="Number list" data-original-title="Number list"><i class="icon-list-ol"></i></a>\
            <a class="btn" data-edit="outdent" title="Reduce indent" data-original-title="Reduce indent (Shift+Tab)"><i class="icon-indent-left"></i></a>\
            <a class="btn" data-edit="indent" title="Indent" data-original-title="Indent (Tab)"><i class="icon-indent-right"></i></a>\
          </div>\
          <div class="btn-group">\
            <a class="btn" data-edit="justifyleft" title="Align Left" data-original-title="Align Left (Ctrl/Cmd+L)"><i class="icon-align-left"></i></a>\
            <a class="btn" data-edit="justifycenter" title="Center" data-original-title="Center (Ctrl/Cmd+E)"><i class="icon-align-center"></i></a>\
            <a class="btn" data-edit="justifyright" title="Align Right" data-original-title="Align Right (Ctrl/Cmd+R)"><i class="icon-align-right"></i></a>\
            <a class="btn btn-info" data-edit="justifyfull" title="Justify" data-original-title="Justify (Ctrl/Cmd+J)"><i class="icon-align-justify"></i></a>\
          </div>\
          <div class="btn-group" style="display:none;">\
              <a class="btn dropdown-toggle" data-toggle="dropdown" title="Hyperlink" data-original-title="Hyperlink"><i class="icon-link"></i></a>\
                <div class="dropdown-menu input-append">\
                    <input class="span2" placeholder="URL" type="text" data-edit="createLink">\
                    <button class="btn" type="button">Add</button>\
            </div>\
            <a class="btn" data-edit="unlink" title="Remove Hyperlink" data-original-title="Remove Hyperlink"><i class="icon-cut"></i></a>\
          </div>\
          <div class="btn-group">\
            <a class="btn" title="Insert picture" id="pictureBtn" data-original-title="Insert picture (or just drag &amp; drop)"><i class="icon-picture"></i></a>\
            <input type="file" data-role="magic-overlay" data-target="#pictureBtn" data-edit="insertImage" style="opacity: 0; position: absolute; top: 0px; left: 0px; width: 41px; height: 30px;">\
          </div>\
          <div class="btn-group">\
            <a class="btn" data-edit="undo" title="Undo (Ctrl/Cmd+Z)" data-original-title="Undo (Ctrl/Cmd+Z)"><i class="icon-undo"></i></a>\
            <a class="btn" data-edit="redo" title="Redo (Ctrl/Cmd+Y)" data-original-title="Redo (Ctrl/Cmd+Y)"><i class="icon-repeat"></i></a>\
          </div>\
          <input type="text" data-edit="inserttext" id="voiceBtn" x-webkit-speech="" style="display: none;">\
        </div>';wysiwyg+=hasEditor?'<div id="editor" contenteditable="true" class="form-control gray-scrollbar">':'';wysiwyg+='</div>';return wysiwyg;}
﻿var WebAPI=(function(){var siteId;switch(window.location.hostname){case'beop.rnbtech.com.hk':siteId='b79c068f77198848e22fe79758836e53';break;case'beop6.rnbtech.com.hk':siteId='f1f6b2b9e6b64592c0b4cb5e9b8bd79e';break;case'beopdemo.rnbtech.com.hk':siteId='ac0df98f274d9a5980a571297248d80b';break;default:break;}
(function(){if(siteId){var hm=document.createElement("script");hm.src="//hm.baidu.com/hm.js?"+siteId;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);}})();var mockList={'/static/mock/analysis_workspace_saveLayout.json':/\/analysis\/workspace\/saveLayout\/\d+\/[01]/i,'/static/mock/analysis_template_get.json':/\/analysis\/template\/get\/\d+/i};function mock(url){var match=null;for(var i in mockList){match=url.match(mockList[i]);if(match!==null)return i;}
return url;}
function WebAPI(){}
WebAPI.isMock=false;$.ajaxSetup({dataFilter:function(result,type){if(result&&result.substring(2,7)=='error'){var data=JSON.parse(result);if(data.error=='token_invalid'){console.log(this.url+' ('+data.error+': code"'+data.msg+'")');if(confirm(i18n_resource.error.token[data.msg]+'. '+i18n_resource.error.relogin+'.')){location.reload();}
throw data.error;}}
return result;}});WebAPI.post=function(url,data,isMock){var mockUrl;isMock=isMock===undefined?WebAPI.isMock:isMock;if(isMock){mockUrl=mock(url);if(url!==mockUrl)return this.get(mockUrl,false);}
return $.ajax({url:url,type:'POST',data:JSON.stringify(data),contentType:'application/json'});};WebAPI.get=function(url,isMock){isMock=isMock===undefined?WebAPI.isMock:isMock;url=isMock?mock(url):url;if(_hmt&&url.indexOf('.html')>0)_hmt.push(['_trackPageview',url]);return $.ajax({url:url,type:'Get',contentType:'application/json'});};WebAPI.getHistoryDS=function(callback){};WebAPI.getHistory=function(callback){};return WebAPI;})();(function(){'use strict';var indexedDB=indexedDB||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(!indexedDB){return;}
function _initStorage(options){var _this=this;this._dbInfo=$.extend({db:null},options);var promise=$.Deferred();(function(){var _this=this;var dbInfo=this._dbInfo;var openreq=indexedDB.open(dbInfo.name,dbInfo.version);openreq.onerror=function(){promise.reject(openreq.error);};openreq.onsuccess=function(){dbInfo.db=openreq.result;promise.resolve();};openreq.onupgradeneeded=function(){var names=openreq.result.objectStoreNames;var length,key;var indexOf=([]).indexOf;if(indexOf.call(names,'cache')>-1){openreq.result.deleteObjectStore('cache');}
if(indexOf.call(names,'datasource')>-1){openreq.result.deleteObjectStore('datasource');}
if(indexOf.call(names,'thumbnail')>-1){openreq.result.deleteObjectStore('thumbnail');}
if(indexOf.call(names,'buffer')===-1){openreq.result.createObjectStore('buffer');}
openreq.result.createObjectStore('datasource');openreq.result.createObjectStore('thumbnail');for(var i=0,len=localStorage.length;i<len;i++){key=localStorage.key(i);if(key.indexOf('workSpacePicStorageEnable')===0){localStorage.removeItem(key);}}};}).call(this);}
function length(callback){var _this=this;var promise=$.Deferred();try{(function(){var dbInfo=_this._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,'readonly').objectStore(dbInfo.storeName);var req=store.count();req.onsuccess=function(){promise.resolve(req.result);};req.onerror=function(){promise.reject(req.error);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function getItem(key,callback){var _this=this;if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,'readonly').objectStore(dbInfo.storeName);var req=store.get(key);req.onsuccess=function(){var value=req.result;value=value===undefined?null:value;promise.resolve(value);};req.onerror=function(){promise.reject(req.error);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function getItemList(keyList,callback){var result={};var promise=this.iterate(function(key,value,i){if(keyList.indexOf(key)>-1){result[key]=value;}}).then(function(){return result;},function(){console.warn('getItemList error!');});excuteCallback(promise,callback);return promise;}
function setItem(key,value,callback){var _this=this;if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
var promise=$.Deferred();try{(function(){var dbInfo=_this._dbInfo;var transaction=dbInfo.db.transaction(dbInfo.storeName,'readwrite');var store=transaction.objectStore(dbInfo.storeName);var req=store.put(value,key);transaction.oncomplete=function(){promise.resolve();};transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;promise.reject(err);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function setItemList(kvList,callback){var promise=$.Deferred();try{(function(){var _this=this;var dbInfo=this._dbInfo;var transaction=dbInfo.db.transaction(dbInfo.storeName,'readwrite');var store=transaction.objectStore(dbInfo.storeName);var result={};kvList.forEach(function(kv,i){var key=kv.key,value=kv.value;if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
store.put(value,key);});transaction.oncomplete=function(){promise.resolve();};transaction.onabort=transaction.onerror=function(){var err=transaction.error;promise.reject(err);};}).call(this);}catch(e){console.warn('setItemList error!');promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function removeItem(key,callback){var _this=this;if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var transaction=dbInfo.db.transaction(dbInfo.storeName,'readwrite');var store=transaction.objectStore(dbInfo.storeName);var req=store.delete(key);transaction.oncomplete=function(){promise.resolve();};transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;promise.reject(err);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function removeItemList(keyList,callback){var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var transaction=dbInfo.db.transaction(dbInfo.storeName,'readwrite');var store=transaction.objectStore(dbInfo.storeName);var req=store.openCursor();req.onsuccess=function(){var cursor=req.result;var request;if(!cursor){promise.resolve();return;}
if(keyList.indexOf(cursor.key)>-1){cursor.delete();}
cursor.continue();};req.onerror=function(err){promise.reject(err);};}).call(this);}catch(e){promise.reject();}
excuteCallback(promise,callback);return promise;}
function clear(callback){var _this=this;var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var transaction=dbInfo.db.transaction(dbInfo.storeName,'readwrite');var store=transaction.objectStore(dbInfo.storeName);var req=store.clear();transaction.oncomplete=function(){promise.resolve();};transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;promise.reject(err);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function key(n,callback){var _this=this;var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,'readonly').objectStore(dbInfo.storeName);var req=store.openCursor();var advanced=false;req.onsuccess=function(){var cursor=req.result;if(!cursor){promise.resolve(null);return;}
if(n===0){promise.resolve(cursor.key);}else{if(!advanced){advanced=true;cursor.advance(n);}else{promise.resolve(cursor.key);}}};req.onerror=function(){promise.reject(req.error);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function keys(callback){var _this=this;var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,'readonly').objectStore(dbInfo.storeName);var keys=[];var req=store.openCursor();req.onsuccess=function(){var cursor=req.result;if(!cursor){promise.resolve(keys);return;}
keys.push(cursor.key);cursor.continue();};req.onerror=function(){promise.reject(req.error);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function iterate(iterator,callback){var _this=this;var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,'readonly').objectStore(dbInfo.storeName);var req=store.openCursor();var index=0;req.onsuccess=function(){var cursor=req.result;var result;if(!cursor){promise.resolve();return;}
result=iterator(cursor.key,cursor.value,index++);if(result===false){promise.resolve();return;}
cursor.continue();};req.onerror=function(){promise.reject(req.error);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function excuteCallback(promise,callback){if(typeof callback==='function'){promise.then(function(result){callback(null,result);},function(error){callback(erro);});}}
var indexDBWrapper={_driver:'indexedDBWrapper',_initStorage:_initStorage,length:length,getItem:getItem,getItemList:getItemList,setItem:setItem,setItemList:setItemList,removeItem:removeItem,removeItemList:removeItemList,clear:clear,key:key,keys:keys,iterate:iterate};this.Beop=this.Beop||{};this.Beop.cache=this.Beop.cache||{};this.Beop.cache.drivers=this.Beop.cache.drivers||{};this.Beop.cache.drivers.indexedDB=indexDBWrapper;}).call(this);(function($){'use strict';var localStorage;try{if(!this.localStorage||!('setItem'in this.localStorage)){return;}
localStorage=this.localStorage;}catch(e){return;}
function _initStorage(options){this._dbInfo=$.extend({},options);this._dbInfo.keyPrefix=this._dbInfo.name+'/';}
function length(callback){var _this=this;var promise=this.keys().then(function(keys){return keys.length;});excuteCallback(promise,callback);return promise;}
function getItem(key,callback){var _this=this;if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
var promise=$.Deferred();(function(){var result;result=localStorage.getItem(this._dbInfo.keyPrefix+key);try{result=JSON.parse(result);}catch(e){}
promise.resolve(result);}).call(this);excuteCallback(promise,callback);return promise;}
function getItemList(keyList,callback){var _this=this;var promise=$.Deferred();(function(){var result={};keyList.forEach(function(key,i){if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
result[key]=localStorage.getItem(_this._dbInfo.keyPrefix+key);try{result[key]=JSON.parse(result[key]);}catch(e){}});promise.resolve(result);}).call(this);excuteCallback(promise,callback);return promise;}
function setItem(key,value,callback){if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
var promise=$.Deferred();(function(){var _this=this;var result;try{try{value=JSON.stringify(value);}catch(e){}
result=localStorage.setItem(_this._dbInfo.keyPrefix+key,value);promise.resolve(result);}catch(e){result=null;if(e.name==='QuotaExceededError'||e.name==='NS_ERROR_DOM_QUOTA_REACHED'){promise.reject(e);return;}
promise.reject(e);}}).call(this);excuteCallback(promise,callback);return promise;}
function setItemList(kvList,callback){var promise=$.Deferred();(function(){var _this=this;var result={};kvList.forEach(function(kv,i){var value;if(typeof kv.key!=='string'){console.warn('The key is not a string!');kv.key=String(kv.key);}
try{try{value=JSON.stringify(kv.value);}catch(e){value=kv.value;}
result[kv.key]=localStorage.setItem(_this._dbInfo.keyPrefix+kv.key,value);}catch(e){console.warn('occur error when set data into storage [key: "'+kv.key+'", value: "'+kv.value+'"]');result[kv.key]=null;if(e.name==='QuotaExceededError'||e.name==='NS_ERROR_DOM_QUOTA_REACHED'){promise.reject(e);return;}}});promise.resolve();}).call(this);excuteCallback(promise,callback);return promise;}
function removeItem(key,callback){if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
var promise=$.Deferred();try{(function(){localStorage.removeItem(this._dbInfo.keyPrefix+key);promise.resolve();}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function removeItemList(keyList,callback){var promise=$.Deferred();try{(function(){var _this=this;keyList.forEach(function(key,i){if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
localStorage.removeItem(_this._dbInfo.keyPrefix+key);});promise.resolve();}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function clear(callback){var _this=this;var promise=$.Deferred();try{(function(){var keyPrefix=this._dbInfo.keyPrefix;var key;for(var i=localStorage.length-1;i>=0;i--){key=localStorage.key(i);if(key.indexOf(keyPrefix)===0){localStorage.removeItem(key);}}
promise.resolve();}).call(this);}catch(e){proimse.reject(e);}
excuteCallback(promise,callback);return promise;}
function key(n,callback){var _this=this;var promise=$.Deferred();(function(){var result;result=localStorage.key(n);if(result){result=result.substring(_this._dbInfo.keyPrefix.length);}
promise.resolve(result);}).call(this);excuteCallback(promise,callback);return promise;}
function keys(callback){var _this=this;var promise=$.Deferred();(function(){var keyPrefix=this._dbInfo.keyPrefix;var length=localStorage.length;var keys=[],key;for(var i=0;i<length;i++){key=localStorage.key(i);if(key.indexOf(keyPrefix)===0){keys.push(key.substring(keyPrefix.length));}}
promise.resolve(keys);}).call(this);excuteCallback(promise,callback);return promise;}
function iterate(iterator,callback){var _this=this;var promise=$.Deferred();try{(function(){var keyPrefix=this._dbInfo.keyPrefix;var key,value;var result;for(var i=localStorage.length-1;i>=0;i--){key=localStorage.key(i);if(key.indexOf(keyPrefix)===0){value=localStorage.getItem(key);try{value=JSON.parse(value);}catch(e){}
result=iterator(key.substring(keyPrefix.length),value,i);}
if(result===false){break;}}
promise.resolve();}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function excuteCallback(promise,callback){if(typeof callback==='function'){promise.then(function(result){callback(null,result);},function(error){callback(erro);});}}
var localStorageWrapper={_driver:'localStorageWrapper',_initStorage:_initStorage,length:length,getItem:getItem,getItemList:getItemList,setItem:setItem,setItemList:setItemList,removeItem:removeItem,removeItemList:removeItemList,clear:clear,key:key,keys:keys,iterate:iterate};this.Beop=this.Beop||{};this.Beop.cache=this.Beop.cache||{};this.Beop.cache.drivers=this.Beop.cache.drivers||{};this.Beop.cache.drivers.localStorage=localStorageWrapper;}).call(this,jQuery);(function($){function BaseCache(options){this.options=$.extend({},DEFAULTS,options);this.storage=Object.create(Beop.cache.drivers[this.options.driver]);this.init();}
BaseCache.prototype.init=function(){this.storage._initStorage(this.options);};BaseCache.prototype.length=function(){return this.storage.length();};BaseCache.prototype.key=function(n,callback){return this.storage.key(n,callback);};BaseCache.prototype.keys=function(callback){return this.storage.keys(callback);};BaseCache.prototype.getItem=function(key,callback){return this.storage.getItem(key,callback);};BaseCache.prototype.getItemList=function(keyList,callback){return this.storage.getItemList(keyList,callback);};BaseCache.prototype.setItem=function(key,value,callback){return this.storage.setItem(key,value,callback);};BaseCache.prototype.setItemList=function(kvList,callback){return this.storage.setItemList(kvList,callback);};BaseCache.prototype.removeItem=function(key,callback){return this.storage.removeItem(key,callback);};BaseCache.prototype.removeItemList=function(keyList,callback){return this.storage.removeItemList(keyList,callback);};BaseCache.prototype.clear=function(callback){return this.storage.clear(callback);};BaseCache.prototype.iterate=function(iterator,callback){return this.storage.iterate(iterator,callback);};var DEFAULTS={dbType:'localStorage',name:'beopcache',version:3};this.Beop=this.Beop||{};this.Beop.cache=this.Beop.cache||{};this.Beop.cache.BaseCache=BaseCache;}).call(this,jQuery);﻿
var Internationalization=(function(){function Internationalization(){this.type=localStorage["language"];this.resource=JSON.parse(localStorage["i18n"]);this.setDefautFont();};Internationalization.prototype={getResource:function(){return this.resource;},setDefautFont:function(strFont){if(!strFont){if(/OS/.test(window.jscd.os))strFont='Helvetica';if(window.jscd.os=='windows')strFont='微软雅黑';}
if(strFont)document.getElementsByTagName('body')[0].style.fontFamily=strFont;},fillPage:function(){this.fill2($('[i18n]'));},fillArea:function(element){this.fill2(element.find('[i18n]'));},fillAreaAttribute:function(element,attributeName){this.fill(element.find('[i18n]['+attributeName+']'),attributeName);},fill:function(arrElement,attributeName){for(var i=0,arrPath,text,len=arrElement.length;i<len;i++){arrPath=arrElement[i].attributes["i18n"].value.split('.');text=this.resource;for(var j=0;j<arrPath.length;j++){text=text&&text[arrPath[j]];}
if(!attributeName){arrElement[i].innerHTML=text;}
else{arrElement[i].setAttribute(attributeName,text);}}},getI18nValue:function(i18nKey){if(!i18nKey){return'';}
var arrPath=i18nKey.split('.');var text=this.resource;for(var j=0;j<arrPath.length;j++){text=text&&text[arrPath[j]];}
return text;},fill2:function(arrElement){for(var i=0,len=arrElement.length;i<len;i++){var i18nValue=arrElement[i].attributes["i18n"];var items=i18nValue.value.split(';'),item,i18nValue,attrMap;for(var j=0;j<items.length;j++){item=items[j];if(!item){continue;}
if(item.indexOf('=')===-1){i18nValue=this.getI18nValue(item);arrElement[i].innerHTML=i18nValue;}else{attrMap=item.split('=');if(!attrMap[0]){continue;}
arrElement[i].setAttribute(attrMap[0],this.getI18nValue(attrMap[1]));}}}},findContent:function(strPath){var arrPath=strPath.split('.');var text=this.resource;for(var i=0,len=arrPath.length;i<len;i++){text=text&&text[arrPath[i]];}
return text;}}
return Internationalization;})();var EventAdapter=(function(){var eventData,eventStatus;function EventAdapter($){}
EventAdapter.on=function(){var eventTarget,eventType,eventFunction,eventSelector,eventHmt,finalFunction;eventHmt=true;if(arguments.length<3||arguments.length>5){console.log('EventAdapter.on arguments.length error');return;}
if(typeof arguments[0]!='object'){console.log('EventAdapter.on arguments[0] type error');return;}else{if(!(arguments[0]instanceof jQuery)){eventTarget=jQuery(arguments[0]);}else{eventTarget=arguments[0];}}
if(typeof arguments[1]!='string'){console.log('EventAdapter.on arguments[1] type error');return;}else{eventType=arguments[1];}
if(typeof arguments[2]=='function'){eventFunction=arguments[2];eventSelector=null;if(typeof arguments[3]=='boolean'){eventHmt=arguments[3]}}else if(typeof arguments[2]=='string'){if(arguments[3]&&typeof arguments[3]=='function'){eventSelector=arguments[2];eventFunction=arguments[3];if(typeof arguments[4]=='boolean'){eventHmt=arguments[4]}}else{console.log('EventAdapter.on arguments[2 or 3] type error');return;}}
finalFunction=function(e){if(eventHmt){EventAdapter.analyse(eventTarget,eventType);}
eventFunction.call(this,e);};if(!AppConfig.isMobile){eventTarget.on(eventType,eventSelector,finalFunction)}else{switch(eventType){case'click':eventTarget.on('touchstart',eventSelector,finalFunction);break;case'dragstart':eventTarget.on('touchstart',eventSelector,function(e){mobileDragStart.call(this,e,eventTarget,finalFunction)});break;case'dragover':$(document).on('touchmove.drag',eventSelector,function(e){mobileDragOver.call(this,e,eventTarget,finalFunction)});break;case'dragleave':$(document).on('touchmove.drag',eventSelector,function(e){mobileDragLeave.call(this,e,eventTarget,finalFunction)});break;case'drop':$(document).on('touchend.drop',eventSelector,function(e){mobileDrop.call(this,e,eventTarget,finalFunction)});break;default:eventTarget.on(eventType,eventSelector,finalFunction);break;}}
return eventTarget;};EventAdapter.off=function(){if((arguments.length>3||arguments.length<1)||(arguments[0]&&typeof arguments[1]!='string')){console.log('EventAdapter.off arguments error');return;}
var eventTarget,eventType,eventSelector;if(!(arguments[0]instanceof jQuery)){eventTarget=jQuery(arguments[0]);}else{eventTarget=arguments[0];}
if(arguments.length==1){eventTarget.off();return eventTarget;}
if(typeof arguments[1]=='string'){eventType=arguments[1]}else{console.log('EventAdapter.off eventType Error');return}
if(typeof arguments[2]=='string'){eventSelector=arguments[2];}else{eventSelector=null;}
if(!AppConfig.isMobile){eventTarget.off(eventType,eventSelector)}else{switch(eventType){case'click':eventTarget.off('touchstart',eventSelector);break;case'dragstart':eventTarget.draggable('destroy');break;case'dragover':eventTarget.droppable('destroy');break;case'dragleave':eventTarget.droppable('destroy');break;case'drop':eventTarget.droppable('destroy');break;default:eventTarget.off(eventType,eventSelector);break;}}
return eventTarget;};$.fn.extend({'eventOn':function(){var eventTarget,eventType,eventFunction,eventSelector,eventHmt,finalFunction;eventHmt=true;if(arguments.length<2||arguments.length>4){console.log('EventAdapter.on arguments.length error');return;}
if(typeof this!='object'){console.log('EventAdapter.on arguments[0] type error');return;}else{if(!(this instanceof jQuery)){eventTarget=jQuery(arguments[0]);}else{eventTarget=this;}}
if(typeof arguments[0]!='string'){console.log('EventAdapter.on arguments[1] type error');return;}else{eventType=arguments[0];}
if(typeof arguments[1]=='function'){eventFunction=arguments[1];eventSelector=null;if(typeof arguments[2]=='boolean'){eventHmt=arguments[2]}}else if(typeof arguments[1]=='string'){if(arguments[2]&&typeof arguments[2]=='function'){eventSelector=arguments[1];eventFunction=arguments[2];if(typeof arguments[3]=='boolean'){eventHmt=arguments[3]}}else{console.log('EventAdapter.on arguments[2 or 3] type error');return;}}
finalFunction=function(e){if(eventHmt){EventAdapter.analyse(eventTarget,eventType);}
eventFunction.call(this,e);};if(!AppConfig.isMobile){eventTarget.on(eventType,eventSelector,finalFunction)}else{switch(eventType){case'click':eventTarget.on('touchstart',eventSelector,finalFunction);break;case'dragstart':mobileDragStart(eventTarget,eventSelector,finalFunction);break;case'dragover':mobileDragOver(eventTarget,eventSelector,finalFunction);break;case'dragleave':mobileDragLeave(eventTarget,eventSelector,finalFunction);break;case'drop':mobileDrop(eventTarget,eventSelector,finalFunction);break;default:eventTarget.on(eventType,eventSelector,finalFunction);break;}}
return eventTarget;},'eventOff':function(){if((arguments.length>2)||(arguments[0]&&typeof arguments[0]!='string')){console.log('EventAdapter.off arguments error');return;}
var eventTarget,eventType,eventSelector;if(!(this instanceof jQuery)){eventTarget=jQuery(this);}else{eventTarget=this;}
if(arguments.length==0){eventTarget.off();return eventTarget;}
if(typeof arguments[0]=='string'){eventType=arguments[0];}else{console.log('EventAdapter.off eventType Error');return}
if(typeof arguments[1]=='string'){eventSelector=arguments[1];}else{eventSelector=null;}
if(!AppConfig.isMobile){eventTarget.off(eventType,eventSelector)}else{switch(eventType){case'click':eventTarget.off('touchstart',eventSelector,mobileDragStart);break;case'dragstart':eventTarget.draggable('destroy');break;case'dragover':eventTarget.droppable('destroy');break;case'dragleave':eventTarget.droppable('destroy');break;case'drop':eventTarget.droppable('destroy');break;default:eventTarget.off(eventType,eventSelector);break;}}
return eventTarget;}});EventAdapter.setData=function(date){if(date==undefined)return;eventData=date;};EventAdapter.getData=function(){return eventData;};document.addEventListener('drop',function(){eventData=null;},false);document.addEventListener('touchend',function(){eventData=null;},false);EventAdapter.clearEvent=function(){$(document).off('touchmove.copy');$(document).off('touchmove.drag');$(document).off('touchend.drop');};EventAdapter.analyse=function(eventTarget,eventType){if(eventTarget.length==0)return;var eventTargetName;if(eventTarget.attr('id')){eventTargetName=eventTarget.attr('id');}else if(eventTarget.attr('i18n')){eventTargetName=eventTarget.attr('i18n');}else if(eventTarget.attr('title')){eventTargetName=eventTarget.attr('title');}else{eventTargetName=eventTarget[0].textContent.substr(0,30);}
if(!eventTargetName)return;_hmt.push(['_trackEvent',eventTargetName,eventType,'']);};var mobileDragStart=function(e,target,eventFunction){var originalTarget=$(e.target).closest('[draggable="true"]')[0];var ev=e.type=='touchstart'?e.originalEvent.touches[0]:e,startPos={left:$(originalTarget).css('left'),top:$(originalTarget).css('top'),zIndex:$(originalTarget).css('z-index')},disX=originalTarget.offsetWidth/2,disY=originalTarget.offsetHeight/2;var $copyTarget=$(originalTarget).clone();$copyTarget.data('startPos',startPos);$copyTarget.css('z-index',10000);$copyTarget.css('position','absolute');$copyTarget.css('opacity','0.5');$copyTarget.css('pointer-events','none');var $container=$('body');$container.append($copyTarget);var sPos=$(originalTarget)[0].getBoundingClientRect();$copyTarget.css('left',sPos.left-$container[0].offsetLeft+'px');$copyTarget.css('top',sPos.top-$container[0].offsetTop+'px');$copyTarget[0].cssText=originalTarget.cssText;$copyTarget.css('width',originalTarget.offsetWidth);$copyTarget.css('height',originalTarget.offsetHeight);eventStatus='dragStart';eventFunction.call(this,ev);$(document).off('touchend.copy').on('touchend.copy',function(e){$copyTarget.remove();eventStatus='dragEnd';});$(document).on('touchmove.copy',function(e){eventStatus='dragMove';var ev=e.type=='touchmove'?e.originalEvent.touches[0]:e;var $parent=$copyTarget.offsetParent();$parent=$parent.is(':root')?$(window):$parent;var targetLeft=ev.pageX-disX;var targetTop=ev.pageY-disY;$copyTarget.css({left:targetLeft+'px',top:targetTop+'px','z-index':10000});})};var mobileDragOver=function(e,target,eventFunction){if(eventStatus!='dragMove'&&eventStatus!='dragMoveIn'&&eventStatus!='dragMoveOut')return;var ev=e.type=='touchmove'?e.originalEvent.touches[0]:e;var targetWidth,targetHeight;for(var i=0;i<target.length;i++){targetWidth=target[i].offsetWidth;targetHeight=target[i].offsetHeight;if((target.eq(i).offset().left<ev.pageX&&target.eq(i).offset().left+targetWidth>ev.pageX)&&(target.eq(i).offset().top<ev.pageY&&target.eq(i).offset().top+targetHeight>ev.pageY)){e.target=target[i];e.currentTarget=target[i];eventStatus='dragMoveIn';eventFunction.call(this,e);break;}}};var mobileDragLeave=function(e,target,eventFunction){if(eventStatus!='dragMoveIn')return;var ev=e.type=='touchmove'?e.originalEvent.touches[0]:e;var targetWidth,targetHeight;for(var i=0;i<target.length;i++){targetWidth=target[i].offsetWidth;targetHeight=target[i].offsetHeight;if(!((target.eq(i).offset().left<ev.pageX&&target.eq(i).offset().left+targetWidth>ev.pageX)&&(target.eq(i).offset().top<ev.pageY&&target.eq(i).offset().top+targetHeight>ev.pageY))){e.target=target[i];e.currentTarget=target[i];eventStatus='dragMoveOut';eventFunction.call(this,e);}}};var mobileDragEnd=function(e,target,eventFunction){eventFunction.call(this,e);};var mobileDrop=function(e,target,eventFunction){if(eventStatus!='dragMove'&&eventStatus!='dragMoveIn')return;var ev=e.type=='touchend'?e.originalEvent.changedTouches[0]:e;var eventTarget=target;var targetWidth,targetHeight;for(var i=0;i<target.length;i++){targetWidth=target[i].offsetWidth;targetHeight=target[i].offsetHeight;if((target.eq(i).offset().left<ev.pageX&&target.eq(i).offset().left+targetWidth>ev.pageX)&&(target.eq(i).offset().top<ev.pageY&&target.eq(i).offset().top+targetHeight>ev.pageY)){e.target=target[i];e.currentTarget=target[i];eventFunction.call(this,e);break;}}};return EventAdapter;})(jQuery);var ElScreenContainer=document.getElementById('indexMain');var ScreenCurrent=undefined;var ScreenPrevious=undefined;var Spinner=new LoadingSpinner({color:'#00FFFF'});var AppConfig={userId:undefined,account:undefined,roomList:undefined,isMobile:true};var I18n=undefined;var appConfigManager=(function(){var DEFAULT_CONFIG={gps:0};function get(){var options=window.localStorage.getItem('appConfig');if(options===null){set(DEFAULT_CONFIG);return DEFAULT_CONFIG;}
try{options=JSON.parse(options);}catch(e){}
return options;}
function set(options){window.localStorage.setItem('appConfig',JSON.stringify(options));}
return{get:get,set:set}}());$(document).ready(function(){if(navigator.userAgent.match(/iP(ad|hone|od)|Android/i))AppConfig.isMobile=true;router.to({typeClass:IndexScreen,data:{}});});var router=(function(){function Router(){this.path=[];}
+function(){this.back=function(){this.path.pop();this._display();return this;};this.to=function(pathNode){this.path.push(pathNode);this._display();return this;};this.empty=function(){this.path.length=0;return this;};this._display=function(){if(this.path.length<=0){return;}
var node=this.path[this.path.length-1];var navOptions=node.navOptions;var typeClass=node.typeClass;var data=node.data;if(data){for(var ele in data){eval("AppConfig."+ele+'=data.'+ele)}}
$('body').removeClass('top-nav bottom-nav');$('#navTop').children().hide();$('#navBottom').children().hide();if(typeClass.navOptions){if(typeClass.navOptions.bottom){$('body').addClass('bottom-nav');}
if(typeClass.navOptions.top){$('body').addClass('top-nav');}}
if(this.path.length>1){$('body').addClass('top-nav');$('.btn-back','#navTop').show();}
ScreenManager.show(node.typeClass);};}.call(Router.prototype);return new Router();}).call(this);var IndexScreen=(function(){function IndexScreen(){}
IndexScreen.prototype={show:function(){var _this=this;WebAPI.get('/static/app/temperatureControl/views/admin/login.html').done(function(resultHTML){$('#indexMain').html(resultHTML);_this.init();});},close:function(){document.onkeydown=false;},init:function(){var _this=this;_this.initLogin();_this.initNav();},initLogin:function(){this.restorePwd();var _this=this;$("#btnLogin").hammer().off('tap').on('tap',function(e){_this.login();});$(document).on("keydown","#divLogin input",function(event){var e=event||window.event||arguments.callee.caller.arguments[0];if(e&&e.keyCode==13){_this.login();}});},login:function(){var _this=this;var $btnLogin=$('#btnLogin');Spinner.spin($btnLogin[0]);var userName=$("#userName").val(),password=$("#password").val();var loginFail=function(msg){$('.alert').remove();new Alert($("#divLoginAlert"),"danger",msg).show().close();Spinner.stop();};if(!(userName&&password)){loginFail('用户名或密码错误！');return;}
WebAPI.post("/login",{name:userName,pwd:password,agent:jscd?jscd:{}}).then(function(_login_result){try{var login_result=JSON.parse(_login_result);var after_login=function(){if(login_result.status!=undefined&&login_result.status==true){if(login_result.projects&&login_result.projects.length>0){_this.rememberPwd();AppConfig.userId=login_result.id;AppConfig.account=$("#userName").val();WebAPI.get('/appTemperature/room/list/'+AppConfig.userId).done(function(rs){var rs=JSON.parse(rs);AppConfig.roomList=rs.roomList;AppConfig.buildingList=rs.buildingList;router.empty().to({typeClass:ObserverScreen,data:{}});}).fail(function(){});}else{loginFail("登录失败，没有任何项目的权限！");}}else{loginFail("用户名或密码错误！");}}}catch(e){loginFail("登录失败！");return false;}
after_login();}).always(function(){Spinner.stop();})},rememberPwd:function(){localStorage["userInfo"]=JSON.stringify({name:$("#userName").val(),pwd:$("#password").val()});},restorePwd:function(){if(localStorage["userInfo"]){var data=JSON.parse(localStorage["userInfo"]);if(data.pwd&&data.pwd!=""){$("#userName").val(data.name);$("#password").val(data.pwd);}}},initNav:function(){$('#navTop','.btn-back').hammer().off('tap').on('tap',function(e){router.back();});$('.btn-config','#navBottom').hammer().off('tap').on('tap',function(e){router.to({typeClass:AdminConfigure});e.preventDefault();});$('.btn-mapsel','#navBottom').hammer().off('tap').on('tap',function(e){router.to({typeClass:ProjectSel});e.preventDefault();});},};return IndexScreen;})();var AdminConfigure=(function(){var _this;AdminConfigure.navOptions={top:true};function AdminConfigure(){_this=this;}
AdminConfigure.prototype={show:function(){WebAPI.get('/static/app/temperatureControl/views/admin/adminConfigure.html').done(function(resultHTML){$('#indexMain').html(resultHTML);_this.init();});},init:function(){this.$container=$('#appConfig');this.$swGps=$('#swGps',this.$container);this.$optChkUpdate=$('#optChkUpdate',this.$container);_this.initNav();_this.initConfigStatus();_this.attachEvents();_this.initLogout();},initNav:function(){var $navTitle=$('.nav-title','#navTop');$navTitle.text('配置').show();},initConfigStatus:function(){var options=appConfigManager.get();var action;options.gps===1&&this.$swGps.addClass('on');},attachEvents:function(){var _this=this;$('.btn-switch',this.$container).hammer().off('tap').on('tap',function(e){var $this=$(this);var options=appConfigManager.get();var config={};$(this).toggleClass('on');if($this.hasClass('on')){config[$this[0].dataset['key']]=1;}else{config[$this[0].dataset['key']]=0;}
options=$.extend(false,options,config);appConfigManager.set(options);e.stopPropagation();e.preventDefault();});},initLogout:function(){$('#btnLogout').off('touchstart').on('touchstart',function(e){localStorage.removeItem('userInfo');ScreenManager.show(IndexScreen);});},close:function(){}};return AdminConfigure;})();var ProjectSel=(function(){var _this;var groupTpl='<div class="list-group">'+'<a class="list-group-item active">'+'<h4 class="list-group-item-heading">{buildingName}</h4>'+'</a>{itemsHtml}</div>';var groupItemTpl='<a href="javascript:;" class="list-group-item room-item" data-id="{roomId}">'+'<h4 class="list-group-item-heading">{roomName}</h4>'+'</a>';ProjectSel.navOptions={top:true};function ProjectSel(){_this=this;}
(function(){this.show=function(){WebAPI.get('static/app/temperatureControl/views/admin/projectSel.html').done(function(resultHTML){$('#indexMain').html(resultHTML);_this.init();});};this.close=function(){};this.init=function(){this.$container=$('#projectSel');this.initNav();this.initList();this.attachEvents();};this.initNav=function(){var $navTitle=$('.nav-title','#navTop');$navTitle.text('地图切换').show();};this.initList=(function(){function getHtml(buildingInfo){var roomList=AppConfig.roomList;var arrHtml=[];for(var i=0,room,len=roomList.length;i<len;i++){room=roomList[i];if(room.buildingId===buildingInfo.id){arrHtml.push(groupItemTpl.formatEL({roomId:room.id,roomName:room.name}));}}
return groupTpl.formatEL({buildingName:buildingInfo.name,itemsHtml:arrHtml.join('')});}
return function(){var buildingList=AppConfig.buildingList;var arrHtml=[];for(var i=0,len=buildingList.length;i<len;i++){arrHtml.push(getHtml(buildingList[i]));}
this.$container.html(arrHtml.join(''));};}());this.attachEvents=function(){this.$container.on('click','.room-item',function(){var roomId=this.dataset.id;if(roomId){AppConfig.roomId=roomId;router.back();}});};}).call(ProjectSel.prototype);return ProjectSel;})();var ObserverScreen=(function(){var _this;ObserverScreen.navOptions={top:true,bottom:true};function ObserverScreen(){_this=this;this.mapConfig=undefined;this.roomConfig=undefined;this.room=undefined;this.spaceList=undefined;this.equipList=undefined;this.sensorConfig=undefined;this.controllerConfig=undefined;}
ObserverScreen.prototype={show:function(){WebAPI.get('/static/app/temperatureControl/views/observer/observerScreen.html').done(function(resultHTML){$('#indexMain').html(resultHTML);_this.init();});},init:function(){var findId,room;if(AppConfig.roomId===undefined){findId=localStorage.getItem('lastOpenRoomId');}else{findId=AppConfig.roomId;}
if(!!findId){room=(function(id){var roomList=AppConfig.roomList;for(var i=0,len=roomList.length;i<len;i++){if(roomList[i].id===id){return roomList[i];}}
return;}(findId));}
if(!room){room=AppConfig.roomList[0];}
if(!!room){_this.mapConfig=room.map;_this.room=room;localStorage.setItem('lastOpenRoomId',room.id);}else{return;}
_this.initNav();_this.initMap();_this.initMapTool();_this.initRoom();_this.initTempSet();_this.initTempShow();},initNav:function(){var $navBottom=$('#navBottom');var $navTop=$('#navTop');var $navTitle=$('.nav-title',$navTop);var title=(function(room){var buildingList=AppConfig.buildingList;for(var i=0,len=buildingList.length;i<len;i++){if(buildingList[i].id===room.buildingId){break;}}
if(i<len){return buildingList[i].name+' '+room.name;}else{return room.name;}}).call(this,this.room);$('.btn-config',$navBottom).show();$('.btn-mapsel',$navBottom).show();$navTitle.text(title).show();},initMap:function(){var strMap='<img id="imgMap" src="'+_this.mapConfig.img+'"/>';$('#containerMap').append(strMap).css({'height':_this.mapConfig.height+'px','width':_this.mapConfig.width+'px'});var $locateTool=$('#btnLocate');var $spanLocateTool=$('#spanLocateIcon');this.mapConfig.offsetX=0;this.mapConfig.offsetY=0;this.mapConfig.scale=1;this.mapConfig.screenX=$locateTool[0].offsetLeft+$spanLocateTool.width()/2;this.mapConfig.screenY=$locateTool[0].offsetTop+$spanLocateTool.height();this.mapConfig.imgX=this.mapConfig.offsetX+this.mapConfig.screenX;this.mapConfig.imgY=this.mapConfig.offsetY+this.mapConfig.screenY;this.mapConfig.mapX=0;this.mapConfig.mapY=0;},initMapTool:function(){new ObserverMap(this).show();},initRoom:function(){WebAPI.get('/appTemperature/room/getDetail/'+_this.room.id).done(function(resultData){_this.roomConfig=JSON.parse(resultData);_this.equipList={sensor:_this.roomConfig.sensors,controller:_this.roomConfig.controllers};_this.spaceList=_this.roomConfig.spaces;_this.initEquipments();})},initTempSet:function(){var $tempChange=$('.tempChange');var $locateTool=$('#btnLocate');var $spanLocateTool=$('#spanLocateIcon');var $tempSetValue=$('#tempSetValue');var $tempSetSure=$('#tempSetSure');var mapX,mapY,interval,setValue;$tempChange.off('touchstart').on('touchstart',function(e){interval=1;setValue=Number($tempSetValue.html());if(e.currentTarget.id=='tempRaise'){setValue+=interval;$tempSetValue.html(setValue.toFixed(0));}else{setValue-=interval;$tempSetValue.html(setValue.toFixed(0));}});$tempSetSure.off('touchstart').on('touchstart',function(e){mapX=(-_this.mapConfig.offsetX+$locateTool[0].offsetLeft+$spanLocateTool.width()/2)/_this.mapConfig.scale;mapY=(-_this.mapConfig.offsetY+$locateTool[0].offsetTop+$spanLocateTool.height())/_this.mapConfig.scale;for(var i=0;i<_this.spaceList.length;i++){if(_this.spaceList[i].x<mapX&&_this.spaceList[i].x+_this.spaceList[i].width>mapX&&_this.spaceList[i].y<mapY&&_this.spaceList[i].y+_this.spaceList[i].height>mapY){alert(_this.spaceList[i].name);var post={userId:'',roomId:_this.room.id,spaceId:_this.spaceList[i]._id,x:mapX,y:mapY,value:setValue,gateway:AppConfig.roomList[0].gateway,sensors:_this.roomConfig.sensors,controllers:_this.roomConfig.controllers};WebAPI.post('/appTemperature/setTemperature',post).done(function(result){var resultTemp=result;$('#divTemperatureShow').text(50+'℃');});break;}}})},initTempShow:function(){var $divTempShow=$('#divTemperatureShow');$('.divEquipment').hammer().off('tap').on('tap',function(e){if($(e.target).hasClass('divSensor')){for(var i=0;i<_this.sensorConfig.length;i++){if(_this.sensorConfig[i].id==$(e.target).attr('id')){$divTempShow.text(_this.sensorConfig[i].value+'℃');break;}}}
if($(e.target).hasClass('divController')){for(var i=0;i<_this.controllerConfig.length;i++){if(_this.controllerConfig[i].id==$(e.target).attr('id')){$divTempShow.text(_this.controllerConfig[i].value+'℃');break;}}}})},initEquipments:function(){var equipIdList={sensors:[],controllers:[]};for(var i=0;i<_this.equipList.sensor.length;++i){equipIdList.sensors.push(_this.equipList.sensor[i].id);}
for(var i=0;i<_this.equipList.controller.length;++i){equipIdList.controllers.push(_this.equipList.controller[i].id);}
var divSensorWidth,divSensorHeight,divControllerWidth,divControllerHeight;WebAPI.post('/appTemperature/get_realtime_value',equipIdList).done(function(result){var resultData=JSON.parse(result);_this.sensorConfig=resultData.sensors;_this.controllerConfig=resultData.controllers;var $containerMap=$('#containerMap');var $divEquipment;var strDivSensor=new StringBuilder();strDivSensor.append('<div class="divEquipment divSensor">');strDivSensor.append('    <div class="divEquipIcon">');strDivSensor.append('        <span class="spanEquipVal"></span>');strDivSensor.append('    </div>');strDivSensor.append('    <div class="divEquipStatus" style="display:none">');strDivSensor.append('        <span class="spanEquipStatus"></span>');strDivSensor.append('    </div>');strDivSensor.append('</div>');for(var i=0;i<_this.equipList.sensor.length;++i){$divEquipment=$(strDivSensor.toString());divSensorWidth=$divEquipment.width();divSensorHeight=$divEquipment.height();$divEquipment.attr('id',_this.equipList.sensor[i].id);$divEquipment.find('.spanEquipVal').text(_this.sensorConfig[i].value);$divEquipment.css({'left':_this.equipList.sensor[i].x-divSensorWidth/2,'top':_this.equipList.sensor[i].y-divSensorHeight/2});$containerMap.append($divEquipment)}
var strDivController=new StringBuilder();strDivController.append('<div class="divEquipment divController">');strDivController.append('    <div class="divEquipIcon">');strDivController.append('        <span class="spanEquipVal"></span>');strDivController.append('    </div>');strDivController.append('    <div class="divEquipStatus" style="display:none">');strDivController.append('        <span class="spanEquipStatus"></span>');strDivController.append('    </div>');strDivController.append('</div>');for(var i=0;i<_this.equipList.controller.length;++i){$divEquipment=$(strDivController.toString());divControllerWidth=$divEquipment.width();divControllerHeight=$divEquipment.height();$divEquipment.attr('id',_this.equipList.controller[i].id);$divEquipment.find('.spanEquipVal').text(_this.controllerConfig[i].value);$divEquipment.css({'left':_this.equipList.controller[i].x-divControllerWidth/2,'top':_this.equipList.controller[i].y-divControllerHeight/2});$containerMap.append($divEquipment)}
_this.initToggle();$('.divEquipStatus').off('touchstart').on('touchstart',function(){new ObserverEquip(this).show();});_this.initTempShow();});},initToggle:function(){var $btnToggle=$('#btnToggle');$btnToggle.addClass('sensorShow');$btnToggle.off('touchstart').on('touchstart',function(e){if($(e.currentTarget).hasClass('sensorShow')){$(e.currentTarget).removeClass('sensorShow');$('.divSensor').css('display','none');$('.divController').css('display','block');}else{$(e.currentTarget).addClass('sensorShow');$('.divSensor').css('display','block');$('.divController').css('display','none');}})},close:function(){}};return ObserverScreen;})();var ObserverMap=(function(){var _this;function getOffsetSum(ele){var top=0,left=0;while(ele){top+=ele.offsetTop;left+=ele.offsetLeft;ele=ele.offsetParent;}
return{top:top,left:left}}
function ObserverMap(page){_this=this;this.page=page;this.mapMoveRate=15;this.mapConfig=page.mapConfig;this.mapScreenTop=getOffsetSum($('#divObserverMap')[0]).top;this.mapEvent=new Hammer(document.getElementById('imgMap'));}
ObserverMap.prototype={show:function(){_this.init();},init:function(){_this.initLocate();_this.initMapResize();_this.initMapRelocate();},initMapRelocate:function(){var $btnRelocate=$('#btnRelocate');var $map=$('#divObserverMap');var divMapHeight=$map[0].offsetHeight;var divMapWidth=$map[0].offsetWidth;var $containerMap=$('#containerMap');$btnRelocate.off('touchstart').on('touchstart',function(e){_this.mapConfig.offsetX-=_this.mapConfig.screenX-divMapWidth/2;_this.mapConfig.offsetY-=_this.mapConfig.screenY-divMapHeight/2;_this.mapConfig.screenX=divMapWidth/2;_this.mapConfig.screenY=divMapHeight/2;_this.offsetAdjust();$containerMap.css({left:_this.mapConfig.offsetX,top:_this.mapConfig.offsetY});});},initMapResize:function(){var $btnSizeUp=$('#btnSizeUp');var $btnSizeDown=$('#btnSizeDown');var $imgMap=$('#imgMap');var $containerMap=$('#containerMap');var $locateTool=$('#btnLocate');var $spanLocateTool=$('#spanLocateIcon');var $map=$('#divObserverMap');var divMapHeight=$map[0].offsetHeight;var divMapWidth=$map[0].offsetWidth;$imgMap[0].onload=function(e){var minXScale=Math.ceil(10*divMapWidth/_this.mapConfig.width)/10;var minYScale=Math.ceil(10*divMapHeight/_this.mapConfig.height)/10;var minScale=Math.max(minXScale,minYScale);var maxScale=2-minScale;var scaleStep=0.1;var mapWidth=_this.mapConfig.width;var mapHeight=_this.mapConfig.height;var lastScale=1;$btnSizeUp.off('touchstart').on('touchstart',function(e){if(_this.mapConfig.scale+scaleStep>maxScale)return;_this.mapConfig.scale+=scaleStep;resizeCalc();});$btnSizeDown.off('touchstart').on('touchstart',function(e){if(_this.mapConfig.scale-scaleStep<minScale)return;_this.mapConfig.scale-=scaleStep;resizeCalc();});function resizeCalc(){$containerMap.width(mapWidth*_this.mapConfig.scale);$containerMap.height(mapHeight*_this.mapConfig.scale);_this.mapConfig.imgX=_this.mapConfig.imgX*_this.mapConfig.scale/lastScale;_this.mapConfig.imgY=_this.mapConfig.imgY*_this.mapConfig.scale/lastScale;_this.mapConfig.offsetX=_this.mapConfig.screenX-_this.mapConfig.imgX;_this.mapConfig.offsetY=_this.mapConfig.screenY-_this.mapConfig.imgY;_this.offsetAdjust();$locateTool.css({left:_this.mapConfig.imgX-$spanLocateTool.width()/2,top:_this.mapConfig.imgY-$spanLocateTool.height()});$containerMap.css({left:_this.mapConfig.offsetX,top:_this.mapConfig.offsetY});$('#divTemperatureShow').text(minScale+':'+maxScale+':'+_this.mapConfig.scale.toFixed(1));lastScale=_this.mapConfig.scale;_this.equipRelocate();_this.locationCal();}
var scaleTransferCoe=0.05;var finalScale=1;_this.mapEvent.add(new Hammer.Pinch());_this.mapEvent.off('pinchmove').on('pinchmove',function(e){var ev=e;finalScale=1+(ev.scale-1)*scaleTransferCoe;$('#divTemperatureShow').text(scaleTransferCoe+':'+minScale+':'+maxScale+':'+ev.scale.toFixed(1));if(finalScale*lastScale>maxScale||finalScale*lastScale<minScale)return;_this.mapConfig.scale*=finalScale;resizeCalc();});};},initLocate:function(){var $map=$('#divObserverMap');var $imgMap=$('#imgMap');var $locateTool=$('#btnLocate');var $containerMap=$('#containerMap');var $spanLocateTool=$('#spanLocateIcon');var locateStatus='end';this.mapEvent.add(new Hammer.Tap());this.mapEvent.off('tap').on('tap',function(e){e.preventDefault();var ev=e;_this.mapConfig.screenX=ev.pointers[0].pageX;_this.mapConfig.screenY=ev.pointers[0].pageY-_this.mapScreenTop;_this.mapConfig.imgX=_this.mapConfig.screenX-_this.mapConfig.offsetX;_this.mapConfig.imgY=_this.mapConfig.screenY-_this.mapConfig.offsetY;$locateTool.css({left:_this.mapConfig.imgX-$spanLocateTool.width()/2,top:_this.mapConfig.imgY-$spanLocateTool.height()});_this.modalTempConfig();_this.locationCal()});$locateTool.hammer().off('panmove').on('panmove',function(e){e.preventDefault();var ev=e.gesture;_this.mapConfig.screenX=ev.pointers[0].pageX;_this.mapConfig.screenY=ev.pointers[0].pageY-_this.mapScreenTop;_this.mapConfig.imgX=_this.mapConfig.screenX-_this.mapConfig.offsetX;_this.mapConfig.imgY=_this.mapConfig.screenY-_this.mapConfig.offsetY;$locateTool.css({left:_this.mapConfig.imgX-$spanLocateTool.width()/2,top:_this.mapConfig.imgY-$spanLocateTool.height()});_this.locationCal()});$locateTool.hammer().off('panend').on('panend',function(e){e.preventDefault();var ev=e.gesture;_this.mapConfig.screenX=ev.changedPointers[0].pageX;_this.mapConfig.screenY=ev.changedPointers[0].pageY-_this.mapScreenTop;_this.mapConfig.imgX=_this.mapConfig.screenX-_this.mapConfig.offsetX;_this.mapConfig.imgY=_this.mapConfig.screenY-_this.mapConfig.offsetY;});var initPageX,initPageY,initOffsetX,initOffsetY;this.mapEvent.add(new Hammer.Pan({threshold:0}));this.mapEvent.off('panstart').on('panstart',function(e){e.preventDefault();var ev=e;initPageX=ev.pointers[0].pageX;initPageY=ev.pointers[0].pageY-_this.mapScreenTop;initOffsetX=_this.mapConfig.offsetX;initOffsetY=_this.mapConfig.offsetY;});this.mapEvent.off('panmove').on('panmove',function(e){var ev=e;var evLeft=ev.pointers[0].pageX-initPageX+initOffsetX;var evTop=ev.pointers[0].pageY-initPageY+initOffsetY-_this.mapScreenTop;if(evLeft>0){evLeft=0;}
if(evTop>0){evTop=0;}
if(evLeft+$containerMap.width()-$map.width()<0){evLeft=-($containerMap.width()-$map.width());}
if(evTop+$containerMap.height()-$map.height()<0){evTop=-($containerMap.height()-$map.height());}
$containerMap.css({'left':evLeft+'px','top':evTop+'px'});});this.mapEvent.off('panend').on('panend',function(e){e.preventDefault();var ev=e;_this.mapConfig.offsetX+=ev.changedPointers[0].pageX-initPageX;_this.mapConfig.offsetY+=ev.changedPointers[0].pageY-initPageY-_this.mapScreenTop;_this.mapConfig.screenX=_this.mapConfig.imgX+_this.mapConfig.offsetX;_this.mapConfig.screenY=_this.mapConfig.imgY+_this.mapConfig.offsetY;_this.offsetAdjust();_this.locationCal()});},modalTempConfig:function(){},equipRelocate:function(){var $divEquipment=$('.divEquipment');var left,top,id,divWidth,divHeight;for(var i=0;i<$divEquipment.length;i++){id=$divEquipment.eq(i).attr('id');if($divEquipment.eq(i).hasClass('divSensor')){for(var j=0;j<_this.page.equipList.sensor.length;j++){if(id==_this.page.equipList.sensor[j]._id){divWidth=$divEquipment.eq(i).width();divHeight=$divEquipment.eq(i).height();left=(_this.page.equipList.sensor[j].x)*_this.mapConfig.scale-divWidth/2;top=(_this.page.equipList.sensor[j].y)*_this.mapConfig.scale-divHeight/2;$divEquipment.eq(i).css({'left':left,'top':top});break;}}}else if($divEquipment.eq(i).hasClass('divController')){for(var j=0;j<_this.page.equipList.controller.length;j++){if(id==_this.page.equipList.controller[j]._id){left=(_this.page.equipList.controller[j].x)*_this.mapConfig.scale;top=(_this.page.equipList.controller[j].y)*_this.mapConfig.scale;$divEquipment.eq(i).css({'left':left,'top':top});break;}}}}},offsetAdjust:function(){var $map=$('#divObserverMap');var divMapHeight=$map[0].offsetHeight;var divMapWidth=$map[0].offsetWidth;var $containerMap=$('#containerMap');if(_this.mapConfig.offsetX>0){_this.mapConfig.offsetX=0}
if(_this.mapConfig.offsetY>0){_this.mapConfig.offsetY=0}
if(_this.mapConfig.offsetX<-($containerMap.width()-divMapWidth)){_this.mapConfig.offsetX=-($containerMap.width()-divMapWidth)}
if(_this.mapConfig.offsetY<-($containerMap.height()-divMapHeight)){_this.mapConfig.offsetY=-($containerMap.height()-divMapHeight)}
_this.mapConfig.screenX=_this.mapConfig.offsetX+_this.mapConfig.imgX;_this.mapConfig.screenY=_this.mapConfig.offsetY+_this.mapConfig.imgY;},locationCal:function(){var $locateTool=$('#btnLocate');var $spanLocateTool=$('#spanLocateIcon');var mapX=_this.mapConfig.imgX/_this.mapConfig.scale;var mapY=_this.mapConfig.imgY/_this.mapConfig.scale;_this.mapConfig.mapX=mapX;_this.mapConfig.mapY=mapY;$('#locateTempShow').text(mapX.toFixed(2)+'/'+mapY.toFixed(2));if(true)return;var post={userId:AppConfig.userId,roomId:'',spaceId:'',x:'',y:'',value:'',sensors:[{_id:'',name:'',x:100,y:100}],controllers:[{_id:'',name:'',x:100,y:100}]};},close:function(){}};return ObserverMap;})();var ObserverEquip=(function(){var _this;function observerEquip(screen){_this=this;this.screen=screen;this.equipList=screen.equipList}
observerEquip.prototype={show:function(){WebAPI.get('/static/app/temperatureControl/views/observer/widgets/equipmentConfig.html').done(function(resultHTML){$('#indexMain').html(resultHTML);_this.init();});},init:function(){var strEquipImg='<img id="imgMap" src="static/app/temperatureControl/img/2.jpg"/>';$('#divEquipImg').append(strEquipImg);_this.initConfigure();},initConfigure:function(){var $spanBtnCfg=$('.spanCfgBtn');$spanBtnCfg.off('touchstart').on('touchstart',function(e){var ev=e.originalEvent?e.originalEvent:e;var $btnCfg=$(ev.currentTarget).find('.btnCfg');if($btnCfg.hasClass('btnCfgOn')){$btnCfg.removeClass('btnCfgOn').addClass('btnCfgOff');}else{$btnCfg.removeClass('btnCfgOff').addClass('btnCfgOn');}})},};return observerEquip;})();
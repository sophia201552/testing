var ScreenManager=(function(){function ScreenManager(){}
ScreenManager.screenFlag='page';ScreenManager.root='#page=IndexScreen';ScreenManager.paneRoot="#page=PaneProjectSelector";ScreenManager.isListening=false;ScreenManager.setProjectSelector=function(ProjectSelector){if(typeof ProjectSelector==='function'){ScreenManager.projectSelector=new ProjectSelector();}};ScreenManager.Init=function(){I18n.fillArea($(".navbar"));};ScreenManager.show=function(){if(arguments.length===0){return;}
var screenClass=arguments[0];if(typeof screenClass!=='function'){return;}
if(ScreenManager.isListening){ScreenManager.applyGoTo.apply(null,arguments);}else{ScreenManager.applyScreen.apply(null,arguments);}};ScreenManager.applyGoTo=function(){var screenClass=arguments[0];if(!screenClass.name){alert(I18n.resource.common.NOT_FOUND_PAGE);return false;}
var paramObj={page:screenClass.name},paramList=ScreenManager._getFunctionParams(screenClass);for(var m=0,n=paramList.length;m<n;m++){if(typeof arguments[m+1]!=typeof undefined){paramObj[paramList[m]]=arguments[m+1];}}
ScreenManager.goTo(paramObj);};ScreenManager.applyScreen=function(){var screenClass=arguments[0];if(!screenClass){alert('Can\'t find the page.');return;}
if(ScreenCurrent){window.onresize=null;try{if(ScreenCurrent.close&&ScreenCurrent.close()===false){return;}}catch(e){console.warn(ScreenCurrent.constructor.name+' close 方法报错:'+e);}}
var screenObj=Object.create(screenClass.prototype);ScreenCurrent=(screenClass.apply(screenObj,Array.prototype.slice.call(arguments,1))||screenObj);if(ScreenCurrent.onresize)window.onresize=ScreenCurrent.onresize;ScreenCurrent.show();};ScreenManager._getFunctionParams=function(func){var STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,ARGUMENT_NAMES=/([^\s,]+)/g,fnStr,result;fnStr=func.toString().replace(STRIP_COMMENTS,'');result=fnStr.slice(fnStr.indexOf('(')+1,fnStr.indexOf(')')).match(ARGUMENT_NAMES);if(result===null){result=[];}
return result;};ScreenManager._getHashParamsMap=function(){var list,map={};list=location.hash.substr(1).split('&');for(var m=0;m<list.length;m++){var item=list[m].split('=');map[item[0]]=_unserializeParams(item[1]);}
return map;};ScreenManager.getPageId=function(){var hashMap=ScreenManager._getHashParamsMap();var params;if(typeof hashMap.id!==typeof undefined){return hashMap.id;}
if(hashMap.reportId){return hashMap.reportId;}
if(typeof hashMap.options==='string'){params={};try{params=JSON.parse(window.decodeURIComponent(hashMap.options));}catch(e){}
return params.id;}
if(typeof hashMap.options==='object'&&hashMap.options){return hashMap.options.id;}};ScreenManager.loadProjectMenu=function(project,page_id){ScreenManager.projectSelector.initProject(project['id'],page_id);};ScreenManager.loadUserPanel=function(){$("#right-nav").show();};ScreenManager.screenChange=function(e){var paramsMap=ScreenManager._getHashParamsMap(),project;if(typeof paramsMap.projectId!==typeof undefined){AppConfig.projectId=parseInt(paramsMap.projectId);project=BEOPUtil.getProjectFromAppConfig(AppConfig.projectId);if(!project){alert.danger(I18n.resource.error.noPermission);return false;}
AppConfig.projectTimeFormat=project.time_format||0;}
var promise=$.Deferred();if(I18n&&I18n.resource){promise.resolve();}else{InitI18nResource().always(function(rs){I18n=new Internationalization(null,rs);promise.resolve();});}
promise.always(function(){var screen,currentPage,screenParamsNameList=[],screenParamsValueList=[];if(AppConfig.afterLogin){$('#navHeader').fadeIn();$('#indexMain').css({top:'55px'});}
if(project){AppConfig.projectEnName=project['name_en'];AppConfig.projectName=project['name_en'];if(location.hash!=ScreenManager.paneRoot&&!AppConfig.navItems){ScreenManager.loadProjectMenu(project,paramsMap.id);}else{ScreenManager.projectSelector.setMenuActive();}}
ScreenManager.loadUserPanel();currentPage=paramsMap[ScreenManager.screenFlag];if(currentPage){if(currentPage.indexOf('.')>0){screen=namespace(currentPage)}else{if(currentPage==='EnergyScreen_M'){currentPage='EnergyScreen';}
screen=window[currentPage]||namespace('observer.screens')[currentPage];}}else{console.error('无法识别的location hash! hash is '+location.hash);return true;}
if(screen&&typeof screen==='function'){screenParamsNameList=ScreenManager._getFunctionParams(screen);for(var m=0;m<screenParamsNameList.length;m++){var paramName=screenParamsNameList[m];if(typeof paramsMap[paramName]!=='undefined'){screenParamsValueList[m]=paramsMap[paramName];}else{screenParamsValueList[m]=undefined;}}
ScreenManager.applyScreen.apply(null,[screen].concat(screenParamsValueList));I18n.fillArea($('#navPane'));return false;}else{return true;}});};ScreenManager.goTo=function(pageInfo){var hashFlag='#',hashList=[];if(!pageInfo){return false;}
if(AppConfig.projectId){pageInfo['projectId']=AppConfig.projectId;}
if(pageInfo[ScreenManager.screenFlag]){hashList.push(ScreenManager.screenFlag+'='+pageInfo[ScreenManager.screenFlag]);}
for(var param in pageInfo){if(pageInfo.hasOwnProperty(param)){if(param!==ScreenManager.screenFlag){hashList.push(param+'='+_serializeParams(pageInfo[param]));}}}
if(location.hash===hashFlag+hashList.join('&')){Spinner&&Spinner.stop();}else{location.hash=hashFlag+hashList.join('&');}};ScreenManager.listen=function(){if("onhashchange"in window&&(!document.documentMode||document.documentMode>=8)){ScreenManager.isListening=true;window.onhashchange=ScreenManager.screenChange;ScreenManager.detectAnchorHash();if(location.hash===''){if(AppConfig.afterLogin){window.addEventListener('load',function(){location.hash=ScreenManager.paneRoot;ScreenManager.projectSelector.show();},false);}else{location.hash=ScreenManager.root;}}else{if(location.hash==ScreenManager.root){if(AppConfig.afterLogin){location.hash=ScreenManager.paneRoot;}else{ScreenManager.screenChange();}}
if(AppConfig.afterLogin){window.addEventListener('load',function(){ScreenManager.screenChange();ScreenManager.projectSelector.init();},false)}else{location.hash=ScreenManager.root;}}}else{console.error('This browser can\'t support onhashchange event.')}};ScreenManager.detectAnchorHash=function(){var isValidHash=function(hash){if(typeof hash===typeof undefined||hash.startsWith('http')||hash.startsWith('https')||hash.startsWith('blob')){return true;}else if(hash==='/factory'||hash==='/point_tool/editor'){return true;}else{return hash.indexOf('=')!=-1;}};$(document).on('click.anchorHash','a',function(ev){var $this=$(this),hash=$this.attr('href'),isManagedHash=$this.attr('nothash');if(typeof isManagedHash!==typeof undefined&&isManagedHash!==false){return true;}
if(!isValidHash(hash)){ev.preventDefault();var dom=document.getElementById(hash.substr(1));if(dom){dom.scrollIntoView();}}
return true;})};if(typeof AppConfig!=typeof undefined){ScreenManager.listen();try{ScreenManager.setProjectSelector(PaneProjectSelector);}catch(e){}}
function _serializeParams(params){return window.encodeURIComponent(JSON.stringify(params));}
function _unserializeParams(params){try{params=JSON.parse(window.decodeURIComponent(params));}catch(e){}
return params;}
return ScreenManager;})();﻿
var beop=beop||{};beop.constant={project_img_path:'/static/images/project_img/',project_default_img:'default.jpg',BEOP_IMG_HOST:'http://images.rnbtech.com.hk',OSS_PROJECT_IMG_PATH:'/custom/project_img/'};var ObjectId=function(){var timestamp=new Date().valueOf();var userId=('000'+((window.AppConfig&&window.AppConfig.userId)||'000')).slice(-3);var hex8=('00000000'+Math.floor(Math.random()*0xFFFFFFFF).toString(16)).slice(-8);return timestamp+userId+hex8;};(function(exports){exports.namespace=function(path){var obj=window;path=path.split('.');path.forEach(function(p,i){p=p.trim();if(i===0&&p==='window')return;obj=obj[p]=obj[p]||{};});return obj;};}(window));(function(exports){exports.Mixin=function(){var prototype={};var methods;for(var i=0,len=arguments.length;i<len;i++){methods=arguments[i];for(var m in methods){prototype[m]=methods[m];}}
return prototype;};}(window));(function(){var ENUM_LEVEL={LOG:1,INFO:2,DEBUG:3,WARN:4,ERROR:5,EXCEPTION:6};window.Log={level:ENUM_LEVEL.WARN,log:function(){if(this.level>ENUM_LEVEL.LOG)return;Log._out('log',arguments);},info:function(){if(this.level>ENUM_LEVEL.INFO)return;Log._out('info',arguments);},debug:function(){if(this.level>ENUM_LEVEL.DEBUG)return;Log._out('debug',arguments);},warn:function(){if(this.level>ENUM_LEVEL.WARN)return;Log._out('warn',arguments);},error:function(){if(this.level>ENUM_LEVEL.ERROR)return;Log._out('error',arguments);},exception:function(message,exception){if(this.level>ENUM_LEVEL.EXCEPTION)return;if(exception){Log.error('Exception: ',message,exception.stack||exception);}else{Log.error('Exception: ',message);}},_out:function(type,args){console[type].apply(console,args)}};}());var FullScreenManager=(function(){var manager=Object.create({init:function(){var _this=this;$(document).off('webkitfullscreenchange');$(document).on('webkitfullscreenchange',function(){var isFullScreen=!!document.webkitFullscreenElement;if(isFullScreen){_this.onFullScreenEnter();}else{_this.onFullScreenOut();}});$(document).off('mozfullscreenchange');$(document).on('mozfullscreenchange',function(){var isFullScreen=!!document.webkitFullscreenElement;if(isFullScreen){_this.onFullScreenEnter();}else{_this.onFullScreenOut();}});$(document).off('msfullscreenchange');$(document).on('msfullscreenchange',function(){var isFullScreen=!!document.webkitFullscreenElement;if(isFullScreen){_this.onFullScreenEnter();}else{_this.onFullScreenOut();}});if(typeof onError==='function'){$(document).off('webkitfullscreenerror');$(document).on('webkitfullscreenerror',this.onFullScreenError);$(document).off('mozfullscreenerror');$(document).on('mozfullscreenerror',this.onFullScreenError);$(document).off('msfullscreenerror');$(document).on('msfullscreenerror',this.onFullScreenError);}},onFullScreenEnter:function(){},onFullScreenOut:function(){},onFullScreenError:function(){},toggle:function(){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen();}else if(document.documentElement.msRequestFullscreen){document.documentElement.msRequestFullscreen();}else if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen();}else if(document.documentElement.webkitRequestFullscreen){document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);}}else{if(document.exitFullscreen){document.exitFullscreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}}}});manager.init();return manager;}());function StringBuilder(){this.data=Array("");}
StringBuilder.prototype.append=function(){this.data.push(arguments[0]);return this;};StringBuilder.prototype.toString=function(){return this.data.join("");};StringBuilder.prototype.getLength=function(){return this.data.length;};if(!String.prototype.format){String.prototype.format=function(){if(arguments[0]===undefined){return'';}
if(arguments[0].constructor===Array){var args=arguments[0];}else{var args=arguments;}
return this.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!='undefined'?args[number]:match;});};}
if(!String.prototype.formatEL){String.prototype.formatEL=function(o,defaultVal){var str=this.toString();if(!str||!o)return'';for(var p in o){if(o.hasOwnProperty(p)){str=str.replace(new RegExp('{'+p+'}','g'),o[p]);}}
if(typeof defaultVal!=='undefined'){str=str.replace(/{[^{}]*?}/g,defaultVal);}
return str;};}
String.prototype.toDate=function(){var str=this;if(str.indexOf('-')>-1)
str=str.replace('-','/').replace('-','/');return new Date(str);};if(!String.prototype.startsWith){String.prototype.startsWith=function(word){return new RegExp('^'+word).test(this);}}
Number.prototype.toDate=function(){return new Date(this);};function Alert(targetElement,type,msg){this.element=targetElement;this.str=new StringBuilder();this.str.append('<div style="display:none;" class="alert beop-alert alert-').append(type).append(' alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>').append('<div class="alert-msg">'+msg+'</div>').append('</div>');this.$alert=$(this.str.toString());}
Alert.danger=function(targetElement,msg){return new Alert(targetElement,Alert.type.danger,msg);};Alert.warning=function(targetElement,msg){return new Alert(targetElement,Alert.type.warning,msg);};Alert.success=function(targetElement,msg){return new Alert(targetElement,Alert.type.success,msg);};Alert.info=function(targetElement,msg){return new Alert(targetElement,Alert.type.info,msg);};Alert.closeAll=function(){$('.beop-alert').remove();};Alert.type={danger:'danger',warning:'warning',success:'success',info:'info'};Alert.prototype.show=function(duration){Alert.closeAll();if(duration){var _this=this;setTimeout(function(){_this.close();},duration);}
$(this.element).append(this.$alert);this.$alert.slideDown(500);return this;};Alert.prototype.close=function(){var _this=this;this.$alert.slideUp(500,function(){_this.$alert.remove();_this=null;});};Alert.prototype.setMessage=function(msg){if(!msg){return false}
this.$alert.find('.alert-msg').text(msg);};Alert.prototype.setStyle=function(style){if(style&&typeof style!=='string'){this.$alert.css(style);}
return this;};Alert.prototype.showAtTop=function(duration){this.setStyle({position:'absolute',top:0,left:0,right:0,margin:'auto',width:'30%',textAlign:'center',zIndex:10000});if(!duration){duration=2000;}
this.show(duration);};function showDialog(url){return WebAPI.get(url).done(function(resultHtml){$("#dialogContent").html(resultHtml);$('#dialogModal').modal({});});}
function clone(obj){if(obj==null||typeof(obj)!='object')
return obj;var temp=obj.constructor();for(var key in obj){if(obj.hasOwnProperty(key)){temp[key]=clone(obj[key]);}}
return temp;}
Date.prototype.format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};var week={"0":"/u65e5","1":"/u4e00","2":"/u4e8c","3":"/u4e09","4":"/u56db","5":"/u4e94","6":"/u516d"};if(/(y+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));}
if(/(E+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,((RegExp.$1.length>1)?(RegExp.$1.length>2?"/u661f/u671f":"/u5468"):"")+week[this.getDay()+""]);}
for(var k in o){if(new RegExp("("+k+")").test(fmt)){fmt=fmt.replace(RegExp.$1,(RegExp.$1.length==1)?(o[k]):(("00"+o[k]).substr((""+o[k]).length)));}}
return fmt;};Date.prototype.timeFormat=function(format,type,language,option){var date=this;if(format&&(typeof format=='string'||typeof format=='object')){if(typeof format=='object'&&(!format.separators||!format.parts)){format='yyyy-mm-dd hh:ii:ss';}}else{format='yyyy-mm-dd hh:ii:ss';}
if(arguments.length>=2){var paramArr=(function(arrayish){return[].slice.call(arrayish);})(arguments);paramArr.shift();type=language=option=null;paramArr.forEach(function(it,i){if(typeof it=='string'){language=it;}else if(typeof it=='number'){type=it;}else if(typeof it=='object'){option=it;}});}
var isReturnNull=false;if(option){for(var k in option){if(k=='isReturnNull'){isReturnNull=option[k];}}}
if(date=='Invalid Date'){console.warn("Invalid date.");if(isReturnNull){return'';}else{return date.toString();}}
var DATES={en:{"days":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"daysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],"daysMin":["Su","Mo","Tu","We","Th","Fr","Sa","Su"],"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"meridiem":["am","pm"]}};language=language?(DATES[language]?language:'en'):'en';var formatObj=(function(formatStr){if(typeof formatStr=='object'){return formatStr;}
if(type){formatStr=timeFormatChange(formatStr,type);}
var reg=/hh?|HH?|p|P|ii?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g;var separators=formatStr.replace(reg,'\0').split('\0');var parts=formatStr.match(reg);if(!separators||!separators.length||!parts||parts.length==0){throw new Error("Invalid date format.");}
return{separators:separators,parts:parts};})(format);var val={yy:date.getFullYear().toString().substring(2),yyyy:date.getFullYear(),m:date.getMonth()+1,M:DATES[language].monthsShort[date.getMonth()],MM:DATES[language].months[date.getMonth()],d:date.getDate(),D:DATES[language].daysShort[date.getDay()],DD:DATES[language].days[date.getDay()],p:(DATES[language].meridiem.length==2?DATES[language].meridiem[date.getHours()<12?0:1]:''),h:date.getHours(),i:date.getMinutes(),s:date.getSeconds()};if(DATES[language].meridiem.length==2){val.H=(val.h%12==0?12:val.h%12);}
else{val.H=val.h;}
val.HH=(val.H<10?'0':'')+val.H;val.P=val.p.toUpperCase();val.hh=(val.h<10?'0':'')+val.h;val.ii=(val.i<10?'0':'')+val.i;val.ss=(val.s<10?'0':'')+val.s;val.dd=(val.d<10?'0':'')+val.d;val.mm=(val.m<10?'0':'')+val.m;var finTime='';for(var i=0,len=formatObj.separators.length;i<len;i++){finTime+=formatObj.separators[i]+(formatObj.parts[i]?val[formatObj.parts[i]]:'');}
return finTime;};var DateUtil=(function(){var dateLocale={month:{en:{month_names:['January','February','March','April','May','June','July','August','September','October','November','December'],month_names_short:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']},zh:{month_names:['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'],month_names_short:['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月']}}};function getWeekNumber(d){d=new Date(+d);d.setHours(0,0,0);d.setDate(d.getDate()+4-(d.getDay()||7));var yearStart=new Date(d.getFullYear(),0,1);var weekNo=Math.ceil((((d-yearStart)/86400000)+1)/7);return[d.getFullYear(),weekNo];}
function getLastWeekNumberOf(y,w){w-=1;if(w===0){y=y-1;w=52;}
return[y,w];}
function getNextWeekNumberOf(y,w){w+=1;if(w===53){y+=1;w=1;}
return[y,w];}
function isLeapYear(y){if(Object.prototype.toString.call(y)==='[object Date]'){y=y.getFullYear();}
return((y%4===0)&&(y%100!==0))||(y%400===0);}
function daysInMonth(dt){var m=dt.getMonth();if(m===1){return isLeapYear(dt)?29:28;}
return[31,28,31,30,31,30,31,31,30,31,30,31][m];}
function getFirstDayOfWeek(year,week){var d=new Date(year,0,1),offset=d.getTimezoneOffset();d.setDate(d.getDate()+4-(d.getDay()||7));d.setTime(d.getTime()+7*24*60*60*1000*(week+(year==d.getFullYear()?-1:0)));d.setTime(d.getTime()
+(d.getTimezoneOffset()-offset)*60*1000);d.setDate(d.getDate()-3);return d;}
function getDateRangeOnWeekNumber(year,week){if(!year||!week){return;}
var firstDay=getFirstDayOfWeek(year,week),lastDay=new Date(firstDay);lastDay.setDate(firstDay.getDate()+6);return[firstDay,lastDay];}
function getMonthName(index,language){var monthList=language&&language in dateLocale.month?dateLocale.month[language].month_names:dateLocale.month['en'].month_names;return monthList[index];}
function getMonthNameShort(index,language){var monthList=language&&language in dateLocale.month?dateLocale.month[language].month_names_short:dateLocale.month['en'].month_names_short;return monthList[index];}
function getLastMonth(currentMonth){if(!currentMonth){currentMonth=new Date().getMonth()+1;}
if(currentMonth===1){return 12;}else{return currentMonth-1;}}
function getNextMonth(currentMonth){if(!currentMonth){currentMonth=new Date().getMonth()+1;}
if(currentMonth===12){return 1;}else{return currentMonth+1;}}
function getRelativeDateInfo(date1,date2){var now=new Date();var lang=I18n.type;var value1,value2,ts,info;if(!date1&&!date2)return'';value1=(date1||now).valueOf();value2=(date2||now).valueOf();ts=Math.floor(Math.abs(value1-value2)/1000);switch(true){case ts<60:info=ts+(ts===1?' second':' seconds');break;case ts<3600:ts=Math.floor(ts/60);info=ts+(ts===1?' minute':' minutes');break;case ts<86400:ts=Math.floor(ts/(3600));info=ts+(ts===1?' hour':' hours');break;case ts<31536000:ts=Math.floor(ts/(86400));info=ts+(ts===1?' day':' days');break;default:ts=Math.floor(ts/(31536000));info=ts+(ts===1?' year':' years');break;}
info+=value1>value2?' ago':' later';if(lang==='zh'){info=info.replace(/\s(seconds?|minutes?|hours?|days?|years?)\s(ago|later)$/,function($0,$1,$2){var rs='';if($1.indexOf('second')>-1)rs+='秒';if($1.indexOf('minute')>-1)rs+='分钟';if($1.indexOf('hour')>-1)rs+='小时';if($1.indexOf('day')>-1)rs+='天';if($1.indexOf('year')>-1)rs+='年';if($2==='ago')rs+='前';if($2==='later')rs+='后';return rs;});}
return info;}
return{getWeekNumber:getWeekNumber,isLeapYear:isLeapYear,daysInMonth:daysInMonth,getLastWeekNumberOf:getLastWeekNumberOf,getNextWeekNumberOf:getNextWeekNumberOf,getDateRangeOnWeekNumber:getDateRangeOnWeekNumber,getFirstDayOfWeek:getFirstDayOfWeek,getMonthName:getMonthName,getMonthNameShort:getMonthNameShort,getLastMonth:getLastMonth,getNextMonth:getNextMonth,getRelativeDateInfo:getRelativeDateInfo,DATA_FORMAT:{FULL_DATETIME:'yyyy-mm-dd hh:ii:ss',FULL_DATETIME_CHANGE:'yyyy-MM-dd HH:mm:ss',FULL_DATETIME_ALL_SEC_CHANGE:'yyyy-MM-dd 00:00:00',FULL_DATETIME_ZERO_SEC_CHANGE:'yyyy-MM-dd HH:mm:00',FULL_DATETIME_NO_SEC_CHANGE:'yyyy-MM-dd HH:mm',FULL_DATETIME_ZERO_SEC:'yyyy-mm-dd hh:ii:00',FULL_DATETIME_HH_00_00:'yyyy-mm-dd hh:00:00',FULL_DATETIME_00_00_00:'yyyy-mm-dd 00:00:00',FULL_DATETIME_NO_SEC:'yyyy-mm-dd hh:ii',FULL_DATETIME_HH_00:'yyyy-mm-dd hh:00',FULL_DATETIME_00_00:'yyyy-mm-dd 00:00',FULL_DATE:'yyyy-mm-dd',TIME:'hh:ii:ss',TIME_HOUR_MINUTE:'hh:ii',TIME_ZERO_SEC:'hh:ii:00'}}})();var StringUtil=(function(){var HTML_ENTITIES={'&':'&amp;','>':'&gt;','<':'&lt;','"':'&quot;',"'":'&#39;','`':'&#x60;'},HTML_ENTITIES_INVERT=invert(HTML_ENTITIES);function invert(obj){var result={},keys=Object.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i];}
return result;}
function padLeft(oldStr,padNum,padStr){if(!padStr){return oldStr;}
return new Array(padNum-String(oldStr).length+1).join(padStr)+oldStr;}
function htmlEscape(text){if(!text){return text;}
var source='(?:'+Object.keys(HTML_ENTITIES).join('|')+')',replaceRegexp=new RegExp(source,'g');return text.replace(replaceRegexp,function(character){return HTML_ENTITIES[character];});}
function htmlUnEscape(text){if(!text){return text;}
var source='(?:'+Object.keys(HTML_ENTITIES_INVERT).join('|')+')',replaceRegexp=new RegExp(source,'g');return text.replace(replaceRegexp,function(character){return HTML_ENTITIES_INVERT[character];});}
var getI18nProjectName=function(project){if(!I18n||!project){return'';}
var result='';switch(I18n.type){case'en':{result=project.name_english;break;}
case'zh':{result=project.name_cn;break;}
default:{result=project.name_english;}}
return result||'';};return{padLeft:padLeft,htmlEscape:htmlEscape,htmlUnEscape:htmlUnEscape,getI18nProjectName:getI18nProjectName}})();var BEOPUtil=(function(){var jsType={function:typeof $.noop,number:typeof 0,string:typeof'',undefined:typeof undefined};var projectImgPath=beop.constant.project_img_path;var setRelativePosition=function($obj,$target,topOffset,leftOffset){$target.css({"left":$obj.offset().left+$obj.width()+(leftOffset||5),"top":$obj.offset().top+(topOffset||10)});};var projectDefaultImgPath=projectImgPath+beop.constant.project_default_img;var getProjectImgPath=function(project){if(project){return project.pic?projectImgPath+project.pic:projectDefaultImgPath;}};var getProjectFromAppConfig=function(projectId){for(var m=0,len=AppConfig.projectList.length;m<len;m++){if(AppConfig.projectList[m].id==projectId){return AppConfig.projectList[m];}}};function getFunctionName(func){if(!func||typeof func!=jsType.function){return'';}
var ret=func.toString();ret=ret.substr('function '.length);ret=ret.substr(0,ret.indexOf('('));return ret;}
function isUndefined(obj){return typeof obj===jsType.undefined;}
function getCookie(name){var value="; "+document.cookie;var parts=value.split("; "+name+"=");if(parts.length==2)return parts.pop().split(";").shift();}
function logicContentHandle(content){if(content){content=content.replace(/\t/g,'    ')}
return content;}
function copyToClipboard(text){if(window.clipboardData&&window.clipboardData.setData){return clipboardData.setData("Text",text);}else if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var textarea=document.createElement("textarea");textarea.textContent=text;textarea.style.position="fixed";document.body.appendChild(textarea);textarea.select();try{return document.execCommand("copy");}catch(ex){console.warn("Copy to clipboard failed.",ex);return false;}finally{document.body.removeChild(textarea);}}}
var projectImgType={logo:'logo.png',pdfCover:'pdf_cover.jpg'};function getProjectImgByType(projectId,name,extension){var img='';if(projectId){img+=projectId+'_';}
img+=name;if(extension){img+='.'+extension;}
return beop.constant.BEOP_IMG_HOST+beop.constant.OSS_PROJECT_IMG_PATH+img;}
function getProjectById(id){if(!id||!AppConfig.projectList){return null;}
for(var i=0;i<AppConfig.projectList.length;i++){var project=AppConfig.projectList[i];if(project.id==id){return project;}}
return null;}
return{setRelativePosition:setRelativePosition,getProjectImgPath:getProjectImgPath,getFunctionName:getFunctionName,isUndefined:isUndefined,getCookie:getCookie,getProjectFromAppConfig:getProjectFromAppConfig,logicContentHandle:logicContentHandle,copyToClipboard:copyToClipboard,getProjectImgByType:getProjectImgByType,getProjectById:getProjectById,projectImgType:projectImgType}})();(function(){var beop_tmpl_cache={};this.beopTmpl=function tmpl(str,data,htmlStr){var fn=!/\W/.test(str)?beop_tmpl_cache[str]=beop_tmpl_cache[str]||tmpl(htmlStr?htmlStr:document.getElementById(str).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+
str.replace(/[\r\t\n]/g," ").split(/<!/).join("\t").replace(/((^|!>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)!>/g,"',$1,'").split("\t").join("');").split(/!>/).join("p.push('").split("\r").join("\\'")
+"');}return p.join('');");return data?fn(data):fn;};})();var SidebarMenuEffect=(function(){function SidebarMenuEffect(){}
SidebarMenuEffect.prototype.init=function(center,left,right){var _this=this;this.$paneCt=$(center);this.$leftBtn=$(center).find('#leftCt');this.$rightBtn=$(center).find('#rightCt');var container=document.getElementById('st-container'),buttons=Array.prototype.slice.call(document.querySelectorAll('.sideTrans')),refresh=function(){var leftCol=0,rightCol=0,centerCol=0;var leftArrow='<span class="glyphicon glyphicon-chevron-left"></span>';var rightArrow='<span class="glyphicon glyphicon-chevron-right"></span>';if(_this.$leftBtn.length>0){if(container.className.indexOf('st-effect-7')>0){var prev=_this.$paneCt.prev('div')[0];if(prev&&prev.className.indexOf('col-')>-1){leftCol=parseInt(prev.classList[0].split('-')[2]);}else{leftCol=0;}
_this.$leftBtn.removeClass('leftCtClose').addClass('leftCtOpen').html(leftArrow);}else{leftCol=0;_this.$leftBtn.removeClass('leftCtOpen').addClass('leftCtClose').html(rightArrow);}}
if(_this.$rightBtn.length>0){if(container.className.indexOf('st-effect-1')>0){var next=_this.$paneCt.next('div')[0];if(next&&next.className.indexOf('col-')>-1){rightCol=parseInt(next.classList[0].split('-')[2]);}else{rightCol=0;}
_this.$rightBtn.removeClass('rightCtClose').addClass('rightCtOpen').html(rightArrow);}else{rightCol=0;_this.$rightBtn.removeClass('rightCtOpen').addClass('rightCtClose').html(leftArrow);}}
centerCol=12-leftCol-rightCol;_this.$paneCt.removeClass().addClass('col-sm-'+centerCol+' st-content');};buttons.forEach(function(el,i){var effect=el.getAttribute('data-effect');el.addEventListener('click',function(ev){var target=ev.target.getAttribute('data-effect')!=null?ev.target.getAttribute('data-effect'):ev.target.parentNode.getAttribute('data-effect');var stCtClass=document.getElementById('st-container').className;if(stCtClass.indexOf(target)<0){ev.stopPropagation();ev.preventDefault();container.classList.add(effect);setTimeout(function(){if($(container.children[0]).children('div').length==3){container.classList.add('st-menu-open');}
refresh();},250);}else{container.classList.remove(target);refresh();}});});};return SidebarMenuEffect;})();(function(window){{var unknown='-';var screenSize='';if(screen.width){var width=(screen.width)?screen.width:'';var height=(screen.height)?screen.height:'';screenSize+=''+width+" x "+height;}
var nVer=navigator.appVersion;var nAgt=navigator.userAgent;var browser=navigator.appName;var version=''+parseFloat(navigator.appVersion);var majorVersion=parseInt(navigator.appVersion,10);var nameOffset,verOffset,ix;if((verOffset=nAgt.indexOf('Opera'))!=-1){browser='Opera';version=nAgt.substring(verOffset+6);if((verOffset=nAgt.indexOf('Version'))!=-1){version=nAgt.substring(verOffset+8);}}
else if((verOffset=nAgt.indexOf('MSIE'))!=-1){browser='Microsoft Internet Explorer';version=nAgt.substring(verOffset+5);}
else if((verOffset=nAgt.indexOf('Chrome'))!=-1){browser='Chrome';version=nAgt.substring(verOffset+7);}
else if((verOffset=nAgt.indexOf('Safari'))!=-1){browser='Safari';version=nAgt.substring(verOffset+7);if((verOffset=nAgt.indexOf('Version'))!=-1){version=nAgt.substring(verOffset+8);}}
else if((verOffset=nAgt.indexOf('Firefox'))!=-1){browser='Firefox';version=nAgt.substring(verOffset+8);}
else if(nAgt.indexOf('Trident/')!=-1){browser='Microsoft Internet Explorer';version=nAgt.substring(nAgt.indexOf('rv:')+3);}
else if((nameOffset=nAgt.lastIndexOf(' ')+1)<(verOffset=nAgt.lastIndexOf('/'))){browser=nAgt.substring(nameOffset,verOffset);version=nAgt.substring(verOffset+1);if(browser.toLowerCase()==browser.toUpperCase()){browser=navigator.appName;}}
if((ix=version.indexOf(';'))!=-1)version=version.substring(0,ix);if((ix=version.indexOf(' '))!=-1)version=version.substring(0,ix);if((ix=version.indexOf(')'))!=-1)version=version.substring(0,ix);majorVersion=parseInt(''+version,10);if(isNaN(majorVersion)){version=''+parseFloat(navigator.appVersion);majorVersion=parseInt(navigator.appVersion,10);}
var mobile=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(nVer);var cookieEnabled=(navigator.cookieEnabled)?true:false;if(typeof navigator.cookieEnabled=='undefined'&&!cookieEnabled){document.cookie='testcookie';cookieEnabled=(document.cookie.indexOf('testcookie')!=-1)?true:false;}
var os=unknown;var clientStrings=[{s:'Windows 3.11',r:/Win16/},{s:'Windows 95',r:/(Windows 95|Win95|Windows_95)/},{s:'Windows ME',r:/(Win 9x 4.90|Windows ME)/},{s:'Windows 98',r:/(Windows 98|Win98)/},{s:'Windows CE',r:/Windows CE/},{s:'Windows 2000',r:/(Windows NT 5.0|Windows 2000)/},{s:'Windows XP',r:/(Windows NT 5.1|Windows XP)/},{s:'Windows Server 2003',r:/Windows NT 5.2/},{s:'Windows Vista',r:/Windows NT 6.0/},{s:'Windows 7',r:/(Windows 7|Windows NT 6.1)/},{s:'Windows 8.1',r:/(Windows 8.1|Windows NT 6.3)/},{s:'Windows 8',r:/(Windows 8|Windows NT 6.2)/},{s:'Windows NT 4.0',r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:'Windows ME',r:/Windows ME/},{s:'Android',r:/Android/},{s:'Open BSD',r:/OpenBSD/},{s:'Sun OS',r:/SunOS/},{s:'Linux',r:/(Linux|X11)/},{s:'iOS',r:/(iPhone|iPad|iPod)/},{s:'Mac OS X',r:/Mac OS X/},{s:'Mac OS',r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:'QNX',r:/QNX/},{s:'UNIX',r:/UNIX/},{s:'BeOS',r:/BeOS/},{s:'OS/2',r:/OS\/2/},{s:'Search Bot',r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var id in clientStrings){var cs=clientStrings[id];if(cs.r.test(nAgt)){os=cs.s;break;}}
var osVersion=unknown;if(/Windows/.test(os)){osVersion=/Windows (.*)/.exec(os)[1];os='Windows';}
switch(os){case'Mac OS X':osVersion=/Mac OS X (10[\.\_\d]+)/.exec(nAgt)[1];break;case'Android':osVersion=/Android ([\.\_\d]+)/.exec(nAgt)[1];break;case'iOS':osVersion=/OS (\d+)_(\d+)_?(\d+)?/.exec(nVer);osVersion=osVersion[1]+'.'+osVersion[2]+'.'+(osVersion[3]|0);break;}}
window.jscd={screen:screenSize,browser:browser,browserVersion:version,mobile:mobile,os:os,osVersion:osVersion,cookies:cookieEnabled};}(this));var getUrlParams=function(){var search=window.location.search.substring(1);var kvArr=search.split('&');var rs={};kvArr.forEach(function(kv){var arr=kv.split('=');if(typeof arr[1]!=='undefined'){rs[arr[0]]=arr[1];}});return rs;};$.fn.serializeObject=function(){var obj={};this.serializeArray().map(function(item){if(/\[\]$/.test(item.name)){if(obj[item.name]){obj[item.name].push(item.value);}else{obj[item.name]=[item.value];}}else{obj[item.name]=item.value;}});return obj;};function kIntSeparate(num,n){var number=num.toFixed(n?n:0);var source=String(number).split(".");source[0]=source[0].replace(new RegExp('(\\d)(?=(\\d{3})+$)','ig'),"$1,");return source.join(".");}
function timeFormatChange(format,type){var lastStr='';var formatObj=(function(formatStr){if(!formatStr||typeof formatStr=='object'){return;}
var reg=/hh?|HH?|p|P|ii?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g;var separators=formatStr.replace(reg,'\0').split('\0');var parts=formatStr.match(reg);if(!separators||!separators.length||!parts||parts.length==0){return;}
return{separators:separators,parts:parts};})(format);if(formatObj){format='';for(var i=0,len=formatObj.separators.length-1;i<len;i++){format+=formatObj.separators[i]+formatObj.parts[i];}
lastStr=formatObj.separators[len];}
var formatArr=['yyyy-mm-dd hh:ii:ss','yyyy-mm-dd hh:ii','yyyy-mm-dd hh','yyyy-mm-dd','yyyy-mm','mm-dd hh:ii:ss','mm-dd hh:ii','mm-dd hh','mm-dd'];var formatChangeArr=[['yyyy-mm-dd hh:ii:ss','yyyy-mm-dd hh:ii','yyyy-mm-dd hh','yyyy-mm-dd','yyyy-mm','mm-dd hh:ii:ss','mm-dd hh:ii','mm-dd hh','mm-dd'],['M d, yyyy hh:ii:ss','M d, yyyy hh:ii','M d, yyyy hh','M d, yyyy','M, yyyy','M d hh:ii:ss','M d hh:ii','M d hh','M d'],['dd/mm/yyyy hh:ii:ss','dd/mm/yyyy hh:ii','dd/mm/yyyy hh','dd/mm/yyyy','mm/yyyy','dd/mm hh:ii:ss','dd/mm hh:ii','dd/mm hh','dd/mm']];if(formatArr.findIndex){var index=formatArr.findIndex(function(v){return v===format;});}else{for(var i=0;i<formatArr.length;i++){if(formatArr[i]===format){var index=i;break;}}}
type=Number(type);type&&(type>=formatChangeArr.length)&&(type=formatChangeArr.length-1);if(index==-1){console.log('format is not defined');return format+lastStr;}else{if(type===0){return formatChangeArr[0][index]+lastStr;}
return formatChangeArr[type||AppConfig.projectTimeFormat||0][index]+lastStr;}}
function timeFormat(time,format,language,option){var date,arr,arr2;var sort=function(year,month,day,time){year=year==undefined?'2001':year;month=month==undefined?'01':month;day=day==undefined?'01':day;time=time==undefined?'':(' '+time);return new Date(year+'/'+month+'/'+day+time);}
if(time instanceof Date){date=time;}else if(typeof(time)=='string'){if(/^\d{1,2}-\d{1,2}/.test(time)){arr=time.split(' ');arr2=arr[0].split('-');time=arr2[1]+'-'+arr2[0]+(arr2[2]==undefined?'':('-'+arr2[2]))+(arr[1]==undefined?'':(' '+arr[1]));}
time=time.replace(/-/g,"/");arr=time.split(' ');arr2=arr[0].split('/');if(/^\d{4}/.test(time)){date=sort(arr2[0],arr2[1],arr2[2],arr[1]);}else if(/^\d{1,2}\/\d{4}/.test(time)){date=sort(arr2[1],arr2[0],'01',arr[1]);}else if(/^\d{1,2}\/\d{1,2}/.test(time)){date=sort(arr2[2],arr2[1],arr2[0],arr[1]);}else{date=new Date(time);}}else{date=new Date(time);}
return date.timeFormat(format,language,option);}
(function(exports){var MINITE_1=60000;var MINITE_5=300000;var HOUR_1=3600000;var DAY_1=86400000;var DAY_365=31536000000;function _formatTimeStr(str,format){var arr=str.split(' ');var date=arr[0].split('-');var time=arr[1].split(':');return format.replace('yyyy',date[0]).replace('MM',date[1]).replace('dd',date[2]).replace('HH',time[0]).replace('mm',time[1]).replace('ss',time[2]);}
function _explainPattern(timeShaft){var startTime=new Date(timeShaft[0]);var endTime=new Date(timeShaft[timeShaft.length-1]);var timeRange=endTime.valueOf()-startTime.valueOf();var timeInterval=timeRange/(timeShaft.length-1);var pattern='MM-dd HH:mm';if(timeInterval<=MINITE_5){if(timeRange<=HOUR_1){pattern='HH:mm';}else if(timeRange<=DAY_1){pattern='HH:mm';}}
else if(timeInterval<=HOUR_1){if(timeRange<=DAY_1){pattern='HH:mm';}else{pattern='MM-dd HH:mm';}}
else if(timeInterval<=DAY_1){if(timeRange<=DAY_365){pattern='MM-dd';}else{pattern='yyyy-MM-dd';}}
else{pattern='yyyy-MM';}
return pattern;}
function _explain(timeShaft){pattern=getPattern(timeShaft);if(pattern){timeShaft=timeShaft.map(function(row){return _formatTimeStr(row,pattern);});}
return timeShaft;}
function _valid(params){var flag=Object.prototype.toString.call(params)==='[object Array]';return flag&&/^[\d-]{10} [\d:]{8}$/.test(params[0]);}
var _getTimePattern=function(timeShaft){if(!_valid(timeShaft)){return;}
if(timeShaft.length<=1){return;}
return _explainPattern(timeShaft);};var formatTimeShaft=exports.formatTimeShaft=function(timeShaft){if(!_valid(timeShaft)){console.warn('function arguments is not a valid time shaft array!');return timeShaft;}
if(timeShaft.length<=1){return timeShaft;}
return _explain(timeShaft);};function _formatTimeStrByAppConfig(data){var formatArr,formatStr,regularArr,language,formatObj;switch(AppConfig.projectTimeFormat||0){case 0:formatArr=['yyyy-mm-dd'];regularArr=[/^[\d-]{10}$/];language='en';break;case 1:formatArr=['M d, yyyy','M d hh:ii','M, yyyy','M, yyyy','M d'];regularArr=[/^[\d-]{10}$/,/^[\d-]{5} [\d:]{5}$/,/^[\d-]{7}$/,/^[\d-]{6}$/,/^[\d-]{5}$/];language='en';break;case 2:formatArr=['dd/mm/yyyy','dd/mm hh:ii','mm/yyyy','mm/yyyy','dd/mm'];regularArr=[/^[\d-]{10}$/,/^[\d-]{5} [\d:]{5}$/,/^[\d-]{7}$/,/^[\d-]{6}$/,/^[\d-]{5}$/];language='en';break;default:formatArr=['yyyy-mm-dd'];regularArr=[/^[\d-]{10}$/];language='en';}
for(var i=0,len=regularArr.length;i<len;i++){if(regularArr[i].test(data)){formatStr=formatArr[i];break;}}
if(formatStr){formatObj=(function _parseFormat(formatStr){var reg=/hh?|HH?|p|P|ii?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g;var separators=formatStr.replace(reg,'\0').split('\0');var parts=formatStr.match(reg);if(!separators||!separators.length||!parts||parts.length==0){throw new Error("Invalid date format.");}
return{separators:separators,parts:parts};})(formatStr);return{formatStr:formatStr,language:language,formatObj:formatObj};}else{return;}}
if(window.echarts){echarts.registerPreprocessor(function(option){var pattern;var formatInfo,firstValue;if(option.formatTime===false){return;}
if(option.xAxis&&option.xAxis.length){option.xAxis.forEach(function(row){if(row.data&&row.data.length){pattern=_getTimePattern(row.data);formatInfo=_formatTimeStrByAppConfig(row.data[0]);if(pattern){row.data=row.data.map(function(row){return row.substr(0,16);});firstValue=_formatTimeStr(row.data[0],pattern);formatInfo=_formatTimeStrByAppConfig(firstValue);if(formatInfo){row.data=row.data.map(function(it,i){return timeFormat(it,formatInfo.formatObj,formatInfo.language);});}else{row.data=row.data.map(function(it,i){return _formatTimeStr(it,pattern);});}}else if(formatInfo){row.data=row.data.map(function(it,i){return timeFormat(it,formatInfo.formatObj,formatInfo.language);});}}});}});}}(window));var generateTimeOption=function(option){var timeConfig=clone(option);(!timeConfig.timeStart)&&(timeConfig.timeStart=timeConfig.startTime);(!timeConfig.timeEnd)&&(timeConfig.timeEnd=timeConfig.endTime);(!timeConfig.timeFormat)&&(timeConfig.timeFormat=timeConfig.format);var recentTime={};var now=new Date();if(typeof option=='string'){recentTime=generateRecentTime(option)}else if(option&&option.timeRecent){if(typeof option.timeRecent=='string'){recentTime=generateRecentTime(option.timeRecent)}else if(option.timeRecent.hasOwnProperty('unit')&&option.timeRecent.hasOwnProperty('val')){recentTime=generateRecentTimeCustom(option.timeRecent)}}
if(recentTime&&Object.keys(recentTime).length>0){timeConfig.timeStart=recentTime.timeStart;timeConfig.timeEnd=recentTime.timeEnd;if(recentTime.format){timeConfig.timeFormat=recentTime.format;}
switch(timeConfig.timeFormat){case'h1':timeConfig.timeEnd=new Date(recentTime.timeEnd).format('yyyy-MM-dd HH:00:00');timeConfig.timeStart=new Date(recentTime.timeStart).format('yyyy-MM-dd HH:00:00');break;case'd1':timeConfig.timeEnd=new Date(recentTime.timeEnd).format('yyyy-MM-dd 00:00:00');timeConfig.timeStart=new Date(recentTime.timeStart).format('yyyy-MM-dd 00:00:00');break;case'M1':timeConfig.timeEnd=new Date(recentTime.timeEnd).format('yyyy-MM-01 00:00:00');timeConfig.timeStart=new Date(recentTime.timeStart).format('yyyy-MM-01 00:00:00');break;}}
timeConfig.startTime=timeConfig.timeStart;timeConfig.endTime=timeConfig.timeEnd;timeConfig.format=timeConfig.timeFormat;return timeConfig;function generateRecentTime(time){var startTime,endTime,format;switch(time){case'today':endTime=now.format('yyyy-MM-dd HH:mm:ss');startTime=new Date(now-86400000).format('yyyy-MM-dd HH:mm:ss');format='h1';break;case'threeDay':endTime=now.format('yyyy-MM-dd HH:00:00');startTime=new Date(now-259200000).format('yyyy-MM-dd HH:mm:ss');format='h1';break;case'yesterday':endTime=new Date(new Date().setDate(now.getDate()-1)).format('yyyy-MM-dd HH:mm:ss');startTime=new Date(new Date().setDate(now.getDate()-2)).format('yyyy-MM-dd HH:mm:ss');format='h1';break;case'thisWeek':endTime=now.format('yyyy-MM-dd 00:00:00');startTime=new Date(now-604800000).format('yyyy-MM-dd HH:mm:ss');format='d1';break;case'lastWeek':endTime=new Date(now-(now.getDay()+1)*86400000).format('yyyy-MM-dd HH:mm:ss');startTime=new Date(now-(now.getDay()+7)*86400000).format('yyyy-MM-dd HH:mm:ss');format='d1';break;case'thisYear':endTime=new Date(now-(now.getDay()+1)*86400000).format('yyyy-MM-dd HH:mm:ss');startTime=new Date(now-(now.getDay()+7)*86400000).format('yyyy-MM-dd HH:mm:ss');format='M1';break;}
return{timeStart:startTime,timeEnd:endTime,format:format}}
function generateRecentTimeCustom(time){var startTime,endTime,format;switch(time.unit){case'hour':endTime=now.format('yyyy-MM-dd HH:mm:ss');startTime=new Date(now-3600000*time.val).format('yyyy-MM-dd HH:mm:ss');break;case'day':endTime=now.format('yyyy-MM-dd HH:00:00');startTime=new Date(now-86400000*time.val).format('yyyy-MM-dd HH:00:00');break;case'month':endTime=now.format('yyyy-MM-dd HH:00:00');startTime=new Date(now-2592000000*time.val).format('yyyy-MM-dd HH:00:00');break;}
return{timeStart:startTime,timeEnd:endTime}}};﻿var WebAPI=(function(){var siteId;switch(window.location.hostname){case'beop.rnbtech.com.hk':siteId='b79c068f77198848e22fe79758836e53';break;case'beop6.rnbtech.com.hk':siteId='f1f6b2b9e6b64592c0b4cb5e9b8bd79e';break;case'beopdemo.rnbtech.com.hk':siteId='ac0df98f274d9a5980a571297248d80b';break;default:break;}
(function(){if(siteId){var hm=document.createElement("script");hm.src="//hm.baidu.com/hm.js?"+siteId;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);}})();var mockList={'/static/mock/analysis_workspace_saveLayout.json':/\/analysis\/workspace\/saveLayout\/\d+\/[01]/i,'/static/mock/analysis_template_get.json':/\/analysis\/template\/get\/\d+/i};function mock(url){var match=null;for(var i in mockList){match=url.match(mockList[i]);if(match!==null)return i;}
return url;}
function requestFailHandle(result){if(result&&result.status==401){alert(i18n_resource.error.noPermission);}}
function WebAPI(){}
WebAPI.isMock=false;$.ajaxSetup({converters:{"text json":true},dataFilter:function(result,type){var data=result;if(type==='script'){return data;}else if(typeof data==='string'){if(/^\s*</.test(data)){return data;}
try{data=JSON.parse(result);}catch(e){console.log('request error: '+e+', the data is :'+data);return data;}}
if(data){if(data.error){switch(data.error){case'token_invalid':{console.log(this.url+' ('+data.error+': code"'+data.msg+'")');if(typeof LoginValidate!='undefined'){var validate=new LoginValidate();validate.show();return;}
confirm(i18n_resource.error.token[data.msg]+'. '+i18n_resource.error.relogin+'.',function(){if(AppConfig.isMobile){location.reload();}else{location.href='/';}});}
case'historyData':{console.log(this.url+' ('+data.error+': code"'+data.msg+'")');alert(data.msg);return{};}
default:break;}}
if(data.code==403){console.log(this.url+' ('+data.msg+'")');alert(I18n.resource.error.noPermission);return{};}}
return data;}});WebAPI.post=function(url,data,isMock){var mockUrl;isMock=isMock===undefined?WebAPI.isMock:isMock;if(isMock){mockUrl=mock(url);if(url!==mockUrl)return this.get(mockUrl,false);}
if(typeof cordova!='undefined'&&AppConfig.host){if(url.indexOf('.html')==-1){url=AppConfig.host+url;}else if(url[0]=='/'){url=url.slice(1)}}
return $.ajax({url:url,type:'POST',data:JSON.stringify(data),contentType:'application/json'}).fail(requestFailHandle);};WebAPI.get=function(url,isMock){isMock=isMock===undefined?WebAPI.isMock:isMock;url=isMock?mock(url):url;if(window._hmt&&url.indexOf('.html')>0)window._hmt.push(['_trackPageview',url]);if(typeof cordova!='undefined'&&AppConfig.host){if(url.indexOf('.html')==-1){url=AppConfig.host+url;}else if(url[0]=='/'){url=url.slice(1)}}
return $.ajax({url:url,type:'Get',contentType:'application/json'}).fail(requestFailHandle);};WebAPI.getHistoryDS=function(callback){};WebAPI.getHistory=function(callback){};return WebAPI;})();(function(){'use strict';var indexedDB=indexedDB||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(!indexedDB){return;}
function _initStorage(options){var _this=this;this._dbInfo=$.extend({db:null},options);var promise=$.Deferred();(function(){var _this=this;var dbInfo=this._dbInfo;var openreq=indexedDB.open(dbInfo.name,dbInfo.version);openreq.onerror=function(){promise.reject(openreq.error);};openreq.onsuccess=function(){dbInfo.db=openreq.result;promise.resolve();};openreq.onupgradeneeded=function(){var names=openreq.result.objectStoreNames;var length,key;var indexOf=([]).indexOf;if(indexOf.call(names,'cache')>-1){openreq.result.deleteObjectStore('cache');}
if(indexOf.call(names,'datasource')>-1){openreq.result.deleteObjectStore('datasource');}
if(indexOf.call(names,'thumbnail')>-1){openreq.result.deleteObjectStore('thumbnail');}
if(indexOf.call(names,'buffer')===-1){openreq.result.createObjectStore('buffer');}
openreq.result.createObjectStore('datasource');openreq.result.createObjectStore('thumbnail');for(var i=0,len=localStorage.length;i<len;i++){key=localStorage.key(i);if(key.indexOf('workSpacePicStorageEnable')===0){localStorage.removeItem(key);}}};}).call(this);}
function length(callback){var _this=this;var promise=$.Deferred();try{(function(){var dbInfo=_this._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,'readonly').objectStore(dbInfo.storeName);var req=store.count();req.onsuccess=function(){promise.resolve(req.result);};req.onerror=function(){promise.reject(req.error);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function getItem(key,callback){var _this=this;if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,'readonly').objectStore(dbInfo.storeName);var req=store.get(key);req.onsuccess=function(){var value=req.result;value=value===undefined?null:value;promise.resolve(value);};req.onerror=function(){promise.reject(req.error);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function getItemList(keyList,callback){var result={};var promise=this.iterate(function(key,value,i){if(keyList.indexOf(key)>-1){result[key]=value;}}).then(function(){return result;},function(){console.warn('getItemList error!');});excuteCallback(promise,callback);return promise;}
function setItem(key,value,callback){var _this=this;if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
var promise=$.Deferred();try{(function(){var dbInfo=_this._dbInfo;var transaction=dbInfo.db.transaction(dbInfo.storeName,'readwrite');var store=transaction.objectStore(dbInfo.storeName);var req=store.put(value,key);transaction.oncomplete=function(){promise.resolve();};transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;promise.reject(err);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function setItemList(kvList,callback){var promise=$.Deferred();try{(function(){var _this=this;var dbInfo=this._dbInfo;var transaction=dbInfo.db.transaction(dbInfo.storeName,'readwrite');var store=transaction.objectStore(dbInfo.storeName);var result={};kvList.forEach(function(kv,i){var key=kv.key,value=kv.value;if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
store.put(value,key);});transaction.oncomplete=function(){promise.resolve();};transaction.onabort=transaction.onerror=function(){var err=transaction.error;promise.reject(err);};}).call(this);}catch(e){console.warn('setItemList error!');promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function removeItem(key,callback){var _this=this;if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var transaction=dbInfo.db.transaction(dbInfo.storeName,'readwrite');var store=transaction.objectStore(dbInfo.storeName);var req=store.delete(key);transaction.oncomplete=function(){promise.resolve();};transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;promise.reject(err);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function removeItemList(keyList,callback){var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var transaction=dbInfo.db.transaction(dbInfo.storeName,'readwrite');var store=transaction.objectStore(dbInfo.storeName);var req=store.openCursor();req.onsuccess=function(){var cursor=req.result;var request;if(!cursor){promise.resolve();return;}
if(keyList.indexOf(cursor.key)>-1){cursor.delete();}
cursor.continue();};req.onerror=function(err){promise.reject(err);};}).call(this);}catch(e){promise.reject();}
excuteCallback(promise,callback);return promise;}
function clear(callback){var _this=this;var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var transaction=dbInfo.db.transaction(dbInfo.storeName,'readwrite');var store=transaction.objectStore(dbInfo.storeName);var req=store.clear();transaction.oncomplete=function(){promise.resolve();};transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;promise.reject(err);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function key(n,callback){var _this=this;var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,'readonly').objectStore(dbInfo.storeName);var req=store.openCursor();var advanced=false;req.onsuccess=function(){var cursor=req.result;if(!cursor){promise.resolve(null);return;}
if(n===0){promise.resolve(cursor.key);}else{if(!advanced){advanced=true;cursor.advance(n);}else{promise.resolve(cursor.key);}}};req.onerror=function(){promise.reject(req.error);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function keys(callback){var _this=this;var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,'readonly').objectStore(dbInfo.storeName);var keys=[];var req=store.openCursor();req.onsuccess=function(){var cursor=req.result;if(!cursor){promise.resolve(keys);return;}
keys.push(cursor.key);cursor.continue();};req.onerror=function(){promise.reject(req.error);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function iterate(iterator,callback){var _this=this;var promise=$.Deferred();try{(function(){var dbInfo=this._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,'readonly').objectStore(dbInfo.storeName);var req=store.openCursor();var index=0;req.onsuccess=function(){var cursor=req.result;var result;if(!cursor){promise.resolve();return;}
result=iterator(cursor.key,cursor.value,index++);if(result===false){promise.resolve();return;}
cursor.continue();};req.onerror=function(){promise.reject(req.error);};}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function excuteCallback(promise,callback){if(typeof callback==='function'){promise.then(function(result){callback(null,result);},function(error){callback(erro);});}}
var indexDBWrapper={_driver:'indexedDBWrapper',_initStorage:_initStorage,length:length,getItem:getItem,getItemList:getItemList,setItem:setItem,setItemList:setItemList,removeItem:removeItem,removeItemList:removeItemList,clear:clear,key:key,keys:keys,iterate:iterate};this.Beop=this.Beop||{};this.Beop.cache=this.Beop.cache||{};this.Beop.cache.drivers=this.Beop.cache.drivers||{};this.Beop.cache.drivers.indexedDB=indexDBWrapper;}).call(this);(function($){'use strict';var localStorage;try{if(!this.localStorage||!('setItem'in this.localStorage)){return;}
localStorage=this.localStorage;}catch(e){return;}
function _initStorage(options){this._dbInfo=$.extend({},options);this._dbInfo.keyPrefix=this._dbInfo.name+'/';}
function length(callback){var _this=this;var promise=this.keys().then(function(keys){return keys.length;});excuteCallback(promise,callback);return promise;}
function getItem(key,callback){var _this=this;if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
var promise=$.Deferred();(function(){var result;result=localStorage.getItem(this._dbInfo.keyPrefix+key);try{result=JSON.parse(result);}catch(e){}
promise.resolve(result);}).call(this);excuteCallback(promise,callback);return promise;}
function getItemList(keyList,callback){var _this=this;var promise=$.Deferred();(function(){var result={};keyList.forEach(function(key,i){if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
result[key]=localStorage.getItem(_this._dbInfo.keyPrefix+key);try{result[key]=JSON.parse(result[key]);}catch(e){}});promise.resolve(result);}).call(this);excuteCallback(promise,callback);return promise;}
function setItem(key,value,callback){if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
var promise=$.Deferred();(function(){var _this=this;var result;try{try{value=JSON.stringify(value);}catch(e){}
result=localStorage.setItem(_this._dbInfo.keyPrefix+key,value);promise.resolve(result);}catch(e){result=null;if(e.name==='QuotaExceededError'||e.name==='NS_ERROR_DOM_QUOTA_REACHED'){promise.reject(e);return;}
promise.reject(e);}}).call(this);excuteCallback(promise,callback);return promise;}
function setItemList(kvList,callback){var promise=$.Deferred();(function(){var _this=this;var result={};kvList.forEach(function(kv,i){var value;if(typeof kv.key!=='string'){console.warn('The key is not a string!');kv.key=String(kv.key);}
try{try{value=JSON.stringify(kv.value);}catch(e){value=kv.value;}
result[kv.key]=localStorage.setItem(_this._dbInfo.keyPrefix+kv.key,value);}catch(e){console.warn('occur error when set data into storage [key: "'+kv.key+'", value: "'+kv.value+'"]');result[kv.key]=null;if(e.name==='QuotaExceededError'||e.name==='NS_ERROR_DOM_QUOTA_REACHED'){promise.reject(e);return;}}});promise.resolve();}).call(this);excuteCallback(promise,callback);return promise;}
function removeItem(key,callback){if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
var promise=$.Deferred();try{(function(){localStorage.removeItem(this._dbInfo.keyPrefix+key);promise.resolve();}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function removeItemList(keyList,callback){var promise=$.Deferred();try{(function(){var _this=this;keyList.forEach(function(key,i){if(typeof key!=='string'){console.warn('The key is not a string!');key=String(key);}
localStorage.removeItem(_this._dbInfo.keyPrefix+key);});promise.resolve();}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function clear(callback){var _this=this;var promise=$.Deferred();try{(function(){var keyPrefix=this._dbInfo.keyPrefix;var key;for(var i=localStorage.length-1;i>=0;i--){key=localStorage.key(i);if(key.indexOf(keyPrefix)===0){localStorage.removeItem(key);}}
promise.resolve();}).call(this);}catch(e){proimse.reject(e);}
excuteCallback(promise,callback);return promise;}
function key(n,callback){var _this=this;var promise=$.Deferred();(function(){var result;result=localStorage.key(n);if(result){result=result.substring(_this._dbInfo.keyPrefix.length);}
promise.resolve(result);}).call(this);excuteCallback(promise,callback);return promise;}
function keys(callback){var _this=this;var promise=$.Deferred();(function(){var keyPrefix=this._dbInfo.keyPrefix;var length=localStorage.length;var keys=[],key;for(var i=0;i<length;i++){key=localStorage.key(i);if(key.indexOf(keyPrefix)===0){keys.push(key.substring(keyPrefix.length));}}
promise.resolve(keys);}).call(this);excuteCallback(promise,callback);return promise;}
function iterate(iterator,callback){var _this=this;var promise=$.Deferred();try{(function(){var keyPrefix=this._dbInfo.keyPrefix;var key,value;var result;for(var i=localStorage.length-1;i>=0;i--){key=localStorage.key(i);if(key.indexOf(keyPrefix)===0){value=localStorage.getItem(key);try{value=JSON.parse(value);}catch(e){}
result=iterator(key.substring(keyPrefix.length),value,i);}
if(result===false){break;}}
promise.resolve();}).call(this);}catch(e){promise.reject(e);}
excuteCallback(promise,callback);return promise;}
function excuteCallback(promise,callback){if(typeof callback==='function'){promise.then(function(result){callback(null,result);},function(error){callback(erro);});}}
var localStorageWrapper={_driver:'localStorageWrapper',_initStorage:_initStorage,length:length,getItem:getItem,getItemList:getItemList,setItem:setItem,setItemList:setItemList,removeItem:removeItem,removeItemList:removeItemList,clear:clear,key:key,keys:keys,iterate:iterate};this.Beop=this.Beop||{};this.Beop.cache=this.Beop.cache||{};this.Beop.cache.drivers=this.Beop.cache.drivers||{};this.Beop.cache.drivers.localStorage=localStorageWrapper;}).call(this,jQuery);(function($){function BaseCache(options){this.options=$.extend({},DEFAULTS,options);this.storage=Object.create(Beop.cache.drivers[this.options.driver]);this.init();}
BaseCache.prototype.init=function(){this.storage._initStorage(this.options);};BaseCache.prototype.length=function(){return this.storage.length();};BaseCache.prototype.key=function(n,callback){return this.storage.key(n,callback);};BaseCache.prototype.keys=function(callback){return this.storage.keys(callback);};BaseCache.prototype.getItem=function(key,callback){return this.storage.getItem(key,callback);};BaseCache.prototype.getItemList=function(keyList,callback){return this.storage.getItemList(keyList,callback);};BaseCache.prototype.setItem=function(key,value,callback){return this.storage.setItem(key,value,callback);};BaseCache.prototype.setItemList=function(kvList,callback){return this.storage.setItemList(kvList,callback);};BaseCache.prototype.removeItem=function(key,callback){return this.storage.removeItem(key,callback);};BaseCache.prototype.removeItemList=function(keyList,callback){return this.storage.removeItemList(keyList,callback);};BaseCache.prototype.clear=function(callback){return this.storage.clear(callback);};BaseCache.prototype.iterate=function(iterator,callback){return this.storage.iterate(iterator,callback);};var DEFAULTS={dbType:'localStorage',name:'beopcache',version:3};this.Beop=this.Beop||{};this.Beop.cache=this.Beop.cache||{};this.Beop.cache.BaseCache=BaseCache;}).call(this,jQuery);var EventAdapter=(function(){var eventData,eventStatus;function EventAdapter($){}
EventAdapter.on=function(){var eventTarget,eventType,eventFunction,eventSelector,eventHmt,finalFunction;if(arguments.length<3||arguments.length>5){console.log('EventAdapter.on arguments.length error');return;}
if(typeof arguments[0]!='object'){console.log('EventAdapter.on arguments[0] type error');return;}else{if(!(arguments[0]instanceof jQuery)){eventTarget=jQuery(arguments[0]);}else{eventTarget=arguments[0];}}
if(typeof arguments[1]!='string'){console.log('EventAdapter.on arguments[1] type error');return;}else{eventType=arguments[1];}
if(typeof arguments[2]=='function'){eventFunction=arguments[2];eventSelector=null;eventHmt=arguments[3]}else if(typeof arguments[2]=='string'){if(arguments[3]&&typeof arguments[3]=='function'){eventSelector=arguments[2];eventFunction=arguments[3];eventHmt=arguments[4]}else{console.log('EventAdapter.on arguments[2 or 3] type error');return;}}
finalFunction=function(e){if(!(eventHmt===false)){EventAdapter.analyse(e,eventType,eventHmt);}
eventFunction.call(this,e);};if(!AppConfig.isMobile){eventTarget.on(eventType,eventSelector,finalFunction)}else{switch(eventType){case'click':eventTarget.on('touchstart',eventSelector,finalFunction);break;case'dragstart':eventTarget.on('touchstart',eventSelector,function(e){mobileDragStart.call(this,e,eventTarget,finalFunction)});break;case'dragover':$(document).on('touchmove.drag',eventSelector,function(e){mobileDragOver.call(this,e,eventTarget,finalFunction)});break;case'dragleave':$(document).on('touchmove.drag',eventSelector,function(e){mobileDragLeave.call(this,e,eventTarget,finalFunction)});break;case'drop':$(document).on('touchend.drop',eventSelector,function(e){mobileDrop.call(this,e,eventTarget,finalFunction)});break;default:eventTarget.on(eventType,eventSelector,finalFunction);break;}}
return eventTarget;};EventAdapter.off=function(){if((arguments.length>3||arguments.length<1)||(arguments[0]&&typeof arguments[1]!='string')){console.log('EventAdapter.off arguments error');return;}
var eventTarget,eventType,eventSelector;if(!(arguments[0]instanceof jQuery)){eventTarget=jQuery(arguments[0]);}else{eventTarget=arguments[0];}
if(arguments.length==1){eventTarget.off();return eventTarget;}
if(typeof arguments[1]=='string'){eventType=arguments[1]}else{console.log('EventAdapter.off eventType Error');return}
if(typeof arguments[2]=='string'){eventSelector=arguments[2];}else{eventSelector=null;}
if(!AppConfig.isMobile){eventTarget.off(eventType,eventSelector)}else{switch(eventType){case'click':eventTarget.off('touchstart',eventSelector);break;case'dragstart':eventTarget.draggable('destroy');break;case'dragover':eventTarget.droppable('destroy');break;case'dragleave':eventTarget.droppable('destroy');break;case'drop':eventTarget.droppable('destroy');break;default:eventTarget.off(eventType,eventSelector);break;}}
return eventTarget;};$.fn.extend({'eventOn':function(){var eventTarget,eventType,eventFunction,eventSelector,eventHmt,finalFunction;if(arguments.length<2||arguments.length>4){console.log('EventAdapter.on arguments.length error');return;}
if(typeof this!='object'){console.log('EventAdapter.on arguments[0] type error');return;}else{if(!(this instanceof jQuery)){eventTarget=jQuery(arguments[0]);}else{eventTarget=this;}}
if(typeof arguments[0]!='string'){console.log('EventAdapter.on arguments[1] type error');return;}else{eventType=arguments[0];}
if(typeof arguments[1]=='function'){eventFunction=arguments[1];eventSelector=null;eventHmt=arguments[2]}else if(typeof arguments[1]=='string'){if(arguments[2]&&typeof arguments[2]=='function'){eventSelector=arguments[1];eventFunction=arguments[2];eventHmt=arguments[3]}else{console.log('EventAdapter.on arguments[2 or 3] type error');return;}}
finalFunction=function(e){if(!(eventHmt===false)){EventAdapter.analyse(e,eventType,eventHmt);}
eventFunction.call(this,e);};if(!AppConfig.isMobile){eventTarget.on(eventType,eventSelector,finalFunction)}else{switch(eventType){case'click':eventTarget.on('touchstart',eventSelector,finalFunction);break;case'dragstart':mobileDragStart(eventTarget,eventSelector,finalFunction);break;case'dragover':mobileDragOver(eventTarget,eventSelector,finalFunction);break;case'dragleave':mobileDragLeave(eventTarget,eventSelector,finalFunction);break;case'drop':mobileDrop(eventTarget,eventSelector,finalFunction);break;default:eventTarget.on(eventType,eventSelector,finalFunction);break;}}
return eventTarget;},'eventOff':function(){if((arguments.length>2)||(arguments[0]&&typeof arguments[0]!='string')){console.log('EventAdapter.off arguments error');return;}
var eventTarget,eventType,eventSelector;if(!(this instanceof jQuery)){eventTarget=jQuery(this);}else{eventTarget=this;}
if(arguments.length==0){eventTarget.off();return eventTarget;}
if(typeof arguments[0]=='string'){eventType=arguments[0];}else{console.log('EventAdapter.off eventType Error');return}
if(typeof arguments[1]=='string'){eventSelector=arguments[1];}else{eventSelector=null;}
if(!AppConfig.isMobile){eventTarget.off(eventType,eventSelector)}else{switch(eventType){case'click':eventTarget.off('touchstart',eventSelector,mobileDragStart);break;case'dragstart':eventTarget.draggable('destroy');break;case'dragover':eventTarget.droppable('destroy');break;case'dragleave':eventTarget.droppable('destroy');break;case'drop':eventTarget.droppable('destroy');break;default:eventTarget.off(eventType,eventSelector);break;}}
return eventTarget;}});EventAdapter.setData=function(date){if(date==undefined)return;eventData=date;};EventAdapter.getData=function(){return eventData;};document.addEventListener('drop',function(){eventData=null;},false);document.addEventListener('touchend',function(){eventData=null;},false);EventAdapter.clearEvent=function(){$(document).off('touchmove.copy');$(document).off('touchmove.drag');$(document).off('touchend.drop');};EventAdapter.analyse=function(e,eventType,hmtInfo){var mainInfo='',initArrTag,finalArrTag,tag,unitTag;var target=$(e.currentTarget);if(hmtInfo instanceof Array&&hmtInfo[0]){mainInfo=judgeWay(hmtInfo[0]);initArrTag=hmtInfo.filter(function(ele,index){return index>0&&ele!='';});finalArrTag=[];for(var i=0;i<initArrTag.length;i++){unitTag=judgeWay(initArrTag[i]);if(unitTag=='')continue;finalArrTag.push(unitTag)}
tag=finalArrTag.join('-');}else{if(hmtInfo!=undefined){mainInfo=judgeWay(hmtInfo);}else{mainInfo=getInfo(target);}
mainInfo=mainInfo?mainInfo:'';tag=mainInfo;}
_hmt.push(['_trackEvent',mainInfo.substr(0,30),eventType,'user-'+(AppConfig.userId?AppConfig.userId:0)+'/project-'+(AppConfig.projectId?AppConfig.projectId:0)]);function getInfo(tar){if(tar.length==0)return;var tarInfo;if(tar.attr('id')){tarInfo=tar.attr('id');}else if(tar.attr('i18n')){tarInfo=tar.attr('i18n');}else if(tar.attr('title')){tarInfo=tar.attr('title');}else{tarInfo=tar[0].innerText.replace(/^\s\s*/,'').replace(/\s\s*$/,'').substr(0,30);}
return tarInfo;}
function judgeWay(arg){if(typeof arg=='undefined'){return'';}
if(arg instanceof Function){return arg.call(this,e)}else if(typeof arg=='string'){if(arg=='text'){return e.currentTarget.innerText.replace(/^\s\s*/,'').replace(/\s\s*$/,'').substr(0,30)}else{return $(e.currentTarget).attr(arg)?$(e.currentTarget).attr(arg):arg;}}else if(typeof arg=='number'){return arg;}}};var mobileDragStart=function(e,target,eventFunction){var originalTarget=$(e.target).closest('[draggable="true"]')[0];var ev=e.type=='touchstart'?e.originalEvent.touches[0]:e,startPos={left:$(originalTarget).css('left'),top:$(originalTarget).css('top'),zIndex:$(originalTarget).css('z-index')},disX=originalTarget.offsetWidth/2,disY=originalTarget.offsetHeight/2;var $copyTarget=$(originalTarget).clone();$copyTarget.data('startPos',startPos);$copyTarget.css('z-index',10000);$copyTarget.css('position','absolute');$copyTarget.css('opacity','0.5');$copyTarget.css('pointer-events','none');var $container=$('body');$container.append($copyTarget);var sPos=$(originalTarget)[0].getBoundingClientRect();$copyTarget.css('left',sPos.left-$container[0].offsetLeft+'px');$copyTarget.css('top',sPos.top-$container[0].offsetTop+'px');$copyTarget[0].cssText=originalTarget.cssText;$copyTarget.css('width',originalTarget.offsetWidth);$copyTarget.css('height',originalTarget.offsetHeight);eventStatus='dragStart';eventFunction.call(this,ev);$(document).off('touchend.copy').on('touchend.copy',function(e){$copyTarget.remove();eventStatus='dragEnd';});$(document).on('touchmove.copy',function(e){eventStatus='dragMove';var ev=e.type=='touchmove'?e.originalEvent.touches[0]:e;var $parent=$copyTarget.offsetParent();$parent=$parent.is(':root')?$(window):$parent;var targetLeft=ev.pageX-disX;var targetTop=ev.pageY-disY;$copyTarget.css({left:targetLeft+'px',top:targetTop+'px','z-index':10000});})};var mobileDragOver=function(e,target,eventFunction){if(eventStatus!='dragMove'&&eventStatus!='dragMoveIn'&&eventStatus!='dragMoveOut')return;var ev=e.type=='touchmove'?e.originalEvent.touches[0]:e;var targetWidth,targetHeight;for(var i=0;i<target.length;i++){targetWidth=target[i].offsetWidth;targetHeight=target[i].offsetHeight;if((target.eq(i).offset().left<ev.pageX&&target.eq(i).offset().left+targetWidth>ev.pageX)&&(target.eq(i).offset().top<ev.pageY&&target.eq(i).offset().top+targetHeight>ev.pageY)){e.target=target[i];e.currentTarget=target[i];eventStatus='dragMoveIn';eventFunction.call(this,e);break;}}};var mobileDragLeave=function(e,target,eventFunction){if(eventStatus!='dragMoveIn')return;var ev=e.type=='touchmove'?e.originalEvent.touches[0]:e;var targetWidth,targetHeight;for(var i=0;i<target.length;i++){targetWidth=target[i].offsetWidth;targetHeight=target[i].offsetHeight;if(!((target.eq(i).offset().left<ev.pageX&&target.eq(i).offset().left+targetWidth>ev.pageX)&&(target.eq(i).offset().top<ev.pageY&&target.eq(i).offset().top+targetHeight>ev.pageY))){e.target=target[i];e.currentTarget=target[i];eventStatus='dragMoveOut';eventFunction.call(this,e);}}};var mobileDragEnd=function(e,target,eventFunction){eventFunction.call(this,e);};var mobileDrop=function(e,target,eventFunction){if(eventStatus!='dragMove'&&eventStatus!='dragMoveIn')return;var ev=e.type=='touchend'?e.originalEvent.changedTouches[0]:e;var eventTarget=target;var targetWidth,targetHeight;for(var i=0;i<target.length;i++){targetWidth=target[i].offsetWidth;targetHeight=target[i].offsetHeight;if((target.eq(i).offset().left<ev.pageX&&target.eq(i).offset().left+targetWidth>ev.pageX)&&(target.eq(i).offset().top<ev.pageY&&target.eq(i).offset().top+targetHeight>ev.pageY)){e.target=target[i];e.currentTarget=target[i];eventFunction.call(this,e);break;}}};return EventAdapter;})(jQuery);﻿
var Internationalization=(function(){function Internationalization(lang,resource){this.type=lang||localStorage["language"];this.resource=resource||{};}
Internationalization.prototype={getResource:function(){return this.resource;},fillPage:function(){this.fill2($('[i18n]'));},fillArea:function(element){this.fill2(element.find('[i18n]'));try{Permission.check(element);}catch(e){console.log('check permission failed:'+e);}},fillAreaAttribute:function(element,attributeName){this.fill(element.find('[i18n]['+attributeName+']'),attributeName);},fill:function(arrElement,attributeName){for(var i=0,arrPath,text,len=arrElement.length;i<len;i++){arrPath=arrElement[i].attributes["i18n"].value.split('.');text=this.resource;for(var j=0;j<arrPath.length;j++){text=text&&text[arrPath[j]];}
if(!attributeName){arrElement[i].innerHTML=text;}
else{arrElement[i].setAttribute(attributeName,text);}}},getI18nValue:function(i18nKey){if(!i18nKey){return'';}
var arrPath=i18nKey.split('.');var text=this.resource;for(var j=0;j<arrPath.length;j++){text=text&&text[arrPath[j]];}
return text;},fill2:function(arrElement){for(var i=0,len=arrElement.length;i<len;i++){var i18nValue=arrElement[i].attributes["i18n"];var items=i18nValue.value.split(';'),item,attrMap;for(var j=0;j<items.length;j++){item=items[j];if(!item){continue;}
if(item.indexOf('=')===-1){i18nValue=this.getI18nValue(item);arrElement[i].innerHTML=i18nValue;}else{attrMap=item.split('=');if(!attrMap[0]){continue;}
arrElement[i].setAttribute(attrMap[0],this.getI18nValue(attrMap[1]));}}}},findContent:function(strPath){var arrPath=strPath.split('.');var text=this.resource;for(var i=0,len=arrPath.length;i<len;i++){text=text&&text[arrPath[i]];}
return text;}};return Internationalization;})();function InitI18nResource(strLanguage,isForce,filePath){if(!strLanguage){strLanguage=localStorage["isUserSelectedLanguage"]||navigator.language.split('-')[0];}
if(isForce){localStorage["isUserSelectedLanguage"]=strLanguage;}else if(localStorage["isUserSelectedLanguage"]){strLanguage=localStorage["isUserSelectedLanguage"];}
filePath=filePath||'/static/views/js/i18n/';return $.ajax({async:false,url:filePath+strLanguage+".js",dataType:"script"}).then(function(){localStorage["language"]=strLanguage;return i18n_resource;},function(){return $.ajax({async:false,url:filePath+"en.js",dataType:'script'}).then(function(){localStorage["language"]="en";return i18n_resource;},function(){console.warn('i18n files loading failed!');return{};});});}
var ElScreenContainer=document.getElementById('indexMain');var SpinnerContainer=document.getElementById('divSpinner');var AlertContainer=document.getElementById('divAlert');var ScreenCurrent=undefined;var ScreenPrevious=undefined;var Spinner=new LoadingSpinner({color:'#00FFFF'});var AppConfig={userId:undefined,account:undefined,isMobile:true,roomId:undefined,roomInit:true,};var roomAll=undefined;var mapConfig={};var curRoom=undefined;var spaceAll=undefined;var ctrAll=undefined;var sensorAll=undefined;var I18n=undefined;var i18n_resource=undefined;var BomConfig={};var appConfigManager=(function(){var DEFAULT_CONFIG={gps:0};function get(){var options=window.localStorage.getItem('appConfig');if(options===null){set(DEFAULT_CONFIG);return DEFAULT_CONFIG;}
try{options=JSON.parse(options);}catch(e){}
return options;}
function set(options){window.localStorage.setItem('appConfig',JSON.stringify(options));}
return{get:get,set:set}}());$(document).ready(function(){if(navigator.userAgent.match(/iP(ad|hone|od)|Android/i))AppConfig.isMobile=true;InitI18nResource(AppConfig.language,null,'static/app/temperatureControl/views/i18n/').always(function(rs){I18n=new Internationalization(null,rs);Init();});});document.addEventListener('deviceready',onDeviceReady,false);function onDeviceReady(){navigator.splashscreen&&navigator.splashscreen.hide();AppConfig.device=device;document.addEventListener("backbutton",router.back,false);document.addEventListener("offline",function(){window.plugins.toast.show('网络连接不可能，部分功能可能受影响','short','bottom');},false);document.addEventListener("online",function(){window.plugins.toast.show('网络已连接','short','bottom');},false);}
var IndexScreen=(function(){function IndexScreen(){}
IndexScreen.prototype={show:function(){var _this=this;_this.time=60;if(localStorage.getItem('beopHost')){AppConfig.host=localStorage.getItem('beopHost')}else{AppConfig.host='http://beop.rnbtech.com.hk'}
if(localStorage.getItem('userInfo')&&typeof JSON.parse(localStorage.userInfo).name!='undefined'&&JSON.parse(localStorage.userInfo).name!='undefined'){_this.initNav();_this.login(true);}else{_this.loginLoad();}
if(!BomConfig.height){BomConfig.height=$(window).height()+'px';}},loginLoad:function(){var _this=this;$.ajax({url:'static/app/inputApp/views/admin/login.html'}).done(function(resultHTML){$('#indexMain').empty().html(resultHTML);I18n.fillArea($('#indexMain'));_this.init();$('#registerPerson').off('touchstart').on('touchstart',function(){WebAPI.get('/static/app/inputApp/views/admin/register.html').done(function(result){$('#indexMain').empty().html(result);I18n.fillArea($('#indexMain'));_this.veriCode();});});});},close:function(){document.onkeydown=false;this.time=null;},init:function(){var _this=this;$(ElScreenContainer).css({'height':'100%','top':0});$('#topBlank').hide();_this.initNav();_this.initLogin();},initLogin:function(){var _this=this;$("#btnLogin").off('tap').on('tap',function(e){_this.login();});$(document).on("keydown","#divLogin input",function(event){var e=event||window.event||arguments.callee.caller.arguments[0];if(e&&e.keyCode==13){_this.login();}});},veriResponse:function(dom,callback){var _this=this;if(_this.time==0){dom.html("<button id='repeatGetVeri' i18n='admin.index.REPEAT_SEND'>重新发送</button>");_this.time=60;callback();}else{dom.html("<span i18n='admin.index.REPEAT_SEND'>重新发送</span><label>( "+_this.time+" )</label>");_this.time--;setTimeout(function(){_this.veriResponse(dom,callback);},1000)}
I18n.fillArea(dom);},veriCode:function(){var _this=this;var $veriCode=$('#veriCode');$(".userAgree").off('touchstart').on('touchstart',function(){WebAPI.get('/static/app/inputApp/views/admin/agreement.html').done(function(result){$('#indexMain').empty().html(result);I18n.fillArea($('#indexMain'));}).done(function(){$('#btnBack','.navTop').off('touchstart').on('touchstart',function(e){WebAPI.get('/static/app/inputApp/views/admin/register.html').done(function(result){$('#indexMain').empty().html(result);I18n.fillArea($('#indexMain'));_this.veriCode();});});});})
$('#isAgree').off('click').click(function(){if($(this).hasClass('selective')){$(this).removeClass('selective');$veriCode.attr('disabled','disabled');}else{$(this).addClass('selective');$veriCode.removeAttr('disabled');}});$('.loginPerson').off('click').click(function(){_this.loginLoad();});$('.deletePass').off('click').click(function(){$('#userPassword').val('');});$('#veriPage').find('.sexList ').off('click').click(function(){var $this=$(this);if(!$this.hasClass('optionActive')){$this.addClass('optionActive').siblings('span').removeClass('optionActive');}});$veriCode.off('click').click(function(){var mobileNum=$('#userNum').val();var reg=/^1[3|4|5|8][0-9]\d{4,8}$/;var $wrongInfo=$('#wrongInfo');if(mobileNum==""){new Alert($wrongInfo,"danger",I18n.resource.admin.index.NUM_INFO).show(1000).close();return;}
if(mobileNum.length!=11){new Alert($wrongInfo,"danger",I18n.resource.admin.index.NUM_ERROR_INFO).show(1000).close();return;}
if(!reg.test(mobileNum)||isNaN(mobileNum)){new Alert($wrongInfo,"danger",I18n.resource.admin.index.NUM_REPEAT_INTER).show(1000).close();return;}
WebAPI.post('/user/checknewphone',{phone:mobileNum}).then(function(result){if(result.data===true){$('#vericodePage').hide();$('#veriPage').show();$('#userVeriCode').val('');$('#userPassword').val('');_this.veriResponse($('.repeatGet'),repeatVeri);function repeatVeri(){$('#repeatGetVeri').off('click').click(function(){_this.veriResponse($('.repeatGet'),repeatVeri);WebAPI.post('/user/checknewphone',{phone:mobileNum}).then(function(result){}).always(function(){$('#submitRegister').removeAttr('disabled');})});}
$('#submitRegister').off('click').click(function(){var $this=$(this);$this.attr('disabled','disabled');var userVeriCode=$('#userVeriCode').val();var userPassword=$('#userPassword').val();var $wrongInfot=$('#wrongInfot');var sexSelectVal=$('.optionActive').attr('data-value');if(userVeriCode===''||userPassword===''){new Alert($wrongInfot,"danger",I18n.resource.admin.index.NUM_ELEVEN).show(1000).close();$this.removeAttr('disabled');return;}
if(userPassword.length<6){new Alert($wrongInfot,"danger",I18n.resource.admin.index.PASS_INFO).show(1000).close();$this.removeAttr('disabled');return;}
WebAPI.post('/user/adduserbyphone',{phone:mobileNum,password:userPassword,code:userVeriCode,sex:sexSelectVal}).then(function(resultData){if(resultData.data){WebAPI.post("/login",{name:mobileNum,pwd:userPassword,agent:jscd?jscd:{}}).then(function(login_result){try{var after_login=function(){CssAdapter.adapter({bottom:false});if(login_result.status!=undefined&&login_result.status==true){AppConfig.userId=login_result.id;AppConfig.account=$("#userName").val();router.empty().to({typeClass:ProjectSel});$('#topBlank').show();}else{loginFail(I18n.resource.admin.index.USER_INFO);}}}catch(e){loginFail(I18n.resource.admin.index.LOGIN_ERROR);return false;}
after_login();}).always(function(){Spinner.stop();$this.removeAttr('disabled');})}else{new Alert($wrongInfot,"danger",I18n.resource.admin.index.VERI_INFO).show(1000).close();}}).always(function(){$this.removeAttr('disabled');})});}else{$wrongInfo.show();new Alert($wrongInfo,"danger",I18n.resource.admin.index.REGISTER_INFO).show(1000).close();}});});},initLanguage:function(){I18n.fillArea($('#divAppDashboardLanguage'));I18n.fillArea($('#divLoginInfo'));$("#selectLanguage a").off('click').click(function(e){InitI18nResource(e.currentTarget.attributes.value.value,true).always(function(rs){I18n=new Internationalization(null,rs);Init();});e.preventDefault();});},login:function(isRestorePwd){var _this=this;SpinnerControl.show();var loginFail=function(msg){$('.alert').remove();new Alert($("#divAlert"),"danger",msg).show().close();SpinnerControl.hide();localStorage.removeItem('userInfo')
router.empty().to({typeClass:IndexScreen});};if(isRestorePwd){var userName=JSON.parse(localStorage.userInfo).name,password=JSON.parse(localStorage.userInfo).pwd;}else{var $btnLogin=$('#btnLogin');var userName=$("#userName").val(),password=$("#password").val();this.rememberPwd();if(!(userName||password)){loginFail(I18n.resource.admin.index.USER_INFO);return;}}
WebAPI.post("/login",{name:userName,pwd:password,agent:jscd?jscd:{}}).then(function(login_result){try{var after_login=function(){CssAdapter.adapter();$('#topBlank').show();if(login_result.status!=undefined&&login_result.status==true){AppConfig.userId=login_result.id;AppConfig.account=$("#userName").val();router.empty().to({typeClass:ObserverScreen,data:{}});}else{loginFail(I18n.resource.admin.index.USER_INFO);}}}catch(e){loginFail(I18n.resource.admin.index.LOGIN_ERROR);return false;}
after_login();}).always(function(){Spinner.stop();}).fail(function(){if(navigator.connection&&navigator.connection.type=='none'){window.plugins&&window.plugins.toast.show(I18n.resource.admin.index.CHECH_INFO,'short','center');}else{window.plugins&&window.plugins.toast.show(I18n.resource.admin.index.MECINE_INFO,'short','center');}
SpinnerControl.hide();localStorage.removeItem('userInfo');router.empty().to({typeClass:IndexScreen});})},rememberPwd:function(){localStorage["userInfo"]=JSON.stringify({name:$("#userName").val(),pwd:$("#password").val()});},restorePwd:function(){if(localStorage["userInfo"]){var data=JSON.parse(localStorage["userInfo"]);if(data.pwd&&data.pwd!=""){$("#userName").val(data.name);$("#password").val(data.pwd);}}},initNav:function(){$('#btnBack','#navTop').off('touchstart').on('touchstart',function(e){router.back();});$('#btnConfig','#navBottom').off('touchstart').on('touchstart',function(e){router.to({typeClass:AdminConfigure});e.preventDefault();});$('#btnRoomSel','#navBottom').off('touchstart').on('touchstart',function(e){router.to({typeClass:ProjectSel});e.preventDefault();});}}
return IndexScreen;})();function Init(){ScreenManager.show(IndexScreen);i18n_resource={error:{token:{0:'身份凭证有效',1:'未登录',2:'身份凭证无效',3:'身份凭证过期',4:'无效的用户'},relogin:'请重新登录',noPermission:'您没有权限访问。'}}}
var ObserverScreen=(function(){var _this;var timer;ObserverScreen.navOptions={top:'<span id="roomName" class="topNavTitle">设备开关</span><span class="topNavRight zepto-ev" id="btnConfig">\
              <span class="iconfont icon-shezhi glyphicon glyphicon-cog" aria-hidden="true"></span>\
              <ul style="display:none;"><li id="liConfig">注销</li></ul></span>',bottom:true,backDisable:false};function ObserverScreen(){_this=this;_this.fileStorage=undefined;}
ObserverScreen.prototype={show:function(){_this.fileStorage=new FileStorage('BeopPtImport');WebAPI.get('static/app/inputApp/views/screen/observerScreen.html').done(function(resultHTML){$('#indexMain').html(resultHTML);_this.init();});},init:function(){var allEquipment=[{"name":"1#地源热泵","attr":[{"point":"GSHP401_GSHPOnOff","name":"运行状态","enum":{"0":"开启","1":"关闭"},"isSticked":true},{"point":"GSHP401_GSHPVoltage","name":"实际电压","unit":"V"},{"point":"GSHP401_GSHPCurrent","name":"实际电流","unit":"A"},{"point":"GSHP401_GSHPPower","name":"功率","unit":"kW"},{"point":"GSHP401_GSHPElecUse","name":"用电量","unit":"kWh"},{"point":"GSHP401_GSHPEnterCondTemp","name":"冷凝器进水温度","unit":"℃"},{"point":"GSHP401_GSHPLeaveCondTemp","name":"冷凝器出水温度","unit":"℃"},{"point":"GSHP401_GSHPEnterEvapTemp","name":"蒸发器进水温度","unit":"℃"},{"point":"GSHP401_GSHPLeaveEvapTemp","name":"蒸发器出水温度","unit":"℃"},{"point":"GSHP401_GSHPChWTempSupplySetPoint","name":"冷水温度设定","unit":"℃"}]},{"name":"2#地源热泵","attr":[{"point":"GSHP402_GSHPOnOff","name":"运行状态","enum":{"0":"开启","1":"关闭"},"isSticked":true},{"point":"GSHP402_GSHPVoltage","name":"实际电压","unit":"V"},{"point":"GSHP402_GSHPCurrent","name":"实际电流","unit":"A"},{"point":"GSHP402_GSHPPower","name":"功率","unit":"kW"},{"point":"GSHP402_GSHPElecUse","name":"用电量","unit":"kWh"},{"point":"GSHP402_GSHPEnterCondTemp","name":"冷凝器进水温度","unit":"℃"},{"point":"GSHP402_GSHPLeaveCondTemp","name":"冷凝器出水温度","unit":"℃"},{"point":"GSHP402_GSHPEnterEvapTemp","name":"蒸发器进水温度","unit":"℃"},{"point":"GSHP402_GSHPLeaveEvapTemp","name":"蒸发器出水温度","unit":"℃"},{"point":"GSHP402_GSHPChWTempSupplySetPoint","name":"冷水温度设定","unit":"℃"}]},{"name":"3#地源热泵","attr":[{"point":"GSHP403_GSHPOnOff","name":"运行状态","enum":{"0":"开启","1":"关闭"},"isSticked":true},{"point":"GSHP403_GSHPVoltage","name":"实际电压","unit":"V"},{"point":"GSHP403_GSHPCurrent","name":"实际电流","unit":"A"},{"point":"GSHP403_GSHPPower","name":"功率","unit":"kW"},{"point":"GSHP403_GSHPElecUse","name":"用电量","unit":"kWh"},{"point":"GSHP403_GSHPEnterCondTemp","name":"冷凝器进水温度","unit":"℃"},{"point":"GSHP403_GSHPLeaveCondTemp","name":"冷凝器出水温度","unit":"℃"},{"point":"GSHP403_GSHPEnterEvapTemp","name":"蒸发器进水温度","unit":"℃"},{"point":"GSHP403_GSHPLeaveEvapTemp","name":"蒸发器出水温度","unit":"℃"},{"point":"GSHP403_GSHPChWTempSupplySetPoint","name":"冷水温度设定","unit":"℃"}]},{"name":"1#空调侧循环泵","attr":[{"point":"Pump401_PumpOnOff","name":"运行状态","enum":{"0":"开启","1":"关闭"},"isSticked":true},{"point":"Pump401_PumpCurrent","name":"实际电流","unit":"A"},{"point":"Pump401_PumpReturnP","name":"进水压力","unit":"bar"},{"point":"Pump401_PumpSupplyP","name":"出水压力","unit":"bar"},{"point":"Pump401_PumpReturnT","name":"进水温度","unit":"℃"},{"point":"Pump401_PumpSupplyT","name":"出水温度","unit":"℃"}]},{"name":"2#空调侧循环泵","attr":[{"point":"Pump402_PumpOnOff","name":"运行状态","enum":{"0":"开启","1":"关闭"},"isSticked":true},{"point":"Pump402_PumpCurrent","name":"实际电流","unit":"A"},{"point":"Pump402_PumpReturnP","name":"进水压力","unit":"bar"},{"point":"Pump402_PumpSupplyP","name":"出水压力","unit":"bar"},{"point":"Pump402_PumpReturnT","name":"进水温度","unit":"℃"},{"point":"Pump402_PumpSupplyT","name":"出水温度","unit":"℃"}]},{"name":"3#空调侧循环泵","attr":[{"point":"Pump403_PumpOnOff","name":"运行状态","enum":{"0":"开启","1":"关闭"},"isSticked":true},{"point":"Pump403_PumpCurrent","name":"实际电流","unit":"A"},{"point":"Pump403_PumpReturnP","name":"进水压力","unit":"bar"},{"point":"Pump403_PumpSupplyP","name":"出水压力","unit":"bar"},{"point":"Pump403_PumpReturnT","name":"进水温度","unit":"℃"},{"point":"Pump403_PumpSupplyT","name":"出水温度","unit":"℃"}]},{"name":"4#空调侧循环泵","attr":[{"point":"Pump404_PumpOnOff","name":"运行状态","enum":{"0":"开启","1":"关闭"},"isSticked":true},{"point":"Pump404_PumpVSDFreq","name":"频率","unit":"Hz"},{"point":"Pump404_PumpCurrent","name":"实际电流","unit":"A"},{"point":"Pump404_PumpReturnP","name":"进水压力","unit":"bar"},{"point":"Pump404_PumpSupplyP","name":"出水压力","unit":"bar"},{"point":"Pump404_PumpReturnT","name":"进水温度","unit":"℃"},{"point":"Pump404_PumpSupplyT","name":"出水温度","unit":"℃"}]},{"name":"1#地埋侧循环泵","attr":[{"point":"Pump405_PumpOnOff","name":"运行状态","enum":{"0":"开启","1":"关闭"},"isSticked":true},{"point":"Pump405_PumpCurrent","name":"实际电流","unit":"A"},{"point":"Pump405_PumpReturnP","name":"进水压力","unit":"bar"},{"point":"Pump405_PumpSupplyP","name":"出水压力","unit":"bar"},{"point":"Pump405_PumpReturnT","name":"进水温度","unit":"℃"},{"point":"Pump405_PumpSupplyT","name":"出水温度","unit":"℃"}]},{"name":"2#地埋侧循环泵","attr":[{"point":"Pump406_PumpOnOff","name":"运行状态","enum":{"0":"开启","1":"关闭"},"isSticked":true},{"point":"Pump406_PumpCurrent","name":"实际电流","unit":"A"},{"point":"Pump406_PumpReturnP","name":"进水压力","unit":"bar"},{"point":"Pump406_PumpSupplyP","name":"出水压力","unit":"bar"},{"point":"Pump406_PumpReturnT","name":"进水温度","unit":"℃"},{"point":"Pump406_PumpSupplyT","name":"出水温度","unit":"℃"}]},{"name":"3#地埋侧循环泵","attr":[{"point":"Pump407_PumpOnOff","name":"运行状态","enum":{"0":"开启","1":"关闭"},"isSticked":true},{"point":"Pump407_PumpCurrent","name":"实际电流","unit":"A"},{"point":"Pump407_PumpReturnP","name":"进水压力","unit":"bar"},{"point":"Pump407_PumpSupplyP","name":"出水压力","unit":"bar"},{"point":"Pump407_PumpReturnT","name":"进水温度","unit":"℃"},{"point":"Pump407_PumpSupplyT","name":"出水温度","unit":"℃"}]},{"name":"4#地埋侧循环泵","attr":[{"point":"Pump408_PumpOnOff","name":"运行状态","enum":{"0":"开启","1":"关闭"},"isSticked":true},{"point":"Pump408_PumpVSDFreq","name":"频率","unit":"Hz"},{"point":"Pump408_PumpCurrent","name":"实际电流","unit":"A"},{"point":"Pump408_PumpReturnP","name":"进水压力","unit":"bar"},{"point":"Pump408_PumpSupplyP","name":"出水压力","unit":"bar"},{"point":"Pump408_PumpReturnT","name":"进水温度","unit":"℃"},{"point":"Pump408_PumpSupplyT","name":"出水温度","unit":"℃"}]},{"name":"空调侧分水器","attr":[{"point":"distributor401_SupplyT","name":"供水温度","unit":"℃"},{"point":"distributor401_SupplyP","name":"供水压力","unit":"bar"}]},{"name":"地埋侧分水器","attr":[{"point":"distributor402_SupplyT","name":"供水温度","unit":"℃"},{"point":"distributor402_SupplyP","name":"供水压力","unit":"bar"}]},{"name":"空调侧集水器","attr":[{"point":"collector401_ReturnT","name":"回水温度","unit":"℃"},{"point":"collector401_ReturnP","name":"回水压力","unit":"bar"}]},{"name":"地埋侧集水器","attr":[{"point":"collector402_ReturnT","name":"回水温度","unit":"℃"},{"point":"collector402_ReturnP","name":"回水压力","unit":"bar"}]},{"name":"地源回水","attr":[{"point":"GsReturnT401_ThermalMeterReading","name":"热计量表读数","unit":"GJ"}]},{"name":"季节模式","attr":[{"point":"GSHP401_SeasonMode","name":"季节模式","enum":{"0":"冬季","1":"夏季"},"isSticked":true}]}];var tpl='';for(var i=0;i<allEquipment.length;i++){tpl+='<li class="zepto-ev" data-name="'+allEquipment[i].name+'"><span class="equipmentName">'+allEquipment[i].name+'</span>';if(allEquipment[i].attr[0].isSticked){tpl+='<button type="button" class="btn btn-xs btn-success btnSticked zepto-ev" data-point="'+allEquipment[i].attr[0].point+'">运行状态</button><ul class="parameterList" style="display:none;">';for(var j=1;j<allEquipment[i].attr.length;j++){tpl+='<li data-point='+allEquipment[i].attr[j].point+'><span class="parameterName">'+allEquipment[i].attr[j].name+'</span><input type="number"><span class="spanUnit" style="float:right;">'+allEquipment[i].attr[j].unit+'</span></li>';}
tpl+='</ul></li>';}else{tpl+='<ul class="parameterList" style="display:none;">';for(var j=0;j<allEquipment[i].attr.length;j++){tpl+='<li data-point='+allEquipment[i].attr[j].point+'><span class="parameterName">'+allEquipment[i].attr[j].name+'</span><input type="number"><span class="spanUnit" style="float:right;">'+allEquipment[i].attr[j].unit+'</span></li>';}
tpl+='</ul></li>';}}
$('#divAllEquipment ul').append(tpl);$('#indexMain').height($('#indexMain').height()+$('#divSummit').height());$('#divAllEquipment .parameterList li input').off().focus(function(){$(this).select();});_this.navBottom();},navBottom:function(){$('#divAllEquipment li .equipmentName').off('click').on('click',function(){$(this).parent().children('.parameterList').toggle();if($(this).parent().hasClass('liCheck')){$(this).parent().removeClass('liCheck');$(this).parent().siblings().show();$('#indexMain').height($('#indexMain').height()+$('#divSummit').height());}else{$(this).parent().addClass('liCheck');$(this).siblings('.parameterList').children('li').find('input');$(this).parent().siblings().removeClass('liCheck');$(this).parent().siblings().children('.parameterList').hide();$(this).parent().siblings().hide();$('#indexMain').height($('#indexMain').height()-$('#divSummit').height());}
if($('.liCheck').length===0){$('#divSummit').hide();}else{$('#divSummit').show();}
$('#divSummit .spanSummit').off('click').on('click',function(){var $liCheck=$('.liCheck');var valueList=$liCheck.find('.parameterList').children('li');var pointArr=[];var valueArr=[];for(var i=0;i<valueList.length;i++){if($(valueList[i]).children('input').val()===''){continue;}else{valueArr.push($(valueList[i]).children('input').val());}
pointArr.push($(valueList[i]).attr('data-point'));}
var optRead={'deviceInfo':{name:'dotInputPara.json',url:'tuanbo',}}
var dataFromFile=_this.fileStorage.read(optRead);var data=dataFromFile?dataFromFile:{projId:200,point:pointArr,value:valueArr}
var optWrite={'deviceInfo':{name:'dotInputPara.json',url:'tuanbo',data:data}}
Spinner.spin($('#indexMain')[0]);_this.fileStorage.write(optWrite);WebAPI.post("/set_realtimedata_from_site",data).done(function(){window.plugins&&window.plugins.toast.show('设备参数上传成功','short','center');}).always(function(){$liCheck.find('.parameterList').hide();Spinner.stop();$('#divSummit').hide();$liCheck.siblings().show();$liCheck.removeClass('liCheck');$('#indexMain').height($('#indexMain').height()+$('#divSummit').height());})});$('#divSummit .spanCancel').off('click').on('click',function(){var $liCheck=$('.liCheck');$liCheck.children('.parameterList').hide();$liCheck.siblings().show();$liCheck.removeClass('liCheck');$('#divSummit').hide();$('#indexMain').height($('#indexMain').height()+$('#divSummit').height());})})
$('#btnConfig').off('click').on('click',function(){$('#btnConfig ul').toggle(function(){$('#liConfig').off('click').on('click',function(){localStorage.clear('userInfo');router.empty().to({typeClass:IndexScreen})});});})
$('.btnSticked').off('click').on('click',function(){var $current=$(this);var pointCName=$(this).parent('li').attr('data-name');var pointEName=$(this).attr('data-point');if(pointCName==='季节模式'){$('#divStickedModal .radio:first label').children('span').text('冬季');$('#divStickedModal .radio:last label').children('span').text('夏季');}else{$('#divStickedModal .radio:first label').children('span').text('开启');$('#divStickedModal .radio:last label').children('span').text('关闭');}
$('#divStickedModal').show(function(){$('.radio').find('input').prop('checked',false);$('.stickedTitle').children('button').off('click').on('click',function(){$('#divStickedModal').hide();$('#divContent').show();$('#divStickedSummit').hide();});$('.radio').off('click').on('click',function(){var $inputCheck=$(this).find('input');$('#divContent').hide();$('#divStickedSummit').show();$('.stickedTitle>span').text('选择'+$(this).children('label').text()+'状态');$('#divStickedSummit .btnSummit').off('click').on('click',function(){var optRead={'deviceInfo':{name:'dotInputPara.json',url:'tuanbo'}}
var dataFromFile=_this.fileStorage.read(optRead);var data=dataFromFile?dataFromFile:{projId:200,point:[pointEName],value:[parseInt($inputCheck.val())]}
var optWrite={'deviceInfo':{name:'dotInputPara.json',url:'tuanbo',data:data}}
_this.fileStorage.write(optWrite);WebAPI.post("/set_realtimedata_from_site",data).done(function(){$('#divStickedModal').hide();$('#divStickedSummit').hide();$('#divContent').show();$('.stickedTitle>span').text('请选择运行状态');window.plugins&&window.plugins.toast.show('运行状态改变成功！','short','center');}).always(function(){})});$('#divStickedSummit .btnCancel').off('click').on('click',function(){$('#divStickedSummit').hide();$('#divContent').show();})});});})},close:function(){_this.fileStorage=null;}};return ObserverScreen;})();var parameterList=(function(){var _this;parameterList.navOptions={top:'<span id="roomName" class="topNavTitle">设备名称</span>',bottom:true,backDisable:false};function parameterList(){_this=this;}
parameterList.prototype={show:function(){WebAPI.get('/static/app/inputApp/views/screen/parameterList.html').done(function(resultHTML){$('#indexMain').html(resultHTML);_this.init();});}}
return parameterList;})();
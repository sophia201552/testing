#coding=utf-8
__author__ = "angelia"

from ExpertContainer.logic.LogicBase import LogicBase
from datetime import datetime
import pytest
from tests.utils import *


@pytest.mark.p0
@pytest.mark.parametrize(("projId", "pointList", "timeStart", "timeEnd", "timePeriod","expected"),[
    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-09-01 23:00:00","2017-09-01 23:05:00","m5",
     [[23.33, 23.33], [1, 1]]
     ),
    (72, ["VAV_J_54_18_Room Temp", "VAV_J_54_14_Air Flow"],"2017-09-01 23:00:00","2017-09-01 23:05:00","m5",
     [[26.45, 26.45], [49.57, 49.46]]
     ),
    (72, ["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-09-01 23:00:00","2017-09-01 23:05:00","m5",
     [[0, 0], [99.78, 99.79]]
     ),
    (72, "VAV_F_12_17_RoomTemp_realdr","2017-09-01 23:00:00","2017-09-01 23:05:00","m5",
     [100, 100]
     ),
    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-09-01 23:00:00","2017-09-01 23:30:00","m5",
     [[23.33, 23.33, 23.33, 23.33, 23.33, 23.33, 23.33], [1, 1, 1, 1, 1, 1, 1]]
     ),
    (72, ["VAV_J_54_18_Room Temp", "VAV_J_54_14_Air Flow"],"2017-09-01 23:00:00","2017-09-01 23:30:00","m5",
     [[26.45, 26.45, 26.47, 26.5, 26.47, 26.5, 26.5], [49.57, 49.46, 49.45, 49.77, 49.81, 49.46, 49.68]]
     ),
    (72, ["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-09-01 23:00:00","2017-09-01 23:30:00","m5",
     [[0, 0, 0, 0, 0, 0, 0], [99.78, 99.79, 99.79, 99.79, 99.79, 99.79, 99.78]]
     ),
    (72, "VAV_F_12_17_RoomTemp_realdr","2017-09-01 23:00:00","2017-09-01 23:30:00","m5",
     [100, 100, 100, 100, 100, 100, 100]
     ),
    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-09-01 00:00:00","2017-09-01 01:00:00","h1",
     [[25.58, 25.35],  [1, 1]]
     ),
    (72, ["VAV_J_54_18_Room Temp", "VAV_J_54_14_Air Flow"],"2017-09-01 00:00:00","2017-09-01 01:00:00","h1",
     [[26.89, 26.99], [49.88, 50.22]]
     ),
    (72, ["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-09-01 00:00:00","2017-09-01 01:00:00","h1",
     [[0, 0], [99.79, 99.79]]
     ),
    (72, "VAV_F_12_17_RoomTemp_realdr","2017-09-01 00:00:00","2017-09-01 01:00:00","h1",
     [100, 100]
     ),
    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-09-01 23:00:00","2017-09-02 23:00:00","h1",
     [
        [
            23.33, 23.33, 23.33, 23.33, 23.33, 23.33, 23.33, 23.33, 23.1, 23.1, 24.45, 22.88, 24.45, 22.99,
            24.11, 24.33, 21.87, 22.65, 22.65, 21.98, 24.22, 22.32, 23.77, 26.38, 26.6
        ],
        [
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
        ],
     ]
     ),
    (72, ["VAV_J_54_18_Room Temp", "VAV_J_54_14_Air Flow"],"2017-09-01 23:00:00","2017-09-02 23:00:00","h1",
     [
        [
            26.45, 26.55, 26.64, 26.69, 26.77, 26.79, 26.84, 26.87, 26.89, 26.96, 27.19,
            27.11, 27.01, 27.01, 26.96, 26.94, 26.94, 26.94, 26.94, 26.92, 26.87, 26.84, 26.84, 26.92, 26.99
        ],
        [
            49.57, 49.49, 49.63, 49.84, 50.07, 50.15, 50.24, 50.14, 50.38, 50.37, 50.39, 50.86, 50.72,
            50.47, 50.93, 50.99, 50.55, 50.67, 51.37, 51.22, 50.57, 50.71, 51.38, 51.01, 50.46
        ],
     ]
     ),
    (72, ["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-09-01 23:00:00","2017-09-02 23:00:00","h1",
     [
         [
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
         ],
         [
            99.78, 99.79, 99.79, 99.78, 99.79, 99.79, 99.78, 99.79, 99.78, 99.78, 99.79, 99.78,
            99.79, 99.78, 99.79, 99.78, 99.79, 99.79, 99.79, 99.79, 99.79, 99.78, 99.78, 99.79, 99.79
         ]
     ]
     ),
    (72, "VAV_F_12_17_RoomTemp_realdr","2017-09-01 23:00:00","2017-09-02 23:00:00","h1",
     [
         100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100
     ]
     ),
    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-09-01 23:00:00","2017-09-02 23:00:00","d1",
     [[23.33, 26.6], [1, 1]]
     ),
    (72, ["VAV_J_54_18_Room Temp", "VAV_J_54_14_Air Flow"],"2017-09-01 23:00:00","2017-09-02 23:00:00","d1",
     [[26.45, 26.99], [49.57, 50.46]]
     ),
    (72, ["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-09-01 23:00:00","2017-09-02 23:00:00","d1",
     [[0, 0], [99.78, 99.79]]
     ),
    (72, "VAV_F_12_17_RoomTemp_realdr","2017-09-01 23:00:00","2017-09-02 23:00:00","d1",
     [100, 100]
     ),
    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-08-01 23:00:00","2017-09-03 23:00:00","d1",
     [
        [
            15.71, 24, 24.11, 24.56, 24.78, 27.84, 26.94, 26.27, 25.01, 25.47, 22.99, 21.2, 25.58, 22.09,
            24.22, 23.55, 23.55, 23.55, 24.67, 26.04, 24.22, 22.43, 23.89, 24.56, 24.22, 24.11, 24.67, 24,
            23.77, 22.09, 25.12, 23.33, 26.6, 22.77
        ],
        [
            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
        ],
     ]
     ),
    (72, ["VAV_J_54_18_Room Temp", "VAV_J_54_14_Air Flow"],"2017-08-01 23:00:00","2017-09-03 23:00:00","d1",
     [
        [
            27.31, 26.99, 27.41, 26.87, 26.77, 24.34, 26.72, 27.06, 27.04, 27.61, 27.36, 27.04, 26.25,
            27.14, 27.36, 26.99, 26.74, 26.72, 26.82, 27.36, 26.1, 26.87, 27.21, 27.66, 27.31, 26.96,
            26.82, 27.76, 27.11, 26.67, 26.79, 26.45, 26.99, 26.18
        ],
        [
            51.55, 51.38, 52.19, 49.4, 50.67, 63.84, 51.07, 50.76, 50.27, 50.72, 50.45, 50.13, 49.01, 49.54,
            50.44, 50.39, 49.38, 50.3, 50.43, 51.44, 49.62, 49.51, 50.29, 50.49, 50.43, 50.34, 49.69, 50.92,
            50.41, 50.27, 49.71, 49.57, 50.46, 49.27
        ],
     ]
     ),
    (72, ["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-08-01 23:00:00","2017-09-03 23:00:00","d1",
     [
         [
             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
         ],
         [
            100, 100, 99.77, 99.83, 99.86, 99.89, 99.9, 99.83, 99.85, 99.86, 99.81, 99.83, 99.84, 99.85, 99.77,
            99.78, 99.8, 99.81, 99.75, 99.76, 99.77, 99.78, 99.79, 99.79, 99.79, 99.79, 99.79, 99.79, 99.83,
            99.79, 99.79, 99.78, 99.79, 99.79
         ]
     ]
     ),
    (72, "VAV_F_12_17_RoomTemp_realdr","2017-08-01 23:00:00","2017-09-03 23:00:00","d1",
     [
         100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100,
         100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100
     ]
     ),
    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-08-03 23:00:00","2017-09-03 23:00:00","M1",
     [[25.58, 25.58], [1, 1]]
     ),
    (72, ["VAV_J_54_18_Room Temp", "VAV_J_54_14_Air Flow"],"2017-08-03 23:00:00","2017-09-03 23:00:00","M1",
     [[27.46, 26.89], [51.58, 49.88]]
     ),
    (72, ["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-08-03 23:00:00","2017-09-03 23:00:00","M1",
     [[0, 0], [99.91, 99.79]]
     ),
    (72, "VAV_F_12_17_RoomTemp_realdr","2017-08-03 23:00:00","2017-09-03 23:00:00","M1",
     [100, 100]
     ),
    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-06-03 23:00:00","2017-09-03 23:00:00","M1",
     [[17.71, 15.37, 25.58, 25.58], [1, 1, 1, 1]]
     ),
    (72, ["VAV_J_54_18_Room Temp", "VAV_J_54_14_Air Flow"],"2017-06-03 23:00:00","2017-09-03 23:00:00","M1",
     [[26.72, 26.72, 27.46, 26.89], [49.12, 49.12, 51.58, 49.88]]
     ),
    (72, ["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-06-03 23:00:00","2017-09-03 23:00:00","M1",
     [[0, 0, 0, 0], [99.88, 99.88, 99.91, 99.79]]
     ),
    (72, "VAV_F_12_17_RoomTemp_realdr","2017-06-03 23:00:00","2017-09-03 23:00:00","M1",
     [100, 100, 100, 100]
     ),
    (1233, ["Max_OUTDOORTemp_W"], "2017-05-01 00:00:00", "2017-09-20 20:00:33", "M1",
     None
     ),
    ("72", "VAV_F_12_17_RoomTemp_realdr","2017-06-03 23:00:00","2017-09-03 23:00:00","M1",
     [100, 100, 100, 100]
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-07-18 00:00", "2017-07-23 20:00:33", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "1505800454.558458", "2017-07-23 20:00:33", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-07-18 00:00:23", "2017-07-23 :20:00", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-07-23 00:00:23", "2017-07-14 :20:00", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-09-19 00:00:23", "1505802730.722475", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-07-18 00:00", "2017-07-23 :20:00", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "1505800454.558458", "1505802730.722475", "m5",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-01-11 17:00:23", "2017-08-11 19:20:00", "m1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-01-11 17:00:23", "2017-08-11 19:20:00", "m5",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2016-08-11 17:00:23", "2017-08-11 19:20:00", "h1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2015-10-11 17:00:23", "2017-11-10 19:20:00", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2013-10-11 17:00:23", "2017-11-10 19:20:00", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-07-18 00:00:00", "2017-07-23 20:00:33", "D1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-07-18 00:00:00", "2017-07-23 20:00:33", "bgf",
     None
     ),
    (72, [], "2017-07-18 00:00:00", "2017-07-23 20:00:33", "d1",
     None
     ),
    (72, "Max_OUTDOORTemp_W1", "2017-05-01 00:00:00", "2017-09-20 20:00:33", "M1",
     []
     ),
    (72, [""], "2017-05-01 00:00:00", "2017-09-20 20:00:33", "M1",
     ['']
     ),
    (-2, ["Max_OUTDOORTemp_W1"], "2017-05-01 26:69:78", "2017-09-20 35:77:88", "M1",
     None
     ),
])

def test_get_his_data_time_range(projId, pointList, timeStart, timeEnd, timePeriod, expected):
    lb = LogicBase(projId, datetime.now(), nMode = LogicBase.REPAIR_HISTORY)
    if lb:
        rt = lb.get_his_data_time_range(projId, pointList, timeStart, timeEnd, timePeriod)
        equal_result_getHisDataTimeRange(pointList, expected, rt)
    else:
        assert False,"create instance failed"

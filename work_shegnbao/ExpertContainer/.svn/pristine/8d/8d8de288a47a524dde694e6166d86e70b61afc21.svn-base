#coding=utf-8
__author__ = 'angelia'


from ExpertContainer.logic.StrategyBase import StrategyBase
from datetime import datetime
import pytest
from tests.utils import *
from ExpertContainer.dbAccess import mongo_operator


@pytest.mark.p0
@pytest.mark.parametrize(('projId', 'pointList', 'timeStart', 'timeEnd', 'timeFormat', 'expected'),[
    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-09-01 23:00:00","2017-09-01 23:05:00","m5",
     {
        "list":
        [{
            "data": [23.33, 23.33],
            "dsItemId": "A11AHU_A_11_TempSaIn"
        },
        {
            "data": [1, 1],
            "dsItemId": "A14AHU_A_24_VFSA"
        }],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-01 23:05:00"]
    }
     ),
    (72,["VAV_J_54_18_Room_Temp", "VAV_J_54_14_Air_Flow"],"2017-09-01 23:00:00","2017-09-01 23:05:00","m5",
     {
        "list":
            [{
                "data": [26.45, 26.45],
                "dsItemId": "VAV_J_54_18_Room Temp"
            },
            {
                "data": [49.57, 49.46],
                "dsItemId": "VAV_J_54_14_Air Flow"
            }],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-01 23:05:00"]
    }
     ),
    (72,["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-09-01 23:00:00","2017-09-01 23:05:00","m5",
     {
        "list":
            [
                {
                    "data": [0, 0],
                    "dsItemId": "VAV_G_21_05_DTUOffStatus"
                },
                {
                    "data": [99.78, 99.79],
                    "dsItemId": "Water_Pump_SP_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-01 23:05:00"]
    }
     ),
    (72,["VAV_F_12_17_RoomTemp_realdr", "HVAC_KPITotalScore"],"2017-09-01 23:00:00","2017-09-01 23:05:00","m5",
     {
        "list":
            [
                {
                    "data": [100, 100],
                    "dsItemId": "VAV_F_12_17_RoomTemp_realdr"
                },
                {
                    "data": [75, 75],
                    "dsItemId": "HVAC_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-01 23:05:00"]
    }
     ),
    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-09-01 23:00:00","2017-09-01 23:30:00","m5",
     {
        "list":
            [
                {
                    "data": [23.33, 23.33, 23.33, 23.33, 23.33, 23.33, 23.33],
                    "dsItemId": "A11AHU_A_11_TempSaIn"
                },
                {
                    "data": [1, 1, 1, 1, 1, 1, 1],
                    "dsItemId": "A14AHU_A_24_VFSA"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-01 23:05:00", "2017-09-01 23:10:00", "2017-09-01 23:15:00",
                      "2017-09-01 23:20:00", "2017-09-01 23:25:00", "2017-09-01 23:30:00"]
    }
     ),
    (72,["VAV_J_54_18_Room_Temp", "VAV_J_54_14_Air_Flow"],"2017-09-01 23:00:00","2017-09-01 23:30:00","m5",
     {
        "list":
            [
                {
                    "data": [26.45, 26.45, 26.47, 26.5, 26.47, 26.5, 26.5],
                    "dsItemId": "VAV_J_54_18_Room Temp"
                },
                {
                    "data": [49.57, 49.46, 49.45, 49.77, 49.81, 49.46, 49.68],
                    "dsItemId": "VAV_J_54_14_Air Flow"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-01 23:05:00", "2017-09-01 23:10:00", "2017-09-01 23:15:00", "2017-09-01 23:20:00",
                      "2017-09-01 23:25:00", "2017-09-01 23:30:00"]
    }
     ),
    (72,["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-09-01 23:00:00","2017-09-01 23:30:00","m5",
     {
        "list":
            [
                {
                    "data": [0, 0, 0, 0, 0, 0, 0],
                    "dsItemId": "VAV_G_21_05_DTUOffStatus"
                },
                {
                    "data": [99.78, 99.79, 99.79, 99.79, 99.79, 99.79, 99.78],
                    "dsItemId": "Water_Pump_SP_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-01 23:05:00", "2017-09-01 23:10:00", "2017-09-01 23:15:00",
                      "2017-09-01 23:20:00", "2017-09-01 23:25:00", "2017-09-01 23:30:00"]
    }
     ),
    (72,["VAV_F_12_17_RoomTemp_realdr", "HVAC_KPITotalScore"],"2017-09-01 23:00:00","2017-09-01 23:30:00","m5",
     {
        "list":
            [
                {
                    "data": [100, 100, 100, 100, 100, 100, 100],
                    "dsItemId": "VAV_F_12_17_RoomTemp_realdr"
                },
                {
                    "data": [75, 75, 75, 75, 75, 75, 75],
                    "dsItemId": "HVAC_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-01 23:05:00", "2017-09-01 23:10:00", "2017-09-01 23:15:00",
                      "2017-09-01 23:20:00", "2017-09-01 23:25:00", "2017-09-01 23:30:00"]
    }
     ),

    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-09-01 00:00:00","2017-09-01 02:00:00","h1",
     {
        "list":
            [
                {
                    "data": [25.58, 25.35, 25.01],
                    "dsItemId": "A11AHU_A_11_TempSaIn"
                },
                {
                    "data": [1, 1, 1],
                    "dsItemId": "A14AHU_A_24_VFSA"
                }
            ],
        "timeShaft": ["2017-09-01 00:00:00", "2017-09-01 01:00:00", "2017-09-01 02:00:00"]
    }
     ),
    (72,["VAV_J_54_18_Room_Temp", "VAV_J_54_14_Air_Flow"],"2017-09-01 00:00:00","2017-09-01 01:00:00","h1",
     {
        "list":
            [
                {
                    "data": [26.89, 26.99],
                    "dsItemId": "VAV_J_54_18_Room Temp"
                },
                {
                    "data": [49.88, 50.22],
                    "dsItemId": "VAV_J_54_14_Air Flow"
                }
            ],
        "timeShaft": ["2017-09-01 00:00:00", "2017-09-01 01:00:00"]
    }
     ),
    (72,["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-09-01 00:00:00","2017-09-01 01:00:00","h1",
     {
        "list":
            [
                {
                    "data": [0, 0],
                    "dsItemId": "VAV_G_21_05_DTUOffStatus"
                },
                {
                    "data": [99.79, 99.79],
                    "dsItemId": "Water_Pump_SP_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-09-01 00:00:00", "2017-09-01 01:00:00"]
    }
     ),
    (72,["VAV_F_12_17_RoomTemp_realdr", "HVAC_KPITotalScore"],"2017-09-01 00:00:00","2017-09-01 01:00:00","h1",
     {
        "list":
            [
                {
                    "data": [100, 100],
                    "dsItemId": "VAV_F_12_17_RoomTemp_realdr"
                },
                {
                    "data": [75, 75],
                    "dsItemId": "HVAC_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-09-01 00:00:00", "2017-09-01 01:00:00"]
    }
     ),

    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-09-01 23:00:00","2017-09-02 23:00:00","h1",
     {
        "list":
            [
                {
                    "data":
                        [
                            23.33, 23.33, 23.33, 23.33, 23.33, 23.33, 23.33, 23.33, 23.1, 23.1, 24.45, 22.88, 24.45, 22.99,
                            24.11, 24.33, 21.87, 22.65, 22.65, 21.98, 24.22, 22.32, 23.77, 26.38, 26.6
                        ],
                    "dsItemId": "A11AHU_A_11_TempSaIn"
                },
                {
                    "data":
                        [
                            1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
                        ],
                    "dsItemId": "A14AHU_A_24_VFSA"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-02 00:00:00", "2017-09-02 01:00:00", "2017-09-02 02:00:00", "2017-09-02 03:00:00",
                      "2017-09-02 04:00:00", "2017-09-02 05:00:00", "2017-09-02 06:00:00", "2017-09-02 07:00:00", "2017-09-02 08:00:00",
                      "2017-09-02 09:00:00", "2017-09-02 10:00:00", "2017-09-02 11:00:00", "2017-09-02 12:00:00", "2017-09-02 13:00:00",
                      "2017-09-02 14:00:00", "2017-09-02 15:00:00", "2017-09-02 16:00:00", "2017-09-02 17:00:00", "2017-09-02 18:00:00",
                      "2017-09-02 19:00:00", "2017-09-02 20:00:00", "2017-09-02 21:00:00", "2017-09-02 22:00:00", "2017-09-02 23:00:00"]
    }
     ),
    (72,["VAV_J_54_18_Room_Temp", "VAV_J_54_14_Air_Flow"],"2017-09-01 23:00:00","2017-09-02 23:00:00","h1",
     {
        "list":
            [
                {
                    "data": [26.45, 26.55, 26.64, 26.69, 26.77, 26.79, 26.84, 26.87, 26.89, 26.96, 27.19,
                             27.11, 27.01, 27.01, 26.96, 26.94, 26.94, 26.94, 26.94, 26.92, 26.87, 26.84, 26.84, 26.92, 26.99],
                    "dsItemId": "VAV_J_54_18_Room Temp"
                },
                {
                    "data": [49.57, 49.49, 49.63, 49.84, 50.07, 50.15, 50.24, 50.14, 50.38, 50.37, 50.39, 50.86, 50.72,
                             50.47, 50.93, 50.99, 50.55, 50.67, 51.37, 51.22, 50.57, 50.71, 51.38, 51.01, 50.46],
                    "dsItemId": "VAV_J_54_14_Air Flow"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-02 00:00:00", "2017-09-02 01:00:00", "2017-09-02 02:00:00", "2017-09-02 03:00:00",
                      "2017-09-02 04:00:00", "2017-09-02 05:00:00", "2017-09-02 06:00:00", "2017-09-02 07:00:00", "2017-09-02 08:00:00",
                      "2017-09-02 09:00:00", "2017-09-02 10:00:00", "2017-09-02 11:00:00", "2017-09-02 12:00:00", "2017-09-02 13:00:00",
                      "2017-09-02 14:00:00", "2017-09-02 15:00:00", "2017-09-02 16:00:00", "2017-09-02 17:00:00", "2017-09-02 18:00:00",
                      "2017-09-02 19:00:00", "2017-09-02 20:00:00", "2017-09-02 21:00:00", "2017-09-02 22:00:00", "2017-09-02 23:00:00"]
    }
     ),
    (72,["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-09-01 23:00:00","2017-09-02 23:00:00","h1",
     {
        "list":
            [
                {
                    "data": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    "dsItemId": "VAV_G_21_05_DTUOffStatus"
                },
                {
                    "data": [99.78, 99.79, 99.79, 99.78, 99.79, 99.79, 99.78, 99.79, 99.78, 99.78, 99.79, 99.78,
                             99.79, 99.78, 99.79, 99.78, 99.79, 99.79, 99.79, 99.79, 99.79, 99.78, 99.78, 99.79, 99.79],
                    "dsItemId": "Water_Pump_SP_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-02 00:00:00", "2017-09-02 01:00:00", "2017-09-02 02:00:00", "2017-09-02 03:00:00",
                      "2017-09-02 04:00:00", "2017-09-02 05:00:00", "2017-09-02 06:00:00", "2017-09-02 07:00:00", "2017-09-02 08:00:00",
                      "2017-09-02 09:00:00", "2017-09-02 10:00:00", "2017-09-02 11:00:00", "2017-09-02 12:00:00", "2017-09-02 13:00:00",
                      "2017-09-02 14:00:00", "2017-09-02 15:00:00", "2017-09-02 16:00:00", "2017-09-02 17:00:00", "2017-09-02 18:00:00",
                      "2017-09-02 19:00:00", "2017-09-02 20:00:00", "2017-09-02 21:00:00", "2017-09-02 22:00:00", "2017-09-02 23:00:00"]
    }
     ),
    (72,["VAV_F_12_17_RoomTemp_realdr", "HVAC_KPITotalScore"],"2017-09-01 23:00:00","2017-09-02 23:00:00","h1",
     {
        "list":
            [
                {
                    "data": [100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100],
                    "dsItemId": "VAV_F_12_17_RoomTemp_realdr"
                },
                {
                    "data": [75, 75, 68.75, 68.75, 68.75, 68.75, 68.75, 68.75, 68.75, 68.75, 68.75, 68.75, 68.75, 68.75, 68.75, 68.75, 68.75,
                             68.75, 68.75, 68.75, 68.75, 68.75, 68.75, 68.75, 68.75],
                    "dsItemId": "HVAC_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-02 00:00:00", "2017-09-02 01:00:00", "2017-09-02 02:00:00", "2017-09-02 03:00:00", "2017-09-02 04:00:00",
                      "2017-09-02 05:00:00", "2017-09-02 06:00:00", "2017-09-02 07:00:00", "2017-09-02 08:00:00", "2017-09-02 09:00:00", "2017-09-02 10:00:00",
                      "2017-09-02 11:00:00", "2017-09-02 12:00:00", "2017-09-02 13:00:00", "2017-09-02 14:00:00", "2017-09-02 15:00:00", "2017-09-02 16:00:00",
                      "2017-09-02 17:00:00", "2017-09-02 18:00:00", "2017-09-02 19:00:00", "2017-09-02 20:00:00", "2017-09-02 21:00:00", "2017-09-02 22:00:00",
                      "2017-09-02 23:00:00"]
    }
     ),

    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-09-01 23:00:00","2017-09-02 23:00:00","d1",
     {
        "list":
            [
                {
                    "data": [23.33, 26.6],
                    "dsItemId": "A11AHU_A_11_TempSaIn"
                },
                {
                    "data": [1, 1],
                    "dsItemId": "A14AHU_A_24_VFSA"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-02 23:00:00"]
    }
     ),
    (72,["VAV_J_54_18_Room_Temp", "VAV_J_54_14_Air_Flow"],"2017-09-01 23:00:00","2017-09-02 23:00:00","d1",
     {
        "list":
            [
                {
                    "data": [26.45, 26.99],
                    "dsItemId": "VAV_J_54_18_Room Temp"
                },
                {
                    "data": [49.57, 50.46],
                    "dsItemId": "VAV_J_54_14_Air Flow"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-02 23:00:00"]
    }
     ),
    (72,["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-09-01 23:00:00","2017-09-02 23:00:00","d1",
     {
        "list":
            [
                {
                    "data": [0, 0],
                    "dsItemId": "VAV_G_21_05_DTUOffStatus"
                },
                {
                    "data": [99.78, 99.79],
                    "dsItemId": "Water_Pump_SP_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-02 23:00:00"]
    }
     ),
    (72,["VAV_F_12_17_RoomTemp_realdr", "HVAC_KPITotalScore"],"2017-09-01 23:00:00","2017-09-02 23:00:00","d1",
     {
        "list":
            [
                {
                    "data": [100, 100],
                    "dsItemId": "VAV_F_12_17_RoomTemp_realdr"
                },
                {
                    "data": [75, 68.75],
                    "dsItemId": "HVAC_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-09-01 23:00:00", "2017-09-02 23:00:00"]
    }
     ),

    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-08-01 23:00:00","2017-09-03 23:00:00","d1",
     {
        "list":
            [
                {
                    "data": [15.71, 24, 24.11, 24.56, 24.78, 27.84, 26.94, 26.27, 25.01, 25.47, 22.99, 21.2, 25.58, 22.09,
                             24.22, 23.55, 23.55, 23.55, 24.67, 26.04, 24.22, 22.43, 23.89, 24.56, 24.22, 24.11, 24.67, 24,
                             23.77, 22.09, 25.12, 23.33, 26.6, 22.77],
                    "dsItemId": "A11AHU_A_11_TempSaIn"
                },
                {
                    "data": [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                    "dsItemId": "A14AHU_A_24_VFSA"
                }
            ],
        "timeShaft": ["2017-08-01 23:00:00", "2017-08-02 23:00:00", "2017-08-03 23:00:00", "2017-08-04 23:00:00", "2017-08-05 23:00:00",
                      "2017-08-06 23:00:00", "2017-08-07 23:00:00", "2017-08-08 23:00:00", "2017-08-09 23:00:00", "2017-08-10 23:00:00",
                      "2017-08-11 23:00:00", "2017-08-12 23:00:00", "2017-08-13 23:00:00", "2017-08-14 23:00:00", "2017-08-15 23:00:00",
                      "2017-08-16 23:00:00", "2017-08-17 23:00:00", "2017-08-18 23:00:00", "2017-08-19 23:00:00", "2017-08-20 23:00:00",
                      "2017-08-21 23:00:00", "2017-08-22 23:00:00", "2017-08-23 23:00:00", "2017-08-24 23:00:00", "2017-08-25 23:00:00",
                      "2017-08-26 23:00:00", "2017-08-27 23:00:00", "2017-08-28 23:00:00", "2017-08-29 23:00:00", "2017-08-30 23:00:00",
                      "2017-08-31 23:00:00", "2017-09-01 23:00:00", "2017-09-02 23:00:00", "2017-09-03 23:00:00"]
    }
     ),
    (72,["VAV_J_54_18_Room_Temp", "VAV_J_54_14_Air_Flow"],"2017-08-01 23:00:00","2017-09-03 23:00:00","d1",
     {
        "list":
            [
                {
                    "data": [27.31, 26.99, 27.41, 26.87, 26.77, 24.34, 26.72, 27.06, 27.04, 27.61, 27.36, 27.04, 26.25,
                             27.14, 27.36, 26.99, 26.74, 26.72, 26.82, 27.36, 26.1, 26.87, 27.21, 27.66, 27.31, 26.96,
                             26.82, 27.76, 27.11, 26.67, 26.79, 26.45, 26.99, 26.18],
                    "dsItemId": "VAV_J_54_18_Room Temp"
                },
                {
                    "data": [51.55, 51.38, 52.19, 49.4, 50.67, 63.84, 51.07, 50.76, 50.27, 50.72, 50.45, 50.13, 49.01, 49.54,
                             50.44, 50.39, 49.38, 50.3, 50.43, 51.44, 49.62, 49.51, 50.29, 50.49, 50.43, 50.34, 49.69, 50.92,
                             50.41, 50.27, 49.71, 49.57, 50.46, 49.27],
                    "dsItemId": "VAV_J_54_14_Air Flow"
                }
            ],
        "timeShaft": ["2017-08-01 23:00:00", "2017-08-02 23:00:00", "2017-08-03 23:00:00", "2017-08-04 23:00:00", "2017-08-05 23:00:00",
                      "2017-08-06 23:00:00", "2017-08-07 23:00:00", "2017-08-08 23:00:00", "2017-08-09 23:00:00", "2017-08-10 23:00:00",
                      "2017-08-11 23:00:00", "2017-08-12 23:00:00", "2017-08-13 23:00:00", "2017-08-14 23:00:00", "2017-08-15 23:00:00",
                      "2017-08-16 23:00:00", "2017-08-17 23:00:00", "2017-08-18 23:00:00", "2017-08-19 23:00:00", "2017-08-20 23:00:00",
                      "2017-08-21 23:00:00", "2017-08-22 23:00:00", "2017-08-23 23:00:00", "2017-08-24 23:00:00", "2017-08-25 23:00:00",
                      "2017-08-26 23:00:00", "2017-08-27 23:00:00", "2017-08-28 23:00:00", "2017-08-29 23:00:00", "2017-08-30 23:00:00",
                      "2017-08-31 23:00:00", "2017-09-01 23:00:00", "2017-09-02 23:00:00", "2017-09-03 23:00:00"]
    }
     ),
    (72,["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-08-01 23:00:00","2017-09-03 23:00:00","d1",
     {
        "list":
            [
                {
                    "data": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    "dsItemId": "VAV_G_21_05_DTUOffStatus"
                },
                {
                    "data": [100, 100, 99.77, 99.83, 99.86, 99.89, 99.9, 99.83, 99.85, 99.86, 99.81, 99.83, 99.84, 99.85, 99.77,
                             99.78, 99.8, 99.81, 99.75, 99.76, 99.77, 99.78, 99.79, 99.79, 99.79, 99.79, 99.79, 99.79, 99.83,
                             99.79, 99.79, 99.78, 99.79, 99.79],
                    "dsItemId": "Water_Pump_SP_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-08-01 23:00:00", "2017-08-02 23:00:00", "2017-08-03 23:00:00", "2017-08-04 23:00:00", "2017-08-05 23:00:00",
                      "2017-08-06 23:00:00", "2017-08-07 23:00:00", "2017-08-08 23:00:00", "2017-08-09 23:00:00", "2017-08-10 23:00:00",
                      "2017-08-11 23:00:00", "2017-08-12 23:00:00", "2017-08-13 23:00:00", "2017-08-14 23:00:00", "2017-08-15 23:00:00",
                      "2017-08-16 23:00:00", "2017-08-17 23:00:00", "2017-08-18 23:00:00", "2017-08-19 23:00:00", "2017-08-20 23:00:00",
                      "2017-08-21 23:00:00", "2017-08-22 23:00:00", "2017-08-23 23:00:00", "2017-08-24 23:00:00", "2017-08-25 23:00:00",
                      "2017-08-26 23:00:00", "2017-08-27 23:00:00", "2017-08-28 23:00:00", "2017-08-29 23:00:00", "2017-08-30 23:00:00",
                      "2017-08-31 23:00:00", "2017-09-01 23:00:00", "2017-09-02 23:00:00", "2017-09-03 23:00:00"]
    }
     ),
    (72,["VAV_F_12_17_RoomTemp_realdr", "HVAC_KPITotalScore"],"2017-08-01 23:00:00","2017-09-03 23:00:00","d1",
     {
        "list":
            [
                {
                    "data":
                        [100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100,
                         100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100],
                    "dsItemId": "VAV_F_12_17_RoomTemp_realdr"
                },
                {
                    "data": [68.75, 75, 68.75, 68.75, 75, 75, 81.25, 81.25, 81.25, 81.25, 81.25, 81.25, 81.25, 81.25, 81.25,
                             81.25, 81.25, 81.25, 81.25, 81.25, 81.25, 81.25, 81.25, 81.25, 81.25, 87.5, 87.5, 87.5, 87.5, 87.5, 87.5, 75, 68.75, 62.5],
                    "dsItemId": "HVAC_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-08-01 23:00:00", "2017-08-02 23:00:00", "2017-08-03 23:00:00", "2017-08-04 23:00:00", "2017-08-05 23:00:00",
                      "2017-08-06 23:00:00", "2017-08-07 23:00:00", "2017-08-08 23:00:00", "2017-08-09 23:00:00", "2017-08-10 23:00:00",
                      "2017-08-11 23:00:00", "2017-08-12 23:00:00", "2017-08-13 23:00:00", "2017-08-14 23:00:00", "2017-08-15 23:00:00",
                      "2017-08-16 23:00:00", "2017-08-17 23:00:00", "2017-08-18 23:00:00", "2017-08-19 23:00:00", "2017-08-20 23:00:00",
                      "2017-08-21 23:00:00", "2017-08-22 23:00:00", "2017-08-23 23:00:00", "2017-08-24 23:00:00", "2017-08-25 23:00:00",
                      "2017-08-26 23:00:00", "2017-08-27 23:00:00", "2017-08-28 23:00:00", "2017-08-29 23:00:00", "2017-08-30 23:00:00",
                      "2017-08-31 23:00:00", "2017-09-01 23:00:00", "2017-09-02 23:00:00", "2017-09-03 23:00:00"]
    }
     ),

    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-08-03 23:00:00","2017-09-03 23:00:00","M1",
     {
        "list":
            [
                {
                    "data": [25.58, 25.58],
                    "dsItemId": "A11AHU_A_11_TempSaIn"
                },
                {
                    "data": [1, 1],
                    "dsItemId": "A14AHU_A_24_VFSA"
                }
            ],
        "timeShaft": ["2017-08-01 00:00:00", "2017-09-01 00:00:00"]
    }
     ),
    (72,["VAV_J_54_18_Room_Temp", "VAV_J_54_14_Air_Flow"],"2017-08-03 23:00:00","2017-09-03 23:00:00","M1",
     {
        "list":
            [
                {
                    "data": [27.46, 26.89],
                    "dsItemId": "VAV_J_54_18_Room Temp"
                },
                {
                    "data": [51.58, 49.88],
                    "dsItemId": "VAV_J_54_14_Air Flow"
                }
            ],
        "timeShaft": ["2017-08-01 00:00:00", "2017-09-01 00:00:00"]
    }
     ),
    (72,["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-08-03 23:00:00","2017-09-03 23:00:00","M1",
     {
        "list":
            [
                {
                    "data": [0, 0],
                    "dsItemId": "VAV_G_21_05_DTUOffStatus"
                },
                {
                    "data": [99.91, 99.79],
                    "dsItemId": "Water_Pump_SP_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-08-01 00:00:00", "2017-09-01 00:00:00"]
    }
     ),
    (72,["VAV_F_12_17_RoomTemp_realdr", "HVAC_KPITotalScore"],"2017-08-03 23:00:00","2017-09-03 23:00:00","M1",
     {
        "list":
            [
                {
                    "data": [100, 100],
                    "dsItemId": "VAV_F_12_17_RoomTemp_realdr"
                },
                {
                    "data": [68.75, 75],
                    "dsItemId": "HVAC_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-08-01 00:00:00", "2017-09-01 00:00:00"]
    }
     ),

    (72,["A11AHU_A_11_TempSaIn", "A14AHU_A_24_VFSA"],"2017-06-03 23:00:00","2017-09-03 23:00:00","M1",
     {
        "list":
            [
                {
                    "data": [17.71, 15.37, 25.58, 25.58],
                    "dsItemId": "A11AHU_A_11_TempSaIn"
                },
                {
                    "data": [1, 1, 1, 1],
                    "dsItemId": "A14AHU_A_24_VFSA"
                }
            ],
        "timeShaft": ["2017-06-01 00:00:00", "2017-07-01 00:00:00", "2017-08-01 00:00:00", "2017-09-01 00:00:00"]
    }
     ),
    (72,["VAV_J_54_18_Room_Temp", "VAV_J_54_14_Air_Flow"],"2017-06-03 23:00:00","2017-09-03 23:00:00","M1",
     {
        "list":
            [
                {
                    "data": [26.72, 26.72, 27.46, 26.89],
                    "dsItemId": "VAV_J_54_18_Room Temp"
                },
                {
                    "data": [49.12, 49.12, 51.58, 49.88],
                    "dsItemId": "VAV_J_54_14_Air Flow"
                }
            ],
        "timeShaft": ["2017-06-01 00:00:00", "2017-07-01 00:00:00", "2017-08-01 00:00:00", "2017-09-01 00:00:00"]
    }
     ),
    (72,["VAV_G_21_05_DTUOffStatus", "Water_Pump_SP_KPITotalScore"],"2017-06-03 23:00:00","2017-09-03 23:00:00","M1",
     {
        "list":
            [
                {
                    "data": [0, 0, 0, 0],
                    "dsItemId": "VAV_G_21_05_DTUOffStatus"
                },
                {
                    "data": [99.88, 99.88, 99.91, 99.79],
                    "dsItemId": "Water_Pump_SP_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-06-01 00:00:00", "2017-07-01 00:00:00", "2017-08-01 00:00:00", "2017-09-01 00:00:00"]
    }
     ),
    (72,["VAV_F_12_17_RoomTemp_realdr", "HVAC_KPITotalScore"],"2017-06-03 23:00:00","2017-09-03 23:00:00","M1",
     {
        "list":
            [
                {
                    "data": [100, 100, 100, 100],
                    "dsItemId": "VAV_F_12_17_RoomTemp_realdr"
                 },
                {
                    "data": [81.25, 81.25, 68.75, 75],
                    "dsItemId": "HVAC_KPITotalScore"
                }
            ],
        "timeShaft": ["2017-06-01 00:00:00", "2017-07-01 00:00:00", "2017-08-01 00:00:00", "2017-09-01 00:00:00"]
    }
     ),
    (1233, ["Max_OUTDOORTemp_W"], "2017-05-01 00:00:00", "2017-09-20 20:00:33", "M1",
     None
     ),
    ("72", "VAV_F_12_17_RoomTemp_realdr","2017-06-03 23:00:00","2017-09-03 23:00:00","M1",
     {
        "list":
            [
                {
                    "data": [100, 100, 100, 100],
                    "dsItemId": "VAV_F_12_17_RoomTemp_realdr"
                 }
            ],
        "timeShaft": ["2017-06-01 00:00:00", "2017-07-01 00:00:00", "2017-08-01 00:00:00", "2017-09-01 00:00:00"]
    }
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-07-18 00:00", "2017-07-23 20:00:33", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "1505800454.558458", "2017-07-23 20:00:33", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-07-18 00:00:23", "2017-07-23 :20:00", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-07-23 00:00:23", "2017-07-14 :20:00", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-09-19 00:00:23", "1505802730.722475", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-07-18 00:00", "2017-07-23 :20:00", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "1505800454.558458", "1505802730.722475", "m5",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-01-11 17:00:23", "2017-08-11 19:20:00", "m1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-01-11 17:00:23", "2017-08-11 19:20:00", "m5",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2016-08-11 17:00:23", "2017-08-11 19:20:00", "h1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2015-10-11 17:00:23", "2017-11-10 19:20:00", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2013-10-11 17:00:23", "2017-11-10 19:20:00", "d1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-07-18 00:00:00", "2017-07-23 20:00:33", "D1",
     None
     ),
    (72, ["Max_OUTDOORTemp_W"], "2017-07-18 00:00:00", "2017-07-23 20:00:33", "bgf",
     None
     ),
    (72, [], "2017-07-18 00:00:00", "2017-07-23 20:00:33", "d1",
     None
     ),
    (72, "Max_OUTDOORTemp_W1", "2017-05-01 00:00:00", "2017-09-20 20:00:33", "M1",
     {'list': [], 'timeShaft': []}
     ),
    (72, [""], "2017-05-01 00:00:00", "2017-09-20 20:00:33", "M1",
     {'list': [], 'timeShaft': []}
     ),
    (-2, ["Max_OUTDOORTemp_W1"], "2017-05-01 26:69:78", "2017-09-20 35:77:88", "M1",
     None
     )
])
def test_get_his_data_with_time(projId, pointList, timeStart, timeEnd, timeFormat, expected):
    Strb= StrategyBase(projId, datetime.now(), nMode = 1)
    if Strb:
        cloudSitePointsAll = mongo_operator.getCloudPointSiteType(projId)
        Strb.initCloudSitePoints(cloudSitePointsAll)
        rt = Strb.get_his_data_with_time(projId, pointList, timeStart, timeEnd, timeFormat)
        equal_result_getHisDataWithTime(expected, rt)
    else:
        assert False, "create instance failed"

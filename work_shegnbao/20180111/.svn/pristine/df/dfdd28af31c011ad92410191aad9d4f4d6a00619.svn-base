import React from 'react';
import PropTypes from 'prop-types';

import s from './DataSetComponent.css';
const css = (className1, className2 = '') => {
  return className1
    .split(' ')
    .map(v => s[v])
    .concat(className2.split(' '))
    .join(' ')
    .trim();
};
/*
  items               [xx,xx],
  defaultSelectedKeys []
  onSelect            ()=>{}
  isRadio             true/false 是否单选
*/
class DataSetComponent extends React.PureComponent {
  constructor(props) {
    super(props);
    this.state = {
      selectedKeys: new Set()
    };
    this._onSelected = this._onSelected.bind(this);
  }
  componentDidMount() {
    const { defaultSelectedKeys = [] } = this.props;
    if (defaultSelectedKeys !== 'CLEAR') {
      this.setState({
        selectedKeys: new Set(defaultSelectedKeys)
      });
    }

    this.componentWillReceiveProps(this.props);
  }
  componentWillReceiveProps(nextProps) {}
  render() {
    const { items = [], title = '', defaultSelectedKeys } = this.props;
    const { selectedKeys } = this.state;
    return (
      <div className={css('datasetWrap')}>
        <div className={css('title')}>{title}</div>
        <div className={css('content clear')}>
          {items.map(it => {
            let className = 'item';
            if (
              selectedKeys.has(it) ||
              (defaultSelectedKeys == 'CLEAR' &&
                selectedKeys.has(defaultSelectedKeys)) ||
              (defaultSelectedKeys && defaultSelectedKeys.indexOf(it) !== -1)
            ) {
              className += ' active';
            }
            return (
              <div
                key={it}
                className={css(className)}
                onClick={this._onSelected.bind(this, it)}
              >
                {it}
              </div>
            );
          })}
        </div>
      </div>
    );
  }
  _onSelected(id, ev) {
    const { selectedKeys } = this.state;
    const { onSelect = () => {}, isRadio } = this.props;
    let selected = true;
    if (id === 'CLEAR') {
      selectedKeys.clear();
    } else {
      if (selectedKeys.has(id)) {
        //取消选中
        selectedKeys.delete(id);
        selected = false;
      } else {
        //选中
        //多选
        // selectedKeys.clear();
        if (isRadio) {
          selectedKeys.clear();
          selectedKeys.add(id);
        } else {
          selectedKeys.add(id);
        }
      }
    }
    this.setState({
      selectedKeys: new Set(selectedKeys)
    });
    onSelect(Array.from(selectedKeys), {
      selected,
      node: ev.target,
      event: ev
    });
  }
}

DataSetComponent.propTypes = {};

export default DataSetComponent;

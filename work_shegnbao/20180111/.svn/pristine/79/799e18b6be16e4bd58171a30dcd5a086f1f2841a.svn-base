import pytestfrom beopWeb.mod_admin import reportControllersfrom flask import current_appfrom beopWeb.mod_oss.ossapi import *from beopWeb.mod_common.Utils import *import osglobal report_path@pytest.mark.p0@pytest.mark.usefixtures("removeReport")@pytest.mark.parametrize(('name_en','project_id', 'report_folder','version'), [    ('shhuawei',72,'KPIReport','2018-01-15'),])def test_report_detail(name_en,project_id, report_folder,version):    folder = os.getcwd() + '/beopWeb/static/projectReports/reports/{0}/{1}'.format(name_en,report_folder)    global report_path    report_path = folder+'/{version}.html'.format(        project=name_en,        folder=report_folder,        version=version)    #添加上下文环境    if not current_app:        app_ctx = app.app_context()        app_ctx.push()    #生成report内容    os.makedirs(folder)    f = open(report_path, 'w')    message = """    <div style="width: 100%; height: 100%; overflow-x: hidden; overflow-y: hidden;" id="beopReport">	<link rel="stylesheet" href="/static/projectReports/report.css"/>    <div class="step-container col-xs-12 col-md-8 col-md-offset-2 report-block scrollbar">        <div class="step-play-container">            <div class="step-play-list">                    <div class="step-item-container" id="report-unit-1">                        <h1 class="page-header"></h1>                            <div class="report-unit" id="report-unit-1-1">                                    <div class="well well-sm">                                        <h3>summary</h3>                                    </div>                            </div>                    </div>            </div>        </div>    </div></div>    """    f.write(message)    f.close()    rt = reportControllers.report_detail(project_id, report_folder, version)    assert 'summary' in rt,'report_detail fail'@pytest.fixture(scope='function')def removeReport(request):    def fin():        global folder        global report_path        os.remove(report_path)        folder1 = os.getcwd() + '/beopWeb/static/projectReports/reports/shhuawei/KPIReport'        os.rmdir(folder1)        folder2 = os.getcwd() + '/beopWeb/static/projectReports/reports/shhuawei'        os.rmdir(folder2)    request.addfinalizer(fin)